function YI(t,e){for(var n=0;n<e.length;n++){const i=e[n];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in t)){const u=Object.getOwnPropertyDescriptor(i,o);u&&Object.defineProperty(t,o,u.get?u:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerpolicy&&(u.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?u.credentials="include":o.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();var KI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function JI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ft={exports:{}},Zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ld=Symbol.for("react.element"),QI=Symbol.for("react.portal"),eP=Symbol.for("react.fragment"),tP=Symbol.for("react.strict_mode"),nP=Symbol.for("react.profiler"),iP=Symbol.for("react.provider"),rP=Symbol.for("react.context"),sP=Symbol.for("react.forward_ref"),oP=Symbol.for("react.suspense"),aP=Symbol.for("react.memo"),lP=Symbol.for("react.lazy"),Xx=Symbol.iterator;function cP(t){return t===null||typeof t!="object"?null:(t=Xx&&t[Xx]||t["@@iterator"],typeof t=="function"?t:null)}var t2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},n2=Object.assign,i2={};function ou(t,e,n){this.props=t,this.context=e,this.refs=i2,this.updater=n||t2}ou.prototype.isReactComponent={};ou.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ou.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function r2(){}r2.prototype=ou.prototype;function o0(t,e,n){this.props=t,this.context=e,this.refs=i2,this.updater=n||t2}var a0=o0.prototype=new r2;a0.constructor=o0;n2(a0,ou.prototype);a0.isPureReactComponent=!0;var Zx=Array.isArray,s2=Object.prototype.hasOwnProperty,l0={current:null},o2={key:!0,ref:!0,__self:!0,__source:!0};function a2(t,e,n){var i,o={},u=null,f=null;if(e!=null)for(i in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(u=""+e.key),e)s2.call(e,i)&&!o2.hasOwnProperty(i)&&(o[i]=e[i]);var l=arguments.length-2;if(l===1)o.children=n;else if(1<l){for(var b=Array(l),T=0;T<l;T++)b[T]=arguments[T+2];o.children=b}if(t&&t.defaultProps)for(i in l=t.defaultProps,l)o[i]===void 0&&(o[i]=l[i]);return{$$typeof:ld,type:t,key:u,ref:f,props:o,_owner:l0.current}}function uP(t,e){return{$$typeof:ld,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function c0(t){return typeof t=="object"&&t!==null&&t.$$typeof===ld}function hP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Yx=/\/+/g;function Bg(t,e){return typeof t=="object"&&t!==null&&t.key!=null?hP(""+t.key):e.toString(36)}function Qf(t,e,n,i,o){var u=typeof t;(u==="undefined"||u==="boolean")&&(t=null);var f=!1;if(t===null)f=!0;else switch(u){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case ld:case QI:f=!0}}if(f)return f=t,o=o(f),t=i===""?"."+Bg(f,0):i,Zx(o)?(n="",t!=null&&(n=t.replace(Yx,"$&/")+"/"),Qf(o,e,n,"",function(T){return T})):o!=null&&(c0(o)&&(o=uP(o,n+(!o.key||f&&f.key===o.key?"":(""+o.key).replace(Yx,"$&/")+"/")+t)),e.push(o)),1;if(f=0,i=i===""?".":i+":",Zx(t))for(var l=0;l<t.length;l++){u=t[l];var b=i+Bg(u,l);f+=Qf(u,e,n,b,o)}else if(b=cP(t),typeof b=="function")for(t=b.call(t),l=0;!(u=t.next()).done;)u=u.value,b=i+Bg(u,l++),f+=Qf(u,e,n,b,o);else if(u==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function Sf(t,e,n){if(t==null)return t;var i=[],o=0;return Qf(t,i,"","",function(u){return e.call(n,u,o++)}),i}function dP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var yr={current:null},ep={transition:null},fP={ReactCurrentDispatcher:yr,ReactCurrentBatchConfig:ep,ReactCurrentOwner:l0};Zt.Children={map:Sf,forEach:function(t,e,n){Sf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Sf(t,function(){e++}),e},toArray:function(t){return Sf(t,function(e){return e})||[]},only:function(t){if(!c0(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Zt.Component=ou;Zt.Fragment=eP;Zt.Profiler=nP;Zt.PureComponent=o0;Zt.StrictMode=tP;Zt.Suspense=oP;Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fP;Zt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=n2({},t.props),o=t.key,u=t.ref,f=t._owner;if(e!=null){if(e.ref!==void 0&&(u=e.ref,f=l0.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(b in e)s2.call(e,b)&&!o2.hasOwnProperty(b)&&(i[b]=e[b]===void 0&&l!==void 0?l[b]:e[b])}var b=arguments.length-2;if(b===1)i.children=n;else if(1<b){l=Array(b);for(var T=0;T<b;T++)l[T]=arguments[T+2];i.children=l}return{$$typeof:ld,type:t.type,key:o,ref:u,props:i,_owner:f}};Zt.createContext=function(t){return t={$$typeof:rP,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:iP,_context:t},t.Consumer=t};Zt.createElement=a2;Zt.createFactory=function(t){var e=a2.bind(null,t);return e.type=t,e};Zt.createRef=function(){return{current:null}};Zt.forwardRef=function(t){return{$$typeof:sP,render:t}};Zt.isValidElement=c0;Zt.lazy=function(t){return{$$typeof:lP,_payload:{_status:-1,_result:t},_init:dP}};Zt.memo=function(t,e){return{$$typeof:aP,type:t,compare:e===void 0?null:e}};Zt.startTransition=function(t){var e=ep.transition;ep.transition={};try{t()}finally{ep.transition=e}};Zt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Zt.useCallback=function(t,e){return yr.current.useCallback(t,e)};Zt.useContext=function(t){return yr.current.useContext(t)};Zt.useDebugValue=function(){};Zt.useDeferredValue=function(t){return yr.current.useDeferredValue(t)};Zt.useEffect=function(t,e){return yr.current.useEffect(t,e)};Zt.useId=function(){return yr.current.useId()};Zt.useImperativeHandle=function(t,e,n){return yr.current.useImperativeHandle(t,e,n)};Zt.useInsertionEffect=function(t,e){return yr.current.useInsertionEffect(t,e)};Zt.useLayoutEffect=function(t,e){return yr.current.useLayoutEffect(t,e)};Zt.useMemo=function(t,e){return yr.current.useMemo(t,e)};Zt.useReducer=function(t,e,n){return yr.current.useReducer(t,e,n)};Zt.useRef=function(t){return yr.current.useRef(t)};Zt.useState=function(t){return yr.current.useState(t)};Zt.useSyncExternalStore=function(t,e,n){return yr.current.useSyncExternalStore(t,e,n)};Zt.useTransition=function(){return yr.current.useTransition()};Zt.version="18.2.0";(function(t){t.exports=Zt})(ft);const pP=JI(ft.exports);var N_={},om={exports:{}},ts={},l2={exports:{}},c2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(et,wt){var St=et.length;et.push(wt);e:for(;0<St;){var tn=St-1>>>1,nn=et[tn];if(0<o(nn,wt))et[tn]=wt,et[St]=nn,St=tn;else break e}}function n(et){return et.length===0?null:et[0]}function i(et){if(et.length===0)return null;var wt=et[0],St=et.pop();if(St!==wt){et[0]=St;e:for(var tn=0,nn=et.length,nr=nn>>>1;tn<nr;){var ni=2*(tn+1)-1,xi=et[ni],ii=ni+1,ln=et[ii];if(0>o(xi,St))ii<nn&&0>o(ln,xi)?(et[tn]=ln,et[ii]=St,tn=ii):(et[tn]=xi,et[ni]=St,tn=ni);else if(ii<nn&&0>o(ln,St))et[tn]=ln,et[ii]=St,tn=ii;else break e}}return wt}function o(et,wt){var St=et.sortIndex-wt.sortIndex;return St!==0?St:et.id-wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var f=Date,l=f.now();t.unstable_now=function(){return f.now()-l}}var b=[],T=[],C=1,L=null,k=3,X=!1,te=!1,ie=!1,ye=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(et){for(var wt=n(T);wt!==null;){if(wt.callback===null)i(T);else if(wt.startTime<=et)i(T),wt.sortIndex=wt.expirationTime,e(b,wt);else break;wt=n(T)}}function _e(et){if(ie=!1,Q(et),!te)if(n(b)!==null)te=!0,vt(we);else{var wt=n(T);wt!==null&&vi(_e,wt.startTime-et)}}function we(et,wt){te=!1,ie&&(ie=!1,J(Ue),Ue=-1),X=!0;var St=k;try{for(Q(wt),L=n(b);L!==null&&(!(L.expirationTime>wt)||et&&!xt());){var tn=L.callback;if(typeof tn=="function"){L.callback=null,k=L.priorityLevel;var nn=tn(L.expirationTime<=wt);wt=t.unstable_now(),typeof nn=="function"?L.callback=nn:L===n(b)&&i(b),Q(wt)}else i(b);L=n(b)}if(L!==null)var nr=!0;else{var ni=n(T);ni!==null&&vi(_e,ni.startTime-wt),nr=!1}return nr}finally{L=null,k=St,X=!1}}var Ce=!1,Oe=null,Ue=-1,st=5,Xe=-1;function xt(){return!(t.unstable_now()-Xe<st)}function $t(){if(Oe!==null){var et=t.unstable_now();Xe=et;var wt=!0;try{wt=Oe(!0,et)}finally{wt?en():(Ce=!1,Oe=null)}}else Ce=!1}var en;if(typeof W=="function")en=function(){W($t)};else if(typeof MessageChannel<"u"){var Dt=new MessageChannel,ti=Dt.port2;Dt.port1.onmessage=$t,en=function(){ti.postMessage(null)}}else en=function(){ye($t,0)};function vt(et){Oe=et,Ce||(Ce=!0,en())}function vi(et,wt){Ue=ye(function(){et(t.unstable_now())},wt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(et){et.callback=null},t.unstable_continueExecution=function(){te||X||(te=!0,vt(we))},t.unstable_forceFrameRate=function(et){0>et||125<et?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):st=0<et?Math.floor(1e3/et):5},t.unstable_getCurrentPriorityLevel=function(){return k},t.unstable_getFirstCallbackNode=function(){return n(b)},t.unstable_next=function(et){switch(k){case 1:case 2:case 3:var wt=3;break;default:wt=k}var St=k;k=wt;try{return et()}finally{k=St}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(et,wt){switch(et){case 1:case 2:case 3:case 4:case 5:break;default:et=3}var St=k;k=et;try{return wt()}finally{k=St}},t.unstable_scheduleCallback=function(et,wt,St){var tn=t.unstable_now();switch(typeof St=="object"&&St!==null?(St=St.delay,St=typeof St=="number"&&0<St?tn+St:tn):St=tn,et){case 1:var nn=-1;break;case 2:nn=250;break;case 5:nn=1073741823;break;case 4:nn=1e4;break;default:nn=5e3}return nn=St+nn,et={id:C++,callback:wt,priorityLevel:et,startTime:St,expirationTime:nn,sortIndex:-1},St>tn?(et.sortIndex=St,e(T,et),n(b)===null&&et===n(T)&&(ie?(J(Ue),Ue=-1):ie=!0,vi(_e,St-tn))):(et.sortIndex=nn,e(b,et),te||X||(te=!0,vt(we))),et},t.unstable_shouldYield=xt,t.unstable_wrapCallback=function(et){var wt=k;return function(){var St=k;k=wt;try{return et.apply(this,arguments)}finally{k=St}}}})(c2);(function(t){t.exports=c2})(l2);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u2=ft.exports,es=l2.exports;function Ve(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h2=new Set,Bh={};function Ol(t,e){Hc(t,e),Hc(t+"Capture",e)}function Hc(t,e){for(Bh[t]=e,t=0;t<e.length;t++)h2.add(e[t])}var Fo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),U_=Object.prototype.hasOwnProperty,mP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Kx={},Jx={};function gP(t){return U_.call(Jx,t)?!0:U_.call(Kx,t)?!1:mP.test(t)?Jx[t]=!0:(Kx[t]=!0,!1)}function _P(t,e,n,i){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function yP(t,e,n,i){if(e===null||typeof e>"u"||_P(t,e,n,i))return!0;if(i)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function vr(t,e,n,i,o,u,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=u,this.removeEmptyString=f}var Vi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Vi[t]=new vr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Vi[e]=new vr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Vi[t]=new vr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Vi[t]=new vr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Vi[t]=new vr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Vi[t]=new vr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Vi[t]=new vr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Vi[t]=new vr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Vi[t]=new vr(t,5,!1,t.toLowerCase(),null,!1,!1)});var u0=/[\-:]([a-z])/g;function h0(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(u0,h0);Vi[e]=new vr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(u0,h0);Vi[e]=new vr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(u0,h0);Vi[e]=new vr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Vi[t]=new vr(t,1,!1,t.toLowerCase(),null,!1,!1)});Vi.xlinkHref=new vr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Vi[t]=new vr(t,1,!1,t.toLowerCase(),null,!0,!0)});function d0(t,e,n,i){var o=Vi.hasOwnProperty(e)?Vi[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(yP(e,n,o,i)&&(n=null),i||o===null?gP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=n===null?o.type===3?!1:"":n:(e=o.attributeName,i=o.attributeNamespace,n===null?t.removeAttribute(e):(o=o.type,n=o===3||o===4&&n===!0?"":""+n,i?t.setAttributeNS(i,e,n):t.setAttribute(e,n))))}var Ho=u2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Af=Symbol.for("react.element"),wc=Symbol.for("react.portal"),Ec=Symbol.for("react.fragment"),f0=Symbol.for("react.strict_mode"),V_=Symbol.for("react.profiler"),d2=Symbol.for("react.provider"),f2=Symbol.for("react.context"),p0=Symbol.for("react.forward_ref"),j_=Symbol.for("react.suspense"),G_=Symbol.for("react.suspense_list"),m0=Symbol.for("react.memo"),va=Symbol.for("react.lazy"),p2=Symbol.for("react.offscreen"),Qx=Symbol.iterator;function sh(t){return t===null||typeof t!="object"?null:(t=Qx&&t[Qx]||t["@@iterator"],typeof t=="function"?t:null)}var Vn=Object.assign,Ng;function vh(t){if(Ng===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ng=e&&e[1]||""}return`
`+Ng+t}var Ug=!1;function Vg(t,e){if(!t||Ug)return"";Ug=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(T){var i=T}Reflect.construct(t,[],e)}else{try{e.call()}catch(T){i=T}t.call(e.prototype)}else{try{throw Error()}catch(T){i=T}t()}}catch(T){if(T&&i&&typeof T.stack=="string"){for(var o=T.stack.split(`
`),u=i.stack.split(`
`),f=o.length-1,l=u.length-1;1<=f&&0<=l&&o[f]!==u[l];)l--;for(;1<=f&&0<=l;f--,l--)if(o[f]!==u[l]){if(f!==1||l!==1)do if(f--,l--,0>l||o[f]!==u[l]){var b=`
`+o[f].replace(" at new "," at ");return t.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",t.displayName)),b}while(1<=f&&0<=l);break}}}finally{Ug=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?vh(t):""}function vP(t){switch(t.tag){case 5:return vh(t.type);case 16:return vh("Lazy");case 13:return vh("Suspense");case 19:return vh("SuspenseList");case 0:case 2:case 15:return t=Vg(t.type,!1),t;case 11:return t=Vg(t.type.render,!1),t;case 1:return t=Vg(t.type,!0),t;default:return""}}function H_(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ec:return"Fragment";case wc:return"Portal";case V_:return"Profiler";case f0:return"StrictMode";case j_:return"Suspense";case G_:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case f2:return(t.displayName||"Context")+".Consumer";case d2:return(t._context.displayName||"Context")+".Provider";case p0:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case m0:return e=t.displayName||null,e!==null?e:H_(t.type)||"Memo";case va:e=t._payload,t=t._init;try{return H_(t(e))}catch{}}return null}function xP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H_(e);case 8:return e===f0?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Oa(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function m2(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function bP(t){var e=m2(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(f){i=""+f,u.call(this,f)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(f){i=""+f},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function If(t){t._valueTracker||(t._valueTracker=bP(t))}function g2(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=m2(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function vp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function $_(t,e){var n=e.checked;return Vn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n!=null?n:t._wrapperState.initialChecked})}function e1(t,e){var n=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;n=Oa(e.value!=null?e.value:n),t._wrapperState={initialChecked:i,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _2(t,e){e=e.checked,e!=null&&d0(t,"checked",e,!1)}function W_(t,e){_2(t,e);var n=Oa(e.value),i=e.type;if(n!=null)i==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?q_(t,e.type,n):e.hasOwnProperty("defaultValue")&&q_(t,e.type,Oa(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function t1(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function q_(t,e,n){(e!=="number"||vp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var xh=Array.isArray;function Oc(t,e,n,i){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Oa(n),e=null,o=0;o<t.length;o++){if(t[o].value===n){t[o].selected=!0,i&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function X_(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ve(91));return Vn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function n1(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ve(92));if(xh(n)){if(1<n.length)throw Error(Ve(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Oa(n)}}function y2(t,e){var n=Oa(e.value),i=Oa(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),i!=null&&(t.defaultValue=""+i)}function i1(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function v2(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Z_(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?v2(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Pf,x2=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,i,o){MSApp.execUnsafeLocalFunction(function(){return t(e,n,i,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Pf=Pf||document.createElement("div"),Pf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Pf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Nh(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Sh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wP=["Webkit","ms","Moz","O"];Object.keys(Sh).forEach(function(t){wP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Sh[e]=Sh[t]})});function b2(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Sh.hasOwnProperty(t)&&Sh[t]?(""+e).trim():e+"px"}function w2(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var i=n.indexOf("--")===0,o=b2(n,e[n],i);n==="float"&&(n="cssFloat"),i?t.setProperty(n,o):t[n]=o}}var EP=Vn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Y_(t,e){if(e){if(EP[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ve(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ve(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ve(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ve(62))}}function K_(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var J_=null;function g0(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Q_=null,Fc=null,Bc=null;function r1(t){if(t=hd(t)){if(typeof Q_!="function")throw Error(Ve(280));var e=t.stateNode;e&&(e=hm(e),Q_(t.stateNode,t.type,e))}}function E2(t){Fc?Bc?Bc.push(t):Bc=[t]:Fc=t}function T2(){if(Fc){var t=Fc,e=Bc;if(Bc=Fc=null,r1(t),e)for(t=0;t<e.length;t++)r1(e[t])}}function S2(t,e){return t(e)}function A2(){}var jg=!1;function I2(t,e,n){if(jg)return t(e,n);jg=!0;try{return S2(t,e,n)}finally{jg=!1,(Fc!==null||Bc!==null)&&(A2(),T2())}}function Uh(t,e){var n=t.stateNode;if(n===null)return null;var i=hm(n);if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ve(231,e,typeof n));return n}var ey=!1;if(Fo)try{var oh={};Object.defineProperty(oh,"passive",{get:function(){ey=!0}}),window.addEventListener("test",oh,oh),window.removeEventListener("test",oh,oh)}catch{ey=!1}function TP(t,e,n,i,o,u,f,l,b){var T=Array.prototype.slice.call(arguments,3);try{e.apply(n,T)}catch(C){this.onError(C)}}var Ah=!1,xp=null,bp=!1,ty=null,SP={onError:function(t){Ah=!0,xp=t}};function AP(t,e,n,i,o,u,f,l,b){Ah=!1,xp=null,TP.apply(SP,arguments)}function IP(t,e,n,i,o,u,f,l,b){if(AP.apply(this,arguments),Ah){if(Ah){var T=xp;Ah=!1,xp=null}else throw Error(Ve(198));bp||(bp=!0,ty=T)}}function Fl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function P2(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function s1(t){if(Fl(t)!==t)throw Error(Ve(188))}function PP(t){var e=t.alternate;if(!e){if(e=Fl(t),e===null)throw Error(Ve(188));return e!==t?null:t}for(var n=t,i=e;;){var o=n.return;if(o===null)break;var u=o.alternate;if(u===null){if(i=o.return,i!==null){n=i;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===n)return s1(o),t;if(u===i)return s1(o),e;u=u.sibling}throw Error(Ve(188))}if(n.return!==i.return)n=o,i=u;else{for(var f=!1,l=o.child;l;){if(l===n){f=!0,n=o,i=u;break}if(l===i){f=!0,i=o,n=u;break}l=l.sibling}if(!f){for(l=u.child;l;){if(l===n){f=!0,n=u,i=o;break}if(l===i){f=!0,i=u,n=o;break}l=l.sibling}if(!f)throw Error(Ve(189))}}if(n.alternate!==i)throw Error(Ve(190))}if(n.tag!==3)throw Error(Ve(188));return n.stateNode.current===n?t:e}function C2(t){return t=PP(t),t!==null?M2(t):null}function M2(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=M2(t);if(e!==null)return e;t=t.sibling}return null}var k2=es.unstable_scheduleCallback,o1=es.unstable_cancelCallback,CP=es.unstable_shouldYield,MP=es.unstable_requestPaint,ei=es.unstable_now,kP=es.unstable_getCurrentPriorityLevel,_0=es.unstable_ImmediatePriority,L2=es.unstable_UserBlockingPriority,wp=es.unstable_NormalPriority,LP=es.unstable_LowPriority,R2=es.unstable_IdlePriority,am=null,uo=null;function RP(t){if(uo&&typeof uo.onCommitFiberRoot=="function")try{uo.onCommitFiberRoot(am,t,void 0,(t.current.flags&128)===128)}catch{}}var Fs=Math.clz32?Math.clz32:OP,DP=Math.log,zP=Math.LN2;function OP(t){return t>>>=0,t===0?32:31-(DP(t)/zP|0)|0}var Cf=64,Mf=4194304;function bh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ep(t,e){var n=t.pendingLanes;if(n===0)return 0;var i=0,o=t.suspendedLanes,u=t.pingedLanes,f=n&268435455;if(f!==0){var l=f&~o;l!==0?i=bh(l):(u&=f,u!==0&&(i=bh(u)))}else f=n&~o,f!==0?i=bh(f):u!==0&&(i=bh(u));if(i===0)return 0;if(e!==0&&e!==i&&(e&o)===0&&(o=i&-i,u=e&-e,o>=u||o===16&&(u&4194240)!==0))return e;if((i&4)!==0&&(i|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)n=31-Fs(e),o=1<<n,i|=t[n],e&=~o;return i}function FP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function BP(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,o=t.expirationTimes,u=t.pendingLanes;0<u;){var f=31-Fs(u),l=1<<f,b=o[f];b===-1?((l&n)===0||(l&i)!==0)&&(o[f]=FP(l,e)):b<=e&&(t.expiredLanes|=l),u&=~l}}function ny(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function D2(){var t=Cf;return Cf<<=1,(Cf&4194240)===0&&(Cf=64),t}function Gg(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function cd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fs(e),t[e]=n}function NP(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-Fs(n),u=1<<o;e[o]=0,i[o]=-1,t[o]=-1,n&=~u}}function y0(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Fs(n),o=1<<i;o&e|t[i]&e&&(t[i]|=e),n&=~o}}var mn=0;function z2(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var O2,v0,F2,B2,N2,iy=!1,kf=[],Ia=null,Pa=null,Ca=null,Vh=new Map,jh=new Map,ba=[],UP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function a1(t,e){switch(t){case"focusin":case"focusout":Ia=null;break;case"dragenter":case"dragleave":Pa=null;break;case"mouseover":case"mouseout":Ca=null;break;case"pointerover":case"pointerout":Vh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":jh.delete(e.pointerId)}}function ah(t,e,n,i,o,u){return t===null||t.nativeEvent!==u?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:u,targetContainers:[o]},e!==null&&(e=hd(e),e!==null&&v0(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function VP(t,e,n,i,o){switch(e){case"focusin":return Ia=ah(Ia,t,e,n,i,o),!0;case"dragenter":return Pa=ah(Pa,t,e,n,i,o),!0;case"mouseover":return Ca=ah(Ca,t,e,n,i,o),!0;case"pointerover":var u=o.pointerId;return Vh.set(u,ah(Vh.get(u)||null,t,e,n,i,o)),!0;case"gotpointercapture":return u=o.pointerId,jh.set(u,ah(jh.get(u)||null,t,e,n,i,o)),!0}return!1}function U2(t){var e=bl(t.target);if(e!==null){var n=Fl(e);if(n!==null){if(e=n.tag,e===13){if(e=P2(n),e!==null){t.blockedOn=e,N2(t.priority,function(){F2(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function tp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ry(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);J_=i,n.target.dispatchEvent(i),J_=null}else return e=hd(n),e!==null&&v0(e),t.blockedOn=n,!1;e.shift()}return!0}function l1(t,e,n){tp(t)&&n.delete(e)}function jP(){iy=!1,Ia!==null&&tp(Ia)&&(Ia=null),Pa!==null&&tp(Pa)&&(Pa=null),Ca!==null&&tp(Ca)&&(Ca=null),Vh.forEach(l1),jh.forEach(l1)}function lh(t,e){t.blockedOn===e&&(t.blockedOn=null,iy||(iy=!0,es.unstable_scheduleCallback(es.unstable_NormalPriority,jP)))}function Gh(t){function e(o){return lh(o,t)}if(0<kf.length){lh(kf[0],t);for(var n=1;n<kf.length;n++){var i=kf[n];i.blockedOn===t&&(i.blockedOn=null)}}for(Ia!==null&&lh(Ia,t),Pa!==null&&lh(Pa,t),Ca!==null&&lh(Ca,t),Vh.forEach(e),jh.forEach(e),n=0;n<ba.length;n++)i=ba[n],i.blockedOn===t&&(i.blockedOn=null);for(;0<ba.length&&(n=ba[0],n.blockedOn===null);)U2(n),n.blockedOn===null&&ba.shift()}var Nc=Ho.ReactCurrentBatchConfig,Tp=!0;function GP(t,e,n,i){var o=mn,u=Nc.transition;Nc.transition=null;try{mn=1,x0(t,e,n,i)}finally{mn=o,Nc.transition=u}}function HP(t,e,n,i){var o=mn,u=Nc.transition;Nc.transition=null;try{mn=4,x0(t,e,n,i)}finally{mn=o,Nc.transition=u}}function x0(t,e,n,i){if(Tp){var o=ry(t,e,n,i);if(o===null)Qg(t,e,i,Sp,n),a1(t,i);else if(VP(o,t,e,n,i))i.stopPropagation();else if(a1(t,i),e&4&&-1<UP.indexOf(t)){for(;o!==null;){var u=hd(o);if(u!==null&&O2(u),u=ry(t,e,n,i),u===null&&Qg(t,e,i,Sp,n),u===o)break;o=u}o!==null&&i.stopPropagation()}else Qg(t,e,i,null,n)}}var Sp=null;function ry(t,e,n,i){if(Sp=null,t=g0(i),t=bl(t),t!==null)if(e=Fl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=P2(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Sp=t,null}function V2(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(kP()){case _0:return 1;case L2:return 4;case wp:case LP:return 16;case R2:return 536870912;default:return 16}default:return 16}}var Ta=null,b0=null,np=null;function j2(){if(np)return np;var t,e=b0,n=e.length,i,o="value"in Ta?Ta.value:Ta.textContent,u=o.length;for(t=0;t<n&&e[t]===o[t];t++);var f=n-t;for(i=1;i<=f&&e[n-i]===o[u-i];i++);return np=o.slice(t,1<i?1-i:void 0)}function ip(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Lf(){return!0}function c1(){return!1}function ns(t){function e(n,i,o,u,f){this._reactName=n,this._targetInst=o,this.type=i,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(u):u[l]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Lf:c1,this.isPropagationStopped=c1,this}return Vn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Lf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Lf)},persist:function(){},isPersistent:Lf}),e}var au={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},w0=ns(au),ud=Vn({},au,{view:0,detail:0}),$P=ns(ud),Hg,$g,ch,lm=Vn({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:E0,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ch&&(ch&&t.type==="mousemove"?(Hg=t.screenX-ch.screenX,$g=t.screenY-ch.screenY):$g=Hg=0,ch=t),Hg)},movementY:function(t){return"movementY"in t?t.movementY:$g}}),u1=ns(lm),WP=Vn({},lm,{dataTransfer:0}),qP=ns(WP),XP=Vn({},ud,{relatedTarget:0}),Wg=ns(XP),ZP=Vn({},au,{animationName:0,elapsedTime:0,pseudoElement:0}),YP=ns(ZP),KP=Vn({},au,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),JP=ns(KP),QP=Vn({},au,{data:0}),h1=ns(QP),eC={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iC(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=nC[t])?!!e[t]:!1}function E0(){return iC}var rC=Vn({},ud,{key:function(t){if(t.key){var e=eC[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ip(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?tC[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:E0,charCode:function(t){return t.type==="keypress"?ip(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ip(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),sC=ns(rC),oC=Vn({},lm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),d1=ns(oC),aC=Vn({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:E0}),lC=ns(aC),cC=Vn({},au,{propertyName:0,elapsedTime:0,pseudoElement:0}),uC=ns(cC),hC=Vn({},lm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),dC=ns(hC),fC=[9,13,27,32],T0=Fo&&"CompositionEvent"in window,Ih=null;Fo&&"documentMode"in document&&(Ih=document.documentMode);var pC=Fo&&"TextEvent"in window&&!Ih,G2=Fo&&(!T0||Ih&&8<Ih&&11>=Ih),f1=String.fromCharCode(32),p1=!1;function H2(t,e){switch(t){case"keyup":return fC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $2(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Tc=!1;function mC(t,e){switch(t){case"compositionend":return $2(e);case"keypress":return e.which!==32?null:(p1=!0,f1);case"textInput":return t=e.data,t===f1&&p1?null:t;default:return null}}function gC(t,e){if(Tc)return t==="compositionend"||!T0&&H2(t,e)?(t=j2(),np=b0=Ta=null,Tc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return G2&&e.locale!=="ko"?null:e.data;default:return null}}var _C={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function m1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!_C[t.type]:e==="textarea"}function W2(t,e,n,i){E2(i),e=Ap(e,"onChange"),0<e.length&&(n=new w0("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Ph=null,Hh=null;function yC(t){iE(t,0)}function cm(t){var e=Ic(t);if(g2(e))return t}function vC(t,e){if(t==="change")return e}var q2=!1;if(Fo){var qg;if(Fo){var Xg="oninput"in document;if(!Xg){var g1=document.createElement("div");g1.setAttribute("oninput","return;"),Xg=typeof g1.oninput=="function"}qg=Xg}else qg=!1;q2=qg&&(!document.documentMode||9<document.documentMode)}function _1(){Ph&&(Ph.detachEvent("onpropertychange",X2),Hh=Ph=null)}function X2(t){if(t.propertyName==="value"&&cm(Hh)){var e=[];W2(e,Hh,t,g0(t)),I2(yC,e)}}function xC(t,e,n){t==="focusin"?(_1(),Ph=e,Hh=n,Ph.attachEvent("onpropertychange",X2)):t==="focusout"&&_1()}function bC(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return cm(Hh)}function wC(t,e){if(t==="click")return cm(e)}function EC(t,e){if(t==="input"||t==="change")return cm(e)}function TC(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Us=typeof Object.is=="function"?Object.is:TC;function $h(t,e){if(Us(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var o=n[i];if(!U_.call(e,o)||!Us(t[o],e[o]))return!1}return!0}function y1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function v1(t,e){var n=y1(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=y1(n)}}function Z2(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Z2(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Y2(){for(var t=window,e=vp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=vp(t.document)}return e}function S0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function SC(t){var e=Y2(),n=t.focusedElem,i=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Z2(n.ownerDocument.documentElement,n)){if(i!==null&&S0(n)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=n.textContent.length,u=Math.min(i.start,o);i=i.end===void 0?u:Math.min(i.end,o),!t.extend&&u>i&&(o=i,i=u,u=o),o=v1(n,u);var f=v1(n,i);o&&f&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==f.node||t.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),u>i?(t.addRange(e),t.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var AC=Fo&&"documentMode"in document&&11>=document.documentMode,Sc=null,sy=null,Ch=null,oy=!1;function x1(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;oy||Sc==null||Sc!==vp(i)||(i=Sc,"selectionStart"in i&&S0(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ch&&$h(Ch,i)||(Ch=i,i=Ap(sy,"onSelect"),0<i.length&&(e=new w0("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Sc)))}function Rf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ac={animationend:Rf("Animation","AnimationEnd"),animationiteration:Rf("Animation","AnimationIteration"),animationstart:Rf("Animation","AnimationStart"),transitionend:Rf("Transition","TransitionEnd")},Zg={},K2={};Fo&&(K2=document.createElement("div").style,"AnimationEvent"in window||(delete Ac.animationend.animation,delete Ac.animationiteration.animation,delete Ac.animationstart.animation),"TransitionEvent"in window||delete Ac.transitionend.transition);function um(t){if(Zg[t])return Zg[t];if(!Ac[t])return t;var e=Ac[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in K2)return Zg[t]=e[n];return t}var J2=um("animationend"),Q2=um("animationiteration"),eE=um("animationstart"),tE=um("transitionend"),nE=new Map,b1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ua(t,e){nE.set(t,e),Ol(e,[t])}for(var Yg=0;Yg<b1.length;Yg++){var Kg=b1[Yg],IC=Kg.toLowerCase(),PC=Kg[0].toUpperCase()+Kg.slice(1);Ua(IC,"on"+PC)}Ua(J2,"onAnimationEnd");Ua(Q2,"onAnimationIteration");Ua(eE,"onAnimationStart");Ua("dblclick","onDoubleClick");Ua("focusin","onFocus");Ua("focusout","onBlur");Ua(tE,"onTransitionEnd");Hc("onMouseEnter",["mouseout","mouseover"]);Hc("onMouseLeave",["mouseout","mouseover"]);Hc("onPointerEnter",["pointerout","pointerover"]);Hc("onPointerLeave",["pointerout","pointerover"]);Ol("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ol("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ol("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ol("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ol("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ol("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CC=new Set("cancel close invalid load scroll toggle".split(" ").concat(wh));function w1(t,e,n){var i=t.type||"unknown-event";t.currentTarget=n,IP(i,e,void 0,t),t.currentTarget=null}function iE(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],o=i.event;i=i.listeners;e:{var u=void 0;if(e)for(var f=i.length-1;0<=f;f--){var l=i[f],b=l.instance,T=l.currentTarget;if(l=l.listener,b!==u&&o.isPropagationStopped())break e;w1(o,l,T),u=b}else for(f=0;f<i.length;f++){if(l=i[f],b=l.instance,T=l.currentTarget,l=l.listener,b!==u&&o.isPropagationStopped())break e;w1(o,l,T),u=b}}}if(bp)throw t=ty,bp=!1,ty=null,t}function Pn(t,e){var n=e[hy];n===void 0&&(n=e[hy]=new Set);var i=t+"__bubble";n.has(i)||(rE(e,t,2,!1),n.add(i))}function Jg(t,e,n){var i=0;e&&(i|=4),rE(n,t,i,e)}var Df="_reactListening"+Math.random().toString(36).slice(2);function Wh(t){if(!t[Df]){t[Df]=!0,h2.forEach(function(n){n!=="selectionchange"&&(CC.has(n)||Jg(n,!1,t),Jg(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Df]||(e[Df]=!0,Jg("selectionchange",!1,e))}}function rE(t,e,n,i){switch(V2(e)){case 1:var o=GP;break;case 4:o=HP;break;default:o=x0}n=o.bind(null,e,n,t),o=void 0,!ey||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):o!==void 0?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function Qg(t,e,n,i,o){var u=i;if((e&1)===0&&(e&2)===0&&i!==null)e:for(;;){if(i===null)return;var f=i.tag;if(f===3||f===4){var l=i.stateNode.containerInfo;if(l===o||l.nodeType===8&&l.parentNode===o)break;if(f===4)for(f=i.return;f!==null;){var b=f.tag;if((b===3||b===4)&&(b=f.stateNode.containerInfo,b===o||b.nodeType===8&&b.parentNode===o))return;f=f.return}for(;l!==null;){if(f=bl(l),f===null)return;if(b=f.tag,b===5||b===6){i=u=f;continue e}l=l.parentNode}}i=i.return}I2(function(){var T=u,C=g0(n),L=[];e:{var k=nE.get(t);if(k!==void 0){var X=w0,te=t;switch(t){case"keypress":if(ip(n)===0)break e;case"keydown":case"keyup":X=sC;break;case"focusin":te="focus",X=Wg;break;case"focusout":te="blur",X=Wg;break;case"beforeblur":case"afterblur":X=Wg;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=u1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=qP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=lC;break;case J2:case Q2:case eE:X=YP;break;case tE:X=uC;break;case"scroll":X=$P;break;case"wheel":X=dC;break;case"copy":case"cut":case"paste":X=JP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=d1}var ie=(e&4)!==0,ye=!ie&&t==="scroll",J=ie?k!==null?k+"Capture":null:k;ie=[];for(var W=T,Q;W!==null;){Q=W;var _e=Q.stateNode;if(Q.tag===5&&_e!==null&&(Q=_e,J!==null&&(_e=Uh(W,J),_e!=null&&ie.push(qh(W,_e,Q)))),ye)break;W=W.return}0<ie.length&&(k=new X(k,te,null,n,C),L.push({event:k,listeners:ie}))}}if((e&7)===0){e:{if(k=t==="mouseover"||t==="pointerover",X=t==="mouseout"||t==="pointerout",k&&n!==J_&&(te=n.relatedTarget||n.fromElement)&&(bl(te)||te[Bo]))break e;if((X||k)&&(k=C.window===C?C:(k=C.ownerDocument)?k.defaultView||k.parentWindow:window,X?(te=n.relatedTarget||n.toElement,X=T,te=te?bl(te):null,te!==null&&(ye=Fl(te),te!==ye||te.tag!==5&&te.tag!==6)&&(te=null)):(X=null,te=T),X!==te)){if(ie=u1,_e="onMouseLeave",J="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(ie=d1,_e="onPointerLeave",J="onPointerEnter",W="pointer"),ye=X==null?k:Ic(X),Q=te==null?k:Ic(te),k=new ie(_e,W+"leave",X,n,C),k.target=ye,k.relatedTarget=Q,_e=null,bl(C)===T&&(ie=new ie(J,W+"enter",te,n,C),ie.target=Q,ie.relatedTarget=ye,_e=ie),ye=_e,X&&te)t:{for(ie=X,J=te,W=0,Q=ie;Q;Q=pc(Q))W++;for(Q=0,_e=J;_e;_e=pc(_e))Q++;for(;0<W-Q;)ie=pc(ie),W--;for(;0<Q-W;)J=pc(J),Q--;for(;W--;){if(ie===J||J!==null&&ie===J.alternate)break t;ie=pc(ie),J=pc(J)}ie=null}else ie=null;X!==null&&E1(L,k,X,ie,!1),te!==null&&ye!==null&&E1(L,ye,te,ie,!0)}}e:{if(k=T?Ic(T):window,X=k.nodeName&&k.nodeName.toLowerCase(),X==="select"||X==="input"&&k.type==="file")var we=vC;else if(m1(k))if(q2)we=EC;else{we=bC;var Ce=xC}else(X=k.nodeName)&&X.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(we=wC);if(we&&(we=we(t,T))){W2(L,we,n,C);break e}Ce&&Ce(t,k,T),t==="focusout"&&(Ce=k._wrapperState)&&Ce.controlled&&k.type==="number"&&q_(k,"number",k.value)}switch(Ce=T?Ic(T):window,t){case"focusin":(m1(Ce)||Ce.contentEditable==="true")&&(Sc=Ce,sy=T,Ch=null);break;case"focusout":Ch=sy=Sc=null;break;case"mousedown":oy=!0;break;case"contextmenu":case"mouseup":case"dragend":oy=!1,x1(L,n,C);break;case"selectionchange":if(AC)break;case"keydown":case"keyup":x1(L,n,C)}var Oe;if(T0)e:{switch(t){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else Tc?H2(t,n)&&(Ue="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(Ue="onCompositionStart");Ue&&(G2&&n.locale!=="ko"&&(Tc||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&Tc&&(Oe=j2()):(Ta=C,b0="value"in Ta?Ta.value:Ta.textContent,Tc=!0)),Ce=Ap(T,Ue),0<Ce.length&&(Ue=new h1(Ue,t,null,n,C),L.push({event:Ue,listeners:Ce}),Oe?Ue.data=Oe:(Oe=$2(n),Oe!==null&&(Ue.data=Oe)))),(Oe=pC?mC(t,n):gC(t,n))&&(T=Ap(T,"onBeforeInput"),0<T.length&&(C=new h1("onBeforeInput","beforeinput",null,n,C),L.push({event:C,listeners:T}),C.data=Oe))}iE(L,e)})}function qh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ap(t,e){for(var n=e+"Capture",i=[];t!==null;){var o=t,u=o.stateNode;o.tag===5&&u!==null&&(o=u,u=Uh(t,n),u!=null&&i.unshift(qh(t,u,o)),u=Uh(t,e),u!=null&&i.push(qh(t,u,o))),t=t.return}return i}function pc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function E1(t,e,n,i,o){for(var u=e._reactName,f=[];n!==null&&n!==i;){var l=n,b=l.alternate,T=l.stateNode;if(b!==null&&b===i)break;l.tag===5&&T!==null&&(l=T,o?(b=Uh(n,u),b!=null&&f.unshift(qh(n,b,l))):o||(b=Uh(n,u),b!=null&&f.push(qh(n,b,l)))),n=n.return}f.length!==0&&t.push({event:e,listeners:f})}var MC=/\r\n?/g,kC=/\u0000|\uFFFD/g;function T1(t){return(typeof t=="string"?t:""+t).replace(MC,`
`).replace(kC,"")}function zf(t,e,n){if(e=T1(e),T1(t)!==e&&n)throw Error(Ve(425))}function Ip(){}var ay=null,ly=null;function cy(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var uy=typeof setTimeout=="function"?setTimeout:void 0,LC=typeof clearTimeout=="function"?clearTimeout:void 0,S1=typeof Promise=="function"?Promise:void 0,RC=typeof queueMicrotask=="function"?queueMicrotask:typeof S1<"u"?function(t){return S1.resolve(null).then(t).catch(DC)}:uy;function DC(t){setTimeout(function(){throw t})}function e_(t,e){var n=e,i=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&o.nodeType===8)if(n=o.data,n==="/$"){if(i===0){t.removeChild(o),Gh(e);return}i--}else n!=="$"&&n!=="$?"&&n!=="$!"||i++;n=o}while(n);Gh(e)}function Ma(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function A1(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var lu=Math.random().toString(36).slice(2),ao="__reactFiber$"+lu,Xh="__reactProps$"+lu,Bo="__reactContainer$"+lu,hy="__reactEvents$"+lu,zC="__reactListeners$"+lu,OC="__reactHandles$"+lu;function bl(t){var e=t[ao];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Bo]||n[ao]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=A1(t);t!==null;){if(n=t[ao])return n;t=A1(t)}return e}t=n,n=t.parentNode}return null}function hd(t){return t=t[ao]||t[Bo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ic(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ve(33))}function hm(t){return t[Xh]||null}var dy=[],Pc=-1;function Va(t){return{current:t}}function Cn(t){0>Pc||(t.current=dy[Pc],dy[Pc]=null,Pc--)}function An(t,e){Pc++,dy[Pc]=t.current,t.current=e}var Fa={},tr=Va(Fa),Cr=Va(!1),Pl=Fa;function $c(t,e){var n=t.type.contextTypes;if(!n)return Fa;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},u;for(u in n)o[u]=e[u];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function Mr(t){return t=t.childContextTypes,t!=null}function Pp(){Cn(Cr),Cn(tr)}function I1(t,e,n){if(tr.current!==Fa)throw Error(Ve(168));An(tr,e),An(Cr,n)}function sE(t,e,n){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return n;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Ve(108,xP(t)||"Unknown",o));return Vn({},n,i)}function Cp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Fa,Pl=tr.current,An(tr,t),An(Cr,Cr.current),!0}function P1(t,e,n){var i=t.stateNode;if(!i)throw Error(Ve(169));n?(t=sE(t,e,Pl),i.__reactInternalMemoizedMergedChildContext=t,Cn(Cr),Cn(tr),An(tr,t)):Cn(Cr),An(Cr,n)}var Lo=null,dm=!1,t_=!1;function oE(t){Lo===null?Lo=[t]:Lo.push(t)}function FC(t){dm=!0,oE(t)}function ja(){if(!t_&&Lo!==null){t_=!0;var t=0,e=mn;try{var n=Lo;for(mn=1;t<n.length;t++){var i=n[t];do i=i(!0);while(i!==null)}Lo=null,dm=!1}catch(o){throw Lo!==null&&(Lo=Lo.slice(t+1)),k2(_0,ja),o}finally{mn=e,t_=!1}}return null}var Cc=[],Mc=0,Mp=null,kp=0,ms=[],gs=0,Cl=null,Do=1,zo="";function yl(t,e){Cc[Mc++]=kp,Cc[Mc++]=Mp,Mp=t,kp=e}function aE(t,e,n){ms[gs++]=Do,ms[gs++]=zo,ms[gs++]=Cl,Cl=t;var i=Do;t=zo;var o=32-Fs(i)-1;i&=~(1<<o),n+=1;var u=32-Fs(e)+o;if(30<u){var f=o-o%5;u=(i&(1<<f)-1).toString(32),i>>=f,o-=f,Do=1<<32-Fs(e)+o|n<<o|i,zo=u+t}else Do=1<<u|n<<o|i,zo=t}function A0(t){t.return!==null&&(yl(t,1),aE(t,1,0))}function I0(t){for(;t===Mp;)Mp=Cc[--Mc],Cc[Mc]=null,kp=Cc[--Mc],Cc[Mc]=null;for(;t===Cl;)Cl=ms[--gs],ms[gs]=null,zo=ms[--gs],ms[gs]=null,Do=ms[--gs],ms[gs]=null}var Jr=null,Yr=null,Dn=!1,zs=null;function lE(t,e){var n=_s(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function C1(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Jr=t,Yr=Ma(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Jr=t,Yr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Cl!==null?{id:Do,overflow:zo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_s(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Jr=t,Yr=null,!0):!1;default:return!1}}function fy(t){return(t.mode&1)!==0&&(t.flags&128)===0}function py(t){if(Dn){var e=Yr;if(e){var n=e;if(!C1(t,e)){if(fy(t))throw Error(Ve(418));e=Ma(n.nextSibling);var i=Jr;e&&C1(t,e)?lE(i,n):(t.flags=t.flags&-4097|2,Dn=!1,Jr=t)}}else{if(fy(t))throw Error(Ve(418));t.flags=t.flags&-4097|2,Dn=!1,Jr=t}}}function M1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Jr=t}function Of(t){if(t!==Jr)return!1;if(!Dn)return M1(t),Dn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!cy(t.type,t.memoizedProps)),e&&(e=Yr)){if(fy(t))throw cE(),Error(Ve(418));for(;e;)lE(t,e),e=Ma(e.nextSibling)}if(M1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ve(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Yr=Ma(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Yr=null}}else Yr=Jr?Ma(t.stateNode.nextSibling):null;return!0}function cE(){for(var t=Yr;t;)t=Ma(t.nextSibling)}function Wc(){Yr=Jr=null,Dn=!1}function P0(t){zs===null?zs=[t]:zs.push(t)}var BC=Ho.ReactCurrentBatchConfig;function Rs(t,e){if(t&&t.defaultProps){e=Vn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Lp=Va(null),Rp=null,kc=null,C0=null;function M0(){C0=kc=Rp=null}function k0(t){var e=Lp.current;Cn(Lp),t._currentValue=e}function my(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function Uc(t,e){Rp=t,C0=kc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Pr=!0),t.firstContext=null)}function xs(t){var e=t._currentValue;if(C0!==t)if(t={context:t,memoizedValue:e,next:null},kc===null){if(Rp===null)throw Error(Ve(308));kc=t,Rp.dependencies={lanes:0,firstContext:t}}else kc=kc.next=t;return e}var wl=null;function L0(t){wl===null?wl=[t]:wl.push(t)}function uE(t,e,n,i){var o=e.interleaved;return o===null?(n.next=n,L0(e)):(n.next=o.next,o.next=n),e.interleaved=n,No(t,i)}function No(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xa=!1;function R0(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hE(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Oo(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ka(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,(on&2)!==0){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,No(t,n)}return o=i.interleaved,o===null?(e.next=e,L0(i)):(e.next=o.next,o.next=e),i.interleaved=e,No(t,n)}function rp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,y0(t,n)}}function k1(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var o=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var f={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?o=u=f:u=u.next=f,n=n.next}while(n!==null);u===null?o=u=e:u=u.next=e}else o=u=e;n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:i.shared,effects:i.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Dp(t,e,n,i){var o=t.updateQueue;xa=!1;var u=o.firstBaseUpdate,f=o.lastBaseUpdate,l=o.shared.pending;if(l!==null){o.shared.pending=null;var b=l,T=b.next;b.next=null,f===null?u=T:f.next=T,f=b;var C=t.alternate;C!==null&&(C=C.updateQueue,l=C.lastBaseUpdate,l!==f&&(l===null?C.firstBaseUpdate=T:l.next=T,C.lastBaseUpdate=b))}if(u!==null){var L=o.baseState;f=0,C=T=b=null,l=u;do{var k=l.lane,X=l.eventTime;if((i&k)===k){C!==null&&(C=C.next={eventTime:X,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var te=t,ie=l;switch(k=e,X=n,ie.tag){case 1:if(te=ie.payload,typeof te=="function"){L=te.call(X,L,k);break e}L=te;break e;case 3:te.flags=te.flags&-65537|128;case 0:if(te=ie.payload,k=typeof te=="function"?te.call(X,L,k):te,k==null)break e;L=Vn({},L,k);break e;case 2:xa=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,k=o.effects,k===null?o.effects=[l]:k.push(l))}else X={eventTime:X,lane:k,tag:l.tag,payload:l.payload,callback:l.callback,next:null},C===null?(T=C=X,b=L):C=C.next=X,f|=k;if(l=l.next,l===null){if(l=o.shared.pending,l===null)break;k=l,l=k.next,k.next=null,o.lastBaseUpdate=k,o.shared.pending=null}}while(1);if(C===null&&(b=L),o.baseState=b,o.firstBaseUpdate=T,o.lastBaseUpdate=C,e=o.shared.interleaved,e!==null){o=e;do f|=o.lane,o=o.next;while(o!==e)}else u===null&&(o.shared.lanes=0);kl|=f,t.lanes=f,t.memoizedState=L}}function L1(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],o=i.callback;if(o!==null){if(i.callback=null,i=n,typeof o!="function")throw Error(Ve(191,o));o.call(i)}}}var dE=new u2.Component().refs;function gy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Vn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var fm={isMounted:function(t){return(t=t._reactInternals)?Fl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var i=gr(),o=Ra(t),u=Oo(i,o);u.payload=e,n!=null&&(u.callback=n),e=ka(t,u,o),e!==null&&(Bs(e,t,o,i),rp(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=gr(),o=Ra(t),u=Oo(i,o);u.tag=1,u.payload=e,n!=null&&(u.callback=n),e=ka(t,u,o),e!==null&&(Bs(e,t,o,i),rp(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=gr(),i=Ra(t),o=Oo(n,i);o.tag=2,e!=null&&(o.callback=e),e=ka(t,o,i),e!==null&&(Bs(e,t,i,n),rp(e,t,i))}};function R1(t,e,n,i,o,u,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,u,f):e.prototype&&e.prototype.isPureReactComponent?!$h(n,i)||!$h(o,u):!0}function fE(t,e,n){var i=!1,o=Fa,u=e.contextType;return typeof u=="object"&&u!==null?u=xs(u):(o=Mr(e)?Pl:tr.current,i=e.contextTypes,u=(i=i!=null)?$c(t,o):Fa),e=new e(n,u),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=fm,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=u),e}function D1(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&fm.enqueueReplaceState(e,e.state,null)}function _y(t,e,n,i){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs=dE,R0(t);var u=e.contextType;typeof u=="object"&&u!==null?o.context=xs(u):(u=Mr(e)?Pl:tr.current,o.context=$c(t,u)),o.state=t.memoizedState,u=e.getDerivedStateFromProps,typeof u=="function"&&(gy(t,e,u,n),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&fm.enqueueReplaceState(o,o.state,null),Dp(t,n,o,i),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function uh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ve(309));var i=n.stateNode}if(!i)throw Error(Ve(147,t));var o=i,u=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===u?e.ref:(e=function(f){var l=o.refs;l===dE&&(l=o.refs={}),f===null?delete l[u]:l[u]=f},e._stringRef=u,e)}if(typeof t!="string")throw Error(Ve(284));if(!n._owner)throw Error(Ve(290,t))}return t}function Ff(t,e){throw t=Object.prototype.toString.call(e),Error(Ve(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function z1(t){var e=t._init;return e(t._payload)}function pE(t){function e(J,W){if(t){var Q=J.deletions;Q===null?(J.deletions=[W],J.flags|=16):Q.push(W)}}function n(J,W){if(!t)return null;for(;W!==null;)e(J,W),W=W.sibling;return null}function i(J,W){for(J=new Map;W!==null;)W.key!==null?J.set(W.key,W):J.set(W.index,W),W=W.sibling;return J}function o(J,W){return J=Da(J,W),J.index=0,J.sibling=null,J}function u(J,W,Q){return J.index=Q,t?(Q=J.alternate,Q!==null?(Q=Q.index,Q<W?(J.flags|=2,W):Q):(J.flags|=2,W)):(J.flags|=1048576,W)}function f(J){return t&&J.alternate===null&&(J.flags|=2),J}function l(J,W,Q,_e){return W===null||W.tag!==6?(W=l_(Q,J.mode,_e),W.return=J,W):(W=o(W,Q),W.return=J,W)}function b(J,W,Q,_e){var we=Q.type;return we===Ec?C(J,W,Q.props.children,_e,Q.key):W!==null&&(W.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===va&&z1(we)===W.type)?(_e=o(W,Q.props),_e.ref=uh(J,W,Q),_e.return=J,_e):(_e=up(Q.type,Q.key,Q.props,null,J.mode,_e),_e.ref=uh(J,W,Q),_e.return=J,_e)}function T(J,W,Q,_e){return W===null||W.tag!==4||W.stateNode.containerInfo!==Q.containerInfo||W.stateNode.implementation!==Q.implementation?(W=c_(Q,J.mode,_e),W.return=J,W):(W=o(W,Q.children||[]),W.return=J,W)}function C(J,W,Q,_e,we){return W===null||W.tag!==7?(W=Al(Q,J.mode,_e,we),W.return=J,W):(W=o(W,Q),W.return=J,W)}function L(J,W,Q){if(typeof W=="string"&&W!==""||typeof W=="number")return W=l_(""+W,J.mode,Q),W.return=J,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case Af:return Q=up(W.type,W.key,W.props,null,J.mode,Q),Q.ref=uh(J,null,W),Q.return=J,Q;case wc:return W=c_(W,J.mode,Q),W.return=J,W;case va:var _e=W._init;return L(J,_e(W._payload),Q)}if(xh(W)||sh(W))return W=Al(W,J.mode,Q,null),W.return=J,W;Ff(J,W)}return null}function k(J,W,Q,_e){var we=W!==null?W.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return we!==null?null:l(J,W,""+Q,_e);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Af:return Q.key===we?b(J,W,Q,_e):null;case wc:return Q.key===we?T(J,W,Q,_e):null;case va:return we=Q._init,k(J,W,we(Q._payload),_e)}if(xh(Q)||sh(Q))return we!==null?null:C(J,W,Q,_e,null);Ff(J,Q)}return null}function X(J,W,Q,_e,we){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return J=J.get(Q)||null,l(W,J,""+_e,we);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case Af:return J=J.get(_e.key===null?Q:_e.key)||null,b(W,J,_e,we);case wc:return J=J.get(_e.key===null?Q:_e.key)||null,T(W,J,_e,we);case va:var Ce=_e._init;return X(J,W,Q,Ce(_e._payload),we)}if(xh(_e)||sh(_e))return J=J.get(Q)||null,C(W,J,_e,we,null);Ff(W,_e)}return null}function te(J,W,Q,_e){for(var we=null,Ce=null,Oe=W,Ue=W=0,st=null;Oe!==null&&Ue<Q.length;Ue++){Oe.index>Ue?(st=Oe,Oe=null):st=Oe.sibling;var Xe=k(J,Oe,Q[Ue],_e);if(Xe===null){Oe===null&&(Oe=st);break}t&&Oe&&Xe.alternate===null&&e(J,Oe),W=u(Xe,W,Ue),Ce===null?we=Xe:Ce.sibling=Xe,Ce=Xe,Oe=st}if(Ue===Q.length)return n(J,Oe),Dn&&yl(J,Ue),we;if(Oe===null){for(;Ue<Q.length;Ue++)Oe=L(J,Q[Ue],_e),Oe!==null&&(W=u(Oe,W,Ue),Ce===null?we=Oe:Ce.sibling=Oe,Ce=Oe);return Dn&&yl(J,Ue),we}for(Oe=i(J,Oe);Ue<Q.length;Ue++)st=X(Oe,J,Ue,Q[Ue],_e),st!==null&&(t&&st.alternate!==null&&Oe.delete(st.key===null?Ue:st.key),W=u(st,W,Ue),Ce===null?we=st:Ce.sibling=st,Ce=st);return t&&Oe.forEach(function(xt){return e(J,xt)}),Dn&&yl(J,Ue),we}function ie(J,W,Q,_e){var we=sh(Q);if(typeof we!="function")throw Error(Ve(150));if(Q=we.call(Q),Q==null)throw Error(Ve(151));for(var Ce=we=null,Oe=W,Ue=W=0,st=null,Xe=Q.next();Oe!==null&&!Xe.done;Ue++,Xe=Q.next()){Oe.index>Ue?(st=Oe,Oe=null):st=Oe.sibling;var xt=k(J,Oe,Xe.value,_e);if(xt===null){Oe===null&&(Oe=st);break}t&&Oe&&xt.alternate===null&&e(J,Oe),W=u(xt,W,Ue),Ce===null?we=xt:Ce.sibling=xt,Ce=xt,Oe=st}if(Xe.done)return n(J,Oe),Dn&&yl(J,Ue),we;if(Oe===null){for(;!Xe.done;Ue++,Xe=Q.next())Xe=L(J,Xe.value,_e),Xe!==null&&(W=u(Xe,W,Ue),Ce===null?we=Xe:Ce.sibling=Xe,Ce=Xe);return Dn&&yl(J,Ue),we}for(Oe=i(J,Oe);!Xe.done;Ue++,Xe=Q.next())Xe=X(Oe,J,Ue,Xe.value,_e),Xe!==null&&(t&&Xe.alternate!==null&&Oe.delete(Xe.key===null?Ue:Xe.key),W=u(Xe,W,Ue),Ce===null?we=Xe:Ce.sibling=Xe,Ce=Xe);return t&&Oe.forEach(function($t){return e(J,$t)}),Dn&&yl(J,Ue),we}function ye(J,W,Q,_e){if(typeof Q=="object"&&Q!==null&&Q.type===Ec&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Af:e:{for(var we=Q.key,Ce=W;Ce!==null;){if(Ce.key===we){if(we=Q.type,we===Ec){if(Ce.tag===7){n(J,Ce.sibling),W=o(Ce,Q.props.children),W.return=J,J=W;break e}}else if(Ce.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===va&&z1(we)===Ce.type){n(J,Ce.sibling),W=o(Ce,Q.props),W.ref=uh(J,Ce,Q),W.return=J,J=W;break e}n(J,Ce);break}else e(J,Ce);Ce=Ce.sibling}Q.type===Ec?(W=Al(Q.props.children,J.mode,_e,Q.key),W.return=J,J=W):(_e=up(Q.type,Q.key,Q.props,null,J.mode,_e),_e.ref=uh(J,W,Q),_e.return=J,J=_e)}return f(J);case wc:e:{for(Ce=Q.key;W!==null;){if(W.key===Ce)if(W.tag===4&&W.stateNode.containerInfo===Q.containerInfo&&W.stateNode.implementation===Q.implementation){n(J,W.sibling),W=o(W,Q.children||[]),W.return=J,J=W;break e}else{n(J,W);break}else e(J,W);W=W.sibling}W=c_(Q,J.mode,_e),W.return=J,J=W}return f(J);case va:return Ce=Q._init,ye(J,W,Ce(Q._payload),_e)}if(xh(Q))return te(J,W,Q,_e);if(sh(Q))return ie(J,W,Q,_e);Ff(J,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,W!==null&&W.tag===6?(n(J,W.sibling),W=o(W,Q),W.return=J,J=W):(n(J,W),W=l_(Q,J.mode,_e),W.return=J,J=W),f(J)):n(J,W)}return ye}var qc=pE(!0),mE=pE(!1),dd={},ho=Va(dd),Zh=Va(dd),Yh=Va(dd);function El(t){if(t===dd)throw Error(Ve(174));return t}function D0(t,e){switch(An(Yh,e),An(Zh,t),An(ho,dd),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Z_(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Z_(e,t)}Cn(ho),An(ho,e)}function Xc(){Cn(ho),Cn(Zh),Cn(Yh)}function gE(t){El(Yh.current);var e=El(ho.current),n=Z_(e,t.type);e!==n&&(An(Zh,t),An(ho,n))}function z0(t){Zh.current===t&&(Cn(ho),Cn(Zh))}var Nn=Va(0);function zp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var n_=[];function O0(){for(var t=0;t<n_.length;t++)n_[t]._workInProgressVersionPrimary=null;n_.length=0}var sp=Ho.ReactCurrentDispatcher,i_=Ho.ReactCurrentBatchConfig,Ml=0,Un=null,_i=null,Ii=null,Op=!1,Mh=!1,Kh=0,NC=0;function Yi(){throw Error(Ve(321))}function F0(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Us(t[n],e[n]))return!1;return!0}function B0(t,e,n,i,o,u){if(Ml=u,Un=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sp.current=t===null||t.memoizedState===null?GC:HC,t=n(i,o),Mh){u=0;do{if(Mh=!1,Kh=0,25<=u)throw Error(Ve(301));u+=1,Ii=_i=null,e.updateQueue=null,sp.current=$C,t=n(i,o)}while(Mh)}if(sp.current=Fp,e=_i!==null&&_i.next!==null,Ml=0,Ii=_i=Un=null,Op=!1,e)throw Error(Ve(300));return t}function N0(){var t=Kh!==0;return Kh=0,t}function oo(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ii===null?Un.memoizedState=Ii=t:Ii=Ii.next=t,Ii}function bs(){if(_i===null){var t=Un.alternate;t=t!==null?t.memoizedState:null}else t=_i.next;var e=Ii===null?Un.memoizedState:Ii.next;if(e!==null)Ii=e,_i=t;else{if(t===null)throw Error(Ve(310));_i=t,t={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},Ii===null?Un.memoizedState=Ii=t:Ii=Ii.next=t}return Ii}function Jh(t,e){return typeof e=="function"?e(t):e}function r_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ve(311));n.lastRenderedReducer=t;var i=_i,o=i.baseQueue,u=n.pending;if(u!==null){if(o!==null){var f=o.next;o.next=u.next,u.next=f}i.baseQueue=o=u,n.pending=null}if(o!==null){u=o.next,i=i.baseState;var l=f=null,b=null,T=u;do{var C=T.lane;if((Ml&C)===C)b!==null&&(b=b.next={lane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),i=T.hasEagerState?T.eagerState:t(i,T.action);else{var L={lane:C,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null};b===null?(l=b=L,f=i):b=b.next=L,Un.lanes|=C,kl|=C}T=T.next}while(T!==null&&T!==u);b===null?f=i:b.next=l,Us(i,e.memoizedState)||(Pr=!0),e.memoizedState=i,e.baseState=f,e.baseQueue=b,n.lastRenderedState=i}if(t=n.interleaved,t!==null){o=t;do u=o.lane,Un.lanes|=u,kl|=u,o=o.next;while(o!==t)}else o===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function s_(t){var e=bs(),n=e.queue;if(n===null)throw Error(Ve(311));n.lastRenderedReducer=t;var i=n.dispatch,o=n.pending,u=e.memoizedState;if(o!==null){n.pending=null;var f=o=o.next;do u=t(u,f.action),f=f.next;while(f!==o);Us(u,e.memoizedState)||(Pr=!0),e.memoizedState=u,e.baseQueue===null&&(e.baseState=u),n.lastRenderedState=u}return[u,i]}function _E(){}function yE(t,e){var n=Un,i=bs(),o=e(),u=!Us(i.memoizedState,o);if(u&&(i.memoizedState=o,Pr=!0),i=i.queue,U0(bE.bind(null,n,i,t),[t]),i.getSnapshot!==e||u||Ii!==null&&Ii.memoizedState.tag&1){if(n.flags|=2048,Qh(9,xE.bind(null,n,i,o,e),void 0,null),Pi===null)throw Error(Ve(349));(Ml&30)!==0||vE(n,e,o)}return o}function vE(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Un.updateQueue,e===null?(e={lastEffect:null,stores:null},Un.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function xE(t,e,n,i){e.value=n,e.getSnapshot=i,wE(e)&&EE(t)}function bE(t,e,n){return n(function(){wE(e)&&EE(t)})}function wE(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Us(t,n)}catch{return!0}}function EE(t){var e=No(t,1);e!==null&&Bs(e,t,1,-1)}function O1(t){var e=oo();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Jh,lastRenderedState:t},e.queue=t,t=t.dispatch=jC.bind(null,Un,t),[e.memoizedState,t]}function Qh(t,e,n,i){return t={tag:t,create:e,destroy:n,deps:i,next:null},e=Un.updateQueue,e===null?(e={lastEffect:null,stores:null},Un.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t)),t}function TE(){return bs().memoizedState}function op(t,e,n,i){var o=oo();Un.flags|=t,o.memoizedState=Qh(1|e,n,void 0,i===void 0?null:i)}function pm(t,e,n,i){var o=bs();i=i===void 0?null:i;var u=void 0;if(_i!==null){var f=_i.memoizedState;if(u=f.destroy,i!==null&&F0(i,f.deps)){o.memoizedState=Qh(e,n,u,i);return}}Un.flags|=t,o.memoizedState=Qh(1|e,n,u,i)}function F1(t,e){return op(8390656,8,t,e)}function U0(t,e){return pm(2048,8,t,e)}function SE(t,e){return pm(4,2,t,e)}function AE(t,e){return pm(4,4,t,e)}function IE(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function PE(t,e,n){return n=n!=null?n.concat([t]):null,pm(4,4,IE.bind(null,e,t),n)}function V0(){}function CE(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&F0(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function ME(t,e){var n=bs();e=e===void 0?null:e;var i=n.memoizedState;return i!==null&&e!==null&&F0(e,i[1])?i[0]:(t=t(),n.memoizedState=[t,e],t)}function kE(t,e,n){return(Ml&21)===0?(t.baseState&&(t.baseState=!1,Pr=!0),t.memoizedState=n):(Us(n,e)||(n=D2(),Un.lanes|=n,kl|=n,t.baseState=!0),e)}function UC(t,e){var n=mn;mn=n!==0&&4>n?n:4,t(!0);var i=i_.transition;i_.transition={};try{t(!1),e()}finally{mn=n,i_.transition=i}}function LE(){return bs().memoizedState}function VC(t,e,n){var i=Ra(t);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},RE(t))DE(e,n);else if(n=uE(t,e,n,i),n!==null){var o=gr();Bs(n,t,i,o),zE(n,e,i)}}function jC(t,e,n){var i=Ra(t),o={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(RE(t))DE(e,o);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=e.lastRenderedReducer,u!==null))try{var f=e.lastRenderedState,l=u(f,n);if(o.hasEagerState=!0,o.eagerState=l,Us(l,f)){var b=e.interleaved;b===null?(o.next=o,L0(e)):(o.next=b.next,b.next=o),e.interleaved=o;return}}catch{}finally{}n=uE(t,e,o,i),n!==null&&(o=gr(),Bs(n,t,i,o),zE(n,e,i))}}function RE(t){var e=t.alternate;return t===Un||e!==null&&e===Un}function DE(t,e){Mh=Op=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function zE(t,e,n){if((n&4194240)!==0){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,y0(t,n)}}var Fp={readContext:xs,useCallback:Yi,useContext:Yi,useEffect:Yi,useImperativeHandle:Yi,useInsertionEffect:Yi,useLayoutEffect:Yi,useMemo:Yi,useReducer:Yi,useRef:Yi,useState:Yi,useDebugValue:Yi,useDeferredValue:Yi,useTransition:Yi,useMutableSource:Yi,useSyncExternalStore:Yi,useId:Yi,unstable_isNewReconciler:!1},GC={readContext:xs,useCallback:function(t,e){return oo().memoizedState=[t,e===void 0?null:e],t},useContext:xs,useEffect:F1,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,op(4194308,4,IE.bind(null,e,t),n)},useLayoutEffect:function(t,e){return op(4194308,4,t,e)},useInsertionEffect:function(t,e){return op(4,2,t,e)},useMemo:function(t,e){var n=oo();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var i=oo();return e=n!==void 0?n(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=VC.bind(null,Un,t),[i.memoizedState,t]},useRef:function(t){var e=oo();return t={current:t},e.memoizedState=t},useState:O1,useDebugValue:V0,useDeferredValue:function(t){return oo().memoizedState=t},useTransition:function(){var t=O1(!1),e=t[0];return t=UC.bind(null,t[1]),oo().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var i=Un,o=oo();if(Dn){if(n===void 0)throw Error(Ve(407));n=n()}else{if(n=e(),Pi===null)throw Error(Ve(349));(Ml&30)!==0||vE(i,e,n)}o.memoizedState=n;var u={value:n,getSnapshot:e};return o.queue=u,F1(bE.bind(null,i,u,t),[t]),i.flags|=2048,Qh(9,xE.bind(null,i,u,n,e),void 0,null),n},useId:function(){var t=oo(),e=Pi.identifierPrefix;if(Dn){var n=zo,i=Do;n=(i&~(1<<32-Fs(i)-1)).toString(32)+n,e=":"+e+"R"+n,n=Kh++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=NC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},HC={readContext:xs,useCallback:CE,useContext:xs,useEffect:U0,useImperativeHandle:PE,useInsertionEffect:SE,useLayoutEffect:AE,useMemo:ME,useReducer:r_,useRef:TE,useState:function(){return r_(Jh)},useDebugValue:V0,useDeferredValue:function(t){var e=bs();return kE(e,_i.memoizedState,t)},useTransition:function(){var t=r_(Jh)[0],e=bs().memoizedState;return[t,e]},useMutableSource:_E,useSyncExternalStore:yE,useId:LE,unstable_isNewReconciler:!1},$C={readContext:xs,useCallback:CE,useContext:xs,useEffect:U0,useImperativeHandle:PE,useInsertionEffect:SE,useLayoutEffect:AE,useMemo:ME,useReducer:s_,useRef:TE,useState:function(){return s_(Jh)},useDebugValue:V0,useDeferredValue:function(t){var e=bs();return _i===null?e.memoizedState=t:kE(e,_i.memoizedState,t)},useTransition:function(){var t=s_(Jh)[0],e=bs().memoizedState;return[t,e]},useMutableSource:_E,useSyncExternalStore:yE,useId:LE,unstable_isNewReconciler:!1};function Zc(t,e){try{var n="",i=e;do n+=vP(i),i=i.return;while(i);var o=n}catch(u){o=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:e,stack:o,digest:null}}function o_(t,e,n){return{value:t,source:null,stack:n!=null?n:null,digest:e!=null?e:null}}function yy(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var WC=typeof WeakMap=="function"?WeakMap:Map;function OE(t,e,n){n=Oo(-1,n),n.tag=3,n.payload={element:null};var i=e.value;return n.callback=function(){Np||(Np=!0,Py=i),yy(t,e)},n}function FE(t,e,n){n=Oo(-1,n),n.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;n.payload=function(){return i(o)},n.callback=function(){yy(t,e)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){yy(t,e),typeof i!="function"&&(La===null?La=new Set([this]):La.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),n}function B1(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new WC;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(n)||(o.add(n),t=oM.bind(null,t,e,n),e.then(t,t))}function N1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function U1(t,e,n,i,o){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Oo(-1,1),e.tag=2,ka(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=o,t)}var qC=Ho.ReactCurrentOwner,Pr=!1;function fr(t,e,n,i){e.child=t===null?mE(e,null,n,i):qc(e,t.child,n,i)}function V1(t,e,n,i,o){n=n.render;var u=e.ref;return Uc(e,o),i=B0(t,e,n,i,u,o),n=N0(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Uo(t,e,o)):(Dn&&n&&A0(e),e.flags|=1,fr(t,e,i,o),e.child)}function j1(t,e,n,i,o){if(t===null){var u=n.type;return typeof u=="function"&&!Z0(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=u,BE(t,e,u,i,o)):(t=up(n.type,null,i,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(u=t.child,(t.lanes&o)===0){var f=u.memoizedProps;if(n=n.compare,n=n!==null?n:$h,n(f,i)&&t.ref===e.ref)return Uo(t,e,o)}return e.flags|=1,t=Da(u,i),t.ref=e.ref,t.return=e,e.child=t}function BE(t,e,n,i,o){if(t!==null){var u=t.memoizedProps;if($h(u,i)&&t.ref===e.ref)if(Pr=!1,e.pendingProps=i=u,(t.lanes&o)!==0)(t.flags&131072)!==0&&(Pr=!0);else return e.lanes=t.lanes,Uo(t,e,o)}return vy(t,e,n,i,o)}function NE(t,e,n){var i=e.pendingProps,o=i.children,u=t!==null?t.memoizedState:null;if(i.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},An(Rc,qr),qr|=n;else{if((n&1073741824)===0)return t=u!==null?u.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,An(Rc,qr),qr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=u!==null?u.baseLanes:n,An(Rc,qr),qr|=i}else u!==null?(i=u.baseLanes|n,e.memoizedState=null):i=n,An(Rc,qr),qr|=i;return fr(t,e,o,n),e.child}function UE(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function vy(t,e,n,i,o){var u=Mr(n)?Pl:tr.current;return u=$c(e,u),Uc(e,o),n=B0(t,e,n,i,u,o),i=N0(),t!==null&&!Pr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Uo(t,e,o)):(Dn&&i&&A0(e),e.flags|=1,fr(t,e,n,o),e.child)}function G1(t,e,n,i,o){if(Mr(n)){var u=!0;Cp(e)}else u=!1;if(Uc(e,o),e.stateNode===null)ap(t,e),fE(e,n,i),_y(e,n,i,o),i=!0;else if(t===null){var f=e.stateNode,l=e.memoizedProps;f.props=l;var b=f.context,T=n.contextType;typeof T=="object"&&T!==null?T=xs(T):(T=Mr(n)?Pl:tr.current,T=$c(e,T));var C=n.getDerivedStateFromProps,L=typeof C=="function"||typeof f.getSnapshotBeforeUpdate=="function";L||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==i||b!==T)&&D1(e,f,i,T),xa=!1;var k=e.memoizedState;f.state=k,Dp(e,i,f,o),b=e.memoizedState,l!==i||k!==b||Cr.current||xa?(typeof C=="function"&&(gy(e,n,C,i),b=e.memoizedState),(l=xa||R1(e,n,l,i,k,b,T))?(L||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=b),f.props=i,f.state=b,f.context=T,i=l):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{f=e.stateNode,hE(t,e),l=e.memoizedProps,T=e.type===e.elementType?l:Rs(e.type,l),f.props=T,L=e.pendingProps,k=f.context,b=n.contextType,typeof b=="object"&&b!==null?b=xs(b):(b=Mr(n)?Pl:tr.current,b=$c(e,b));var X=n.getDerivedStateFromProps;(C=typeof X=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(l!==L||k!==b)&&D1(e,f,i,b),xa=!1,k=e.memoizedState,f.state=k,Dp(e,i,f,o);var te=e.memoizedState;l!==L||k!==te||Cr.current||xa?(typeof X=="function"&&(gy(e,n,X,i),te=e.memoizedState),(T=xa||R1(e,n,T,i,k,te,b)||!1)?(C||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(i,te,b),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(i,te,b)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=te),f.props=i,f.state=te,f.context=b,i=T):(typeof f.componentDidUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&k===t.memoizedState||(e.flags|=1024),i=!1)}return xy(t,e,n,i,u,o)}function xy(t,e,n,i,o,u){UE(t,e);var f=(e.flags&128)!==0;if(!i&&!f)return o&&P1(e,n,!1),Uo(t,e,u);i=e.stateNode,qC.current=e;var l=f&&typeof n.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&f?(e.child=qc(e,t.child,null,u),e.child=qc(e,null,l,u)):fr(t,e,l,u),e.memoizedState=i.state,o&&P1(e,n,!0),e.child}function VE(t){var e=t.stateNode;e.pendingContext?I1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&I1(t,e.context,!1),D0(t,e.containerInfo)}function H1(t,e,n,i,o){return Wc(),P0(o),e.flags|=256,fr(t,e,n,i),e.child}var by={dehydrated:null,treeContext:null,retryLane:0};function wy(t){return{baseLanes:t,cachePool:null,transitions:null}}function jE(t,e,n){var i=e.pendingProps,o=Nn.current,u=!1,f=(e.flags&128)!==0,l;if((l=f)||(l=t!==null&&t.memoizedState===null?!1:(o&2)!==0),l?(u=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),An(Nn,o&1),t===null)return py(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(f=i.children,t=i.fallback,u?(i=e.mode,u=e.child,f={mode:"hidden",children:f},(i&1)===0&&u!==null?(u.childLanes=0,u.pendingProps=f):u=_m(f,i,0,null),t=Al(t,i,n,null),u.return=e,t.return=e,u.sibling=t,e.child=u,e.child.memoizedState=wy(n),e.memoizedState=by,t):j0(e,f));if(o=t.memoizedState,o!==null&&(l=o.dehydrated,l!==null))return XC(t,e,f,i,l,o,n);if(u){u=i.fallback,f=e.mode,o=t.child,l=o.sibling;var b={mode:"hidden",children:i.children};return(f&1)===0&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=b,e.deletions=null):(i=Da(o,b),i.subtreeFlags=o.subtreeFlags&14680064),l!==null?u=Da(l,u):(u=Al(u,f,n,null),u.flags|=2),u.return=e,i.return=e,i.sibling=u,e.child=i,i=u,u=e.child,f=t.child.memoizedState,f=f===null?wy(n):{baseLanes:f.baseLanes|n,cachePool:null,transitions:f.transitions},u.memoizedState=f,u.childLanes=t.childLanes&~n,e.memoizedState=by,i}return u=t.child,t=u.sibling,i=Da(u,{mode:"visible",children:i.children}),(e.mode&1)===0&&(i.lanes=n),i.return=e,i.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=i,e.memoizedState=null,i}function j0(t,e){return e=_m({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Bf(t,e,n,i){return i!==null&&P0(i),qc(e,t.child,null,n),t=j0(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function XC(t,e,n,i,o,u,f){if(n)return e.flags&256?(e.flags&=-257,i=o_(Error(Ve(422))),Bf(t,e,f,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(u=i.fallback,o=e.mode,i=_m({mode:"visible",children:i.children},o,0,null),u=Al(u,o,f,null),u.flags|=2,i.return=e,u.return=e,i.sibling=u,e.child=i,(e.mode&1)!==0&&qc(e,t.child,null,f),e.child.memoizedState=wy(f),e.memoizedState=by,u);if((e.mode&1)===0)return Bf(t,e,f,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var l=i.dgst;return i=l,u=Error(Ve(419)),i=o_(u,i,void 0),Bf(t,e,f,i)}if(l=(f&t.childLanes)!==0,Pr||l){if(i=Pi,i!==null){switch(f&-f){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(i.suspendedLanes|f))!==0?0:o,o!==0&&o!==u.retryLane&&(u.retryLane=o,No(t,o),Bs(i,t,o,-1))}return X0(),i=o_(Error(Ve(421))),Bf(t,e,f,i)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=aM.bind(null,t),o._reactRetry=e,null):(t=u.treeContext,Yr=Ma(o.nextSibling),Jr=e,Dn=!0,zs=null,t!==null&&(ms[gs++]=Do,ms[gs++]=zo,ms[gs++]=Cl,Do=t.id,zo=t.overflow,Cl=e),e=j0(e,i.children),e.flags|=4096,e)}function $1(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),my(t.return,e,n)}function a_(t,e,n,i,o){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:o}:(u.isBackwards=e,u.rendering=null,u.renderingStartTime=0,u.last=i,u.tail=n,u.tailMode=o)}function GE(t,e,n){var i=e.pendingProps,o=i.revealOrder,u=i.tail;if(fr(t,e,i.children,n),i=Nn.current,(i&2)!==0)i=i&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$1(t,n,e);else if(t.tag===19)$1(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(An(Nn,i),(e.mode&1)===0)e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;n!==null;)t=n.alternate,t!==null&&zp(t)===null&&(o=n),n=n.sibling;n=o,n===null?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),a_(e,!1,o,n,u);break;case"backwards":for(n=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&zp(t)===null){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}a_(e,!0,n,null,u);break;case"together":a_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ap(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Uo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),kl|=e.lanes,(n&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(Ve(153));if(e.child!==null){for(t=e.child,n=Da(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Da(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ZC(t,e,n){switch(e.tag){case 3:VE(e),Wc();break;case 5:gE(e);break;case 1:Mr(e.type)&&Cp(e);break;case 4:D0(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;An(Lp,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(An(Nn,Nn.current&1),e.flags|=128,null):(n&e.child.childLanes)!==0?jE(t,e,n):(An(Nn,Nn.current&1),t=Uo(t,e,n),t!==null?t.sibling:null);An(Nn,Nn.current&1);break;case 19:if(i=(n&e.childLanes)!==0,(t.flags&128)!==0){if(i)return GE(t,e,n);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),An(Nn,Nn.current),i)break;return null;case 22:case 23:return e.lanes=0,NE(t,e,n)}return Uo(t,e,n)}var HE,Ey,$E,WE;HE=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ey=function(){};$E=function(t,e,n,i){var o=t.memoizedProps;if(o!==i){t=e.stateNode,El(ho.current);var u=null;switch(n){case"input":o=$_(t,o),i=$_(t,i),u=[];break;case"select":o=Vn({},o,{value:void 0}),i=Vn({},i,{value:void 0}),u=[];break;case"textarea":o=X_(t,o),i=X_(t,i),u=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=Ip)}Y_(n,i);var f;n=null;for(T in o)if(!i.hasOwnProperty(T)&&o.hasOwnProperty(T)&&o[T]!=null)if(T==="style"){var l=o[T];for(f in l)l.hasOwnProperty(f)&&(n||(n={}),n[f]="")}else T!=="dangerouslySetInnerHTML"&&T!=="children"&&T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(Bh.hasOwnProperty(T)?u||(u=[]):(u=u||[]).push(T,null));for(T in i){var b=i[T];if(l=o!=null?o[T]:void 0,i.hasOwnProperty(T)&&b!==l&&(b!=null||l!=null))if(T==="style")if(l){for(f in l)!l.hasOwnProperty(f)||b&&b.hasOwnProperty(f)||(n||(n={}),n[f]="");for(f in b)b.hasOwnProperty(f)&&l[f]!==b[f]&&(n||(n={}),n[f]=b[f])}else n||(u||(u=[]),u.push(T,n)),n=b;else T==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,l=l?l.__html:void 0,b!=null&&l!==b&&(u=u||[]).push(T,b)):T==="children"?typeof b!="string"&&typeof b!="number"||(u=u||[]).push(T,""+b):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&(Bh.hasOwnProperty(T)?(b!=null&&T==="onScroll"&&Pn("scroll",t),u||l===b||(u=[])):(u=u||[]).push(T,b))}n&&(u=u||[]).push("style",n);var T=u;(e.updateQueue=T)&&(e.flags|=4)}};WE=function(t,e,n,i){n!==i&&(e.flags|=4)};function hh(t,e){if(!Dn)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ki(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)n|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function YC(t,e,n){var i=e.pendingProps;switch(I0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ki(e),null;case 1:return Mr(e.type)&&Pp(),Ki(e),null;case 3:return i=e.stateNode,Xc(),Cn(Cr),Cn(tr),O0(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(Of(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,zs!==null&&(ky(zs),zs=null))),Ey(t,e),Ki(e),null;case 5:z0(e);var o=El(Yh.current);if(n=e.type,t!==null&&e.stateNode!=null)$E(t,e,n,i,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ve(166));return Ki(e),null}if(t=El(ho.current),Of(e)){i=e.stateNode,n=e.type;var u=e.memoizedProps;switch(i[ao]=e,i[Xh]=u,t=(e.mode&1)!==0,n){case"dialog":Pn("cancel",i),Pn("close",i);break;case"iframe":case"object":case"embed":Pn("load",i);break;case"video":case"audio":for(o=0;o<wh.length;o++)Pn(wh[o],i);break;case"source":Pn("error",i);break;case"img":case"image":case"link":Pn("error",i),Pn("load",i);break;case"details":Pn("toggle",i);break;case"input":e1(i,u),Pn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!u.multiple},Pn("invalid",i);break;case"textarea":n1(i,u),Pn("invalid",i)}Y_(n,u),o=null;for(var f in u)if(u.hasOwnProperty(f)){var l=u[f];f==="children"?typeof l=="string"?i.textContent!==l&&(u.suppressHydrationWarning!==!0&&zf(i.textContent,l,t),o=["children",l]):typeof l=="number"&&i.textContent!==""+l&&(u.suppressHydrationWarning!==!0&&zf(i.textContent,l,t),o=["children",""+l]):Bh.hasOwnProperty(f)&&l!=null&&f==="onScroll"&&Pn("scroll",i)}switch(n){case"input":If(i),t1(i,u,!0);break;case"textarea":If(i),i1(i);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(i.onclick=Ip)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{f=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=v2(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=f.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=f.createElement(n,{is:i.is}):(t=f.createElement(n),n==="select"&&(f=t,i.multiple?f.multiple=!0:i.size&&(f.size=i.size))):t=f.createElementNS(t,n),t[ao]=e,t[Xh]=i,HE(t,e,!1,!1),e.stateNode=t;e:{switch(f=K_(n,i),n){case"dialog":Pn("cancel",t),Pn("close",t),o=i;break;case"iframe":case"object":case"embed":Pn("load",t),o=i;break;case"video":case"audio":for(o=0;o<wh.length;o++)Pn(wh[o],t);o=i;break;case"source":Pn("error",t),o=i;break;case"img":case"image":case"link":Pn("error",t),Pn("load",t),o=i;break;case"details":Pn("toggle",t),o=i;break;case"input":e1(t,i),o=$_(t,i),Pn("invalid",t);break;case"option":o=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},o=Vn({},i,{value:void 0}),Pn("invalid",t);break;case"textarea":n1(t,i),o=X_(t,i),Pn("invalid",t);break;default:o=i}Y_(n,o),l=o;for(u in l)if(l.hasOwnProperty(u)){var b=l[u];u==="style"?w2(t,b):u==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&x2(t,b)):u==="children"?typeof b=="string"?(n!=="textarea"||b!=="")&&Nh(t,b):typeof b=="number"&&Nh(t,""+b):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Bh.hasOwnProperty(u)?b!=null&&u==="onScroll"&&Pn("scroll",t):b!=null&&d0(t,u,b,f))}switch(n){case"input":If(t),t1(t,i,!1);break;case"textarea":If(t),i1(t);break;case"option":i.value!=null&&t.setAttribute("value",""+Oa(i.value));break;case"select":t.multiple=!!i.multiple,u=i.value,u!=null?Oc(t,!!i.multiple,u,!1):i.defaultValue!=null&&Oc(t,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=Ip)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ki(e),null;case 6:if(t&&e.stateNode!=null)WE(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ve(166));if(n=El(Yh.current),El(ho.current),Of(e)){if(i=e.stateNode,n=e.memoizedProps,i[ao]=e,(u=i.nodeValue!==n)&&(t=Jr,t!==null))switch(t.tag){case 3:zf(i.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&zf(i.nodeValue,n,(t.mode&1)!==0)}u&&(e.flags|=4)}else i=(n.nodeType===9?n:n.ownerDocument).createTextNode(i),i[ao]=e,e.stateNode=i}return Ki(e),null;case 13:if(Cn(Nn),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Dn&&Yr!==null&&(e.mode&1)!==0&&(e.flags&128)===0)cE(),Wc(),e.flags|=98560,u=!1;else if(u=Of(e),i!==null&&i.dehydrated!==null){if(t===null){if(!u)throw Error(Ve(318));if(u=e.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(Ve(317));u[ao]=e}else Wc(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;Ki(e),u=!1}else zs!==null&&(ky(zs),zs=null),u=!0;if(!u)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=n,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(Nn.current&1)!==0?yi===0&&(yi=3):X0())),e.updateQueue!==null&&(e.flags|=4),Ki(e),null);case 4:return Xc(),Ey(t,e),t===null&&Wh(e.stateNode.containerInfo),Ki(e),null;case 10:return k0(e.type._context),Ki(e),null;case 17:return Mr(e.type)&&Pp(),Ki(e),null;case 19:if(Cn(Nn),u=e.memoizedState,u===null)return Ki(e),null;if(i=(e.flags&128)!==0,f=u.rendering,f===null)if(i)hh(u,!1);else{if(yi!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(f=zp(t),f!==null){for(e.flags|=128,hh(u,!1),i=f.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=n,n=e.child;n!==null;)u=n,t=i,u.flags&=14680066,f=u.alternate,f===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,t=f.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return An(Nn,Nn.current&1|2),e.child}t=t.sibling}u.tail!==null&&ei()>Yc&&(e.flags|=128,i=!0,hh(u,!1),e.lanes=4194304)}else{if(!i)if(t=zp(f),t!==null){if(e.flags|=128,i=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),hh(u,!0),u.tail===null&&u.tailMode==="hidden"&&!f.alternate&&!Dn)return Ki(e),null}else 2*ei()-u.renderingStartTime>Yc&&n!==1073741824&&(e.flags|=128,i=!0,hh(u,!1),e.lanes=4194304);u.isBackwards?(f.sibling=e.child,e.child=f):(n=u.last,n!==null?n.sibling=f:e.child=f,u.last=f)}return u.tail!==null?(e=u.tail,u.rendering=e,u.tail=e.sibling,u.renderingStartTime=ei(),e.sibling=null,n=Nn.current,An(Nn,i?n&1|2:n&1),e):(Ki(e),null);case 22:case 23:return q0(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&(e.mode&1)!==0?(qr&1073741824)!==0&&(Ki(e),e.subtreeFlags&6&&(e.flags|=8192)):Ki(e),null;case 24:return null;case 25:return null}throw Error(Ve(156,e.tag))}function KC(t,e){switch(I0(e),e.tag){case 1:return Mr(e.type)&&Pp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Xc(),Cn(Cr),Cn(tr),O0(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return z0(e),null;case 13:if(Cn(Nn),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ve(340));Wc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Cn(Nn),null;case 4:return Xc(),null;case 10:return k0(e.type._context),null;case 22:case 23:return q0(),null;case 24:return null;default:return null}}var Nf=!1,Qi=!1,JC=typeof WeakSet=="function"?WeakSet:Set,pt=null;function Lc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(i){qn(t,e,i)}else n.current=null}function Ty(t,e,n){try{n()}catch(i){qn(t,e,i)}}var W1=!1;function QC(t,e){if(ay=Tp,t=Y2(),S0(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var o=i.anchorOffset,u=i.focusNode;i=i.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var f=0,l=-1,b=-1,T=0,C=0,L=t,k=null;t:for(;;){for(var X;L!==n||o!==0&&L.nodeType!==3||(l=f+o),L!==u||i!==0&&L.nodeType!==3||(b=f+i),L.nodeType===3&&(f+=L.nodeValue.length),(X=L.firstChild)!==null;)k=L,L=X;for(;;){if(L===t)break t;if(k===n&&++T===o&&(l=f),k===u&&++C===i&&(b=f),(X=L.nextSibling)!==null)break;L=k,k=L.parentNode}L=X}n=l===-1||b===-1?null:{start:l,end:b}}else n=null}n=n||{start:0,end:0}}else n=null;for(ly={focusedElem:t,selectionRange:n},Tp=!1,pt=e;pt!==null;)if(e=pt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pt=t;else for(;pt!==null;){e=pt;try{var te=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(te!==null){var ie=te.memoizedProps,ye=te.memoizedState,J=e.stateNode,W=J.getSnapshotBeforeUpdate(e.elementType===e.type?ie:Rs(e.type,ie),ye);J.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var Q=e.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ve(163))}}catch(_e){qn(e,e.return,_e)}if(t=e.sibling,t!==null){t.return=e.return,pt=t;break}pt=e.return}return te=W1,W1=!1,te}function kh(t,e,n){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&t)===t){var u=o.destroy;o.destroy=void 0,u!==void 0&&Ty(e,n,u)}o=o.next}while(o!==i)}}function mm(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var i=n.create;n.destroy=i()}n=n.next}while(n!==e)}}function Sy(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function qE(t){var e=t.alternate;e!==null&&(t.alternate=null,qE(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ao],delete e[Xh],delete e[hy],delete e[zC],delete e[OC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function XE(t){return t.tag===5||t.tag===3||t.tag===4}function q1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||XE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ay(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ip));else if(i!==4&&(t=t.child,t!==null))for(Ay(t,e,n),t=t.sibling;t!==null;)Ay(t,e,n),t=t.sibling}function Iy(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(Iy(t,e,n),t=t.sibling;t!==null;)Iy(t,e,n),t=t.sibling}var Fi=null,Ds=!1;function fa(t,e,n){for(n=n.child;n!==null;)ZE(t,e,n),n=n.sibling}function ZE(t,e,n){if(uo&&typeof uo.onCommitFiberUnmount=="function")try{uo.onCommitFiberUnmount(am,n)}catch{}switch(n.tag){case 5:Qi||Lc(n,e);case 6:var i=Fi,o=Ds;Fi=null,fa(t,e,n),Fi=i,Ds=o,Fi!==null&&(Ds?(t=Fi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Fi.removeChild(n.stateNode));break;case 18:Fi!==null&&(Ds?(t=Fi,n=n.stateNode,t.nodeType===8?e_(t.parentNode,n):t.nodeType===1&&e_(t,n),Gh(t)):e_(Fi,n.stateNode));break;case 4:i=Fi,o=Ds,Fi=n.stateNode.containerInfo,Ds=!0,fa(t,e,n),Fi=i,Ds=o;break;case 0:case 11:case 14:case 15:if(!Qi&&(i=n.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var u=o,f=u.destroy;u=u.tag,f!==void 0&&((u&2)!==0||(u&4)!==0)&&Ty(n,e,f),o=o.next}while(o!==i)}fa(t,e,n);break;case 1:if(!Qi&&(Lc(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(l){qn(n,e,l)}fa(t,e,n);break;case 21:fa(t,e,n);break;case 22:n.mode&1?(Qi=(i=Qi)||n.memoizedState!==null,fa(t,e,n),Qi=i):fa(t,e,n);break;default:fa(t,e,n)}}function X1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new JC),e.forEach(function(i){var o=lM.bind(null,t,i);n.has(i)||(n.add(i),i.then(o,o))})}}function Ls(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var o=n[i];try{var u=t,f=e,l=f;e:for(;l!==null;){switch(l.tag){case 5:Fi=l.stateNode,Ds=!1;break e;case 3:Fi=l.stateNode.containerInfo,Ds=!0;break e;case 4:Fi=l.stateNode.containerInfo,Ds=!0;break e}l=l.return}if(Fi===null)throw Error(Ve(160));ZE(u,f,o),Fi=null,Ds=!1;var b=o.alternate;b!==null&&(b.return=null),o.return=null}catch(T){qn(o,e,T)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)YE(e,t),e=e.sibling}function YE(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ls(e,t),no(t),i&4){try{kh(3,t,t.return),mm(3,t)}catch(ie){qn(t,t.return,ie)}try{kh(5,t,t.return)}catch(ie){qn(t,t.return,ie)}}break;case 1:Ls(e,t),no(t),i&512&&n!==null&&Lc(n,n.return);break;case 5:if(Ls(e,t),no(t),i&512&&n!==null&&Lc(n,n.return),t.flags&32){var o=t.stateNode;try{Nh(o,"")}catch(ie){qn(t,t.return,ie)}}if(i&4&&(o=t.stateNode,o!=null)){var u=t.memoizedProps,f=n!==null?n.memoizedProps:u,l=t.type,b=t.updateQueue;if(t.updateQueue=null,b!==null)try{l==="input"&&u.type==="radio"&&u.name!=null&&_2(o,u),K_(l,f);var T=K_(l,u);for(f=0;f<b.length;f+=2){var C=b[f],L=b[f+1];C==="style"?w2(o,L):C==="dangerouslySetInnerHTML"?x2(o,L):C==="children"?Nh(o,L):d0(o,C,L,T)}switch(l){case"input":W_(o,u);break;case"textarea":y2(o,u);break;case"select":var k=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!u.multiple;var X=u.value;X!=null?Oc(o,!!u.multiple,X,!1):k!==!!u.multiple&&(u.defaultValue!=null?Oc(o,!!u.multiple,u.defaultValue,!0):Oc(o,!!u.multiple,u.multiple?[]:"",!1))}o[Xh]=u}catch(ie){qn(t,t.return,ie)}}break;case 6:if(Ls(e,t),no(t),i&4){if(t.stateNode===null)throw Error(Ve(162));o=t.stateNode,u=t.memoizedProps;try{o.nodeValue=u}catch(ie){qn(t,t.return,ie)}}break;case 3:if(Ls(e,t),no(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Gh(e.containerInfo)}catch(ie){qn(t,t.return,ie)}break;case 4:Ls(e,t),no(t);break;case 13:Ls(e,t),no(t),o=t.child,o.flags&8192&&(u=o.memoizedState!==null,o.stateNode.isHidden=u,!u||o.alternate!==null&&o.alternate.memoizedState!==null||($0=ei())),i&4&&X1(t);break;case 22:if(C=n!==null&&n.memoizedState!==null,t.mode&1?(Qi=(T=Qi)||C,Ls(e,t),Qi=T):Ls(e,t),no(t),i&8192){if(T=t.memoizedState!==null,(t.stateNode.isHidden=T)&&!C&&(t.mode&1)!==0)for(pt=t,C=t.child;C!==null;){for(L=pt=C;pt!==null;){switch(k=pt,X=k.child,k.tag){case 0:case 11:case 14:case 15:kh(4,k,k.return);break;case 1:Lc(k,k.return);var te=k.stateNode;if(typeof te.componentWillUnmount=="function"){i=k,n=k.return;try{e=i,te.props=e.memoizedProps,te.state=e.memoizedState,te.componentWillUnmount()}catch(ie){qn(i,n,ie)}}break;case 5:Lc(k,k.return);break;case 22:if(k.memoizedState!==null){Y1(L);continue}}X!==null?(X.return=k,pt=X):Y1(L)}C=C.sibling}e:for(C=null,L=t;;){if(L.tag===5){if(C===null){C=L;try{o=L.stateNode,T?(u=o.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(l=L.stateNode,b=L.memoizedProps.style,f=b!=null&&b.hasOwnProperty("display")?b.display:null,l.style.display=b2("display",f))}catch(ie){qn(t,t.return,ie)}}}else if(L.tag===6){if(C===null)try{L.stateNode.nodeValue=T?"":L.memoizedProps}catch(ie){qn(t,t.return,ie)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===t)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===t)break e;for(;L.sibling===null;){if(L.return===null||L.return===t)break e;C===L&&(C=null),L=L.return}C===L&&(C=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Ls(e,t),no(t),i&4&&X1(t);break;case 21:break;default:Ls(e,t),no(t)}}function no(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(XE(n)){var i=n;break e}n=n.return}throw Error(Ve(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&(Nh(o,""),i.flags&=-33);var u=q1(t);Iy(t,u,o);break;case 3:case 4:var f=i.stateNode.containerInfo,l=q1(t);Ay(t,l,f);break;default:throw Error(Ve(161))}}catch(b){qn(t,t.return,b)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function eM(t,e,n){pt=t,KE(t)}function KE(t,e,n){for(var i=(t.mode&1)!==0;pt!==null;){var o=pt,u=o.child;if(o.tag===22&&i){var f=o.memoizedState!==null||Nf;if(!f){var l=o.alternate,b=l!==null&&l.memoizedState!==null||Qi;l=Nf;var T=Qi;if(Nf=f,(Qi=b)&&!T)for(pt=o;pt!==null;)f=pt,b=f.child,f.tag===22&&f.memoizedState!==null?K1(o):b!==null?(b.return=f,pt=b):K1(o);for(;u!==null;)pt=u,KE(u),u=u.sibling;pt=o,Nf=l,Qi=T}Z1(t)}else(o.subtreeFlags&8772)!==0&&u!==null?(u.return=o,pt=u):Z1(t)}}function Z1(t){for(;pt!==null;){var e=pt;if((e.flags&8772)!==0){var n=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:Qi||mm(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Qi)if(n===null)i.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:Rs(e.type,n.memoizedProps);i.componentDidUpdate(o,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var u=e.updateQueue;u!==null&&L1(e,u,i);break;case 3:var f=e.updateQueue;if(f!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}L1(e,f,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var b=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&n.focus();break;case"img":b.src&&(n.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var T=e.alternate;if(T!==null){var C=T.memoizedState;if(C!==null){var L=C.dehydrated;L!==null&&Gh(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ve(163))}Qi||e.flags&512&&Sy(e)}catch(k){qn(e,e.return,k)}}if(e===t){pt=null;break}if(n=e.sibling,n!==null){n.return=e.return,pt=n;break}pt=e.return}}function Y1(t){for(;pt!==null;){var e=pt;if(e===t){pt=null;break}var n=e.sibling;if(n!==null){n.return=e.return,pt=n;break}pt=e.return}}function K1(t){for(;pt!==null;){var e=pt;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{mm(4,e)}catch(b){qn(e,n,b)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(b){qn(e,o,b)}}var u=e.return;try{Sy(e)}catch(b){qn(e,u,b)}break;case 5:var f=e.return;try{Sy(e)}catch(b){qn(e,f,b)}}}catch(b){qn(e,e.return,b)}if(e===t){pt=null;break}var l=e.sibling;if(l!==null){l.return=e.return,pt=l;break}pt=e.return}}var tM=Math.ceil,Bp=Ho.ReactCurrentDispatcher,G0=Ho.ReactCurrentOwner,ys=Ho.ReactCurrentBatchConfig,on=0,Pi=null,ui=null,Ui=0,qr=0,Rc=Va(0),yi=0,ed=null,kl=0,gm=0,H0=0,Lh=null,Ir=null,$0=0,Yc=1/0,ko=null,Np=!1,Py=null,La=null,Uf=!1,Sa=null,Up=0,Rh=0,Cy=null,lp=-1,cp=0;function gr(){return(on&6)!==0?ei():lp!==-1?lp:lp=ei()}function Ra(t){return(t.mode&1)===0?1:(on&2)!==0&&Ui!==0?Ui&-Ui:BC.transition!==null?(cp===0&&(cp=D2()),cp):(t=mn,t!==0||(t=window.event,t=t===void 0?16:V2(t.type)),t)}function Bs(t,e,n,i){if(50<Rh)throw Rh=0,Cy=null,Error(Ve(185));cd(t,n,i),((on&2)===0||t!==Pi)&&(t===Pi&&((on&2)===0&&(gm|=n),yi===4&&wa(t,Ui)),kr(t,i),n===1&&on===0&&(e.mode&1)===0&&(Yc=ei()+500,dm&&ja()))}function kr(t,e){var n=t.callbackNode;BP(t,e);var i=Ep(t,t===Pi?Ui:0);if(i===0)n!==null&&o1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(n!=null&&o1(n),e===1)t.tag===0?FC(J1.bind(null,t)):oE(J1.bind(null,t)),RC(function(){(on&6)===0&&ja()}),n=null;else{switch(z2(i)){case 1:n=_0;break;case 4:n=L2;break;case 16:n=wp;break;case 536870912:n=R2;break;default:n=wp}n=sT(n,JE.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function JE(t,e){if(lp=-1,cp=0,(on&6)!==0)throw Error(Ve(327));var n=t.callbackNode;if(Vc()&&t.callbackNode!==n)return null;var i=Ep(t,t===Pi?Ui:0);if(i===0)return null;if((i&30)!==0||(i&t.expiredLanes)!==0||e)e=Vp(t,i);else{e=i;var o=on;on|=2;var u=eT();(Pi!==t||Ui!==e)&&(ko=null,Yc=ei()+500,Sl(t,e));do try{rM();break}catch(l){QE(t,l)}while(1);M0(),Bp.current=u,on=o,ui!==null?e=0:(Pi=null,Ui=0,e=yi)}if(e!==0){if(e===2&&(o=ny(t),o!==0&&(i=o,e=My(t,o))),e===1)throw n=ed,Sl(t,0),wa(t,i),kr(t,ei()),n;if(e===6)wa(t,i);else{if(o=t.current.alternate,(i&30)===0&&!nM(o)&&(e=Vp(t,i),e===2&&(u=ny(t),u!==0&&(i=u,e=My(t,u))),e===1))throw n=ed,Sl(t,0),wa(t,i),kr(t,ei()),n;switch(t.finishedWork=o,t.finishedLanes=i,e){case 0:case 1:throw Error(Ve(345));case 2:vl(t,Ir,ko);break;case 3:if(wa(t,i),(i&130023424)===i&&(e=$0+500-ei(),10<e)){if(Ep(t,0)!==0)break;if(o=t.suspendedLanes,(o&i)!==i){gr(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=uy(vl.bind(null,t,Ir,ko),e);break}vl(t,Ir,ko);break;case 4:if(wa(t,i),(i&4194240)===i)break;for(e=t.eventTimes,o=-1;0<i;){var f=31-Fs(i);u=1<<f,f=e[f],f>o&&(o=f),i&=~u}if(i=o,i=ei()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*tM(i/1960))-i,10<i){t.timeoutHandle=uy(vl.bind(null,t,Ir,ko),i);break}vl(t,Ir,ko);break;case 5:vl(t,Ir,ko);break;default:throw Error(Ve(329))}}}return kr(t,ei()),t.callbackNode===n?JE.bind(null,t):null}function My(t,e){var n=Lh;return t.current.memoizedState.isDehydrated&&(Sl(t,e).flags|=256),t=Vp(t,e),t!==2&&(e=Ir,Ir=n,e!==null&&ky(e)),t}function ky(t){Ir===null?Ir=t:Ir.push.apply(Ir,t)}function nM(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var i=0;i<n.length;i++){var o=n[i],u=o.getSnapshot;o=o.value;try{if(!Us(u(),o))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function wa(t,e){for(e&=~H0,e&=~gm,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fs(e),i=1<<n;t[n]=-1,e&=~i}}function J1(t){if((on&6)!==0)throw Error(Ve(327));Vc();var e=Ep(t,0);if((e&1)===0)return kr(t,ei()),null;var n=Vp(t,e);if(t.tag!==0&&n===2){var i=ny(t);i!==0&&(e=i,n=My(t,i))}if(n===1)throw n=ed,Sl(t,0),wa(t,e),kr(t,ei()),n;if(n===6)throw Error(Ve(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,vl(t,Ir,ko),kr(t,ei()),null}function W0(t,e){var n=on;on|=1;try{return t(e)}finally{on=n,on===0&&(Yc=ei()+500,dm&&ja())}}function Ll(t){Sa!==null&&Sa.tag===0&&(on&6)===0&&Vc();var e=on;on|=1;var n=ys.transition,i=mn;try{if(ys.transition=null,mn=1,t)return t()}finally{mn=i,ys.transition=n,on=e,(on&6)===0&&ja()}}function q0(){qr=Rc.current,Cn(Rc)}function Sl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LC(n)),ui!==null)for(n=ui.return;n!==null;){var i=n;switch(I0(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Pp();break;case 3:Xc(),Cn(Cr),Cn(tr),O0();break;case 5:z0(i);break;case 4:Xc();break;case 13:Cn(Nn);break;case 19:Cn(Nn);break;case 10:k0(i.type._context);break;case 22:case 23:q0()}n=n.return}if(Pi=t,ui=t=Da(t.current,null),Ui=qr=e,yi=0,ed=null,H0=gm=kl=0,Ir=Lh=null,wl!==null){for(e=0;e<wl.length;e++)if(n=wl[e],i=n.interleaved,i!==null){n.interleaved=null;var o=i.next,u=n.pending;if(u!==null){var f=u.next;u.next=o,i.next=f}n.pending=i}wl=null}return t}function QE(t,e){do{var n=ui;try{if(M0(),sp.current=Fp,Op){for(var i=Un.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Op=!1}if(Ml=0,Ii=_i=Un=null,Mh=!1,Kh=0,G0.current=null,n===null||n.return===null){yi=1,ed=e,ui=null;break}e:{var u=t,f=n.return,l=n,b=e;if(e=Ui,l.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var T=b,C=l,L=C.tag;if((C.mode&1)===0&&(L===0||L===11||L===15)){var k=C.alternate;k?(C.updateQueue=k.updateQueue,C.memoizedState=k.memoizedState,C.lanes=k.lanes):(C.updateQueue=null,C.memoizedState=null)}var X=N1(f);if(X!==null){X.flags&=-257,U1(X,f,l,u,e),X.mode&1&&B1(u,T,e),e=X,b=T;var te=e.updateQueue;if(te===null){var ie=new Set;ie.add(b),e.updateQueue=ie}else te.add(b);break e}else{if((e&1)===0){B1(u,T,e),X0();break e}b=Error(Ve(426))}}else if(Dn&&l.mode&1){var ye=N1(f);if(ye!==null){(ye.flags&65536)===0&&(ye.flags|=256),U1(ye,f,l,u,e),P0(Zc(b,l));break e}}u=b=Zc(b,l),yi!==4&&(yi=2),Lh===null?Lh=[u]:Lh.push(u),u=f;do{switch(u.tag){case 3:u.flags|=65536,e&=-e,u.lanes|=e;var J=OE(u,b,e);k1(u,J);break e;case 1:l=b;var W=u.type,Q=u.stateNode;if((u.flags&128)===0&&(typeof W.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(La===null||!La.has(Q)))){u.flags|=65536,e&=-e,u.lanes|=e;var _e=FE(u,l,e);k1(u,_e);break e}}u=u.return}while(u!==null)}nT(n)}catch(we){e=we,ui===n&&n!==null&&(ui=n=n.return);continue}break}while(1)}function eT(){var t=Bp.current;return Bp.current=Fp,t===null?Fp:t}function X0(){(yi===0||yi===3||yi===2)&&(yi=4),Pi===null||(kl&268435455)===0&&(gm&268435455)===0||wa(Pi,Ui)}function Vp(t,e){var n=on;on|=2;var i=eT();(Pi!==t||Ui!==e)&&(ko=null,Sl(t,e));do try{iM();break}catch(o){QE(t,o)}while(1);if(M0(),on=n,Bp.current=i,ui!==null)throw Error(Ve(261));return Pi=null,Ui=0,yi}function iM(){for(;ui!==null;)tT(ui)}function rM(){for(;ui!==null&&!CP();)tT(ui)}function tT(t){var e=rT(t.alternate,t,qr);t.memoizedProps=t.pendingProps,e===null?nT(t):ui=e,G0.current=null}function nT(t){var e=t;do{var n=e.alternate;if(t=e.return,(e.flags&32768)===0){if(n=YC(n,e,qr),n!==null){ui=n;return}}else{if(n=KC(n,e),n!==null){n.flags&=32767,ui=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{yi=6,ui=null;return}}if(e=e.sibling,e!==null){ui=e;return}ui=e=t}while(e!==null);yi===0&&(yi=5)}function vl(t,e,n){var i=mn,o=ys.transition;try{ys.transition=null,mn=1,sM(t,e,n,i)}finally{ys.transition=o,mn=i}return null}function sM(t,e,n,i){do Vc();while(Sa!==null);if((on&6)!==0)throw Error(Ve(327));n=t.finishedWork;var o=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ve(177));t.callbackNode=null,t.callbackPriority=0;var u=n.lanes|n.childLanes;if(NP(t,u),t===Pi&&(ui=Pi=null,Ui=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||Uf||(Uf=!0,sT(wp,function(){return Vc(),null})),u=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||u){u=ys.transition,ys.transition=null;var f=mn;mn=1;var l=on;on|=4,G0.current=null,QC(t,n),YE(n,t),SC(ly),Tp=!!ay,ly=ay=null,t.current=n,eM(n),MP(),on=l,mn=f,ys.transition=u}else t.current=n;if(Uf&&(Uf=!1,Sa=t,Up=o),u=t.pendingLanes,u===0&&(La=null),RP(n.stateNode),kr(t,ei()),e!==null)for(i=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],i(o.value,{componentStack:o.stack,digest:o.digest});if(Np)throw Np=!1,t=Py,Py=null,t;return(Up&1)!==0&&t.tag!==0&&Vc(),u=t.pendingLanes,(u&1)!==0?t===Cy?Rh++:(Rh=0,Cy=t):Rh=0,ja(),null}function Vc(){if(Sa!==null){var t=z2(Up),e=ys.transition,n=mn;try{if(ys.transition=null,mn=16>t?16:t,Sa===null)var i=!1;else{if(t=Sa,Sa=null,Up=0,(on&6)!==0)throw Error(Ve(331));var o=on;for(on|=4,pt=t.current;pt!==null;){var u=pt,f=u.child;if((pt.flags&16)!==0){var l=u.deletions;if(l!==null){for(var b=0;b<l.length;b++){var T=l[b];for(pt=T;pt!==null;){var C=pt;switch(C.tag){case 0:case 11:case 15:kh(8,C,u)}var L=C.child;if(L!==null)L.return=C,pt=L;else for(;pt!==null;){C=pt;var k=C.sibling,X=C.return;if(qE(C),C===T){pt=null;break}if(k!==null){k.return=X,pt=k;break}pt=X}}}var te=u.alternate;if(te!==null){var ie=te.child;if(ie!==null){te.child=null;do{var ye=ie.sibling;ie.sibling=null,ie=ye}while(ie!==null)}}pt=u}}if((u.subtreeFlags&2064)!==0&&f!==null)f.return=u,pt=f;else e:for(;pt!==null;){if(u=pt,(u.flags&2048)!==0)switch(u.tag){case 0:case 11:case 15:kh(9,u,u.return)}var J=u.sibling;if(J!==null){J.return=u.return,pt=J;break e}pt=u.return}}var W=t.current;for(pt=W;pt!==null;){f=pt;var Q=f.child;if((f.subtreeFlags&2064)!==0&&Q!==null)Q.return=f,pt=Q;else e:for(f=W;pt!==null;){if(l=pt,(l.flags&2048)!==0)try{switch(l.tag){case 0:case 11:case 15:mm(9,l)}}catch(we){qn(l,l.return,we)}if(l===f){pt=null;break e}var _e=l.sibling;if(_e!==null){_e.return=l.return,pt=_e;break e}pt=l.return}}if(on=o,ja(),uo&&typeof uo.onPostCommitFiberRoot=="function")try{uo.onPostCommitFiberRoot(am,t)}catch{}i=!0}return i}finally{mn=n,ys.transition=e}}return!1}function Q1(t,e,n){e=Zc(n,e),e=OE(t,e,1),t=ka(t,e,1),e=gr(),t!==null&&(cd(t,1,e),kr(t,e))}function qn(t,e,n){if(t.tag===3)Q1(t,t,n);else for(;e!==null;){if(e.tag===3){Q1(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(La===null||!La.has(i))){t=Zc(n,t),t=FE(e,t,1),e=ka(e,t,1),t=gr(),e!==null&&(cd(e,1,t),kr(e,t));break}}e=e.return}}function oM(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),e=gr(),t.pingedLanes|=t.suspendedLanes&n,Pi===t&&(Ui&n)===n&&(yi===4||yi===3&&(Ui&130023424)===Ui&&500>ei()-$0?Sl(t,0):H0|=n),kr(t,e)}function iT(t,e){e===0&&((t.mode&1)===0?e=1:(e=Mf,Mf<<=1,(Mf&130023424)===0&&(Mf=4194304)));var n=gr();t=No(t,e),t!==null&&(cd(t,e,n),kr(t,n))}function aM(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),iT(t,n)}function lM(t,e){var n=0;switch(t.tag){case 13:var i=t.stateNode,o=t.memoizedState;o!==null&&(n=o.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(Ve(314))}i!==null&&i.delete(e),iT(t,n)}var rT;rT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Cr.current)Pr=!0;else{if((t.lanes&n)===0&&(e.flags&128)===0)return Pr=!1,ZC(t,e,n);Pr=(t.flags&131072)!==0}else Pr=!1,Dn&&(e.flags&1048576)!==0&&aE(e,kp,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;ap(t,e),t=e.pendingProps;var o=$c(e,tr.current);Uc(e,n),o=B0(null,e,i,t,o,n);var u=N0();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Mr(i)?(u=!0,Cp(e)):u=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,R0(e),o.updater=fm,e.stateNode=o,o._reactInternals=e,_y(e,i,t,n),e=xy(null,e,i,!0,u,n)):(e.tag=0,Dn&&u&&A0(e),fr(null,e,o,n),e=e.child),e;case 16:i=e.elementType;e:{switch(ap(t,e),t=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=uM(i),t=Rs(i,t),o){case 0:e=vy(null,e,i,t,n);break e;case 1:e=G1(null,e,i,t,n);break e;case 11:e=V1(null,e,i,t,n);break e;case 14:e=j1(null,e,i,Rs(i.type,t),n);break e}throw Error(Ve(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),vy(t,e,i,o,n);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),G1(t,e,i,o,n);case 3:e:{if(VE(e),t===null)throw Error(Ve(387));i=e.pendingProps,u=e.memoizedState,o=u.element,hE(t,e),Dp(e,i,null,n);var f=e.memoizedState;if(i=f.element,u.isDehydrated)if(u={element:i,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=u,e.memoizedState=u,e.flags&256){o=Zc(Error(Ve(423)),e),e=H1(t,e,i,n,o);break e}else if(i!==o){o=Zc(Error(Ve(424)),e),e=H1(t,e,i,n,o);break e}else for(Yr=Ma(e.stateNode.containerInfo.firstChild),Jr=e,Dn=!0,zs=null,n=mE(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Wc(),i===o){e=Uo(t,e,n);break e}fr(t,e,i,n)}e=e.child}return e;case 5:return gE(e),t===null&&py(e),i=e.type,o=e.pendingProps,u=t!==null?t.memoizedProps:null,f=o.children,cy(i,o)?f=null:u!==null&&cy(i,u)&&(e.flags|=32),UE(t,e),fr(t,e,f,n),e.child;case 6:return t===null&&py(e),null;case 13:return jE(t,e,n);case 4:return D0(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=qc(e,null,i,n):fr(t,e,i,n),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),V1(t,e,i,o,n);case 7:return fr(t,e,e.pendingProps,n),e.child;case 8:return fr(t,e,e.pendingProps.children,n),e.child;case 12:return fr(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,u=e.memoizedProps,f=o.value,An(Lp,i._currentValue),i._currentValue=f,u!==null)if(Us(u.value,f)){if(u.children===o.children&&!Cr.current){e=Uo(t,e,n);break e}}else for(u=e.child,u!==null&&(u.return=e);u!==null;){var l=u.dependencies;if(l!==null){f=u.child;for(var b=l.firstContext;b!==null;){if(b.context===i){if(u.tag===1){b=Oo(-1,n&-n),b.tag=2;var T=u.updateQueue;if(T!==null){T=T.shared;var C=T.pending;C===null?b.next=b:(b.next=C.next,C.next=b),T.pending=b}}u.lanes|=n,b=u.alternate,b!==null&&(b.lanes|=n),my(u.return,n,e),l.lanes|=n;break}b=b.next}}else if(u.tag===10)f=u.type===e.type?null:u.child;else if(u.tag===18){if(f=u.return,f===null)throw Error(Ve(341));f.lanes|=n,l=f.alternate,l!==null&&(l.lanes|=n),my(f,n,e),f=u.sibling}else f=u.child;if(f!==null)f.return=u;else for(f=u;f!==null;){if(f===e){f=null;break}if(u=f.sibling,u!==null){u.return=f.return,f=u;break}f=f.return}u=f}fr(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,Uc(e,n),o=xs(o),i=i(o),e.flags|=1,fr(t,e,i,n),e.child;case 14:return i=e.type,o=Rs(i,e.pendingProps),o=Rs(i.type,o),j1(t,e,i,o,n);case 15:return BE(t,e,e.type,e.pendingProps,n);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Rs(i,o),ap(t,e),e.tag=1,Mr(i)?(t=!0,Cp(e)):t=!1,Uc(e,n),fE(e,i,o),_y(e,i,o,n),xy(null,e,i,!0,t,n);case 19:return GE(t,e,n);case 22:return NE(t,e,n)}throw Error(Ve(156,e.tag))};function sT(t,e){return k2(t,e)}function cM(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(t,e,n,i){return new cM(t,e,n,i)}function Z0(t){return t=t.prototype,!(!t||!t.isReactComponent)}function uM(t){if(typeof t=="function")return Z0(t)?1:0;if(t!=null){if(t=t.$$typeof,t===p0)return 11;if(t===m0)return 14}return 2}function Da(t,e){var n=t.alternate;return n===null?(n=_s(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function up(t,e,n,i,o,u){var f=2;if(i=t,typeof t=="function")Z0(t)&&(f=1);else if(typeof t=="string")f=5;else e:switch(t){case Ec:return Al(n.children,o,u,e);case f0:f=8,o|=8;break;case V_:return t=_s(12,n,e,o|2),t.elementType=V_,t.lanes=u,t;case j_:return t=_s(13,n,e,o),t.elementType=j_,t.lanes=u,t;case G_:return t=_s(19,n,e,o),t.elementType=G_,t.lanes=u,t;case p2:return _m(n,o,u,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case d2:f=10;break e;case f2:f=9;break e;case p0:f=11;break e;case m0:f=14;break e;case va:f=16,i=null;break e}throw Error(Ve(130,t==null?t:typeof t,""))}return e=_s(f,n,e,o),e.elementType=t,e.type=i,e.lanes=u,e}function Al(t,e,n,i){return t=_s(7,t,i,e),t.lanes=n,t}function _m(t,e,n,i){return t=_s(22,t,i,e),t.elementType=p2,t.lanes=n,t.stateNode={isHidden:!1},t}function l_(t,e,n){return t=_s(6,t,null,e),t.lanes=n,t}function c_(t,e,n){return e=_s(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function hM(t,e,n,i,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Gg(0),this.expirationTimes=Gg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gg(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Y0(t,e,n,i,o,u,f,l,b){return t=new hM(t,e,n,l,b),e===1?(e=1,u===!0&&(e|=8)):e=0,u=_s(3,null,null,e),t.current=u,u.stateNode=t,u.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},R0(u),t}function dM(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wc,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}function oT(t){if(!t)return Fa;t=t._reactInternals;e:{if(Fl(t)!==t||t.tag!==1)throw Error(Ve(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Mr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ve(171))}if(t.tag===1){var n=t.type;if(Mr(n))return sE(t,n,e)}return e}function aT(t,e,n,i,o,u,f,l,b){return t=Y0(n,i,!0,t,o,u,f,l,b),t.context=oT(null),n=t.current,i=gr(),o=Ra(n),u=Oo(i,o),u.callback=e!=null?e:null,ka(n,u,o),t.current.lanes=o,cd(t,o,i),kr(t,i),t}function ym(t,e,n,i){var o=e.current,u=gr(),f=Ra(o);return n=oT(n),e.context===null?e.context=n:e.pendingContext=n,e=Oo(u,f),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=ka(o,e,f),t!==null&&(Bs(t,o,f,u),rp(t,o,f)),f}function jp(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function eb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function K0(t,e){eb(t,e),(t=t.alternate)&&eb(t,e)}function fM(){return null}var lT=typeof reportError=="function"?reportError:function(t){console.error(t)};function J0(t){this._internalRoot=t}vm.prototype.render=J0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ve(409));ym(t,e,null,null)};vm.prototype.unmount=J0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ll(function(){ym(null,t,null,null)}),e[Bo]=null}};function vm(t){this._internalRoot=t}vm.prototype.unstable_scheduleHydration=function(t){if(t){var e=B2();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ba.length&&e!==0&&e<ba[n].priority;n++);ba.splice(n,0,t),n===0&&U2(t)}};function Q0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function xm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tb(){}function pM(t,e,n,i,o){if(o){if(typeof i=="function"){var u=i;i=function(){var T=jp(f);u.call(T)}}var f=aT(e,i,t,0,null,!1,!1,"",tb);return t._reactRootContainer=f,t[Bo]=f.current,Wh(t.nodeType===8?t.parentNode:t),Ll(),f}for(;o=t.lastChild;)t.removeChild(o);if(typeof i=="function"){var l=i;i=function(){var T=jp(b);l.call(T)}}var b=Y0(t,0,!1,null,null,!1,!1,"",tb);return t._reactRootContainer=b,t[Bo]=b.current,Wh(t.nodeType===8?t.parentNode:t),Ll(function(){ym(e,b,n,i)}),b}function bm(t,e,n,i,o){var u=n._reactRootContainer;if(u){var f=u;if(typeof o=="function"){var l=o;o=function(){var b=jp(f);l.call(b)}}ym(e,f,t,o)}else f=pM(n,e,t,o,i);return jp(f)}O2=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=bh(e.pendingLanes);n!==0&&(y0(e,n|1),kr(e,ei()),(on&6)===0&&(Yc=ei()+500,ja()))}break;case 13:Ll(function(){var i=No(t,1);if(i!==null){var o=gr();Bs(i,t,1,o)}}),K0(t,1)}};v0=function(t){if(t.tag===13){var e=No(t,134217728);if(e!==null){var n=gr();Bs(e,t,134217728,n)}K0(t,134217728)}};F2=function(t){if(t.tag===13){var e=Ra(t),n=No(t,e);if(n!==null){var i=gr();Bs(n,t,e,i)}K0(t,e)}};B2=function(){return mn};N2=function(t,e){var n=mn;try{return mn=t,e()}finally{mn=n}};Q_=function(t,e,n){switch(e){case"input":if(W_(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var o=hm(i);if(!o)throw Error(Ve(90));g2(i),W_(i,o)}}}break;case"textarea":y2(t,n);break;case"select":e=n.value,e!=null&&Oc(t,!!n.multiple,e,!1)}};S2=W0;A2=Ll;var mM={usingClientEntryPoint:!1,Events:[hd,Ic,hm,E2,T2,W0]},dh={findFiberByHostInstance:bl,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},gM={bundleType:dh.bundleType,version:dh.version,rendererPackageName:dh.rendererPackageName,rendererConfig:dh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ho.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=C2(t),t===null?null:t.stateNode},findFiberByHostInstance:dh.findFiberByHostInstance||fM,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vf.isDisabled&&Vf.supportsFiber)try{am=Vf.inject(gM),uo=Vf}catch{}}ts.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mM;ts.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Q0(e))throw Error(Ve(200));return dM(t,e,null,n)};ts.createRoot=function(t,e){if(!Q0(t))throw Error(Ve(299));var n=!1,i="",o=lT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=Y0(t,1,!1,null,null,n,!1,i,o),t[Bo]=e.current,Wh(t.nodeType===8?t.parentNode:t),new J0(e)};ts.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ve(188)):(t=Object.keys(t).join(","),Error(Ve(268,t)));return t=C2(e),t=t===null?null:t.stateNode,t};ts.flushSync=function(t){return Ll(t)};ts.hydrate=function(t,e,n){if(!xm(e))throw Error(Ve(200));return bm(null,t,e,!0,n)};ts.hydrateRoot=function(t,e,n){if(!Q0(t))throw Error(Ve(405));var i=n!=null&&n.hydratedSources||null,o=!1,u="",f=lT;if(n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),e=aT(e,null,t,1,n!=null?n:null,o,!1,u,f),t[Bo]=e.current,Wh(t),i)for(t=0;t<i.length;t++)n=i[t],o=n._getVersion,o=o(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new vm(e)};ts.render=function(t,e,n){if(!xm(e))throw Error(Ve(200));return bm(null,t,e,!1,n)};ts.unmountComponentAtNode=function(t){if(!xm(t))throw Error(Ve(40));return t._reactRootContainer?(Ll(function(){bm(null,null,t,!1,function(){t._reactRootContainer=null,t[Bo]=null})}),!0):!1};ts.unstable_batchedUpdates=W0;ts.unstable_renderSubtreeIntoContainer=function(t,e,n,i){if(!xm(n))throw Error(Ve(200));if(t==null||t._reactInternals===void 0)throw Error(Ve(38));return bm(t,e,n,!1,i)};ts.version="18.2.0-next-9e3b772b8-20220608";(function(t){function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}e(),t.exports=ts})(om);var nb=om.exports;N_.createRoot=nb.createRoot,N_.hydrateRoot=nb.hydrateRoot;function U(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Gp(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const ev=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser),ib=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ib&&parseFloat(ib[1]);const _M="3.2.12";function Vo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const hp=typeof process!="object"||String(process)!=="[object process]"||process.browser,yM=typeof window<"u"&&typeof window.orientation<"u",rb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);rb&&parseFloat(rb[1]);class vM{constructor(e,n){U(this,"name",void 0),U(this,"workerThread",void 0),U(this,"isRunning",!0),U(this,"result",void 0),U(this,"_resolve",()=>{}),U(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((i,o)=>{this._resolve=i,this._reject=o})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Vo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Vo(this.isRunning),this.isRunning=!1,this._reject(e)}}class u_{}const h_=new Map;function xM(t){Vo(t.source&&!t.url||!t.source&&t.url);let e=h_.get(t.source||t.url);return e||(t.url&&(e=bM(t.url),h_.set(t.url,e)),t.source&&(e=cT(t.source),h_.set(t.source,e))),Vo(e),e}function bM(t){if(!t.startsWith("http"))return t;const e=wM(t);return cT(e)}function cT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function wM(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function uT(t,e=!0,n){const i=n||new Set;if(t){if(sb(t))i.add(t);else if(sb(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const o in t)uT(t[o],e,i)}}return n===void 0?Array.from(i):[]}function sb(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const d_=()=>{};class Ly{static isSupported(){return typeof Worker<"u"&&hp||typeof u_<"u"&&!hp}constructor(e){U(this,"name",void 0),U(this,"source",void 0),U(this,"url",void 0),U(this,"terminated",!1),U(this,"worker",void 0),U(this,"onMessage",void 0),U(this,"onError",void 0),U(this,"_loadableURL","");const{name:n,source:i,url:o}=e;Vo(i||o),this.name=n,this.source=i,this.url=o,this.onMessage=d_,this.onError=u=>console.log(u),this.worker=hp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=d_,this.onError=d_,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,n){n=n||uT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=xM({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new u_(i,{eval:!1})}else if(this.source)e=new u_(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class EM{static isSupported(){return Ly.isSupported()}constructor(e){U(this,"name","unnamed"),U(this,"source",void 0),U(this,"url",void 0),U(this,"maxConcurrency",1),U(this,"maxMobileConcurrency",1),U(this,"onDebug",()=>{}),U(this,"reuseWorkers",!0),U(this,"props",{}),U(this,"jobQueue",[]),U(this,"idleQueue",[]),U(this,"count",0),U(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(o,u,f)=>o.done(f),i=(o,u)=>o.error(u)){const o=new Promise(u=>(this.jobQueue.push({name:e,onMessage:n,onError:i,onStart:u}),this));return this._startQueuedJob(),await o}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const i=new vM(n.name,e);e.onMessage=o=>n.onMessage(i,o.type,o.payload),e.onError=o=>n.onError(i,o),n.onStart(i);try{await i.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Ly({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return yM?this.maxMobileConcurrency:this.maxConcurrency}}const TM={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ro{static isSupported(){return Ly.isSupported()}static getWorkerFarm(e={}){return Ro._workerFarm=Ro._workerFarm||new Ro({}),Ro._workerFarm.setProps(e),Ro._workerFarm}constructor(e){U(this,"props",void 0),U(this,"workerPools",new Map),this.props={...TM},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:i,url:o}=e;let u=this.workerPools.get(n);return u||(u=new EM({name:n,source:i,url:o}),u.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,u)),u}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}U(Ro,"_workerFarm",void 0);const SM="latest";function AM(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let o=n.workerUrl;if(!o&&t.id==="compression"&&(o=e.workerUrl),e._workerType==="test"&&(o="modules/".concat(t.module,"/dist/").concat(i)),!o){let u=t.version;u==="latest"&&(u=SM);const f=u?"@".concat(u):"";o="https://unpkg.com/@loaders.gl/".concat(t.module).concat(f,"/dist/").concat(i)}return Vo(o),o}function IM(t,e=_M){Vo(t,"no worker provided");const n=t.version;return!(!e||!n)}function PM(t,e){return!Ro.isSupported()||!hp&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function CM(t,e,n,i,o){const u=t.id,f=AM(t,n),b=Ro.getWorkerFarm(n).getWorkerPool({name:u,url:f});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const T=await b.startJob("process-on-worker",MM.bind(null,o));return T.postMessage("process",{input:e,options:n,context:i}),await(await T.result).result}async function MM(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:o,input:u,options:f}=i;try{const l=await t(u,f);e.postMessage("done",{id:o,result:l})}catch(l){const b=l instanceof Error?l.message:"unknown error";e.postMessage("error",{id:o,error:b})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function hT(t){return t&&typeof t=="object"&&t.isBuffer}function kM(t){return hT(t)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t}function dT(t){if(hT(t))return kM(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function LM(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),o=new Uint8Array(e);for(let u=0;u<i.length;++u)if(i[u]!==o[u])return!1;return!0}function RM(...t){const e=t.map(u=>u instanceof ArrayBuffer?new Uint8Array(u):u),n=e.reduce((u,f)=>u+f.byteLength,0),i=new Uint8Array(n);let o=0;for(const u of e)i.set(u,o),o+=u.byteLength;return i.buffer}async function DM(t){const e=[];for await(const n of t)e.push(n);return RM(...e)}function ob(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class ab{constructor(e,n){U(this,"name",void 0),U(this,"type",void 0),U(this,"sampleSize",1),U(this,"time",void 0),U(this,"count",void 0),U(this,"samples",void 0),U(this,"lastTiming",void 0),U(this,"lastSampleTime",void 0),U(this,"lastSampleCount",void 0),U(this,"_count",0),U(this,"_time",0),U(this,"_samples",0),U(this,"_startTime",0),U(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=ob(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(ob()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class tv{constructor(e){U(this,"id",void 0),U(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:i}=e;return this.stats[n]||(e instanceof ab?this.stats[n]=e:this.stats[n]=new ab(n,i)),this.stats[n]}}let zM="";const lb={};function OM(t){for(const e in lb)if(t.startsWith(e)){const n=lb[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(zM).concat(t)),t}function FM(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}const BM=t=>typeof t=="boolean",Dh=t=>typeof t=="function",fd=t=>t!==null&&typeof t=="object",cb=t=>fd(t)&&t.constructor==={}.constructor,NM=t=>t&&typeof t[Symbol.iterator]=="function",UM=t=>t&&typeof t[Symbol.asyncIterator]=="function",cu=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,uu=t=>typeof Blob<"u"&&t instanceof Blob,VM=t=>t&&typeof t=="object"&&t.isBuffer,jM=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||fd(t)&&Dh(t.tee)&&Dh(t.cancel)&&Dh(t.getReader),GM=t=>fd(t)&&Dh(t.read)&&Dh(t.pipe)&&BM(t.readable),fT=t=>jM(t)||GM(t),HM=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,$M=/^([-\w.]+\/[-\w.+]+)/;function WM(t){const e=$M.exec(t);return e?e[1]:t}function ub(t){const e=HM.exec(t);return e?e[1]:""}const qM=/\?.*/;function wm(t){if(cu(t)){const e=f_(t.url||""),n=t.headers.get("content-type")||"";return{url:e,type:WM(n)||ub(e)}}return uu(t)?{url:f_(t.name||""),type:t.type||""}:typeof t=="string"?{url:f_(t),type:ub(t)}:{url:"",type:""}}function XM(t){return cu(t)?t.headers["content-length"]||-1:uu(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function f_(t){return t.replace(qM,"")}async function pT(t){if(cu(t))return t;const e={},n=XM(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:o}=wm(t);o&&(e["content-type"]=o);const u=await KM(t);u&&(e["x-first-bytes"]=u),typeof t=="string"&&(t=new TextEncoder().encode(t));const f=new Response(t,{headers:e});return Object.defineProperty(f,"url",{value:i}),f}async function ZM(t){if(!t.ok){const e=await YM(t);throw new Error(e)}}async function YM(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function KM(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(i=>{const o=new FileReader;o.onload=u=>{var f;return i(u==null||(f=u.target)===null||f===void 0?void 0:f.result)},o.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),i=JM(n);return"data:base64,".concat(i)}return null}function JM(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}async function hb(t,e){if(typeof t=="string"){t=OM(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await pT(t)}function mT(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&Boolean(process.versions.electron))return!0;const e=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function $o(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||mT()}const dp={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},jf=dp.window||dp.self||dp.global,fh=dp.process||{},gT=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";$o();const p_=globalThis;function _T(t){if(!t&&!$o())return"Node";if(mT(t))return"Electron";const n=t||(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o?"IE":p_.chrome?"Chrome":p_.safari?"Safari":p_.mozInnerScreenX?"Firefox":"Unknown"}function QM(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class ek{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";U(this,"storage",void 0),U(this,"id",void 0),U(this,"config",{}),this.storage=QM(i),this.id=e,this.config={},Object.assign(this.config,n),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function tk(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function nk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function m_(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const o=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const u=t.width*n,f=t.height*n,l=["font-size:1px;","padding:".concat(Math.floor(f/2),"px ").concat(Math.floor(u/2),"px;"),"line-height:".concat(f,"px;"),"background:url(".concat(o,");"),"background-size:".concat(u,"px ").concat(f,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),l]}let Hp;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Hp||(Hp={}));function db(t){return typeof t=="string"?Hp[t.toUpperCase()]||Hp.WHITE:t}function ik(t,e,n){return!$o&&typeof t=="string"&&(e&&(e=db(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=db(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function rk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const o of i)typeof t[o]=="function"&&(e.find(u=>o===u)||(t[o]=t[o].bind(t)))}function $p(t,e){if(!t)throw new Error(e||"Assertion failed")}function mc(){let t;if($o&&"performance"in jf){var e,n;t=jf==null||(e=jf.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in fh){var i;const o=fh==null||(i=fh.hrtime)===null||i===void 0?void 0:i.call(fh);t=o[0]*1e3+o[1]/1e6}else t=Date.now();return t}const gc={debug:$o&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},sk={enabled:!0,level:0};function ps(){}const fb={},pb={once:!0};class pd{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};U(this,"id",void 0),U(this,"VERSION",gT),U(this,"_startTs",mc()),U(this,"_deltaTs",mc()),U(this,"_storage",void 0),U(this,"userData",{}),U(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new ek("__probe-".concat(this.id,"__"),sk),this.userData={},this.timeStamp("".concat(this.id," started")),rk(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((mc()-this._startTs).toPrecision(10))}getDelta(){return Number((mc()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.updateConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){$p(e,n)}warn(e){return this._getLogFunction(0,e,gc.warn,arguments,pb)}error(e){return this._getLogFunction(0,e,gc.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,gc.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,gc.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),u=2;u<i;u++)o[u-2]=arguments[u];return this._getLogFunction(e,n,gc.debug||gc.info,arguments,pb)}table(e,n,i){return n?this._getLogFunction(e,n,console.table||ps,i&&[i],{tag:ck(n)}):ps}image(e){let{logLevel:n,priority:i,image:o,message:u="",scale:f=1}=e;return this._shouldLog(n||i)?$o?lk({image:o,message:u,scale:f}):ak({image:o,message:u,scale:f}):ps}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||ps)}group(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const o=mb({logLevel:e,message:n,opts:i}),{collapsed:u}=i;return o.method=(u?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}groupCollapsed(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||ps)}withGroup(e,n,i){this.group(e,n)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=yT(e)}_getLogFunction(e,n,i,o,u){if(this._shouldLog(e)){u=mb({logLevel:e,message:n,args:o,opts:u}),i=i||u.method,$p(i),u.total=this.getTotal(),u.delta=this.getDelta(),this._deltaTs=mc();const f=u.tag||u.message;if(u.once)if(!fb[f])fb[f]=mc();else return ps;return n=ok(this.id,u.message,u),i.bind(console,n,...u.args)}return ps}}U(pd,"VERSION",gT);function yT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return $p(Number.isFinite(e)&&e>=0),e}function mb(t){const{logLevel:e,message:n}=t;t.logLevel=yT(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const o=typeof t.message;return $p(o==="string"||o==="object"),Object.assign(t,{args:i},t.opts)}function ok(t,e,n){if(typeof e=="string"){const i=n.time?nk(tk(n.total)):"";e=n.time?"".concat(t,": ").concat(i,"  ").concat(e):"".concat(t,": ").concat(e),e=ik(e,n.color,n.background)}return e}function ak(t){let{image:e,message:n="",scale:i=1}=t;return(void 0)({image:e,message:n,scale:i}),ps}function lk(t){let{image:e,message:n="",scale:i=1}=t;if(typeof e=="string"){const u=new Image;return u.onload=()=>{const f=m_(u,n,i);console.log(...f)},u.src=e,ps}const o=e.nodeName||"";if(o.toLowerCase()==="img")return console.log(...m_(e,n,i)),ps;if(o.toLowerCase()==="canvas"){const u=new Image;return u.onload=()=>console.log(...m_(u,n,i)),u.src=e.toDataURL(),ps}return ps}function ck(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const gb=new pd({id:"loaders.gl"});class uk{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class hk{constructor(){U(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const vT={fetch:null,mimeType:void 0,nothrow:!1,log:new hk,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ev,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},dk={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function xT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const bT=()=>{const t=xT();return t.globalOptions=t.globalOptions||{...vT},t.globalOptions};function fk(t,e,n,i){return n=n||[],n=Array.isArray(n)?n:[n],pk(t,n),gk(e,t,i)}function wT(t,e){const n=bT(),i=t||n;return typeof i.fetch=="function"?i.fetch:fd(i.fetch)?o=>hb(o,i):e!=null&&e.fetch?e==null?void 0:e.fetch:hb}function pk(t,e){_b(t,null,vT,dk,e);for(const n of e){const i=t&&t[n.id]||{},o=n.options&&n.options[n.id]||{},u=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};_b(i,n.id,o,u,e)}}function _b(t,e,n,i,o){const u=e||"Top level",f=e?"".concat(e,"."):"";for(const l in t){const b=!e&&fd(t[l]),T=l==="baseUri"&&!e,C=l==="workerUrl"&&e;if(!(l in n)&&!T&&!C){if(l in i)gb.warn("".concat(u," loader option '").concat(f).concat(l,"' no longer supported, use '").concat(i[l],"'"))();else if(!b){const L=mk(l,o);gb.warn("".concat(u," loader option '").concat(f).concat(l,"' not recognized. ").concat(L))()}}}}function mk(t,e){const n=t.toLowerCase();let i="";for(const o of e)for(const u in o.options){if(t===u)return"Did you mean '".concat(o.id,".").concat(u,"'?");const f=u.toLowerCase();(n.startsWith(f)||f.startsWith(n))&&(i=i||"Did you mean '".concat(o.id,".").concat(u,"'?"))}return i}function gk(t,e,n){const o={...t.options||{}};return _k(o,n),o.log===null&&(o.log=new uk),yb(o,bT()),yb(o,e),o}function yb(t,e){for(const n in e)if(n in e){const i=e[n];cb(i)&&cb(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function _k(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function nv(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function iv(t){var e,n;Gp(t,"null loader"),Gp(nv(t),"invalid loader");let i;return Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const ET=()=>{const t=xT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function yk(t){const e=ET();t=Array.isArray(t)?t:[t];for(const n of t){const i=iv(n);e.find(o=>i===o)||e.unshift(i)}}function vk(){return ET()}const xk=new pd({id:"loaders.gl"}),bk=/\.([^.]+)$/;async function wk(t,e=[],n,i){if(!TT(t))return null;let o=vb(t,e,{...n,nothrow:!0},i);if(o)return o;if(uu(t)&&(t=await t.slice(0,10).arrayBuffer(),o=vb(t,e,n,i)),!o&&!(n!=null&&n.nothrow))throw new Error(ST(t));return o}function vb(t,e=[],n,i){if(!TT(t))return null;if(e&&!Array.isArray(e))return iv(e);let o=[];e&&(o=o.concat(e)),n!=null&&n.ignoreRegisteredLoaders||o.push(...vk()),Tk(o);const u=Ek(t,o,n,i);if(!u&&!(n!=null&&n.nothrow))throw new Error(ST(t));return u}function Ek(t,e,n,i){const{url:o,type:u}=wm(t),f=o||(i==null?void 0:i.url);let l=null,b="";if(n!=null&&n.mimeType&&(l=g_(e,n==null?void 0:n.mimeType),b="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),l=l||Sk(e,f),b=b||(l?"matched url ".concat(f):""),l=l||g_(e,u),b=b||(l?"matched MIME type ".concat(u):""),l=l||Ik(e,t),b=b||(l?"matched initial data ".concat(AT(t)):""),l=l||g_(e,n==null?void 0:n.fallbackMimeType),b=b||(l?"matched fallback MIME type ".concat(u):""),b){var T;xk.log(1,"selectLoader selected ".concat((T=l)===null||T===void 0?void 0:T.name,": ").concat(b,"."))}return l}function TT(t){return!(t instanceof Response&&t.status===204)}function ST(t){const{url:e,type:n}=wm(t);let i="No valid loader found (";i+=e?"".concat(FM(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const o=t?AT(t):"";return i+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",i+=")",i}function Tk(t){for(const e of t)iv(e)}function Sk(t,e){const n=e&&bk.exec(e),i=n&&n[1];return i?Ak(t,i):null}function Ak(t,e){e=e.toLowerCase();for(const n of t)for(const i of n.extensions)if(i.toLowerCase()===e)return n;return null}function g_(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function Ik(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(Pk(e,n))return n}else if(ArrayBuffer.isView(e)){if(xb(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&xb(e,0,n))return n;return null}function Pk(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function xb(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(o=>Ck(t,e,n,o))}function Ck(t,e,n,i){if(i instanceof ArrayBuffer)return LM(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":const o=Ry(t,e,i.length);return i===o;default:return!1}}function AT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Ry(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Ry(t,0,e):""}function Ry(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let o="";for(let u=0;u<n;u++)o+=String.fromCharCode(i.getUint8(e+u));return o}const Mk=256*1024;function*kk(t,e){const n=(e==null?void 0:e.chunkSize)||Mk;let i=0;const o=new TextEncoder;for(;i<t.length;){const u=Math.min(t.length-i,n),f=t.slice(i,i+u);i+=u,yield o.encode(f)}}const Lk=256*1024;function*Rk(t,e={}){const{chunkSize:n=Lk}=e;let i=0;for(;i<t.byteLength;){const o=Math.min(t.byteLength-i,n),u=new ArrayBuffer(o),f=new Uint8Array(t,i,o);new Uint8Array(u).set(f),i+=o,yield u}}const Dk=1024*1024;async function*zk(t,e){const n=(e==null?void 0:e.chunkSize)||Dk;let i=0;for(;i<t.size;){const o=i+n,u=await t.slice(i,o).arrayBuffer();i=o,yield u}}function bb(t,e){return ev?Ok(t,e):Fk(t)}async function*Ok(t,e){const n=t.getReader();let i;try{for(;;){const o=i||n.read();e!=null&&e._streamReadAhead&&(i=n.read());const{done:u,value:f}=await o;if(u)return;yield dT(f)}}catch{n.releaseLock()}}async function*Fk(t,e){for await(const n of t)yield dT(n)}function Bk(t,e){if(typeof t=="string")return kk(t,e);if(t instanceof ArrayBuffer)return Rk(t,e);if(uu(t))return zk(t,e);if(fT(t))return bb(t,e);if(cu(t))return bb(t.body,e);throw new Error("makeIterator")}const IT="Cannot convert supplied data type";function Nk(t,e,n){if(e.text&&typeof t=="string")return t;if(VM(t)&&(t=t.buffer),t instanceof ArrayBuffer){const i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer;const o=t.byteLength||t.length;return(t.byteOffset!==0||o!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+o)),i}throw new Error(IT)}async function Uk(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return Nk(t,e);if(uu(t)&&(t=await pT(t)),cu(t)){const o=t;return await ZM(o),e.binary?await o.arrayBuffer():await o.text()}if(fT(t)&&(t=Bk(t,n)),NM(t)||UM(t))return DM(t);throw new Error(IT)}function Vk(t,e,n=null){if(n)return n;const i={fetch:wT(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}function jk(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...i]:i}return n&&n.length?n:null}async function rv(t,e,n,i){Vo(!i||typeof i=="object"),e&&!Array.isArray(e)&&!nv(e)&&(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:o}=wm(t),f=jk(e,i),l=await wk(t,f,n);return l?(n=fk(n,l,f,o),i=Vk({url:o,parse:rv,loaders:f},n,i),await Gk(l,t,n,i)):null}async function Gk(t,e,n,i){if(IM(t),cu(e)){const o=e,{ok:u,redirected:f,status:l,statusText:b,type:T,url:C}=o,L=Object.fromEntries(o.headers.entries());i.response={headers:L,ok:u,redirected:f,status:l,statusText:b,type:T,url:C}}if(e=await Uk(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,i,t);if(PM(t,n))return await CM(t,e,n,i,rv);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Vo(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function Wp(t,e,n,i){!Array.isArray(e)&&!nv(e)&&(n=e,e=void 0);const o=wT(n);let u=t;return typeof t=="string"&&(u=await o(t)),uu(t)&&(u=await o(t)),await rv(u,e,n)}const Hk="3.2.12",{_parseImageNode:$k}=globalThis,Dy=typeof Image<"u",zy=typeof ImageBitmap<"u",Wk=Boolean($k),Oy=ev?!0:Wk;function qk(t){switch(t){case"auto":return zy||Dy||Oy;case"imagebitmap":return zy;case"image":return Dy;case"data":return Oy;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function Xk(){if(zy)return"imagebitmap";if(Dy)return"image";if(Oy)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Zk(t){const e=Kk(t);if(!e)throw new Error("Not an image");return e}function Yk(t){switch(Zk(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function Kk(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Jk=/^data:image\/svg\+xml/,Qk=/\.svg((\?|#).*)?$/;function sv(t){return t&&(Jk.test(t)||Qk.test(t))}function eL(t,e){if(sv(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(u){throw new Error(u.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return PT(t,e)}function PT(t,e){if(sv(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function CT(t,e,n){const i=eL(t,n),o=self.URL||self.webkitURL,u=typeof i!="string"&&o.createObjectURL(i);try{return await tL(u||i,e)}finally{u&&o.revokeObjectURL(u)}}async function tL(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((i,o)=>{try{n.onload=()=>i(n),n.onerror=u=>o(new Error("Could not load image ".concat(t,": ").concat(u)))}catch(u){o(u)}})}const nL={};let wb=!0;async function iL(t,e,n){let i;sv(n)?i=await CT(t,e,n):i=PT(t,n);const o=e&&e.imagebitmap;return await rL(i,o)}async function rL(t,e=null){if((sL(e)||!wb)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),wb=!1}return await createImageBitmap(t)}function sL(t){for(const e in t||nL)return!1;return!0}const lo=!1,zh=!0;function MT(t){const e=md(t);return oL(e)||cL(e)||aL(e)||lL(e)}function oL(t){const e=md(t);return e.byteLength>=24&&e.getUint32(0,lo)===2303741511?{mimeType:"image/png",width:e.getUint32(16,lo),height:e.getUint32(20,lo)}:null}function aL(t){const e=md(t);return e.byteLength>=10&&e.getUint32(0,lo)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,zh),height:e.getUint16(8,zh)}:null}function lL(t){const e=md(t);return e.byteLength>=14&&e.getUint16(0,lo)===16973&&e.getUint32(2,zh)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,zh),height:e.getUint32(22,zh)}:null}function cL(t){const e=md(t);if(!(e.byteLength>=3&&e.getUint16(0,lo)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:o}=uL();let u=2;for(;u+9<e.byteLength;){const f=e.getUint16(u,lo);if(o.has(f))return{mimeType:"image/jpeg",height:e.getUint16(u+5,lo),width:e.getUint16(u+7,lo)};if(!i.has(f))return null;u+=2,u+=e.getUint16(u,lo)}return null}function uL(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function md(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function hL(t,e){const{mimeType:n}=MT(t)||{},i=globalThis._parseImageNode;return Gp(i),await i(t,n)}async function dL(t,e,n){e=e||{};const o=(e.image||{}).type||"auto",{url:u}=n||{},f=fL(o);let l;switch(f){case"imagebitmap":l=await iL(t,e,u);break;case"image":l=await CT(t,e,u);break;case"data":l=await hL(t);break;default:Gp(!1)}return o==="data"&&(l=Yk(l)),l}function fL(t){switch(t){case"auto":case"data":return Xk();default:return qk(t),t}}const pL=["png","jpg","jpeg","gif","webp","bmp","ico","svg"],mL=["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],gL={image:{type:"auto",decode:!0}},kT={id:"image",module:"images",name:"Images",version:Hk,mimeTypes:mL,extensions:pL,parse:dL,tests:[t=>Boolean(MT(new DataView(t)))],options:gL},pn=new pd({id:"deck"});let Fy={};function _L(t){Fy=t}function pr(t,e,n,i){pn.level>0&&Fy[t]&&Fy[t].call(null,e,n,i)}function yL(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const vL={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:yL,parseTextSync:JSON.parse},Oh="8.8.20",fp=globalThis.deck&&globalThis.deck.VERSION;if(fp&&fp!==Oh)throw new Error("deck.gl - multiple versions detected: ".concat(fp," vs ").concat(Oh));fp||(pn.log(1,"deck.gl ".concat(Oh))(),globalThis.deck={...globalThis.deck,VERSION:Oh,version:Oh,log:pn,_registerLoggers:_L},yk([vL,[kT,{imagebitmap:{premultiplyAlpha:"none"}}]]));const xL=globalThis.deck,Et=new pd({id:"luma.gl"});function mr(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const bL="Invalid WebGLRenderingContext",wL="Requires WebGL2";function Em(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&Number.isFinite(t._version))}function Xt(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function EL(t){return Xt(t)?t:null}function Tm(t){return mr(Em(t),bL),t}function er(t){return mr(Xt(t),wL),t}const Eh={};function TL(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function SL(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function AL(t,e){Eh[t]=!0,e!==void 0&&TL(e)}function IL(t){const e=t.getError;t.getError=function(){let i;do i=e.apply(t),i!==0&&(Eh[i]=!0);while(i!==0);for(i in Eh)if(Eh[i])return delete Eh[i],parseInt(i,10);return 0}}const gd=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let i=0;i<this.attribs.length;i++){const o=new t.VertexAttrib(n);this.attribs[i]=o}this.maxAttrib=0};gd.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};gd.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Bl=function(e){const n=this;this.gl=e,IL(e);const i=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(u){return u===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:i.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!0,i.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(u){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,u);const l=f.attribs[u];return l.enabled=!1,i.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(u,f){switch(u){case 34962:n.currentArrayBuffer=f;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=f;break}return i.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(u,f){const b=n.currentVertexArrayObject.attribs[u];switch(f){case 34975:return b.buffer;case 34338:return b.enabled;case 34339:return b.size;case 34340:return b.stride;case 34341:return b.type;case 34922:return b.normalized;default:return i.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(u,f,l,b,T,C){const L=n.currentVertexArrayObject;L.maxAttrib=Math.max(L.maxAttrib,u);const k=L.attribs[u];return k.buffer=n.currentArrayBuffer,k.size=f,k.type=l,k.normalized=b,k.stride=T,k.offset=C,k.recache(),i.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{SL("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Bl.prototype.VERTEX_ARRAY_BINDING_OES=34229;Bl.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let i=0;i<this.vertexArrayObjects.length;++i)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new gd(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Bl.prototype.createVertexArrayOES=function(){const e=new gd(this);return this.vertexArrayObjects.push(e),e};Bl.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Bl.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof gd&&e.hasBeenBound&&e.ext===this)};Bl.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){AL(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const i=this.original,o=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const u=this.currentVertexArrayObject;if(o===u)return;(!o||u.elementArrayBuffer!==o.elementArrayBuffer)&&i.bindBuffer.call(n,34963,u.elementArrayBuffer);let f=this.currentArrayBuffer;const l=Math.max(o?o.maxAttrib:0,u.maxAttrib);for(let b=0;b<=l;b++){const T=u.attribs[b],C=o?o.attribs[b]:null;if((!o||T.enabled!==C.enabled)&&(T.enabled?i.enableVertexAttribArray.call(n,b):i.disableVertexAttribArray.call(n,b)),T.enabled){let L=!1;(!o||T.buffer!==C.buffer)&&(f!==T.buffer&&(i.bindBuffer.call(n,34962,T.buffer),f=T.buffer),L=!0),(L||T.cached!==C.cached)&&i.vertexAttribPointer.call(n,b,T.size,T.type,T.normalized,T.stride,T.offset)}}this.currentArrayBuffer!==f&&i.bindBuffer.call(n,34962,this.currentArrayBuffer)};function PL(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const o=e.call(this)||[];return o.indexOf("OES_vertex_array_object")<0&&o.push("OES_vertex_array_object"),o};const n=t.getExtension;t.getExtension=function(o){const u=n.call(this,o);return u||(o!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Bl(this)),this.__OESVertexArrayObject))}}const Eb="OES_element_index",Tb="WEBGL_draw_buffers",CL="EXT_disjoint_timer_query",ML="EXT_disjoint_timer_query_webgl2",kL="EXT_texture_filter_anisotropic",Sb="WEBGL_debug_renderer_info",LL=35723,RL=4352,DL=36795,zL=34047,OL=37445,FL=37446,Sn=t=>Xt(t)?void 0:0,BL={[3074]:t=>Xt(t)?void 0:36064,[LL]:t=>Xt(t)?void 0:RL,[35977]:Sn,[32937]:Sn,[DL]:(t,e)=>{const n=Xt(t)?t.getExtension(ML):t.getExtension(CL);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[OL]:(t,e)=>{const n=t.getExtension(Sb);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[FL]:(t,e)=>{const n=t.getExtension(Sb);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[zL]:(t,e)=>{const n=t.luma.extensions[kL];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[32883]:Sn,[35071]:Sn,[37447]:Sn,[36063]:(t,e)=>{if(!Xt(t)){const n=t.getExtension(Tb);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[35379]:Sn,[35374]:Sn,[35377]:Sn,[34852]:t=>{if(!Xt(t)){const e=t.getExtension(Tb);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[36203]:t=>t.getExtension(Eb)?2147483647:65535,[33001]:t=>t.getExtension(Eb)?16777216:65535,[33e3]:t=>16777216,[37157]:Sn,[35373]:Sn,[35657]:Sn,[36183]:Sn,[37137]:Sn,[34045]:Sn,[35978]:Sn,[35979]:Sn,[35968]:Sn,[35376]:Sn,[35375]:Sn,[35659]:Sn,[37154]:Sn,[35371]:Sn,[35658]:Sn,[35076]:Sn,[35077]:Sn,[35380]:Sn};function NL(t,e,n){const i=BL[n],o=typeof i=="function"?i(t,e,n):i;return o!==void 0?o:e(n)}const UL="OES_vertex_array_object",LT="ANGLE_instanced_arrays",VL="WEBGL_draw_buffers",jL="EXT_disjoint_timer_query",GL="EXT_texture_filter_anisotropic",HL="VertexArray requires WebGL2 or OES_vertex_array_object extension";function $L(t,e){return{webgl2:Xt(t),ext:t.getExtension(e)}}const RT={[UL]:{meta:{suffix:"OES"},createVertexArray:()=>{mr(!1,HL)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[LT]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){mr(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[VL]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{mr(!1)}},[jL]:{meta:{suffix:"EXT"},createQuery:()=>{mr(!1)},deleteQuery:()=>{mr(!1)},beginQuery:()=>{mr(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},__={readBuffer:(t,e,n)=>{Xt(t)&&e(n)},getVertexAttrib:(t,e,n,i)=>{const{webgl2:o,ext:u}=$L(t,LT);let f;switch(i){case 35069:f=o?void 0:!1;break;case 35070:f=!o&&!u?0:void 0;break}return f!==void 0?f:e(n,i)},getProgramParameter:(t,e,n,i)=>{if(!Xt(t))switch(i){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,i)},getInternalformatParameter:(t,e,n,i,o)=>{if(!Xt(t))switch(o){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,i,o)},getTexParameter(t,e,n,i){switch(i){case 34046:const{extensions:o}=t.luma,u=o[GL];i=u&&u.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,i)},getParameter:NL,hint(t,e,n,i){return e(n,i)}};function WL(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(PL(t),qL(t),ZL(t,RT),XL(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=WL;function qL(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function XL(t,e){let{target:n,target2:i}=e;Object.keys(__).forEach(o=>{if(typeof __[o]=="function"){const u=t[o]?t[o].bind(t):()=>{},f=__[o].bind(null,t,u);n[o]=f,i[o]=f}})}function ZL(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&YL(t,{extension:n,target:t.luma,target2:t})}function YL(t,e){let{extension:n,target:i,target2:o}=e;const u=RT[n];mr(u);const{meta:f={}}=u,{suffix:l=""}=f,b=t.getExtension(n);for(const T of Object.keys(u)){const C="".concat(T).concat(l);let L=null;T==="meta"||typeof t[T]=="function"||(b&&typeof b[C]=="function"?L=function(){return b[C](...arguments)}:typeof u[T]=="function"&&(L=u[T].bind(i))),L&&(i[T]=L,o[T]=L)}}const ov={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[36006]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[35723]:4352,[36010]:null,[35977]:!1,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},pa=(t,e,n)=>e?t.enable(n):t.disable(n),Ab=(t,e,n)=>t.hint(n,e),Hr=(t,e,n)=>t.pixelStorei(n,e),KL=(t,e)=>{const n=Xt(t)?36009:36160;return t.bindFramebuffer(n,e)},JL=(t,e)=>t.bindFramebuffer(36008,e);function ph(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const QL={[3042]:pa,[32773]:(t,e)=>t.blendColor(...e),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(t,e)=>t.clearColor(...e),[3107]:(t,e)=>t.colorMask(...e),[2884]:pa,[2885]:(t,e)=>t.cullFace(e),[2929]:pa,[2931]:(t,e)=>t.clearDepth(e),[2932]:(t,e)=>t.depthFunc(e),[2928]:(t,e)=>t.depthRange(...e),[2930]:(t,e)=>t.depthMask(e),[3024]:pa,[35723]:Ab,[36006]:KL,[2886]:(t,e)=>t.frontFace(e),[33170]:Ab,[2849]:(t,e)=>t.lineWidth(e),[32823]:pa,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:pa,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:pa,[3088]:(t,e)=>t.scissor(...e),[2960]:pa,[2961]:(t,e)=>t.clearStencil(e),[2968]:(t,e)=>t.stencilMaskSeparate(1028,e),[36005]:(t,e)=>t.stencilMaskSeparate(1029,e),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(t,e)=>t.viewport(...e),[3333]:Hr,[3317]:Hr,[37440]:Hr,[37441]:Hr,[37443]:Hr,[3330]:Hr,[3332]:Hr,[3331]:Hr,[36010]:JL,[3314]:Hr,[32878]:Hr,[3316]:Hr,[3315]:Hr,[32877]:Hr,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=ph(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=ph(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=ph(e)?e:[e,e];const[n,i]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=ph(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilFuncSeparate(1028,n,i,o),t.stencilFuncSeparate(1029,u,f,l)},stencilOp:(t,e)=>{e=ph(e)&&e.length===3?[...e,...e]:e;const[n,i,o,u,f,l]=e;t.stencilOpSeparate(1028,n,i,o),t.stencilOpSeparate(1029,u,f,l)},viewport:(t,e)=>t.viewport(...e)};function Wn(t,e,n){return e[t]!==void 0?e[t]:n[t]}const e3={blendEquation:(t,e,n)=>t.blendEquationSeparate(Wn(32777,e,n),Wn(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Wn(32969,e,n),Wn(32968,e,n),Wn(32971,e,n),Wn(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Wn(32824,e,n),Wn(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Wn(32938,e,n),Wn(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Wn(2962,e,n),Wn(2967,e,n),Wn(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Wn(34816,e,n),Wn(36003,e,n),Wn(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Wn(2964,e,n),Wn(2965,e,n),Wn(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Wn(34817,e,n),Wn(34818,e,n),Wn(34819,e,n))},Ib={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({[36006]:n,[36010]:n});case 36009:return t({[36006]:n});case 36008:return t({[36010]:n});default:return null}},blendColor:(t,e,n,i,o)=>t({[32773]:new Float32Array([e,n,i,o])}),blendEquation:(t,e)=>t({[32777]:e,[34877]:e}),blendEquationSeparate:(t,e,n)=>t({[32777]:e,[34877]:n}),blendFunc:(t,e,n)=>t({[32969]:e,[32968]:n,[32971]:e,[32970]:n}),blendFuncSeparate:(t,e,n,i,o)=>t({[32969]:e,[32968]:n,[32971]:i,[32970]:o}),clearColor:(t,e,n,i,o)=>t({[3106]:new Float32Array([e,n,i,o])}),clearDepth:(t,e)=>t({[2931]:e}),clearStencil:(t,e)=>t({[2961]:e}),colorMask:(t,e,n,i,o)=>t({[3107]:[e,n,i,o]}),cullFace:(t,e)=>t({[2885]:e}),depthFunc:(t,e)=>t({[2932]:e}),depthRange:(t,e,n)=>t({[2928]:new Float32Array([e,n])}),depthMask:(t,e)=>t({[2930]:e}),frontFace:(t,e)=>t({[2886]:e}),lineWidth:(t,e)=>t({[2849]:e}),polygonOffset:(t,e,n)=>t({[32824]:e,[10752]:n}),sampleCoverage:(t,e,n)=>t({[32938]:e,[32939]:n}),scissor:(t,e,n,i,o)=>t({[3088]:new Int32Array([e,n,i,o])}),stencilMask:(t,e)=>t({[2968]:e,[36005]:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,i)=>t({[2962]:e,[2967]:n,[2963]:i,[34816]:e,[36003]:n,[36004]:i}),stencilFuncSeparate:(t,e,n,i,o)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:i,[e===1028?2963:36004]:o}),stencilOp:(t,e,n,i)=>t({[2964]:e,[2965]:n,[2966]:i,[34817]:e,[34818]:n,[34819]:i}),stencilOpSeparate:(t,e,n,i,o)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:i,[e===1028?2966:34819]:o}),viewport:(t,e,n,i,o)=>t({[2978]:[e,n,i,o]})},io=(t,e)=>t.isEnabled(e),Pb={[3042]:io,[2884]:io,[2929]:io,[3024]:io,[32823]:io,[32926]:io,[32928]:io,[3089]:io,[2960]:io,[35977]:io};function DT(t){for(const e in t)return!1;return!0}function t3(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&i&&t.length===e.length){for(let o=0;o<t.length;++o)if(t[o]!==e[o])return!1;return!0}return!1}function Cb(t,e){const n=t[e].bind(t);t[e]=function(){const o=arguments.length<=0?void 0:arguments[0];return o in t.state.cache?t.state.enable?t.state.cache[o]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function n3(t,e,n){const i=t[e].bind(t);t[e]=function(){for(var u=arguments.length,f=new Array(u),l=0;l<u;l++)f[l]=arguments[l];const{valueChanged:b,oldValue:T}=n(t.state._updateCache,...f);return b&&i(...f),T},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function i3(t){const e=t.useProgram.bind(t);t.useProgram=function(i){t.state.program!==i&&(e(i),t.state.program=i)}}class r3{constructor(e){let{copyState:n=!1,log:i=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?o3(e):Object.assign({},ov),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){mr(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];jo(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,i;const o=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const u in e){mr(u!==void 0);const f=e[u],l=this.cache[u];t3(f,l)||(n=!0,i=l,o&&!(u in o)&&(o[u]=l),this.cache[u]=f)}return{valueChanged:n,oldValue:i}}}function zT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:i}=e;if(mr(i!==void 0),!t.state){const{polyfillContext:o}=globalThis;o&&o(t),t.state=new r3(t,{copyState:i}),i3(t);for(const u in Ib){const f=Ib[u];n3(t,u,f)}Cb(t,"getParameter"),Cb(t,"isEnabled")}return t.state.enable=n,t}function s3(t){t.state||zT(t,{copyState:!1}),t.state.push()}function Mb(t){mr(t.state),t.state.pop()}function jo(t,e){if(mr(Em(t),"setParameters requires a WebGL context"),DT(e))return;const n={};for(const o in e){const u=Number(o),f=QL[o];f&&(typeof f=="string"?n[f]=!0:f(t,e[o],u))}const i=t.state&&t.state.cache;if(i)for(const o in n){const u=e3[o];u(t,e,i)}}function o3(t,e){if(e=e||ov,typeof e=="number"){const o=e,u=Pb[o];return u?u(t,o):t.getParameter(o)}const n=Array.isArray(e)?e:Object.keys(e),i={};for(const o of n){const u=Pb[o];i[o]=u?u(t,Number(o)):t.getParameter(Number(o))}return i}function a3(t){jo(t,ov)}function vs(t,e,n){if(DT(e))return n(t);const{nocatch:i=!0}=e;s3(t),jo(t,e);let o;if(i)o=n(t),Mb(t);else try{o=n(t)}finally{Mb(t)}return o}function Kc(t){const{luma:e}=t;if(t.canvas&&e){const{clientWidth:n}=e.canvasSizeInfo;return n?t.drawingBufferWidth/n:1}return 1}function y_(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const i=Kc(t),o=t.drawingBufferWidth,u=t.drawingBufferHeight;return c3(e,i,o,u,n)}function l3(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function c3(t,e,n,i,o){const u=kb(t[0],e,n);let f=Lb(t[1],e,i,o),l=kb(t[0]+1,e,n);const b=l===n-1?l:l-1;l=Lb(t[1]+1,e,i,o);let T;return o?(l=l===0?l:l+1,T=f,f=l):T=l===i-1?l:l-1,{x:u,y:f,width:Math.max(b-u+1,1),height:Math.max(T-f+1,1)}}function kb(t,e,n){return Math.min(Math.round(t*e),n-1)}function Lb(t,e,n,i){return i?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const av=$o(),u3=av&&typeof document<"u",OT={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function FT(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};mr(av,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},OT,t);const{width:e,height:n}=t;function i(l){if(t.throwOnError)throw new Error(l);return console.error(l),null}t.onError=i;let o;const{canvas:u}=t,f=p3({canvas:u,width:e,height:n,onError:i});return o=f3(f,t),o?(o=lv(o,t),m3(o),o):null}function lv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||g3(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},OT,e);const{manageState:n,debug:i}=e;return n&&zT(t,{copyState:!1,log:function(){for(var o=arguments.length,u=new Array(o),f=0;f<o;f++)u[f]=arguments[f];return Et.log(1,...u)()}}),av&&i&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),Et.level=Math.max(Et.level,1)):Et.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function h3(t){const e=t.getParameter(7936),n=t.getParameter(7937),i=t.getExtension("WEBGL_debug_renderer_info"),o=i&&t.getParameter(i.UNMASKED_VENDOR_WEBGL||7936),u=i&&t.getParameter(i.UNMASKED_RENDERER_WEBGL||7937);return{vendor:o||e,renderer:u||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function d3(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const i=l3(e.useDevicePixels);_3(t,i,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function f3(t,e){const{onError:n}=e;let i=null;const o=b=>i=b.statusMessage||i;t.addEventListener("webglcontextcreationerror",o,!1);const{webgl1:u=!0,webgl2:f=!0}=e;let l=null;return f&&(l=l||t.getContext("webgl2",e),l=l||t.getContext("experimental-webgl2",e)),u&&(l=l||t.getContext("webgl",e),l=l||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",o,!1),l?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),l):n("Failed to create ".concat(f&&!u?"WebGL2":"WebGL"," context: ").concat(i||"Unknown error"))}function p3(t){let{canvas:e,width:n=800,height:i=600,onError:o}=t,u;return typeof e=="string"?(u3&&document.readyState==="complete"||o("createGLContext called on canvas '".concat(e,"' before page was loaded")),u=document.getElementById(e)):e?u=e:(u=document.createElement("canvas"),u.id="lumagl-canvas",u.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",u.style.height=Number.isFinite(i)?"".concat(i,"px"):"100%",document.body.insertBefore(u,document.body.firstChild)),u}function m3(t){const e=Xt(t)?"WebGL2":"WebGL1",n=h3(t),i=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",o=t.debug?" debug":"";Et.info(1,"".concat(e).concat(o," context ").concat(i))()}function g3(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function _3(t,e,n){let i="width"in n?n.width:t.canvas.clientWidth,o="height"in n?n.height:t.canvas.clientHeight;(!i||!o)&&(Et.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=t.canvas.width||1,o=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const u=t.luma.canvasSizeInfo;if(u.clientWidth!==i||u.clientHeight!==o||u.devicePixelRatio!==e){let f=e;const l=Math.floor(i*f),b=Math.floor(o*f);t.canvas.width=l,t.canvas.height=b,(t.drawingBufferWidth!==l||t.drawingBufferHeight!==b)&&(Et.warn("Device pixel ratio clamped")(),f=Math.min(t.drawingBufferWidth/i,t.drawingBufferHeight/o),t.canvas.width=Math.floor(i*f),t.canvas.height=Math.floor(o*f)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:i,clientHeight:o,devicePixelRatio:e})}}const Fh="8.5.17",y3="set luma.log.level=1 (or higher) to trace rendering";class v3{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new tv({id:e})),this.stats.get(e)}}const Tl=new v3;if(globalThis.luma&&globalThis.luma.VERSION!==Fh)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(Fh));globalThis.luma||($o()&&Et.log(1,"luma.gl ".concat(Fh," - ").concat(y3))(),globalThis.luma=globalThis.luma||{VERSION:Fh,version:Fh,log:Et,stats:Tl,globals:{modules:{},nodeIO:{}}});function x3(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function b3(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function ct(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function v_(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const i=t[e];return ct(i!==void 0,"Accessing undefined constant GL.".concat(e)),i}function za(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const x_={};function Ba(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";x_[t]=x_[t]||1;const e=x_[t]++;return"".concat(t,"-").concat(e)}function Rb(t){return ct(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Jc(t){let e=!0;for(const n in t){e=!1;break}return e}function BT(t,e,n,i){const o="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),u=Object.getPrototypeOf(t);i.forEach(f=>{u.methodName||(u[f]=()=>{throw Et.removed("Calling removed method ".concat(e,".").concat(f,": "),o)(),new Error(f)})})}const _c="Resource subclass must define virtual methods";class Wo{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(e);const{id:i,userData:o={}}=n;this.gl=e,this.gl2=e,this.id=i||Ba(this[Symbol.toStringTag]),this.userData=o,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(i=>i.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=v_(this.gl,e),ct(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Xt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension)))){const l=o.webgl1,b="webgl2"in o?o.webgl2:o.webgl1;return u?b:l}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:i}=e,o=this.constructor.PARAMETERS||{},u=Xt(this.gl),f={},l=n||Object.keys(o);for(const b of l){const T=o[b];if(T&&(!("webgl2"in T)||u)&&(!("extension"in T)||this.gl.getExtension(T.extension))){const L=i?za(this.gl,b):b;f[L]=this.getParameter(b,e),i&&T.type==="GLenum"&&(f[L]=za(this.gl,f[L]))}}return f}setParameter(e,n){e=v_(this.gl,e),ct(e);const o=(this.constructor.PARAMETERS||{})[e];if(o){const u=Xt(this.gl);if(!((!("webgl2"in o)||u)&&(!("extension"in o)||this.gl.getExtension(o.extension))))throw new Error("Parameter not available on this platform");o.type==="GLenum"&&(n=v_(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,i){return BT(this,e,n,i)}initialize(e){}_createHandle(){throw new Error(_c)}_deleteHandle(){throw new Error(_c)}_bindHandle(e){throw new Error(_c)}_getOptsFromHandle(){throw new Error(_c)}_getParameter(e,n){throw new Error(_c)}_setParameter(e,n){throw new Error(_c)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=Tl.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];Tl.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id)}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const o=Tl.get("Memory Usage".concat(i));o.get("GPU Memory").addCount(e),o.get("".concat(n," Memory")).addCount(e),this.byteLength=e}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id)}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const i=Tl.get("Memory Usage".concat(n));i.get("GPU Memory").subtractCount(this.byteLength),i.get("".concat(e," Memory")).subtractCount(this.byteLength),this.byteLength=0}}const w3="Failed to deduce GL constant from typed array";function By(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(w3)}}function td(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function E3(t){let{data:e,width:n,height:i,bytesPerPixel:o=4,temp:u}=t;const f=n*o;u=u||new Uint8Array(f);for(let l=0;l<i/2;++l){const b=l*f,T=(i-l-1)*f;u.set(e.subarray(b,b+f)),e.copyWithin(b,T,T+f),e.set(u,T)}}function T3(t){let{data:e,width:n,height:i}=t;const o=Math.round(n/2),u=Math.round(i/2),f=new Uint8Array(o*u*4);for(let l=0;l<u;l++)for(let b=0;b<o;b++)for(let T=0;T<4;T++)f[(l*o+b)*4+T]=e[(l*2*n+b*2)*4+T];return{data:f,width:o,height:u}}function Ny(t,e,n){const{removedProps:i={},deprecatedProps:o={},replacedProps:u={}}=n;for(const l in i)if(l in e){const T=i[l]?"".concat(t,".").concat(i[l]):"N/A";Et.removed("".concat(t,".").concat(l),T)()}for(const l in o)if(l in e){const b=o[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))()}let f=null;for(const l in u)if(l in e){const b=u[l];Et.deprecated("".concat(t,".").concat(l),"".concat(t,".").concat(b))(),f=f||Object.assign({},e),f[b]=e[l],delete f[l]}return f||e}const S3={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},A3={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Zr{static getBytesPerElement(e){return td(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return ct(e.size),td(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return new Zr(S3,...n)}constructor(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];n.forEach(o=>this._assign(o)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Zr.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Zr.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=Ny("Accessor",e,A3),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Db=10,NT={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},I3={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:NT},P3={removedProps:NT};class wn extends Wo{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/Zr.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=Ny("Buffer",e,I3),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=Ny("Buffer",e,P3),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new Zr(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:i=0,srcOffset:o=0}=e,u=e.byteLength||e.length;ct(n);const f=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(f,this.handle),o!==0||u!==void 0?(er(this.gl),this.gl.bufferSubData(this.target,i,n,o,u)):this.gl.bufferSubData(f,i,n),this.gl.bindBuffer(f,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:i=0,writeOffset:o=0,size:u}=e;const{gl:f}=this;return er(f),f.bindBuffer(36662,n.handle),f.bindBuffer(36663,this.handle),f.copyBufferSubData(36662,36663,i,o,u),f.bindBuffer(36662,null),f.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:i=0,length:o=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};er(this.gl);const u=td(this.accessor.type||5126,{clamped:!1}),f=this._getAvailableElementCount(n),l=i;let b,T;e?(T=e.length,b=T-l):(b=Math.min(f,o||f),T=l+b);const C=Math.min(f,b);return o=o||C,ct(o<=C),e=e||new u(T),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,i,o),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:i=0,size:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?o!==void 0?this.gl.bindBufferRange(e,n,this.handle,i,o):(ct(i===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Db,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;ct(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const o=this._getTarget();this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,this.usage),this.gl.bufferSubData(o,n,e),this.gl.bindBuffer(o,null),this.debugData=e.slice(0,Db),this.bytesUsed=i,this._trackAllocatedMemory(i);const u=By(e);return ct(u),this.setAccessor(new Zr(this.accessor,{type:u})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;ct(e>=0),this._trackDeallocatedMemory();let i=e;e===0&&(i=new Float32Array(0));const o=this._getTarget();return this.gl.bindBuffer(o,this.handle),this.gl.bufferData(o,i,n),this.gl.bindBuffer(o,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=td(this.accessor.type||5126,{clamped:!1}),i=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-i}_inferType(e){this.accessor.type||this.setAccessor(new Zr(this.accessor,{type:By(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return Et.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return Et.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return Et.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return Et.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Zr(this.accessor,e),this}}const cv={[6407]:{dataFormat:6407,types:[5121,33635]},[6408]:{dataFormat:6408,types:[5121,32819,32820]},[6406]:{dataFormat:6406,types:[5121]},[6409]:{dataFormat:6409,types:[5121]},[6410]:{dataFormat:6410,types:[5121]},[33326]:{dataFormat:6403,types:[5126],gl2:!0},[33328]:{dataFormat:33319,types:[5126],gl2:!0},[34837]:{dataFormat:6407,types:[5126],gl2:!0},[34836]:{dataFormat:6408,types:[5126],gl2:!0}},UT={[6403]:1,[36244]:1,[33319]:2,[33320]:2,[6407]:3,[36248]:3,[6408]:4,[36249]:4,[6402]:1,[34041]:1,[6406]:1,[6409]:1,[6410]:2},VT={[5126]:4,[5125]:4,[5124]:4,[5123]:2,[5122]:2,[5131]:2,[5120]:1,[5121]:1};function C3(t,e){const n=cv[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const i=Xt(t)&&n.gl2||n.gl1;return typeof i=="string"?t.getExtension(i):i}function M3(t,e){const n=cv[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const k3=[9729,9728],zb=globalThis.WebGLBuffer||function(){};class Rl extends Wo{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:i,linearFiltering:o}=n;let u=!0;return i&&(u=u&&C3(e,i),u=u&&(!o||M3(e,i))),u}constructor(e,n){const{id:i=Ba("texture"),handle:o,target:u}=n;super(e,{id:i,handle:o}),this.target=u,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(W=>this.initialize(Object.assign({},e,{pixels:W,data:W}))),this;const i=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(i&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:o=null,format:u=6408,border:f=0,recreate:l=!1,parameters:b={},pixelStore:T={},textureUnit:C=void 0}=e;n||(n=o);let{width:L,height:k,dataFormat:X,type:te,compressed:ie=!1,mipmaps:ye=!0}=e;const{depth:J=0}=e;return{width:L,height:k,compressed:ie,dataFormat:X,type:te}=this._deduceParameters({format:u,type:te,dataFormat:X,compressed:ie,data:n,width:L,height:k}),this.width=L,this.height=k,this.depth=J,this.format=u,this.type=te,this.dataFormat=X,this.border=f,this.textureUnit=C,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),ye&&this._isNPOT()&&(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),ye=!1,this._updateForNPOT(b)),this.mipmaps=ye,this.setImageData({data:n,width:L,height:k,depth:J,format:u,type:te,dataFormat:X,border:f,mipmaps:ye,parameters:T,compressed:ie}),ye&&this.generateMipmap(),this.setParameters(b),l&&(this.data=n),i&&(this._video={video:n,parameters:b,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:i}=this._video;if(i===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:i,mipmaps:o=!1}=e;return i!==this.width||n!==this.height?this.initialize({width:i,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:o}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(Et.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),vs(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:i=null,level:o=0,format:u=this.format,border:f=this.border,offset:l=0,parameters:b={}}=e;let{data:T=null,type:C=this.type,width:L=this.width,height:k=this.height,dataFormat:X=this.dataFormat,compressed:te=!1}=e;T||(T=i),{type:C,dataFormat:X,compressed:te,width:L,height:k}=this._deduceParameters({format:u,type:C,dataFormat:X,compressed:te,data:T,width:L,height:k});const{gl:ie}=this;ie.bindTexture(this.target,this.handle);let ye=null;({data:T,dataType:ye}=this._getDataType({data:T,compressed:te}));let J,W=0;if(vs(this.gl,b,()=>{switch(ye){case"null":ie.texImage2D(n,o,u,L,k,f,X,C,T);break;case"typed-array":ie.texImage2D(n,o,u,L,k,f,X,C,T,l);break;case"buffer":J=er(ie),J.bindBuffer(35052,T.handle||T),J.texImage2D(n,o,u,L,k,f,X,C,l),J.bindBuffer(35052,null);break;case"browser-object":Xt(ie)?ie.texImage2D(n,o,u,L,k,f,X,C,T):ie.texImage2D(n,o,u,X,C,T);break;case"compressed":for(const[Q,_e]of T.entries())ie.compressedTexImage2D(n,Q,_e.format,_e.width,_e.height,f,_e.data),W+=_e.levelSize;break;default:ct(!1,"Unknown image data type")}}),ye==="compressed")this._trackAllocatedMemory(W,"Texture");else if(T&&T.byteLength)this._trackAllocatedMemory(T.byteLength,"Texture");else{const Q=UT[this.dataFormat]||4,_e=VT[this.type]||1;this._trackAllocatedMemory(this.width*this.height*Q*_e,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:i=null,data:o=null,x:u=0,y:f=0,width:l=this.width,height:b=this.height,level:T=0,format:C=this.format,type:L=this.type,dataFormat:k=this.dataFormat,compressed:X=!1,offset:te=0,border:ie=this.border,parameters:ye={}}=e;if({type:L,dataFormat:k,compressed:X,width:l,height:b}=this._deduceParameters({format:C,type:L,dataFormat:k,compressed:X,data:o,width:l,height:b}),ct(this.depth===0,"texSubImage not supported for 3D textures"),o||(o=i),o&&o.data){const J=o;o=J.data,l=J.shape[0],b=J.shape[1]}o instanceof wn&&(o=o.handle),this.gl.bindTexture(this.target,this.handle),vs(this.gl,ye,()=>{if(X)this.gl.compressedTexSubImage2D(n,T,u,f,l,b,C,o);else if(o===null)this.gl.texSubImage2D(n,T,u,f,l,b,k,L,null);else if(ArrayBuffer.isView(o))this.gl.texSubImage2D(n,T,u,f,l,b,k,L,o,te);else if(o instanceof zb){const J=er(this.gl);J.bindBuffer(35052,o),J.texSubImage2D(n,T,u,f,l,b,k,L,te),J.bindBuffer(35052,null)}else Xt(this.gl)?er(this.gl).texSubImage2D(n,T,u,f,l,b,k,L,o):this.gl.texSubImage2D(n,T,u,f,k,L,o)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return Et.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:i=!1}=e;return i?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof wn?{data:n.handle,dataType:"buffer"}:n instanceof zb?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:i}=e;let{width:o,height:u,dataFormat:f,type:l,compressed:b}=e;const T=cv[n];return f=f||T&&T.dataFormat,l=l||T&&T.types[0],b=b||T&&T.compressed,{width:o,height:u}=this._deduceImageSize(i,o,u),{dataFormat:f,type:l,compressed:b,width:o,height:u,format:n,data:i}}_deduceImageSize(e,n,i){let o;return typeof ImageData<"u"&&e instanceof ImageData?o={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?o={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?o={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?o={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?o={width:e.videoWidth,height:e.videoHeight}:e?o={width:n,height:i}:o={width:n>=0?n:1,height:i>=0?i:1},ct(o,"Could not deduced texture size"),ct(n===void 0||o.width===n,"Deduced texture width does not match supplied width"),ct(i===void 0||o.height===i,"Deduced texture height does not match supplied height"),o}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:ct(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return Xt(this.gl)||!this.width||!this.height?!1:!Rb(this.width)||!Rb(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:k3.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let L3="";function R3(t,e){return ct(typeof t=="string"),t=L3+t,new Promise((n,i)=>{try{const o=new Image;o.onload=()=>n(o),o.onerror=()=>i(new Error("Could not load image ".concat(t,"."))),o.crossOrigin=e&&e.crossOrigin||"anonymous",o.src=t}catch(o){i(o)}})}class _r extends Rl{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return Rl.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:R3(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const Uy=[34069,34070,34071,34072,34073,34074];class jT extends Rl{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Tm(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:i={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(i)}),this}subImage(e){let{face:n,data:i,x:o=0,y:u=0,mipmapLevel:f=0}=e;return this._subImage({target:n,data:i,x:o,y:u,mipmapLevel:f})}async setCubeMapImageData(e){let{width:n,height:i,pixels:o,data:u,border:f=0,format:l=6408,type:b=5121}=e;const{gl:T}=this,C=o||u,L=await Promise.all(Uy.map(k=>{const X=C[k];return Promise.all(Array.isArray(X)?X:[X])}));this.bind(),Uy.forEach((k,X)=>{L[X].length>1&&this.opts.mipmaps!==!1&&Et.warn("".concat(this.id," has mipmap and multiple LODs."))(),L[X].forEach((te,ie)=>{n&&i?T.texImage2D(k,ie,l,n,i,f,l,b,te):T.texImage2D(k,ie,l,l,b,te)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:i,height:o,pixels:u,data:f,border:l=0,format:b=6408,type:T=5121}=e,{gl:C}=this,L=u||f;return this.bind(),L instanceof Promise?L.then(k=>this.setImageDataForFace(Object.assign({},e,{face:n,data:k,pixels:k}))):this.width||this.height?C.texImage2D(n,0,b,i,o,l,b,T,L):C.texImage2D(n,0,b,b,T,L),this}}jT.FACES=Uy;class D3 extends Rl{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:i=6408,width:o,height:u,depth:f=1,border:l=0,format:b,type:T=5121,offset:C=0,data:L,parameters:k={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),vs(this.gl,k,()=>{ArrayBuffer.isView(L)&&this.gl.texImage3D(this.target,n,i,o,u,f,l,b,T,L),L instanceof wn&&(this.gl.bindBuffer(35052,L.handle),this.gl.texImage3D(this.target,n,i,o,u,f,l,b,T,C))}),L&&L.byteLength)this._trackAllocatedMemory(L.byteLength,"Texture");else{const X=UT[this.dataFormat]||4,te=VT[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*X*te,"Texture")}return this.loaded=!0,this}}const ml="EXT_color_buffer_float",Ob={[33189]:{bpp:2},[33190]:{gl2:!0,bpp:3},[36012]:{gl2:!0,bpp:4},[36168]:{bpp:1},[34041]:{bpp:4},[35056]:{gl2:!0,bpp:4},[36013]:{gl2:!0,bpp:5},[32854]:{bpp:2},[36194]:{bpp:2},[32855]:{bpp:2},[33321]:{gl2:!0,bpp:1},[33330]:{gl2:!0,bpp:1},[33329]:{gl2:!0,bpp:1},[33332]:{gl2:!0,bpp:2},[33331]:{gl2:!0,bpp:2},[33334]:{gl2:!0,bpp:4},[33333]:{gl2:!0,bpp:4},[33323]:{gl2:!0,bpp:2},[33336]:{gl2:!0,bpp:2},[33335]:{gl2:!0,bpp:2},[33338]:{gl2:!0,bpp:4},[33337]:{gl2:!0,bpp:4},[33340]:{gl2:!0,bpp:8},[33339]:{gl2:!0,bpp:8},[32849]:{gl2:!0,bpp:3},[32856]:{gl2:!0,bpp:4},[32857]:{gl2:!0,bpp:4},[36220]:{gl2:!0,bpp:4},[36238]:{gl2:!0,bpp:4},[36975]:{gl2:!0,bpp:4},[36214]:{gl2:!0,bpp:8},[36232]:{gl2:!0,bpp:8},[36226]:{gl2:!0,bpp:16},[36208]:{gl2:!0,bpp:16},[33325]:{gl2:ml,bpp:2},[33327]:{gl2:ml,bpp:4},[34842]:{gl2:ml,bpp:8},[33326]:{gl2:ml,bpp:4},[33328]:{gl2:ml,bpp:8},[34836]:{gl2:ml,bpp:16},[35898]:{gl2:ml,bpp:4}};function z3(t,e,n){const i=n[e];if(!i)return!1;const o=Xt(t)&&i.gl2||i.gl1;return typeof o=="string"?t.getExtension(o):o}class Dc extends Wo{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||z3(e,n,Ob)}static getSamplesForFormat(e,n){let{format:i}=n;return e.getInternalformatParameter(36161,i,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:i=1,height:o=1,samples:u=0}=e;return ct(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),u!==0&&Xt(this.gl)?this.gl.renderbufferStorageMultisample(36161,u,n,i,o):this.gl.renderbufferStorage(36161,n,i,o),this.format=n,this.width=i,this.height=o,this.samples=u,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ob[this.format].bpp),this}resize(e){let{width:n,height:i}=e;return n!==this.width||i!==this.height?this.initialize({width:n,height:i,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const O3=256,F3=1024,B3=16384,Fb=6144,Bb=6145,Nb=6146,Ub=34041,GT="clear: bad arguments";function uv(t){let{framebuffer:e=null,color:n=null,depth:i=null,stencil:o=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const u={};e&&(u.framebuffer=e);let f=0;n&&(f|=B3,n!==!0&&(u.clearColor=n)),i&&(f|=O3,i!==!0&&(u.clearDepth=i)),o&&(f|=F3,i!==!0&&(u.clearStencil=i)),ct(f!==0,GT),vs(t,u,()=>{t.clear(f)})}function N3(t){let{framebuffer:e=null,buffer:n=Fb,drawBuffer:i=0,value:o=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(t),vs(t,{framebuffer:e},()=>{switch(n){case Fb:switch(o.constructor){case Int32Array:t.clearBufferiv(n,i,o);break;case Uint32Array:t.clearBufferuiv(n,i,o);break;case Float32Array:default:t.clearBufferfv(n,i,o)}break;case Bb:t.clearBufferfv(Bb,0,[o]);break;case Nb:t.clearBufferiv(Nb,0,[o]);break;case Ub:const[u,f]=o;t.clearBufferfi(Ub,0,u,f);break;default:ct(!1,GT)}})}function U3(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return ct(!1),0}}function Sm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:i=0,sourceFormat:o=6408}=e;let{sourceAttachment:u=36064,target:f=null,sourceWidth:l,sourceHeight:b,sourceType:T}=e;const{framebuffer:C,deleteFramebuffer:L}=HT(t);ct(C);const{gl:k,handle:X,attachments:te}=C;l=l||C.width,b=b||C.height,u===36064&&X===null&&(u=1028),ct(te[u]),T=T||te[u].type,f=j3(f,T,o,l,b),T=T||By(f);const ie=k.bindFramebuffer(36160,X);return k.readPixels(n,i,l,b,o,T,f),k.bindFramebuffer(36160,ie||null),L&&C.delete(),f}function Vb(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=Sm(t,{sourceAttachment:e}),{width:o,height:u}=t;for(;u>n;)({data:i,width:o,height:u}=T3({data:i,width:o,height:u}));E3({data:i,width:o,height:u});const f=document.createElement("canvas");f.width=o,f.height=u;const l=f.getContext("2d"),b=l.createImageData(o,u);return b.data.set(i),l.putImageData(b,0,0),f.toDataURL()}function V3(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:i=0,sourceY:o=0,targetMipmaplevel:u=0,targetInternalFormat:f=6408}=n;let{targetX:l,targetY:b,targetZ:T,width:C,height:L}=n;const{framebuffer:k,deleteFramebuffer:X}=HT(t);ct(k);const{gl:te,handle:ie}=k,ye=typeof l<"u"||typeof b<"u"||typeof T<"u";l=l||0,b=b||0,T=T||0;const J=te.bindFramebuffer(36160,ie);ct(e);let W=null;if(e instanceof Rl&&(W=e,C=Number.isFinite(C)?C:W.width,L=Number.isFinite(L)?L:W.height,W.bind(0),e=W.target),!ye)te.copyTexImage2D(e,u,f,i,o,C,L,0);else switch(e){case 3553:case 34067:te.copyTexSubImage2D(e,u,l,b,i,o,C,L);break;case 35866:case 32879:er(te).copyTexSubImage3D(e,u,l,b,T,i,o,C,L);break}return W&&W.unbind(),te.bindFramebuffer(36160,J||null),X&&k.delete(),W}function HT(t){return t instanceof hi?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:J3(t),deleteFramebuffer:!0}}function j3(t,e,n,i,o){if(t)return t;e=e||5121;const u=td(e,{clamped:!1}),f=U3(n);return new u(i*o*f)}const Rn={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function G3(t){const e=new _r(t,{format:6408,type:5126,dataFormat:6408}),n=new hi(t,{id:"test-framebuffer",check:!1,attachments:{[36064]:e}}),i=n.getStatus();return e.delete(),n.delete(),i===36053}const $T={[Rn.WEBGL2]:[!1,!0],[Rn.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Rn.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Rn.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Rn.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Rn.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Rn.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Rn.FLOAT_BLEND]:["EXT_float_blend"],[Rn.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Rn.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Rn.TEXTURE_FLOAT]:["OES_texture_float",!0],[Rn.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Rn.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Rn.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Rn.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Rn.COLOR_ATTACHMENT_RGBA32F]:[G3,"EXT_color_buffer_float"],[Rn.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Rn.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Rn.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Rn.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Rn.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Rn.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},H3=2;function $3(t,e){return WT(t,e)}function WT(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>qT(t,n))}function W3(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in $T)t.luma.caps[e]===void 0&&(t.luma.caps[e]=qT(t,e));return t.luma.caps}function qT(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=q3(t,e)),t.luma.caps[e]||Et.log(H3,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function q3(t,e){const n=$T[e];ct(n,e);let i;const o=Xt(t)&&n[1]||n[0];if(typeof o=="function")i=o(t);else if(Array.isArray(o)){i=!0;for(const u of o)i=i&&Boolean(t.getExtension(u))}else typeof o=="string"?i=Boolean(t.getExtension(o)):typeof o=="boolean"?i=o:ct(!1);return i}const jb="Multiple render targets not supported";class hi extends Wo{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:i,colorBufferHalfFloat:o}=n;let u=!0;return i&&(u=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),o&&(u=u&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),u}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new hi(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=er(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=er(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:i=1,attachments:o=null,color:u=!0,depth:f=!0,stencil:l=!1,check:b=!0,readBuffer:T=void 0,drawBuffers:C=void 0}=e;if(ct(n>=0&&i>=0,"Width and height need to be integers"),this.width=n,this.height=i,o)for(const L in o){const k=o[L];(Array.isArray(k)?k[0]:k).resize({width:n,height:i})}else o=this._createDefaultAttachments(u,f,l,n,i);this.update({clearAttachments:!0,attachments:o,readBuffer:T,drawBuffers:C}),o&&b&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:i,drawBuffers:o,clearAttachments:u=!1,resizeAttachments:f=!0}=e;this.attach(n,{clearAttachments:u,resizeAttachments:f});const{gl:l}=this,b=l.bindFramebuffer(36160,this.handle);return i&&this._setReadBuffer(i),o&&this._setDrawBuffers(o),l.bindFramebuffer(36160,b||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:i}=e;if(this.handle===null)return ct(n===void 0&&i===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),i===void 0&&(i=this.gl.drawingBufferHeight),n!==this.width&&i!==this.height&&Et.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(i))();for(const o in this.attachments)this.attachments[o].resize({width:n,height:i});return this.width=n,this.height=i,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o={};n&&Object.keys(this.attachments).forEach(f=>{o[f]=null}),Object.assign(o,e);const u=this.gl.bindFramebuffer(36160,this.handle);for(const f in o){ct(f!==void 0,"Misspelled framebuffer binding point?");const l=Number(f),b=o[l];let T=b;if(!T)this._unattach(l);else if(T instanceof Dc)this._attachRenderbuffer({attachment:l,renderbuffer:T});else if(Array.isArray(b)){const[C,L=0,k=0]=b;T=C,this._attachTexture({attachment:l,texture:C,layer:L,level:k})}else this._attachTexture({attachment:l,texture:T,layer:0,level:0});i&&T&&T.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,u||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(f=>!this.attachments[f]).forEach(f=>{delete this.attachments[f]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(Z3(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),i=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),i}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:i,stencil:o,drawBuffers:u=[]}=e,f=this.gl.bindFramebuffer(36160,this.handle);return(n||i||o)&&uv(this.gl,{color:n,depth:i,stencil:o}),u.forEach((l,b)=>{N3(this.gl,{drawBuffer:b,value:l})}),this.gl.bindFramebuffer(36160,f||null),this}readPixels(){return Et.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return Et.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return Et.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return Et.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return Et.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return Et.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:i=0,y:o=0,width:u,height:f}=e;const l=er(this.gl),b=l.bindFramebuffer(36008,this.handle);return i===0&&o===0&&u===void 0&&f===void 0?l.invalidateFramebuffer(36008,n):l.invalidateFramebuffer(36008,n,i,o,u,f),l.bindFramebuffer(36008,b),this}getAttachmentParameter(e,n,i){let o=this._getAttachmentParameterFallback(n);return o===null&&(this.gl.bindFramebuffer(36160,this.handle),o=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),i&&o>1e3&&(o=za(this.gl,o)),o}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const o={};for(const u of i){const f=n?za(this.gl,u):u;o[f]=this.getAttachmentParameter(e,u,n)}return o}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),i={};for(const o of n){const u=Number(o),f=e?za(this.gl,u):u;i[f]=this.getAttachmentParameters(u,e)}return i}show(){return typeof window<"u"&&window.open(Vb(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>Et.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const i=Vb(this,{targetMaxHeight:100});return Et.image({logLevel:e,message:n,image:i},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,i,o,u){let f=null;return e&&(f=f||{},f[36064]=new _r(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:o,height:u,mipmaps:!1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.ownResources.push(f[36064])),n&&i?(f=f||{},f[33306]=new Dc(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:o,height:111}),this.ownResources.push(f[33306])):n?(f=f||{},f[36096]=new Dc(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:o,height:u}),this.ownResources.push(f[36096])):i&&ct(!1),f}_unattach(e){const n=this.attachments[e];!n||(n instanceof Dc?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:i}=e;const{gl:o}=this;o.framebufferRenderbuffer(36160,n,36161,i.handle),this.attachments[n]=i}_attachTexture(e){let{attachment:n=36064,texture:i,layer:o,level:u}=e;const{gl:f}=this;switch(f.bindTexture(i.target,i.handle),i.target){case 35866:case 32879:er(f).framebufferTextureLayer(36160,n,i.target,u,o);break;case 34067:const b=X3(o);f.framebufferTexture2D(36160,n,b,i.handle,u);break;case 3553:f.framebufferTexture2D(36160,n,3553,i.handle,u);break;default:ct(!1,"Illegal texture type")}f.bindTexture(i.target,null),this.attachments[n]=i}_setReadBuffer(e){const n=EL(this.gl);n?n.readBuffer(e):ct(e===36064||e===1029,jb),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,i=er(n);if(i)i.drawBuffers(e);else{const o=n.getExtension("WEBGL_draw_buffers");o?o.drawBuffersWEBGL(e):ct(e.length===1&&(e[0]===36064||e[0]===1029),jb)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=W3(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function X3(t){return t<34069?t+34069:t}function Z3(t){return(hi.STATUS||{})[t]||"Framebuffer error ".concat(t)}const Y3=[36049,36048,33296,33298,33299,33300,33301,33302,33303];hi.ATTACHMENT_PARAMETERS=Y3;function K3(t,e){ct(t instanceof _r||t instanceof jT||t instanceof D3);const n=t.constructor,{gl:i,width:o,height:u,format:f,type:l,dataFormat:b,border:T,mipmaps:C}=t,L=Object.assign({width:o,height:u,format:f,type:l,dataFormat:b,border:T,mipmaps:C},e);return new n(i,L)}function J3(t,e){const{gl:n,width:i,height:o,id:u}=t;return new hi(n,Object.assign({},e,{id:"framebuffer-for-".concat(u),width:i,height:o,attachments:{[36064]:t}}))}function pp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,i=t.match(n);return i?i[1]:e}const Q3=35632,eR=35633;function tR(t){switch(t){case Q3:return"fragment";case eR:return"vertex";default:return"unknown type"}}function nR(t,e,n,i){const o=t.split(/\r?\n/),u={},f={},l=i||pp(e)||"(unnamed)",b="".concat(tR(n)," shader ").concat(l);for(let C=0;C<o.length;C++){const L=o[C];if(L.length<=1)continue;const k=L.split(":"),X=k[0],te=parseInt(k[2],10);if(isNaN(te))throw new Error("GLSL compilation error in ".concat(b,": ").concat(t));X!=="WARNING"?u[te]=L:f[te]=L}const T=iR(e);return{shaderName:b,errors:Gb(u,T),warnings:Gb(f,T)}}function Gb(t,e){let n="";for(let i=0;i<e.length;i++){const o=e[i];if(!(!t[i+3]&&!t[i+2]&&!t[i+1])&&(n+="".concat(o,`
`),t[i+1])){const u=t[i+1],f=u.split(":",3),l=f[0],b=parseInt(f[1],10)||0,T=u.substring(f.join(":").length+1).trim();n+=XT("^^^ ".concat(l,": ").concat(T,`

`),b)}}return n}function iR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const i=t.split(/\r?\n/),o=String(i.length+e-1).length;return i.map((u,f)=>{const l=String(f+e),b=l.length;return XT(l,o-b)+n+u})}function XT(t,e){let n="";for(let i=0;i<e;++i)n+=" ";return"".concat(n).concat(t)}function ZT(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const i=parseInt(n[1],10);Number.isFinite(i)&&(e=i)}return e}const rR="Shader: GLSL source code must be a JavaScript string";class nd extends Wo{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return ct(!1),"unknown"}}constructor(e,n){Tm(e),ct(typeof n.source=="string",rR);const i=pp(n.source,null)||n.id||Ba("unnamed ".concat(nd.getTypeName(n.shaderType)));super(e,{id:i}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const i=pp(n,null);i&&(this.id=Ba(i)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(nd.getTypeName(this.shaderType),":").concat(this.id)}getName(){return pp(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const i=this.gl.getShaderInfoLog(this.handle),{shaderName:o,errors:u,warnings:f}=nR(i,this.source,this.shaderType,this.id);throw Et.error("GLSL compilation errors in ".concat(o,`
`).concat(u))(),Et.warn("GLSL compilation warnings in ".concat(o,`
`).concat(f))(),new Error("GLSL compilation errors in ".concat(o))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class b_ extends nd{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class w_ extends nd{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const sR={[5126]:In.bind(null,"uniform1fv",$r,1,Ji),[35664]:In.bind(null,"uniform2fv",$r,2,Ji),[35665]:In.bind(null,"uniform3fv",$r,3,Ji),[35666]:In.bind(null,"uniform4fv",$r,4,Ji),[5124]:In.bind(null,"uniform1iv",ma,1,Ji),[35667]:In.bind(null,"uniform2iv",ma,2,Ji),[35668]:In.bind(null,"uniform3iv",ma,3,Ji),[35669]:In.bind(null,"uniform4iv",ma,4,Ji),[35670]:In.bind(null,"uniform1iv",ma,1,Ji),[35671]:In.bind(null,"uniform2iv",ma,2,Ji),[35672]:In.bind(null,"uniform3iv",ma,3,Ji),[35673]:In.bind(null,"uniform4iv",ma,4,Ji),[35674]:In.bind(null,"uniformMatrix2fv",$r,4,Mo),[35675]:In.bind(null,"uniformMatrix3fv",$r,9,Mo),[35676]:In.bind(null,"uniformMatrix4fv",$r,16,Mo),[35678]:Oi,[35680]:Oi,[5125]:In.bind(null,"uniform1uiv",Gf,1,Ji),[36294]:In.bind(null,"uniform2uiv",Gf,2,Ji),[36295]:In.bind(null,"uniform3uiv",Gf,3,Ji),[36296]:In.bind(null,"uniform4uiv",Gf,4,Ji),[35685]:In.bind(null,"uniformMatrix2x3fv",$r,6,Mo),[35686]:In.bind(null,"uniformMatrix2x4fv",$r,8,Mo),[35687]:In.bind(null,"uniformMatrix3x2fv",$r,6,Mo),[35688]:In.bind(null,"uniformMatrix3x4fv",$r,12,Mo),[35689]:In.bind(null,"uniformMatrix4x2fv",$r,8,Mo),[35690]:In.bind(null,"uniformMatrix4x3fv",$r,12,Mo),[35678]:Oi,[35680]:Oi,[35679]:Oi,[35682]:Oi,[36289]:Oi,[36292]:Oi,[36293]:Oi,[36298]:Oi,[36299]:Oi,[36300]:Oi,[36303]:Oi,[36306]:Oi,[36307]:Oi,[36308]:Oi,[36311]:Oi},oR={},aR={},lR={},Hb=[0];function hv(t,e,n,i){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Hb[0]=t,t=Hb);const o=t.length;if(o%e&&Et.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let u=i[o];u||(u=new n(o),i[o]=u);for(let f=0;f<o;f++)u[f]=t[f];return u}function $r(t,e){return hv(t,e,Float32Array,oR)}function ma(t,e){return hv(t,e,Int32Array,aR)}function Gf(t,e){return hv(t,e,Uint32Array,lR)}function $b(t,e,n){const i=sR[n.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(n.type));return i().bind(null,t,e)}function cR(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:Boolean(n[2])}}function uR(t,e,n){for(const i in t){const o=t[i];if((!n||Boolean(n[i]))&&!hR(o))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(i),o),new Error("".concat(e," Bad uniform ").concat(i))}return!0}function hR(t){return Array.isArray(t)||ArrayBuffer.isView(t)?fR(t):isFinite(t)||t===!0||t===!1||t instanceof Rl||t instanceof Dc?!0:t instanceof hi?Boolean(t.texture):!1}function dR(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const i=t[e];for(let o=0,u=n.length;o<u;++o)i[o]=n[o]}else t[e]=n.slice();else t[e]=n}function fR(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Oi(){let t=null;return(e,n,i)=>{const o=t!==i;return o&&(e.uniform1i(n,i),t=i),o}}function In(t,e,n,i){let o=null,u=null;return(f,l,b)=>{const T=e(b,n),C=T.length;let L=!1;if(o===null)o=new Float32Array(C),u=C,L=!0;else{ct(u===C,"Uniform length cannot change.");for(let k=0;k<C;++k)if(T[k]!==o[k]){L=!0;break}}return L&&(i(f,t,l,T),o.set(T)),L}}function Ji(t,e,n,i){t[e](n,i)}function Mo(t,e,n,i){t[e](n,!1,i)}const pR=5120,mR=5121,gR=5122,_R=5123,Wb=0,Hf=1,yR=2,vR=3,$f=4,xR=5,bR=6,gi=5126,wR=35664,ER=35665,TR=35666,mh=5124,SR=35667,AR=35668,IR=35669,gh=5125,PR=36294,CR=36295,MR=36296,kR=35670,LR=35671,RR=35672,DR=35673,zR=35674,OR=35675,FR=35676,BR=35685,NR=35686,UR=35687,VR=35688,jR=35689,GR=35690,Vy={[gi]:[gi,1,"float"],[wR]:[gi,2,"vec2"],[ER]:[gi,3,"vec3"],[TR]:[gi,4,"vec4"],[mh]:[mh,1,"int"],[SR]:[mh,2,"ivec2"],[AR]:[mh,3,"ivec3"],[IR]:[mh,4,"ivec4"],[gh]:[gh,1,"uint"],[PR]:[gh,2,"uvec2"],[CR]:[gh,3,"uvec3"],[MR]:[gh,4,"uvec4"],[kR]:[gi,1,"bool"],[LR]:[gi,2,"bvec2"],[RR]:[gi,3,"bvec3"],[DR]:[gi,4,"bvec4"],[zR]:[gi,8,"mat2"],[BR]:[gi,8,"mat2x3"],[NR]:[gi,8,"mat2x4"],[OR]:[gi,12,"mat3"],[UR]:[gi,12,"mat3x2"],[VR]:[gi,12,"mat3x4"],[FR]:[gi,16,"mat4"],[jR]:[gi,16,"mat4x2"],[GR]:[gi,16,"mat4x3"]};function HR(t){switch(t){case Wb:return Wb;case Hf:return Hf;case vR:return Hf;case yR:return Hf;case $f:return $f;case xR:return $f;case bR:return $f;default:return ct(!1),0}}function qb(t){const e=Vy[t];if(!e)return null;const[n,i]=e;return{type:n,components:i}}function YT(t,e){switch(t){case pR:case mR:case gR:case _R:t=gi;break}for(const n in Vy){const[i,o,u]=Vy[n];if(i===t&&o===e)return{glType:n,name:u}}return null}class $R{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,i=n.getProgramParameter(e.handle,35721);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getActiveAttrib(e.handle,o),b=n.getAttribLocation(e.handle,u);b>=0&&this._addAttribute(b,u,f,l)}this.attributeInfos.sort((o,u)=>o.location-u.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!Xt(n))return;const i=n.getProgramParameter(e.handle,35971);for(let o=0;o<i;o++){const{name:u,type:f,size:l}=n.getTransformFeedbackVarying(e.handle,o);this._addVarying(o,u,f,l)}this.varyingInfos.sort((o,u)=>o.location-u.location)}_addAttribute(e,n,i,o){const{type:u,components:f}=qb(i),l={type:u,size:o*f};this._inferProperties(e,n,l);const b={location:e,name:n,accessor:new Zr(l)};this.attributeInfos.push(b),this.attributeInfosByLocation[e]=b,this.attributeInfosByName[b.name]=b}_inferProperties(e,n,i){/instance/i.test(n)&&(i.divisor=1)}_addVarying(e,n,i,o){const{type:u,components:f}=qb(i),l=new Zr({type:u,size:o*f}),b={location:e,name:n,accessor:l};this.varyingInfos.push(b),this.varyingInfosByName[b.name]=b}}const Xb=4,WR=35981,qR=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class KT extends Wo{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",qR),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:i,fs:o,varyings:u,bufferMode:f=WR}=e;return this.hash=n||"",this.vs=typeof i=="string"?new b_(this.gl,{id:"".concat(e.id,"-vs"),source:i}):i,this.fs=typeof o=="string"?new w_(this.gl,{id:"".concat(e.id,"-fs"),source:o}):o,ct(this.vs instanceof b_),ct(this.fs instanceof w_),this.uniforms={},this._textureUniforms={},u&&u.length>0&&(er(this.gl),this.varyings=u,this.gl2.transformFeedbackVaryings(this.handle,u,f)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new $R(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:i=4,vertexCount:o,offset:u=0,start:f,end:l,isIndexed:b=!1,indexType:T=5123,instanceCount:C=0,isInstanced:L=C>0,vertexArray:k=null,transformFeedback:X,framebuffer:te,parameters:ie={},uniforms:ye,samplers:J}=e;if((ye||J)&&(Et.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(ye||{})),Et.priority>=n){const W=te?te.id:"default",Q="mode=".concat(za(this.gl,i)," verts=").concat(o," ")+"instances=".concat(C," indexType=").concat(za(this.gl,T)," ")+"isInstanced=".concat(L," isIndexed=").concat(b," ")+"Framebuffer=".concat(W);Et.log(n,Q)()}return ct(k),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||o===0||L&&C===0?!1:(k.bindForDraw(o,C,()=>{if(te!==void 0&&(ie=Object.assign({},ie,{framebuffer:te})),X){const W=HR(i);X.begin(W)}this._bindTextures(),vs(this.gl,ie,()=>{b&&L?this.gl2.drawElementsInstanced(i,o,T,u,C):b&&Xt(this.gl)&&!isNaN(f)&&!isNaN(l)?this.gl2.drawRangeElements(i,f,l,o,T,u):b?this.gl.drawElements(i,o,T,u):L?this.gl2.drawArraysInstanced(i,u,o,C):this.gl.drawArrays(i,u,o)}),X&&X.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Et.priority>=2&&uR(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const i=e[n],o=this._uniformSetters[n];if(o){let u=i,f=!1;if(u instanceof hi&&(u=u.texture),u instanceof Rl)if(f=this.uniforms[n]!==i,f){o.textureIndex===void 0&&(o.textureIndex=this._textureIndexCounter++);const l=u,{textureIndex:b}=o;l.bind(b),u=b,this._textureUniforms[n]=l}else u=o.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(o(u)||f)&&dR(this.uniforms,n,i)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const i=this._textureUniforms[n];i.update(),e=e&&i.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),i={};for(const o of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:i.vs=new b_({handle:o});break;case 35632:i.fs=new w_({handle:o});break}return i}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Ba(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Et.time(Xb,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),Et.timeEnd(Xb,"linkProgram for ".concat(this._getName()))(),e.debug||Et.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const i=this.gl.getActiveUniform(this.handle,n),{name:o}=cR(i.name);let u=e.getUniformLocation(this.handle,o);if(this._uniformSetters[o]=$b(e,u,i),i.size>1)for(let f=0;f<i.size;f++)u=e.getUniformLocation(this.handle,"".concat(o,"[").concat(f,"]")),this._uniformSetters["".concat(o,"[").concat(f,"]")]=$b(e,u,i)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const XR=34918,ZR=34919,YR=35007,KR=36795,JR=35976,QR=35887,eD=36202;class qp extends Wo{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const i=Xt(e),o=WT(e,Rn.TIMER_QUERY);let u=i||o;for(const f of n)switch(f){case"queries":u=u&&i;break;case"timers":u=u&&o;break;default:ct(!1)}return u}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(YR)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?eD:QR)}beginTransformFeedbackQuery(){return this.begin(JR)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,ZR);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(KR)}getResult(){return this.gl2.getQueryParameter(this.handle,XR)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((i,o)=>{const u=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):n++>e?(o("Timed out"),this._pollingPromise=null):requestAnimationFrame(u)};requestAnimationFrame(u)}),this._pollingPromise}_createHandle(){return qp.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class JT extends Wo{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};er(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Jc(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const i=this._getVaryingIndex(e),{buffer:o,byteSize:u,byteOffset:f}=this._getBufferParams(n);return i<0?(this.unused[e]=o,Et.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[i]=n,this.bindOnUse||this._bindBuffer(i,o,f,u),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,i,o;return e instanceof wn?o=e:(o=e.buffer,i=e.byteSize,n=e.byteOffset),(n!==void 0||i!==void 0)&&(n=n||0,i=i||o.byteLength-n),{buffer:o,byteOffset:n,byteSize:i}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:i,byteOffset:o}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,o,i)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0;const u=n&&n.handle;return!u||o===void 0?this.gl.bindBufferBase(35982,e,u):this.gl.bindBufferRange(35982,e,u,i,o),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Wf=null;function tD(t){return(!Wf||Wf.byteLength<t)&&(Wf=new ArrayBuffer(t)),Wf}function nD(t,e){const n=tD(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function iD(t){let{target:e,source:n,start:i=0,count:o=1}=t;const u=n.length,f=o*u;let l=0;for(let b=i;l<u;l++)e[b++]=n[l];for(;l<f;)l<f-l?(e.copyWithin(i+l,i,i+l),l*=2):(e.copyWithin(i+l,i,i+f-l),l=f);return e}const rD="elements must be GL.ELEMENT_ARRAY_BUFFER";class Wr extends Wo{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?Xt(e)||_T()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new Wr(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return Wr.MAX_ATTRIBUTES=Wr.MAX_ATTRIBUTES||e.getParameter(34921),Wr.MAX_ATTRIBUTES}static setConstant(e,n,i){switch(i.constructor){case Float32Array:Wr._setConstantFloatArray(e,n,i);break;case Int32Array:Wr._setConstantIntArray(e,n,i);break;case Uint32Array:Wr._setConstantUintArray(e,n,i);break;default:ct(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:i})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return Wr.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return ct(!e||e.target===34963,rD),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,i){if(n.target===34963)return this.setElementBuffer(n,i);const{size:o,type:u,stride:f,offset:l,normalized:b,integer:T,divisor:C}=i,{gl:L,gl2:k}=this;return e=Number(e),this.bind(()=>{L.bindBuffer(34962,n.handle),T?(ct(Xt(L)),k.vertexAttribIPointer(e,o,u,f,l)):L.vertexAttribPointer(e,o,u,b,f,l),L.enableVertexAttribArray(e),k.vertexAttribDivisor(e,C||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!Wr.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const i=this._normalizeConstantArrayValue(n),o=i.byteLength*e,u=i.length*e;let f=!this.buffer;if(this.buffer=this.buffer||new wn(this.gl,o),f=f||this.buffer.reallocate(o),f=f||!this._compareConstantArrayValues(i,this.bufferValue),f){const l=nD(n.constructor,u);iD({target:l,source:i,start:0,count:u}),this.buffer.subData(l),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let i=0;i<e.length;++i)if(e[i]!==n[i])return!1;return!0}static _setConstantFloatArray(e,n,i){switch(i.length){case 1:e.vertexAttrib1fv(n,i);break;case 2:e.vertexAttrib2fv(n,i);break;case 3:e.vertexAttrib3fv(n,i);break;case 4:e.vertexAttrib4fv(n,i);break;default:ct(!1)}}static _setConstantIntArray(e,n,i){switch(ct(Xt(e)),i.length){case 1:e.vertexAttribI1iv(n,i);break;case 2:e.vertexAttribI2iv(n,i);break;case 3:e.vertexAttribI3iv(n,i);break;case 4:e.vertexAttribI4iv(n,i);break;default:ct(!1)}}static _setConstantUintArray(e,n,i){switch(ct(Xt(e)),i.length){case 1:e.vertexAttribI1uiv(n,i);break;case 2:e.vertexAttribI2uiv(n,i);break;case 3:e.vertexAttribI3uiv(n,i);break;case 4:e.vertexAttribI4uiv(n,i);break;default:ct(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:i}=n;return ct(Number.isFinite(i)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(i,e);default:return this.gl.getVertexAttrib(i,e)}})}}const sD="VertexArray: attributes must be Buffers or constants (i.e. typed array)",oD=/^(.+)__LOCATION_([0-9]+)$/,aD=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class lD{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=n.id||n.program&&n.program.id;this.id=i,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new Wr(e),BT(this,"VertexArray","v6.0",aD),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const i=e[n];this._setAttribute(n,i)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,i);const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,n.accessor,i);return o>=0&&(this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.setBuffer(o,n,u)),this}setConstant(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:o,accessor:u}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},i));return o>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[o]=n,this.accessors[o]=u,this.clearDrawParams(),this.vertexArrayObject.enable(o,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new wn(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof wn&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof wn&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,i){let o;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),o=i()}),o}_resolveLocationAndAccessor(e,n,i,o){const u={location:-1,accessor:null},{location:f,name:l}=this._getAttributeIndex(e);if(!Number.isFinite(f)||f<0)return this.unused[e]=n,Et.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),u;const b=this._getAttributeInfo(l||f);if(!b)return u;const T=this.accessors[f]||{},C=Zr.resolve(b.accessor,T,i,o),{size:L,type:k}=C;return ct(Number.isFinite(L)&&Number.isFinite(k)),{location:f,accessor:C}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const i=oD.exec(e),o=i?i[1]:e,u=i?Number(i[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(o)+u,name:o}:{location:-1}}_setAttribute(e,n){if(n instanceof wn)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof wn){const i=n[0],o=n[1];this.setBuffer(e,i,o)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const i=n;this.setConstant(e,i)}else if(n.buffer instanceof wn){const i=n;this.setBuffer(e,i.buffer,i)}else throw new Error(sD)}_setConstantAttributes(e,n){const i=Math.max(e|0,n|0);let o=this.values[0];ArrayBuffer.isView(o)&&this._setConstantAttributeZero(o,i);for(let u=1;u<this.vertexArrayObject.MAX_ATTRIBUTES;u++)o=this.values[u],ArrayBuffer.isView(o)&&this._setConstantAttribute(u,o)}_setConstantAttributeZero(e,n){if(Wr.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const i=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,i,this.accessors[0])}_setConstantAttribute(e,n){Wr.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const i=this.values[n],o=this.accessors[n];if(!i)return;const{divisor:u}=o,f=u>0;if(e.isInstanced=e.isInstanced||f,i instanceof wn){const l=i;if(f){const b=l.getVertexCount(o);e.instanceCount=Math.min(e.instanceCount,b)}else{const b=l.getVertexCount(o);e.vertexCount=Math.min(e.vertexCount,b)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Et.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function cD(t,e){const{maxElts:n=16,size:i=1}=e;let o="[";for(let f=0;f<t.length&&f<n;++f)f>0&&(o+=",".concat(f%i===0?" ":"")),o+=id(t[f],e);const u=t.length>n?"...":"]";return"".concat(o).concat(u)}function id(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:i=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return cD(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return i?"0":"0.";if(i||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const o=t.toPrecision(2);return o.indexOf(".0")===o.length-2?o.slice(0,-1):o}function Zb(t){let{header:e="Uniforms",program:n,uniforms:i,undefinedOnly:o=!1}=t;ct(n);const u=".*_.*",f=".*Matrix",l=n._uniformSetters,b={},T=Object.keys(l).sort();let C=0;for(const X of T)!X.match(u)&&!X.match(f)&&E_({table:b,header:e,uniforms:i,uniformName:X,undefinedOnly:o})&&C++;for(const X of T)X.match(f)&&E_({table:b,header:e,uniforms:i,uniformName:X,undefinedOnly:o})&&C++;for(const X of T)b[X]||E_({table:b,header:e,uniforms:i,uniformName:X,undefinedOnly:o})&&C++;let L=0;const k={};if(!o)for(const X in i){const te=i[X];b[X]||(L++,k[X]={Type:"NOT USED: ".concat(te),[e]:id(te)})}return{table:b,count:C,unusedTable:k,unusedCount:L}}function E_(t){let{table:e,header:n,uniforms:i,uniformName:o,undefinedOnly:u}=t;const f=i[o],l=uD(f);return!u||!l?(e[o]={[n]:l?id(f):"N/A","Uniform Type":l?f:"NOT PROVIDED"},!0):!1}function uD(t){return t!=null}function hD(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const i={};e.elements&&(i.ELEMENT_ARRAY_BUFFER=Yb(e,e.elements,null,n));const o=e.values;for(const u in o){const f=e._getAttributeInfo(u);if(f){let l="".concat(u,": ").concat(f.name);const b=e.accessors[f.location];b&&(l="".concat(u,": ").concat(dD(f.name,b))),i[l]=Yb(e,o[u],b,n)}}return i}function Yb(t,e,n,i){const{gl:o}=t;if(!e)return{[i]:"null","Format ":"N/A"};let u="NOT PROVIDED",f=1,l=0,b=0,T,C,L;if(n&&(u=n.type,f=n.size,u=String(u).replace("Array",""),T=u.indexOf("nt")!==-1),e instanceof wn){const k=e,{data:X,changed:te}=k.getDebugData();C=te?"*":"",L=X,b=k.byteLength,l=b/X.BYTES_PER_ELEMENT/f;let ie;if(n){const ye=n.divisor>0;ie="".concat(ye?"I ":"P "," ").concat(l," (x").concat(f,"=").concat(b," bytes ").concat(za(o,u),")")}else T=!0,ie="".concat(b," bytes");return{[i]:"".concat(C).concat(id(L,{size:f,isInteger:T})),"Format ":ie}}return L=e,f=e.length,u=String(e.constructor.name).replace("Array",""),T=u.indexOf("nt")!==-1,{[i]:"".concat(id(L,{size:f,isInteger:T})," (constant)"),"Format ":"".concat(f,"x").concat(u," (constant)")}}function dD(t,e){const{type:n,size:i}=e,o=YT(n,i);return o?"".concat(t," (").concat(o.name,")"):t}function fD(t){const e={},n="Accessors for ".concat(t.id);for(const i of t.attributeInfos)if(i){const o=Kb(i);e["in ".concat(o)]={[n]:JSON.stringify(i.accessor)}}for(const i of t.varyingInfos)if(i){const o=Kb(i);e["out ".concat(o)]={[n]:JSON.stringify(i.accessor)}}return e}function Kb(t){const{type:e,size:n}=t.accessor,i=YT(e,n);return i?"".concat(i.name," ").concat(t.name):t.name}const Jb=$o()&&typeof document<"u";let pD=0;class mD{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=ye=>FT(ye),onAddHTML:i=null,onInitialize:o=()=>{},onRender:u=()=>{},onFinalize:f=()=>{},onError:l,gl:b=null,glOptions:T={},debug:C=!1,createFramebuffer:L=!1,autoResizeViewport:k=!0,autoResizeDrawingBuffer:X=!0,stats:te=Tl.get("animation-loop-".concat(pD++))}=e;let{useDevicePixels:ie=!0}=e;"useDevicePixelRatio"in e&&(Et.deprecated("useDevicePixelRatio","useDevicePixels")(),ie=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:i,onInitialize:o,onRender:u,onFinalize:f,onError:l,gl:b,glOptions:T,debug:C,createFramebuffer:L},this.gl=b,this.needsRedraw=null,this.timeline=null,this.stats=te,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:k,autoResizeDrawingBuffer:X,useDevicePixels:ie}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return ct(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=qp.isSupported(this.gl,["timers"])?new qp(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(i=>{this._running&&(this._addCallbackData(i||{}),i!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.getElementById(e);return i?Number(i.value):n}setViewParameters(){return Et.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{!this._running||(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Jb?new Promise((e,n)=>{if(Jb&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):b3(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):x3(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?lv(this.props.gl,e):this.onCreateContext(e),!Em(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");a3(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const i=this.props.onAddHTML(n);i&&(n.innerHTML=i)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let i=1;const{canvas:o}=this.gl;return o&&o.clientHeight?i=o.clientWidth/o.clientHeight:e>0&&n>0&&(i=e/n),{width:e,height:n,aspect:i}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&d3(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new hi(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const _d="vs",dv="fs";function Qr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const T_={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function gD(t){const e={};for(const n in t){const i=t[n],o=_D(i);e[n]=o}return e}function _D(t){let e=Qb(t);return e==="object"?t?"type"in t?Object.assign({},t,T_[t.type]):"value"in t?(e=Qb(t.value),Object.assign({type:e},t,T_[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},T_[e])}function Qb(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const yD="vs",vD="fs";class ew{constructor(e){let{name:n,vs:i,fs:o,dependencies:u=[],uniforms:f,getUniforms:l,deprecations:b=[],defines:T={},inject:C={},vertexShader:L,fragmentShader:k}=e;Qr(typeof n=="string"),this.name=n,this.vs=i||L,this.fs=o||k,this.getModuleUniforms=l,this.dependencies=u,this.deprecations=this._parseDeprecationDefinitions(b),this.defines=T,this.injections=xD(C),f&&(this.uniforms=gD(f))}getModuleSource(e){let n;switch(e){case yD:n=this.vs||"";break;case vD:n=this.fs||"";break;default:Qr(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(i=>{i.regex.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},i=this.uniforms;for(const o in i){const u=i[o];o in e&&!u.private?(u.validate&&Qr(u.validate(e[o],u),"".concat(this.name,": invalid ").concat(o)),n[o]=e[o]):n[o]=u.value}return n}}function xD(t){const e={vs:{},fs:{}};for(const n in t){let i=t[n];const o=n.slice(0,2);typeof i=="string"&&(i={order:0,injection:i}),e[o][n]=i}return e}function bD(t){return wD(eS(t))}function wD(t){const e={},n={};return QT({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((i,o)=>n[o]-n[i]).map(i=>e[i])}function QT(t){let{modules:e,level:n,moduleMap:i,moduleDepth:o}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const u of e)i[u.name]=u,(o[u.name]===void 0||o[u.name]<n)&&(o[u.name]=n);for(const u of e)u.dependencies&&QT({modules:u.dependencies,level:n+1,moduleMap:i,moduleDepth:o})}function eS(t,e){return t.map(n=>(n instanceof ew||(Qr(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),Qr(n.name,"shader module has no name"),n=new ew(n),n.dependencies=eS(n.dependencies)),n))}function ED(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",i=n.indexOf("MSIE ")!==-1,o=n.indexOf("Trident/")!==-1;return i||o}const TD=7936,SD=7937,AD=7938,ID=35724,fv={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},xl={};Object.keys(fv).forEach(t=>{xl[t]=t});function PD(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:Boolean(t&&t._version===2)}function CD(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||TD),i=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||SD);return{gpuVendor:MD(n,i),vendor:n,renderer:i,version:t.getParameter(AD),shadingLanguageVersion:t.getParameter(ID)}}function MD(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const S_={};function tw(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=fv[e];if(Qr(i,e),!ED(n))return!0;if(e in S_)return S_[e];const o=i[0],u=n.behavior||"enable",f="#extension GL_".concat(o," : ").concat(u,`
void main(void) {}`),l=t.createShader(35633);t.shaderSource(l,f),t.compileShader(l);const b=t.getShaderParameter(l,35713);return t.deleteShader(l),S_[e]=b,b}function kD(t,e){const n=fv[e];Qr(n,e);const i=PD(t)&&n[1]||n[0],o=typeof i=="string"?Boolean(t.getExtension(i)):i;return Qr(o===!1||o===!0),o}function qf(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>kD(t,n))}function LD(t){switch(CD(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function RD(t,e,n){let i=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return qf(t,xl.GLSL_FRAG_DEPTH)&&(i+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),qf(t,xl.GLSL_DERIVATIVES)&&tw(t,xl.GLSL_DERIVATIVES)&&(i+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),qf(t,xl.GLSL_FRAG_DATA)&&tw(t,xl.GLSL_FRAG_DATA,{behavior:"require"})&&(i+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),qf(t,xl.GLSL_TEXTURE_LOD)&&(i+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),i}const DD=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,zD=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,OD={[_d]:DD,[dv]:zD},mp="__LUMA_INJECT_DECLARATIONS__",nw=/void\s+main\s*\([^)]*\)\s*\{\n?/,iw=/}\n?[^{}]*$/,A_=[];function rw(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=e===_d;for(const u in n){const f=n[u];f.sort((b,T)=>b.order-T.order),A_.length=f.length;for(let b=0,T=f.length;b<T;++b)A_[b]=f[b].injection;const l="".concat(A_.join(`
`),`
`);switch(u){case"vs:#decl":o&&(t=t.replace(mp,l));break;case"vs:#main-start":o&&(t=t.replace(nw,b=>b+l));break;case"vs:#main-end":o&&(t=t.replace(iw,b=>l+b));break;case"fs:#decl":o||(t=t.replace(mp,l));break;case"fs:#main-start":o||(t=t.replace(nw,b=>b+l));break;case"fs:#main-end":o||(t=t.replace(iw,b=>l+b));break;default:t=t.replace(u,b=>b+l)}}return t=t.replace(mp,""),i&&(t=t.replace(/\}\s*$/,u=>u+OD[e])),t}function jy(t){const e={};return Qr(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const i in n)e[i]=e[i]?"".concat(e[i],`
`).concat(n[i]):n[i]}),e}function Qc(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const tS=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],FD=[...tS,[Qc("attribute"),"in $1"],[Qc("varying"),"out $1"]],BD=[...tS,[Qc("varying"),"in $1"]],nS=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],ND=[...nS,[Qc("in"),"attribute $1"],[Qc("out"),"varying $1"]],UD=[...nS,[Qc("in"),"varying $1"]],Gy="gl_FragColor",Hy=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,VD=/void\s+main\s*\([^)]*\)\s*\{\n?/;function jD(t,e,n){switch(e){case 300:return n?Xp(t,FD):GD(t);case 100:return n?Xp(t,ND):HD(t);default:throw new Error("unknown GLSL version ".concat(e))}}function Xp(t,e){for(const[n,i]of e)t=t.replace(n,i);return t}function GD(t){t=Xp(t,BD);const e=t.match(Hy);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(Gy,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace(VD,i=>"out vec4 ".concat(n,`;
`).concat(i)).replace(new RegExp("\\b".concat(Gy,"\\b"),"g"),n)}return t}function HD(t){t=Xp(t,UD);const e=t.match(Hy);if(e){const n=e[1];t=t.replace(Hy,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),Gy)}return t}const $D=`

`.concat(mp,`

`),iS={[_d]:"vertex",[dv]:"fragment"},WD=`precision highp float;

`;function qD(t,e){const{vs:n,fs:i}=e,o=bD(e.modules||[]);return{gl:t,vs:sw(t,Object.assign({},e,{source:n,type:_d,modules:o})),fs:sw(t,Object.assign({},e,{source:i,type:dv,modules:o})),getUniforms:XD(o)}}function sw(t,e){let{id:n,source:i,type:o,modules:u,defines:f={},hookFunctions:l=[],inject:b={},transpileToGLSL100:T=!1,prologue:C=!0,log:L}=e;Qr(typeof i=="string","shader source must be a string");const k=o===_d,X=i.split(`
`);let te=100,ie="",ye=i;X[0].indexOf("#version ")===0?(te=300,ie=X[0],ye=X.slice(1).join(`
`)):ie="#version ".concat(te);const J={};u.forEach(Oe=>{Object.assign(J,Oe.getDefines())}),Object.assign(J,f);let W=C?"".concat(ie,`
`).concat(YD({id:n,source:i,type:o}),`
`).concat(ZD({type:o}),`
`).concat(LD(t),`
`).concat(RD(t),`
`).concat(KD(J),`
`).concat(k?"":WD,`
`):"".concat(ie,`
`);const Q=QD(l),_e={},we={},Ce={};for(const Oe in b){const Ue=typeof b[Oe]=="string"?{injection:b[Oe],order:0}:b[Oe],st=Oe.match(/^(v|f)s:(#)?([\w-]+)$/);if(st){const Xe=st[2],xt=st[3];Xe?xt==="decl"?we[Oe]=[Ue]:Ce[Oe]=[Ue]:_e[Oe]=[Ue]}else Ce[Oe]=[Ue]}for(const Oe of u){L&&Oe.checkDeprecations(ye,L);const Ue=Oe.getModuleSource(o,te);W+=Ue;const st=Oe.injections[o];for(const Xe in st){const xt=Xe.match(/^(v|f)s:#([\w-]+)$/);if(xt){const en=xt[2]==="decl"?we:Ce;en[Xe]=en[Xe]||[],en[Xe].push(st[Xe])}else _e[Xe]=_e[Xe]||[],_e[Xe].push(st[Xe])}}return W+=$D,W=rw(W,o,we),W+=JD(Q[o],_e),W+=ye,W=rw(W,o,Ce),W=jD(W,T?100:te,k),W}function XD(t){return function(n){const i={};for(const o of t){const u=o.getUniforms(n,i);Object.assign(i,u)}return i}}function ZD(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(iS[e].toUpperCase(),`
`)}function YD(t){let{id:e,source:n,type:i}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(iS[i],`

`):""}function KD(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const i in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const o=t[i];(o||Number.isFinite(o))&&(n+="#define ".concat(i.toUpperCase()," ").concat(t[i],`
`))}return e===0&&(n+=`
`),n}function JD(t,e){let n="";for(const i in t){const o=t[i];if(n+="void ".concat(o.signature,` {
`),o.header&&(n+="  ".concat(o.header)),e[i]){const u=e[i];u.sort((f,l)=>f.order-l.order);for(const f of u)n+="  ".concat(f.injection,`
`)}o.footer&&(n+="  ".concat(o.footer)),n+=`}
`}return n}function QD(t){const e={vs:{},fs:{}};return t.forEach(n=>{let i;typeof n!="string"?(i=n,n=i.hook):i={},n=n.trim();const[o,u]=n.split(":"),f=n.replace(/\(.+/,"");e[o][f]=Object.assign(i,{signature:u})}),e}const ez="void main() {gl_FragColor = vec4(0);}",rS=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,tz=`#version 300 es
`.concat(rS);function sS(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[i,o,u]=n;if(!e.includes(i)||!o||!u)return null;const f=u.split(";")[0];return{qualifier:i,type:o,name:f}}function oS(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:i,output:o}=t;if(!n)return e===300?tz:e>300?"#version ".concat(e,`
`).concat(rS):ez;const u=rz(n,i);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(i," ").concat(n,`;
out vec4 `).concat(o,`;
void main() {
  `).concat(o," = ").concat(u,`;
}`):"varying ".concat(i," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(u,`;
}`)}function nz(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Qr(!1),null}}function iz(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Qr(!1),null}}function rz(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return Qr(!1),null}}const sz=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,oz={name:"fp32",vs:sz,fs:null};function ow(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Kr={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function az(t,{precision:e=Kr.precision}={}){return t=lz(t),"".concat(parseFloat(t.toPrecision(e)))}function eu(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ni(t,e,n){return uz(t,i=>Math.max(e,Math.min(n,i)))}function Zp(t,e,n){return eu(t)?t.map((i,o)=>Zp(i,e[o],n)):n*e+(1-n)*t}function tu(t,e,n){const i=Kr.EPSILON;n&&(Kr.EPSILON=n);try{if(t===e)return!0;if(eu(t)&&eu(e)){if(t.length!==e.length)return!1;for(let o=0;o<t.length;++o)if(!tu(t[o],e[o]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Kr.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Kr.EPSILON=i}}function lz(t){return Math.round(t/Kr.EPSILON)*Kr.EPSILON}function cz(t){return t.clone?t.clone():new Array(t.length)}function uz(t,e,n){if(eu(t)){const i=t;n=n||cz(i);for(let o=0;o<n.length&&o<i.length;++o)n[o]=e(t[o],o,n);return n}return e(t)}function hz(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class aS extends hz(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+n];return this.check()}toArray(e=[],n=0){for(let i=0;i<this.ELEMENTS;++i)e[n+i]=this[i];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:eu(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Kr)}formatString(e){let n="";for(let i=0;i<this.ELEMENTS;++i)n+=(i>0?", ":"")+az(this[i],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!tu(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,i){if(i===void 0)return this.lerp(this,e,n);for(let o=0;o<this.ELEMENTS;++o){const u=e[o];this[o]=u+i*(n[o]-u)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),n[i]);return this.check()}add(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=n[i];return this.check()}subtract(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=n[i];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Kr.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),n);return this.check()}get elements(){return this}}function dz(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Xr(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function I_(t,e,n=""){if(Kr.debug&&!dz(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class fz extends aS{get x(){return this[0]}set x(e){this[0]=Xr(e)}get y(){return this[1]}set y(e){this[1]=Xr(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let i=0;i<this.ELEMENTS;++i){const o=this[i]-e[i];n+=o*o}return Xr(n)}dot(e){let n=0;for(let i=0;i<this.ELEMENTS;++i)n+=this[i]*e[i];return Xr(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=n[i];return this.check()}divide(...e){for(const n of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=n[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ow(e>=0&&e<this.ELEMENTS,"index is out of range"),Xr(this[e])}setComponent(e,n){return ow(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var gp=1e-6,nu=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function pz(){var t=new nu(2);return nu!=Float32Array&&(t[0]=0,t[1]=0),t}function Yp(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function lS(t,e){return t[0]=-e[0],t[1]=-e[1],t}function cS(t,e,n,i){var o=e[0],u=e[1];return t[0]=o+i*(n[0]-o),t[1]=u+i*(n[1]-u),t}function mz(t,e,n){var i=e[0],o=e[1];return t[0]=n[0]*i+n[4]*o+n[12],t[1]=n[1]*i+n[5]*o+n[13],t}(function(){var t=pz();return function(e,n,i,o,u,f){var l,b;for(n||(n=2),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],u(t,t,f),e[l]=t[0],e[l+1]=t[1];return e}})();function gz(t,e,n){const i=e[0],o=e[1],u=n[3]*i+n[7]*o||1;return t[0]=(n[0]*i+n[4]*o)/u,t[1]=(n[1]*i+n[5]*o)/u,t}function uS(t,e,n){const i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u||1;return t[0]=(n[0]*i+n[4]*o+n[8]*u)/f,t[1]=(n[1]*i+n[5]*o+n[9]*u)/f,t[2]=(n[2]*i+n[6]*o+n[10]*u)/f,t}function _z(t,e,n){const i=e[0],o=e[1];return t[0]=n[0]*i+n[2]*o,t[1]=n[1]*i+n[3]*o,t[2]=e[2],t}function yz(){var t=new nu(3);return nu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function vz(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function xz(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function bz(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wz(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[0],l=n[1],b=n[2];return t[0]=o*b-u*l,t[1]=u*f-i*b,t[2]=i*l-o*f,t}function hS(t,e,n){var i=e[0],o=e[1],u=e[2],f=n[3]*i+n[7]*o+n[11]*u+n[15];return f=f||1,t[0]=(n[0]*i+n[4]*o+n[8]*u+n[12])/f,t[1]=(n[1]*i+n[5]*o+n[9]*u+n[13])/f,t[2]=(n[2]*i+n[6]*o+n[10]*u+n[14])/f,t}function Ez(t,e,n){var i=e[0],o=e[1],u=e[2];return t[0]=i*n[0]+o*n[3]+u*n[6],t[1]=i*n[1]+o*n[4]+u*n[7],t[2]=i*n[2]+o*n[5]+u*n[8],t}function Tz(t,e,n){var i=n[0],o=n[1],u=n[2],f=n[3],l=e[0],b=e[1],T=e[2],C=o*T-u*b,L=u*l-i*T,k=i*b-o*l,X=o*k-u*L,te=u*C-i*k,ie=i*L-o*C,ye=f*2;return C*=ye,L*=ye,k*=ye,X*=2,te*=2,ie*=2,t[0]=l+C+X,t[1]=b+L+te,t[2]=T+k+ie,t}function Sz(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0],u[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),u[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function Az(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),u[1]=o[1],u[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function Iz(t,e,n,i){var o=[],u=[];return o[0]=e[0]-n[0],o[1]=e[1]-n[1],o[2]=e[2]-n[2],u[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),u[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),u[2]=o[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t}function Pz(t,e){var n=t[0],i=t[1],o=t[2],u=e[0],f=e[1],l=e[2],b=Math.sqrt(n*n+i*i+o*o),T=Math.sqrt(u*u+f*f+l*l),C=b*T,L=C&&bz(t,e)/C;return Math.acos(Math.min(Math.max(L,-1),1))}var Cz=vz;(function(){var t=yz();return function(e,n,i,o,u,f){var l,b;for(n||(n=3),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2];return e}})();const P_=[0,0,0];let Xf;class fo extends fz{static get ZERO(){return Xf||(Xf=new fo(0,0,0),Object.freeze(Xf)),Xf}constructor(e=0,n=0,i=0){super(-0,-0,-0),arguments.length===1&&eu(e)?this.copy(e):(Kr.debug&&(Xr(e),Xr(n),Xr(i)),this[0]=e,this[1]=n,this[2]=i)}set(e,n,i){return this[0]=e,this[1]=n,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Kr.debug&&(Xr(e.x),Xr(e.y),Xr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Xr(e)}angle(e){return Pz(this,e)}cross(e){return wz(this,this,e),this.check()}rotateX({radians:e,origin:n=P_}){return Sz(this,this,n,e),this.check()}rotateY({radians:e,origin:n=P_}){return Az(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=P_}){return Iz(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return hS(this,this,e),this.check()}transformAsVector(e){return uS(this,this,e),this.check()}transformByMatrix3(e){return Ez(this,this,e),this.check()}transformByMatrix2(e){return _z(this,this,e),this.check()}transformByQuaternion(e){return Tz(this,this,e),this.check()}}class Mz extends aS{toString(){let e="[";if(Kr.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let i=0;i<this.RANK;++i)e+=" ".concat(this[i*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,i){return this[n*this.RANK+e]=Xr(i),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)n[o]=this[i+o];return n}setColumn(e,n){const i=e*this.RANK;for(let o=0;o<this.RANK;++o)this[i+o]=n[o];return this}}function kz(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lz(t,e){if(t===e){var n=e[1],i=e[2],o=e[3],u=e[6],f=e[7],l=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=u,t[11]=e[14],t[12]=o,t[13]=f,t[14]=l}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function $y(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=e[4],l=e[5],b=e[6],T=e[7],C=e[8],L=e[9],k=e[10],X=e[11],te=e[12],ie=e[13],ye=e[14],J=e[15],W=n*l-i*f,Q=n*b-o*f,_e=n*T-u*f,we=i*b-o*l,Ce=i*T-u*l,Oe=o*T-u*b,Ue=C*ie-L*te,st=C*ye-k*te,Xe=C*J-X*te,xt=L*ye-k*ie,$t=L*J-X*ie,en=k*J-X*ye,Dt=W*en-Q*$t+_e*xt+we*Xe-Ce*st+Oe*Ue;return Dt?(Dt=1/Dt,t[0]=(l*en-b*$t+T*xt)*Dt,t[1]=(o*$t-i*en-u*xt)*Dt,t[2]=(ie*Oe-ye*Ce+J*we)*Dt,t[3]=(k*Ce-L*Oe-X*we)*Dt,t[4]=(b*Xe-f*en-T*st)*Dt,t[5]=(n*en-o*Xe+u*st)*Dt,t[6]=(ye*_e-te*Oe-J*Q)*Dt,t[7]=(C*Oe-k*_e+X*Q)*Dt,t[8]=(f*$t-l*Xe+T*Ue)*Dt,t[9]=(i*Xe-n*$t-u*Ue)*Dt,t[10]=(te*Ce-ie*_e+J*W)*Dt,t[11]=(L*_e-C*Ce-X*W)*Dt,t[12]=(l*st-f*xt-b*Ue)*Dt,t[13]=(n*xt-i*st+o*Ue)*Dt,t[14]=(ie*Q-te*we-ye*W)*Dt,t[15]=(C*we-L*Q+k*W)*Dt,t):null}function Rz(t){var e=t[0],n=t[1],i=t[2],o=t[3],u=t[4],f=t[5],l=t[6],b=t[7],T=t[8],C=t[9],L=t[10],k=t[11],X=t[12],te=t[13],ie=t[14],ye=t[15],J=e*f-n*u,W=e*l-i*u,Q=e*b-o*u,_e=n*l-i*f,we=n*b-o*f,Ce=i*b-o*l,Oe=T*te-C*X,Ue=T*ie-L*X,st=T*ye-k*X,Xe=C*ie-L*te,xt=C*ye-k*te,$t=L*ye-k*ie;return J*$t-W*xt+Q*Xe+_e*st-we*Ue+Ce*Oe}function Il(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3],l=e[4],b=e[5],T=e[6],C=e[7],L=e[8],k=e[9],X=e[10],te=e[11],ie=e[12],ye=e[13],J=e[14],W=e[15],Q=n[0],_e=n[1],we=n[2],Ce=n[3];return t[0]=Q*i+_e*l+we*L+Ce*ie,t[1]=Q*o+_e*b+we*k+Ce*ye,t[2]=Q*u+_e*T+we*X+Ce*J,t[3]=Q*f+_e*C+we*te+Ce*W,Q=n[4],_e=n[5],we=n[6],Ce=n[7],t[4]=Q*i+_e*l+we*L+Ce*ie,t[5]=Q*o+_e*b+we*k+Ce*ye,t[6]=Q*u+_e*T+we*X+Ce*J,t[7]=Q*f+_e*C+we*te+Ce*W,Q=n[8],_e=n[9],we=n[10],Ce=n[11],t[8]=Q*i+_e*l+we*L+Ce*ie,t[9]=Q*o+_e*b+we*k+Ce*ye,t[10]=Q*u+_e*T+we*X+Ce*J,t[11]=Q*f+_e*C+we*te+Ce*W,Q=n[12],_e=n[13],we=n[14],Ce=n[15],t[12]=Q*i+_e*l+we*L+Ce*ie,t[13]=Q*o+_e*b+we*k+Ce*ye,t[14]=Q*u+_e*T+we*X+Ce*J,t[15]=Q*f+_e*C+we*te+Ce*W,t}function Kp(t,e,n){var i=n[0],o=n[1],u=n[2],f,l,b,T,C,L,k,X,te,ie,ye,J;return e===t?(t[12]=e[0]*i+e[4]*o+e[8]*u+e[12],t[13]=e[1]*i+e[5]*o+e[9]*u+e[13],t[14]=e[2]*i+e[6]*o+e[10]*u+e[14],t[15]=e[3]*i+e[7]*o+e[11]*u+e[15]):(f=e[0],l=e[1],b=e[2],T=e[3],C=e[4],L=e[5],k=e[6],X=e[7],te=e[8],ie=e[9],ye=e[10],J=e[11],t[0]=f,t[1]=l,t[2]=b,t[3]=T,t[4]=C,t[5]=L,t[6]=k,t[7]=X,t[8]=te,t[9]=ie,t[10]=ye,t[11]=J,t[12]=f*i+C*o+te*u+e[12],t[13]=l*i+L*o+ie*u+e[13],t[14]=b*i+k*o+ye*u+e[14],t[15]=T*i+X*o+J*u+e[15]),t}function pv(t,e,n){var i=n[0],o=n[1],u=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Dz(t,e,n,i){var o=i[0],u=i[1],f=i[2],l=Math.hypot(o,u,f),b,T,C,L,k,X,te,ie,ye,J,W,Q,_e,we,Ce,Oe,Ue,st,Xe,xt,$t,en,Dt,ti;return l<gp?null:(l=1/l,o*=l,u*=l,f*=l,b=Math.sin(n),T=Math.cos(n),C=1-T,L=e[0],k=e[1],X=e[2],te=e[3],ie=e[4],ye=e[5],J=e[6],W=e[7],Q=e[8],_e=e[9],we=e[10],Ce=e[11],Oe=o*o*C+T,Ue=u*o*C+f*b,st=f*o*C-u*b,Xe=o*u*C-f*b,xt=u*u*C+T,$t=f*u*C+o*b,en=o*f*C+u*b,Dt=u*f*C-o*b,ti=f*f*C+T,t[0]=L*Oe+ie*Ue+Q*st,t[1]=k*Oe+ye*Ue+_e*st,t[2]=X*Oe+J*Ue+we*st,t[3]=te*Oe+W*Ue+Ce*st,t[4]=L*Xe+ie*xt+Q*$t,t[5]=k*Xe+ye*xt+_e*$t,t[6]=X*Xe+J*xt+we*$t,t[7]=te*Xe+W*xt+Ce*$t,t[8]=L*en+ie*Dt+Q*ti,t[9]=k*en+ye*Dt+_e*ti,t[10]=X*en+J*Dt+we*ti,t[11]=te*en+W*Dt+Ce*ti,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function dS(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[4],f=e[5],l=e[6],b=e[7],T=e[8],C=e[9],L=e[10],k=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*o+T*i,t[5]=f*o+C*i,t[6]=l*o+L*i,t[7]=b*o+k*i,t[8]=T*o-u*i,t[9]=C*o-f*i,t[10]=L*o-l*i,t[11]=k*o-b*i,t}function zz(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],T=e[8],C=e[9],L=e[10],k=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o-T*i,t[1]=f*o-C*i,t[2]=l*o-L*i,t[3]=b*o-k*i,t[8]=u*i+T*o,t[9]=f*i+C*o,t[10]=l*i+L*o,t[11]=b*i+k*o,t}function fS(t,e,n){var i=Math.sin(n),o=Math.cos(n),u=e[0],f=e[1],l=e[2],b=e[3],T=e[4],C=e[5],L=e[6],k=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*o+T*i,t[1]=f*o+C*i,t[2]=l*o+L*i,t[3]=b*o+k*i,t[4]=T*o-u*i,t[5]=C*o-f*i,t[6]=L*o-l*i,t[7]=k*o-b*i,t}function Oz(t,e){var n=e[0],i=e[1],o=e[2],u=e[3],f=n+n,l=i+i,b=o+o,T=n*f,C=i*f,L=i*l,k=o*f,X=o*l,te=o*b,ie=u*f,ye=u*l,J=u*b;return t[0]=1-L-te,t[1]=C+J,t[2]=k-ye,t[3]=0,t[4]=C-J,t[5]=1-T-te,t[6]=X+ie,t[7]=0,t[8]=k+ye,t[9]=X-ie,t[10]=1-T-L,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fz(t,e,n,i,o,u,f){var l=1/(n-e),b=1/(o-i),T=1/(u-f);return t[0]=u*2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u*2*b,t[6]=0,t[7]=0,t[8]=(n+e)*l,t[9]=(o+i)*b,t[10]=(f+u)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=f*u*2*T,t[15]=0,t}function Bz(t,e,n,i,o){var u=1/Math.tan(e/2),f;return t[0]=u/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,o!=null&&o!==1/0?(f=1/(i-o),t[10]=(o+i)*f,t[14]=2*o*i*f):(t[10]=-1,t[14]=-2*i),t}var Nz=Bz;function Uz(t,e,n,i,o,u,f){var l=1/(e-n),b=1/(i-o),T=1/(u-f);return t[0]=-2*l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+n)*l,t[13]=(o+i)*b,t[14]=(f+u)*T,t[15]=1,t}var Vz=Uz;function jz(t,e,n,i){var o,u,f,l,b,T,C,L,k,X,te=e[0],ie=e[1],ye=e[2],J=i[0],W=i[1],Q=i[2],_e=n[0],we=n[1],Ce=n[2];return Math.abs(te-_e)<gp&&Math.abs(ie-we)<gp&&Math.abs(ye-Ce)<gp?kz(t):(C=te-_e,L=ie-we,k=ye-Ce,X=1/Math.hypot(C,L,k),C*=X,L*=X,k*=X,o=W*k-Q*L,u=Q*C-J*k,f=J*L-W*C,X=Math.hypot(o,u,f),X?(X=1/X,o*=X,u*=X,f*=X):(o=0,u=0,f=0),l=L*f-k*u,b=k*o-C*f,T=C*u-L*o,X=Math.hypot(l,b,T),X?(X=1/X,l*=X,b*=X,T*=X):(l=0,b=0,T=0),t[0]=o,t[1]=l,t[2]=C,t[3]=0,t[4]=u,t[5]=b,t[6]=L,t[7]=0,t[8]=f,t[9]=T,t[10]=k,t[11]=0,t[12]=-(o*te+u*ie+f*ye),t[13]=-(l*te+b*ie+T*ye),t[14]=-(C*te+L*ie+k*ye),t[15]=1,t)}function Gz(){var t=new nu(4);return nu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Hz(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function yd(t,e,n){var i=e[0],o=e[1],u=e[2],f=e[3];return t[0]=n[0]*i+n[4]*o+n[8]*u+n[12]*f,t[1]=n[1]*i+n[5]*o+n[9]*u+n[13]*f,t[2]=n[2]*i+n[6]*o+n[10]*u+n[14]*f,t[3]=n[3]*i+n[7]*o+n[11]*u+n[15]*f,t}(function(){var t=Gz();return function(e,n,i,o,u,f){var l,b;for(n||(n=4),i||(i=0),o?b=Math.min(o*n+i,e.length):b=e.length,l=i;l<b;l+=n)t[0]=e[l],t[1]=e[l+1],t[2]=e[l+2],t[3]=e[l+3],u(t,t,f),e[l]=t[0],e[l+1]=t[1],e[l+2]=t[2],e[l+3]=t[3];return e}})();var Wy;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Wy||(Wy={}));const $z=45*Math.PI/180,Wz=1,C_=.1,M_=500,qz=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class ws extends Mz{static get IDENTITY(){return Zz()}static get ZERO(){return Xz()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Wy}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,i,o,u,f,l,b,T,C,L,k,X,te,ie,ye){return this[0]=e,this[1]=n,this[2]=i,this[3]=o,this[4]=u,this[5]=f,this[6]=l,this[7]=b,this[8]=T,this[9]=C,this[10]=L,this[11]=k,this[12]=X,this[13]=te,this[14]=ie,this[15]=ye,this.check()}setRowMajor(e,n,i,o,u,f,l,b,T,C,L,k,X,te,ie,ye){return this[0]=e,this[1]=u,this[2]=T,this[3]=X,this[4]=n,this[5]=f,this[6]=C,this[7]=te,this[8]=i,this[9]=l,this[10]=L,this[11]=ie,this[12]=o,this[13]=b,this[14]=k,this[15]=ye,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(qz)}fromObject(e){return this.check()}fromQuaternion(e){return Oz(this,e),this.check()}frustum(e){const{left:n,right:i,bottom:o,top:u,near:f=C_,far:l=M_}=e;return l===1/0?Yz(this,n,i,o,u,f):Fz(this,n,i,o,u,f,l),this.check()}lookAt(e){const{eye:n,center:i=[0,0,0],up:o=[0,1,0]}=e;return jz(this,n,i,o),this.check()}ortho(e){const{left:n,right:i,bottom:o,top:u,near:f=C_,far:l=M_}=e;return Vz(this,n,i,o,u,f,l),this.check()}orthographic(e){const{fovy:n=$z,aspect:i=Wz,focalDistance:o=1,near:u=C_,far:f=M_}=e;aw(n);const l=n/2,b=o*Math.tan(l),T=b*i;return this.ortho({left:-T,right:T,bottom:-b,top:b,near:u,far:f})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:i=1,near:o=.1,far:u=500}=e;return aw(n),Nz(this,n,i,o,u),this.check()}determinant(){return Rz(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=0,e[4]=this[4]*o,e[5]=this[5]*u,e[6]=this[6]*f,e[7]=0,e[8]=this[8]*o,e[9]=this[9]*u,e[10]=this[10]*f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const i=this.getScale(n),o=1/i[0],u=1/i[1],f=1/i[2];return e[0]=this[0]*o,e[1]=this[1]*u,e[2]=this[2]*f,e[3]=this[4]*o,e[4]=this[5]*u,e[5]=this[6]*f,e[6]=this[8]*o,e[7]=this[9]*u,e[8]=this[10]*f,e}transpose(){return Lz(this,this),this.check()}invert(){return $y(this,this),this.check()}multiplyLeft(e){return Il(this,e,this),this.check()}multiplyRight(e){return Il(this,this,e),this.check()}rotateX(e){return dS(this,this,e),this.check()}rotateY(e){return zz(this,this,e),this.check()}rotateZ(e){return fS(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Dz(this,this,e,n),this.check()}scale(e){return pv(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Kp(this,this,e),this.check()}transform(e,n){return e.length===4?(n=yd(n||[-0,-0,-0,-0],e,this),I_(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:i}=e;let o;switch(i){case 2:o=mz(n||[-0,-0],e,this);break;case 3:o=hS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return I_(o,e.length),o}transformAsVector(e,n){let i;switch(e.length){case 2:i=gz(n||[-0,-0],e,this);break;case 3:i=uS(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return I_(i,e.length),i}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,i){return this.identity().translate([e,n,i])}}let Zf,Yf;function Xz(){return Zf||(Zf=new ws([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Zf)),Zf}function Zz(){return Yf||(Yf=new ws,Object.freeze(Yf)),Yf}function aw(t){if(t>Math.PI*2)throw Error("expected radians")}function Yz(t,e,n,i,o,u){const f=2*u/(n-e),l=2*u/(o-i),b=(n+e)/(n-e),T=(o+i)/(o-i),C=-1,L=-1,k=-2*u;return t[0]=f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=b,t[9]=T,t[10]=C,t[11]=L,t[12]=0,t[13]=0,t[14]=k,t[15]=0,t}const Kz=new Uint8Array([0,255,255,255]),Jz={pickingSelectedColor:null,pickingHighlightColor:Kz,pickingActive:!1,pickingAttribute:!1};function Qz(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Jz;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,i=>i/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=Boolean(t.pickingActive),e.picking_uAttribute=Boolean(t.pickingAttribute)),e}const eO=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,tO=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,nO={name:"picking",vs:eO,fs:tO,getUniforms:Qz},iO=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,rO={name:"transform",vs:iO,fs:null};class vd{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new vd(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:i="",defines:o={},inject:u={},varyings:f=[],bufferMode:l=35981,transpileToGLSL100:b=!1}=e,T=this._getModuleList(e.modules),C=this._getHash(n),L=this._getHash(i),k=T.map(Q=>this._getHash(Q.name)).sort(),X=f.map(Q=>this._getHash(Q)),te=Object.keys(o).sort(),ie=Object.keys(u).sort(),ye=[],J=[];for(const Q of te)ye.push(this._getHash(Q)),ye.push(this._getHash(o[Q]));for(const Q of ie)J.push(this._getHash(Q)),J.push(this._getHash(u[Q]));const W="".concat(C,"/").concat(L,"D").concat(ye.join("/"),"M").concat(k.join("/"),"I").concat(J.join("/"),"V").concat(X.join("/"),"H").concat(this.stateHash,"B").concat(l).concat(b?"T":"");if(!this._programCache[W]){const Q=qD(this.gl,{vs:n,fs:i,modules:T,inject:u,defines:o,hookFunctions:this._hookFunctions,transpileToGLSL100:b});this._programCache[W]=new KT(this.gl,{hash:W,vs:Q.vs,fs:Q.fs,varyings:f,bufferMode:l}),this._getUniforms[W]=Q.getUniforms||(_e=>{}),this._useCounts[W]=0}return this._useCounts[W]++,this._programCache[W]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),i={};let o=0;for(let u=0,f=this._defaultModules.length;u<f;++u){const l=this._defaultModules[u],b=l.name;n[o++]=l,i[b]=!0}for(let u=0,f=e.length;u<f;++u){const l=e[u],b=l.name;i[b]||(n[o++]=l,i[b]=!0)}return n.length=o,n}}const sO={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function oO(t,e,n){const i={};let o=e.indices;for(const u in e.attributes){const f=e.attributes[u],l=aO(u,n);if(u==="indices")o=f;else if(f.constant)i[l]=f.value;else{const b=f.value,T={...f};delete T.value,i[l]=[new wn(t,b),T],lO(u,T)}}if(o){const u=o.value||o;ct(u instanceof Uint16Array||u instanceof Uint32Array,'attribute array for "indices" must be of integer type');const f={size:1,isIndexed:o.isIndexed===void 0?!0:o.isIndexed};i.indices=[new wn(t,{data:u,target:34963}),f]}return i}function aO(t,e){const{attributeMap:n=sO}=e||{};return n&&n[t]||t}function lO(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}ct(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const yc=2,cO=1e4,uO="Model needs drawMode and vertexCount",lw=()=>{},hO={};class pS{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:i=Ba("model")}=n;ct(Em(e)),this.id=i,this.gl=e,this.id=n.id||Ba("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||vd.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:T,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:T,transpileToGLSL100:C},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},ct(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),uO)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:T,transpileToGLSL100:C}=e;this.programProps={program:n,vs:i,fs:o,modules:u,defines:f,inject:l,varyings:b,bufferMode:T,transpileToGLSL100:C},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return ct(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return ct(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=oO(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Jc(e))return this;const n={};for(const i in e){const o=e[i];n[i]=o.getValue?o.getValue():o}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return uv(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:i,uniforms:o={},attributes:u={},transformFeedback:f=this.transformFeedback,parameters:l={},vertexArray:b=this.vertexArray}=e;this.setAttributes(u),this.updateModuleSettings(n),this.setUniforms(o);let T;Et.priority>=yc&&(T=this._logDrawCallStart(yc));const C=this.vertexArray.getDrawParams(),{isIndexed:L=C.isIndexed,indexType:k=C.indexType,indexOffset:X=C.indexOffset,vertexArrayInstanced:te=C.isInstanced}=this.props;te&&!this.isInstanced&&Et.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:ie,instanceCount:ye}=this,{onBeforeRender:J=lw,onAfterRender:W=lw}=this.props;J(),this.program.setUniforms(this.uniforms);const Q=this.program.draw(Object.assign(hO,e,{logPriority:T,uniforms:null,framebuffer:i,parameters:l,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:b,transformFeedback:f,isIndexed:L,indexType:k,isInstanced:ie,instanceCount:ye,offset:L?X:0}));return W(),Et.priority>=yc&&this._logDrawCallEnd(T,b,i),Q}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:i,unbindModels:o=[]}=e;let{parameters:u}=e;i&&this._setFeedbackBuffers(i),n&&(u=Object.assign({},u,{[35977]:n})),o.forEach(f=>f.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:u}))}finally{o.forEach(f=>f.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Et.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:T,transpileToGLSL100:C}=this.programProps;n=this.programManager.get({vs:i,fs:o,modules:u,inject:f,defines:l,varyings:b,bufferMode:T,transpileToGLSL100:C}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}ct(n instanceof KT,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new lD(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof wn&&n.delete()}}_setAnimationProps(e){this.animated&&ct(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Jc(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new JT(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:cO;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),Et.group(yc,">>> DRAWING MODEL ".concat(this.id),{collapsed:Et.level<=2})(),e}_logDrawCallEnd(e,n,i,o){if(e===void 0)return;const u=hD({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:f,unusedTable:l,unusedCount:b}=Zb({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i)}),{table:T,count:C}=Zb({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,i),undefinedOnly:!0});C>0&&Et.log("MISSING UNIFORMS",Object.keys(T))(),b>0&&Et.log("UNUSED UNIFORMS",Object.keys(l))();const L=fD(this.vertexArray.configuration);Et.table(e,u)(),Et.table(e,f)(),Et.table(e+1,L)(),o&&o.log({logLevel:yc,message:"Rendered to ".concat(o.id)}),Et.groupEnd(yc)()}}class dO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:i,transformFeedback:o}=n;return{attributes:Object.assign({},i,e.attributes),transformFeedback:o}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],i=e?n[e]:null;return i?i instanceof wn?i:i.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,i=this.getBuffer(n);return i?i.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&ct(Xt(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,i={};if(this.bindings[this.currentIndex]&&Object.assign(i,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const o in this.feedbackMap){const u=this.feedbackMap[o];o in n&&(i[u]=o)}Object.assign(i,e.feedbackBuffers);for(const o in i){const u=i[o];if(typeof u=="string"){const f=n[u],{byteLength:l,usage:b,accessor:T}=f;i[o]=this._createNewBuffer(o,{byteLength:l,usage:b,accessor:T})}}return i}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const i=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:i})}_setupTransformFeedback(e,n){let{model:i}=n;const{program:o}=i;e.transformFeedback=new JT(this.gl,{program:o,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:i}=this._swapBuffers(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceBuffers:n,feedbackBuffers:i})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),i=Object.assign({},e.feedbackBuffers);for(const o in this.feedbackMap){const u=this.feedbackMap[o];n[o]=e.feedbackBuffers[u],i[u]=e.sourceBuffers[o],ct(i[u]instanceof wn)}return{sourceBuffers:n,feedbackBuffers:i}}_createNewBuffer(e,n){const i=new wn(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=i,i}_getNextIndex(){return(this.currentIndex+1)%2}}const fO="transform_uSampler_",Jp="transform_uSize_",cw="transform_position";function pO(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:i,targetTexture:o}=t,f=Object.keys(n).length,l=null;const b={};let T=e,C={};if(f>0||i){const L=T.split(`
`),k=L.slice();if(L.forEach((X,te,ie)=>{if(f>0){const ye=vO(X,n);if(ye){const{updatedLine:J,inject:W}=ye;k[te]=J,C=jy([C,W]),Object.assign(b,ye.samplerTextureMap),f--}}i&&!l&&(l=yO(X,i))}),i){ct(o);const X="".concat(Jp).concat(i),te="uniform vec2 ".concat(X,`;
`),ie="     vec2 ".concat(cw," = transform_getPos(").concat(X,`);
     gl_Position = vec4(`).concat(cw,`, 0, 1.);
`);C=jy([C,{"vs:#decl":te,"vs:#main-start":ie}])}T=k.join(`
`)}return{vs:T,targetTextureType:l,inject:C,samplerTextureMap:b}}function mO(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:i}=t;const o={};let u,f;n&&({width:u,height:f}=i,o["".concat(Jp).concat(n)]=[u,f]);for(const l in e)({width:u,height:f}=e[l]),o["".concat(Jp).concat(l)]=[u,f];return o}function gO(t){return sS(t,["attribute","in"])}function _O(t){const e="".concat(fO).concat(t),n="".concat(Jp).concat(t),i="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:i}}function yO(t,e){const n=sS(t,["varying","out"]);return n&&n.name===e?n.type:null}function vO(t,e){const n={},i=gO(t);if(!i)return null;const{type:o,name:u}=i;if(u&&e[u]){const f="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:l,sizeName:b,uniformDeclerations:T}=_O(u),C=nz(o),L="  ".concat(o," ").concat(u," = transform_getInput(").concat(l,", ").concat(b,").").concat(C,`;
`);return n[l]=u,{updatedLine:f,inject:{"vs:#decl":T,"vs:#main-start":L},samplerTextureMap:n}}return null}const xO={[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},bO="transform_output";class wO{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:i,framebuffer:o,targetTexture:u}=this.bindings[this.currentIndex],f=Object.assign({},n,e.attributes),l=Object.assign({},e.uniforms),b=Object.assign({},e.parameters);let T=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){f.transform_elementID=this.elementIDBuffer;for(const L in this.samplerTextureMap){const k=this.samplerTextureMap[L];l[L]=i[k]}this._setSourceTextureParameters();const C=mO({sourceTextureMap:i,targetTextureVarying:this.targetTextureVarying,targetTexture:u});Object.assign(l,C)}return this.hasTargetTexture&&(T=!1,b.viewport=[0,0,o.width,o.height]),{attributes:f,framebuffer:o,uniforms:l,discard:T,parameters:b}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],i=Sm(n);if(!e)return i;const o=i.constructor,u=iz(this.targetTextureType),f=new o(i.length*u/4);let l=0;for(let b=0;b<i.length;b+=4)for(let T=0;T<u;T++)f[l++]=i[b+T];return f}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:i}=e;this._swapTexture=i,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:i}=e;if(i instanceof _r)return i;const o=n[i];return o?(this._targetRefTexName=i,this._createNewTexture(o)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:i={},_targetTexture:o}=e,u=this._createTargetTexture({sourceTextures:i,textureOrReference:o});this.hasSourceTextures=this.hasSourceTextures||i&&Object.keys(i).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:i,targetTexture:u}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((i,o,u)=>{u[o]=o}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new wn(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:i}=this._swapTextures(this.bindings[this.currentIndex]),o=this._getNextIndex();this.bindings[o]=this._updateBinding(this.bindings[o],{sourceTextures:n,targetTexture:i})}}_updateBinding(e,n){const{sourceBuffers:i,sourceTextures:o,targetTexture:u}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,o),Object.assign(e.sourceBuffers,i),u){e.targetTexture=u;const{width:f,height:l}=u,{framebuffer:b}=e;b?(b.update({attachments:{[36064]:u},resizeAttachments:!1}),b.resize({width:f,height:l})):e.framebuffer=new hi(this.gl,{id:"transform-framebuffer",width:f,height:l,attachments:{[36064]:u}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const i in n)n[i].setParameters(xO)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const i=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:i}}_createNewTexture(e){const n=K3(e,{parameters:{[10241]:9728,[10240]:9728,[10242]:33071,[10243]:33071},pixelStore:{[37440]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:i}=this.bindings[this.currentIndex],{vs:o,uniforms:u,targetTextureType:f,inject:l,samplerTextureMap:b}=pO({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:i}),T=jy([e.inject||{},l]);this.targetTextureType=f,this.samplerTextureMap=b;const C=e._fs||oS({version:ZT(o),input:this.targetTextureVarying,inputType:f,output:bO}),L=this.hasSourceTextures||this.targetTextureVarying?[rO].concat(e.modules||[]):e.modules;return{vs:o,fs:C,modules:L,uniforms:u,inject:T}}}class mv{static isSupported(e){return Xt(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:i}=this;e&&e.delete(),n&&n.delete(),i&&i.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,i=this._updateDrawOptions(e);n&&i.framebuffer&&i.framebuffer.clear({color:!0}),this.model.transform(i)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)e=e||i.swap();ct(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n){const o=i.getData(e);if(o)return o}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of n)i.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new pS(n,Object.assign({},e,{fs:e.fs||oS({version:ZT(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=o.updateModelProps(n);return n}_buildResourceTransforms(e,n){EO(n)&&(this.bufferTransform=new dO(e,n)),TO(n)&&(this.textureTransform=new wO(e,n)),ct(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const i=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const o of i)n=Object.assign(n,o.getDrawOptions(n));return n}}function EO(t){return!!(!Jc(t.feedbackBuffers)||!Jc(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function TO(t){return!!(!Jc(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const uw={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class SO{static get DRAW_MODE(){return uw}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Ba("geometry"),drawMode:i=uw.TRIANGLES,attributes:o={},indices:u=null,vertexCount:f=null}=e;this.id=n,this.drawMode=i|0,this.attributes={},this.userData={},this._setAttributes(o,u),this.vertexCount=f||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const i in e){let o=e[i];o=ArrayBuffer.isView(o)?{value:o}:o,ct(ArrayBuffer.isView(o.value),"".concat(this._print(i),": must be typed array or object with value as typed array")),(i==="POSITION"||i==="positions")&&!o.size&&(o.size=3),i==="indices"?(ct(!this.indices),this.indices=o):this.attributes[i]=o}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let i=1/0;for(const o in e){const u=e[o],{value:f,size:l,constant:b}=u;!b&&f&&l>=1&&(i=Math.min(i,f.length/l))}return ct(Number.isFinite(i)),i}}let AO=1,IO=1;class mS{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:i=Number.POSITIVE_INFINITY,rate:o=1,repeat:u=1}=e,f=AO++,l={time:0,delay:n,duration:i,rate:o,repeat:u};return this._setChannelTime(l,this.time),this.channels.set(f,l),f}removeChannel(e){this.channels.delete(e);for(const[n,i]of this.animations)i.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const o of n)this._setChannelTime(o,this.time);const i=this.animations.values();for(const o of i){const{animation:u,channel:f}=o;u.setTime(this.getTime(f))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const i=IO++;return this.animations.set(i,{animation:e,channel:n}),e.setTime(this.getTime(n)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const i=n-e.delay,o=e.duration*e.repeat;i>=o?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}const gS="#define SMOOTH_EDGE_RADIUS 0.5",PO=`
`.concat(gS,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),CO=`
`.concat(gS,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),MO={name:"geometry",vs:PO,fs:CO},fn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(fn,"IDENTITY",{get:()=>(pn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const co={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},qy={common:0,meters:1,pixels:2},hw={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},xd={DRAW:"draw",MASK:"mask"},kO=Object.keys(fn).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(fn[t],";")).join(""),LO=Object.keys(co).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(co[t],";")).join(""),RO=Object.keys(qy).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(qy[t],";")).join(""),DO="".concat(kO,`
`).concat(LO,`
`).concat(RO,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0; // meters
const float GLOBE_RADIUS = 256.0;

// returns an adjustment factor for uCommonUnitsPerMeter
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {

    // uCommonUnitsPerMeter in low-zoom Web Mercator is non-linear
    // Adjust by 1 / cos(latitude)
    // If geometry.position (vertex in common space) is populated, use it
    // Otherwise use geometry.worldPosition (anchor in world space)
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }

    // latitude from common y: 2.0 * (atan(exp(y / TILE_SIZE * 2.0 * PI - PI)) - PI / 4.0)
    // Taylor series of 1 / cos(latitude)
    // Max error < 0.003
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}

//
// Scaling offsets - scales meters to "world distance"
// Note the scalar version of project_size is for scaling the z component only
//
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}

// Get rotation matrix that aligns the z axis with the given up vector
// Find 3 unit vectors ux, uy, uz that are perpendicular to each other and uz == up
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  // Tangent on XY plane
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}

//
// Projecting normal - transform deltas from current coordinate system to
// normals in the worldspace
//
vec3 project_normal(vec3 vector) {
  // Apply model matrix
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

//
// Projecting positions - non-linear projection: lnglats => unit tile [0-1, 0-1]
//
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

//
// Projects positions (defined by project_uCoordinateSystem) to common space (defined by project_uProjectionMode)
//
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;

  // Work around for a Mac+NVIDIA bug https://github.com/visgl/deck.gl/issues/4145
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        // Too far from the projection center for offset mode to be accurate
        // Only use high parts
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    // Subtract high part of 64 bit value. Convert remainder to float32, preserving precision.
    position_world.xyz -= project_uCoordinateOrigin;
  }

  // Translation is already added to the high parts
  return project_offset_(position_world + project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}

//
// Projects from common space coordinates to clip space.
// Uses project_uViewProjectionMatrix
//
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}

// Returns a clip space offset that corresponds to a given number of screen pixels
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  // UNIT_PIXELS
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function zO(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}return!1}function Am(t){let e={},n;return i=>{for(const o in i)if(!zO(i[o],e[o])){n=t(i),e=i;break}return n}}const dw=[0,0,0,0],OO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],_S=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],FO=[0,0,0],yS=[0,0,0],BO=Am(VO);function vS(t,e,n=yS){n.length<3&&(n=[n[0],n[1],0]);let i=n,o,u=!0;switch(e===fn.LNGLAT_OFFSETS||e===fn.METER_OFFSETS?o=n:o=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case co.WEB_MERCATOR:(e===fn.LNGLAT||e===fn.CARTESIAN)&&(o=[0,0,0],u=!1);break;case co.WEB_MERCATOR_AUTO_OFFSET:e===fn.LNGLAT?i=o:e===fn.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],o=t.unprojectPosition(i),i[0]-=n[0],i[1]-=n[1],i[2]-=n[2]);break;case co.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case co.GLOBE:u=!1,o=null;break;default:u=!1}return{geospatialOrigin:o,shaderCoordinateOrigin:i,offsetMode:u}}function NO(t,e,n){const{viewMatrixUncentered:i,projectionMatrix:o}=t;let{viewMatrix:u,viewProjectionMatrix:f}=t,l=dw,b=dw,T=t.cameraPosition;const{geospatialOrigin:C,shaderCoordinateOrigin:L,offsetMode:k}=vS(t,e,n);return k&&(b=t.projectPosition(C||L),T=[T[0]-b[0],T[1]-b[1],T[2]-b[2]],b[3]=1,l=yd([],b,f),u=i||u,f=Il([],o,u),f=Il([],f,OO)),{viewMatrix:u,viewProjectionMatrix:f,projectionCenter:l,originCommon:b,cameraPosCommon:T,shaderCoordinateOrigin:L,geospatialOrigin:C}}function UO({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:i=fn.DEFAULT,coordinateOrigin:o=yS,autoWrapLongitude:u=!1}){i===fn.DEFAULT&&(i=t.isGeospatial?fn.LNGLAT:fn.CARTESIAN);const f=BO({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:o});return f.project_uWrapLongitude=u,f.project_uModelMatrix=n||_S,f}function VO({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:i}){const{projectionCenter:o,viewProjectionMatrix:u,originCommon:f,cameraPosCommon:l,shaderCoordinateOrigin:b,geospatialOrigin:T}=NO(t,n,i),C=t.getDistanceScales(),L=[t.width*e,t.height*e],k=yd([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,X={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:b,project_uCommonOrigin:f.slice(0,3),project_uCenter:o,project_uPseudoMeters:Boolean(t._pseudoMeters),project_uViewportSize:L,project_uDevicePixelRatio:e,project_uFocalDistance:k,project_uCommonUnitsPerMeter:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit:C.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:FO,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:u,project_uModelMatrix:_S,project_uCameraPosition:l};if(T){const te=t.getDistanceScales(T);switch(n){case fn.METER_OFFSETS:X.project_uCommonUnitsPerWorldUnit=te.unitsPerMeter,X.project_uCommonUnitsPerWorldUnit2=te.unitsPerMeter2;break;case fn.LNGLAT:case fn.LNGLAT_OFFSETS:t._pseudoMeters||(X.project_uCommonUnitsPerMeter=te.unitsPerMeter),X.project_uCommonUnitsPerWorldUnit=te.unitsPerDegree,X.project_uCommonUnitsPerWorldUnit2=te.unitsPerDegree2;break;case fn.CARTESIAN:X.project_uCommonUnitsPerWorldUnit=[1,1,te.unitsPerMeter[2]],X.project_uCommonUnitsPerWorldUnit2=[0,0,te.unitsPerMeter2[2]];break}}return X}const jO={};function GO(t=jO){return"viewport"in t?UO(t):{}}const gv={name:"project",dependencies:[oz,MO],vs:DO,getUniforms:GO},HO=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,$O={name:"project32",dependencies:[gv],vs:HO};function WO(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jc(t,e){const n=yd([],e,t);return Hz(n,n,1/n[3]),n}function fw(t,e){const n=t%e;return n<0?e+n:n}function Xy(t,e,n){return t<e?e:t>n?n:t}function qO(t){return Math.log(t)*Math.LOG2E}const _v=Math.log2||qO;function Go(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Os=Math.PI,xS=Os/4,Ns=Os/180,Zy=180/Os,rd=512,Yy=4003e4,Kf=85.051129,XO=1.5;function ZO(t){return _v(t)}function Qp(t){const[e,n]=t;Go(Number.isFinite(e)),Go(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const i=e*Ns,o=n*Ns,u=rd*(i+Os)/(2*Os),f=rd*(Os+Math.log(Math.tan(xS+o*.5)))/(2*Os);return[u,f]}function iu(t){const[e,n]=t,i=e/rd*(2*Os)-Os,o=2*(Math.atan(Math.exp(n/rd*(2*Os)-Os))-xS);return[i*Zy,o*Zy]}function YO(t){const{latitude:e}=t;Go(Number.isFinite(e));const n=Math.cos(e*Ns);return ZO(Yy*n)-9}function Ky(t){const{latitude:e,longitude:n,highPrecision:i=!1}=t;Go(Number.isFinite(e)&&Number.isFinite(n));const o=rd,u=Math.cos(e*Ns),f=o/360,l=f/u,b=o/Yy/u,T={unitsPerMeter:[b,b,b],metersPerUnit:[1/b,1/b,1/b],unitsPerDegree:[f,l,b],degreesPerUnit:[1/f,1/l,1/b]};if(i){const C=Ns*Math.tan(e*Ns)/u,L=f*C/2,k=o/Yy*C,X=k/l*b;T.unitsPerDegree2=[0,L,k],T.unitsPerMeter2=[X,0,X]}return T}function bS(t,e){const[n,i,o]=t,[u,f,l]=e,{unitsPerMeter:b,unitsPerMeter2:T}=Ky({longitude:n,latitude:i,highPrecision:!0}),C=Qp(t);C[0]+=u*(b[0]+T[0]*f),C[1]+=f*(b[1]+T[1]*f);const L=iu(C),k=(o||0)+(l||0);return Number.isFinite(o)||Number.isFinite(l)?[L[0],L[1],k]:L}function KO(t){const{height:e,pitch:n,bearing:i,altitude:o,scale:u,center:f}=t,l=WO();Kp(l,l,[0,0,-o]),dS(l,l,-n*Ns),fS(l,l,i*Ns);const b=u/e;return pv(l,l,[b,b,b]),f&&Kp(l,l,xz([],f)),l}function JO(t){const{width:e,height:n,altitude:i,pitch:o=0,offset:u,center:f,scale:l,nearZMultiplier:b=1,farZMultiplier:T=1}=t;let{fovy:C=em(XO)}=t;i!==void 0&&(C=em(i));const L=C*Ns,k=o*Ns,X=wS(C);let te=X;f&&(te+=f[2]*l/Math.cos(k)/n);const ie=L*(.5+(u?u[1]:0)/n),ye=Math.sin(ie)*te/Math.sin(Xy(Math.PI/2-k-ie,.01,Math.PI-.01)),J=Math.sin(k)*ye+te,W=te*10,Q=Math.min(J*T,W);return{fov:L,aspect:e/n,focalDistance:X,near:b,far:Q}}function em(t){return 2*Math.atan(.5/t)*Zy}function wS(t){return .5/Math.tan(.5*t*Ns)}function ES(t,e){const[n,i,o=0]=t;return Go(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),jc(e,[n,i,o,1])}function Im(t,e,n=0){const[i,o,u]=t;if(Go(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u))return jc(e,[i,o,u,1]);const f=jc(e,[i,o,0,1]),l=jc(e,[i,o,1,1]),b=f[2],T=l[2],C=b===T?0:((n||0)-b)/(T-b);return cS([],f,l,C)}function TS(t){const{width:e,height:n,bounds:i,minExtent:o=0,maxZoom:u=24,offset:f=[0,0]}=t,[[l,b],[T,C]]=i,L=QO(t.padding),k=Qp([l,Xy(C,-Kf,Kf)]),X=Qp([T,Xy(b,-Kf,Kf)]),te=[Math.max(Math.abs(X[0]-k[0]),o),Math.max(Math.abs(X[1]-k[1]),o)],ie=[e-L.left-L.right-Math.abs(f[0])*2,n-L.top-L.bottom-Math.abs(f[1])*2];Go(ie[0]>0&&ie[1]>0);const ye=ie[0]/te[0],J=ie[1]/te[1],W=(L.right-L.left)/2/ye,Q=(L.top-L.bottom)/2/J,_e=[(X[0]+k[0])/2+W,(X[1]+k[1])/2+Q],we=iu(_e),Ce=Math.min(u,_v(Math.abs(Math.min(ye,J))));return Go(Number.isFinite(Ce)),{longitude:we[0],latitude:we[1],zoom:Ce}}function QO(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Go(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const pw=Math.PI/180;function e4(t,e=0){const{width:n,height:i,unproject:o}=t,u={targetZ:e},f=o([0,i],u),l=o([n,i],u);let b,T;const C=t.fovy?.5*t.fovy*pw:Math.atan(.5/t.altitude),L=(90-t.pitch)*pw;return C>L-.01?(b=mw(t,0,e),T=mw(t,n,e)):(b=o([0,0],u),T=o([n,0],u)),[f,l,T,b]}function mw(t,e,n){const{pixelUnprojectionMatrix:i}=t,o=jc(i,[e,0,1,1]),u=jc(i,[e,t.height,1,1]),l=(n*t.distanceScales.unitsPerMeter[2]-o[2])/(u[2]-o[2]),b=cS([],o,u,l),T=iu(b);return T.push(n),T}const gw=512;function t4(t){const{width:e,height:n,pitch:i=0}=t;let{longitude:o,latitude:u,zoom:f,bearing:l=0}=t;(o<-180||o>180)&&(o=fw(o+180,360)-180),(l<-180||l>180)&&(l=fw(l+180,360)-180);const b=_v(n/gw);if(f<=b)f=b,u=0;else{const T=n/2/Math.pow(2,f),C=iu([0,T])[1];if(u<C)u=C;else{const L=iu([0,gw-T])[1];u>L&&(u=L)}}return{width:e,height:n,longitude:o,latitude:u,zoom:f,pitch:i,bearing:l}}const n4=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,i4=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,r4=Am(c4),s4=Am(u4),o4=[0,0,0,1],a4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function l4(t,e){const[n,i,o]=t,u=Im([n,i,o],e);return Number.isFinite(o)?u:[u[0],u[1],0]}function c4({viewport:t,center:e}){return new ws(t.viewProjectionMatrix).invert().transform(e)}function u4({viewport:t,shadowMatrices:e}){const n=[],i=t.pixelUnprojectionMatrix,o=t.isGeospatial?void 0:1,u=[[0,0,o],[t.width,0,o],[0,t.height,o],[t.width,t.height,o],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(f=>l4(f,i));for(const f of e){const l=f.clone().translate(new fo(t.center).negate()),b=u.map(C=>l.transform(C)),T=new ws().ortho({left:Math.min(...b.map(C=>C[0])),right:Math.max(...b.map(C=>C[0])),bottom:Math.min(...b.map(C=>C[1])),top:Math.max(...b.map(C=>C[1])),near:Math.min(...b.map(C=>-C[2])),far:Math.max(...b.map(C=>-C[2]))});n.push(T.multiplyRight(f))}return n}function h4(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const i={shadow_uDrawShadowMap:Boolean(t.drawToShadowMap),shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||o4,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},o=r4({viewport:t.viewport,center:e.project_uCenter}),u=[],f=s4({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<t.shadowMatrices.length;l++){const b=f[l],T=b.clone().translate(new fo(t.viewport.center).negate());e.project_uCoordinateSystem===fn.LNGLAT&&e.project_uProjectionMode===co.WEB_MERCATOR?(f[l]=T,u[l]=o):(f[l]=b.clone().multiplyRight(a4),u[l]=T.transform(o))}for(let l=0;l<f.length;l++)i["shadow_uViewProjectionMatrices[".concat(l,"]")]=f[l],i["shadow_uProjectCenters[".concat(l,"]")]=u[l],t.shadowMaps&&t.shadowMaps.length>0?i["shadow_uShadowMap".concat(l)]=t.shadowMaps[l]:i["shadow_uShadowMap".concat(l)]=t.dummyShadowMap;return i}const k_={name:"shadow",dependencies:[gv],vs:n4,fs:i4,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?h4(t,e):{}},d4={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...nO},f4=[gv],p4=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function m4(t){const e=vd.getDefaultProgramManager(t);for(const n of f4)e.addDefaultModule(n);for(const n of p4)e.addShaderHook(n);return e}const g4=[255,255,255],_4=1;let y4=0;class v4{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","ambient");const{color:n=g4}=e,{intensity:i=_4}=e;this.id=e.id||"ambient-".concat(y4++),this.color=n,this.intensity=i}}const x4=[255,255,255],b4=1,w4=[0,0,-1];let E4=0;class _w{constructor(e={}){U(this,"id",void 0),U(this,"color",void 0),U(this,"intensity",void 0),U(this,"type","directional"),U(this,"direction",void 0),U(this,"shadow",void 0);const{color:n=x4}=e,{intensity:i=b4}=e,{direction:o=w4}=e,{_shadow:u=!1}=e;this.id=e.id||"directional-".concat(E4++),this.color=n,this.intensity=i,this.type="directional",this.direction=new fo(o).normalize().toArray(),this.shadow=u}getProjectedLight(e){return this}}class T4{constructor(e,n={id:"pass"}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"props",void 0);const{id:i}=n;this.id=i,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Pm extends T4{constructor(...e){super(...e),U(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return jo(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:i,viewports:o,views:u,onViewportActive:f,clearStack:l=!0,clearCanvas:b=!0}=e;e.pass=e.pass||"unknown";const T=this.gl;b&&A4(T),l&&(this._lastRenderIndex=-1);const C=[];for(const L of o){const k=u&&u[L.id];f(L);const X=this._getDrawLayerParams(L,e),te=L.subViewports||[L];for(const ie of te){const ye=this._drawLayersInViewport(T,{target:n,moduleParameters:i,viewport:ie,view:k,pass:e.pass,layers:e.layers},X);C.push(ye)}}return C}_getDrawLayerParams(e,{layers:n,pass:i,layerFilter:o,cullRect:u,effects:f,moduleParameters:l}){const b=[],T=SS(this._lastRenderIndex+1),C={layer:n[0],viewport:e,isPicking:i.startsWith("picking"),renderPass:i,cullRect:u},L={};for(let k=0;k<n.length;k++){const X=n[k],te=this._shouldDrawLayer(X,C,o,L),ie={shouldDrawLayer:te};te&&(ie.layerRenderIndex=T(X,te),ie.moduleParameters=this._getModuleParameters(X,f,i,l),ie.layerParameters=this.getLayerParameters(X,k,e)),b[k]=ie}return b}_drawLayersInViewport(e,{layers:n,moduleParameters:i,pass:o,target:u,viewport:f,view:l},b){const T=S4(e,{moduleParameters:i,target:u,viewport:f});if(l&&l.props.clear){const L=l.props.clear===!0?{color:!0,depth:!0}:l.props.clear;vs(e,{scissorTest:!0,scissor:T},()=>uv(e,L))}const C={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};jo(e,{viewport:T});for(let L=0;L<n.length;L++){const k=n[L],{shouldDrawLayer:X,layerRenderIndex:te,moduleParameters:ie,layerParameters:ye}=b[L];if(X&&k.props.pickable&&C.pickableCount++,k.isComposite)C.compositeCount++;else if(X){C.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,te),ie.viewport=f;try{k._drawLayer({moduleParameters:ie,uniforms:{layerIndex:te},parameters:ye})}catch(J){k.raiseError(J,"drawing ".concat(k," to ").concat(o))}}}return C}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,i){return e.props.parameters}_shouldDrawLayer(e,n,i,o){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let f=e.parent;for(;f;){if(!f.props.visible||!f.filterSubLayer(n))return!1;n.layer=f,f=f.parent}if(i){const l=n.layer.id;if(l in o||(o[l]=i(n)),!o[l])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,i,o){var u;const f=Object.assign(Object.create(((u=e.internalState)===null||u===void 0?void 0:u.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:Kc(this.gl)});if(n)for(const b of n){var l;Object.assign(f,(l=b.getModuleParameters)===null||l===void 0?void 0:l.call(b,e))}return Object.assign(f,this.getModuleParameters(e,n),o)}}function SS(t=0,e={}){const n={},i=(o,u)=>{const f=o.props._offset,l=o.id,b=o.parent&&o.parent.id;let T;if(b&&!(b in e)&&i(o.parent,!1),b in n){const C=n[b]=n[b]||SS(e[b],e);T=C(o,u),n[l]=C}else Number.isFinite(f)?(T=f+(e[b]||0),n[l]=null):T=t;return u&&T>=t&&(t=T+1),e[l]=T,T};return i}function S4(t,{moduleParameters:e,target:n,viewport:i}){const o=n&&n.id!=="default-framebuffer",u=e&&e.devicePixelRatio||Kc(t),f=o?n.height:t.drawingBufferHeight,l=i;return[l.x*u,f-(l.y+l.height)*u,l.width*u,l.height*u]}function A4(t){const e=t.drawingBufferWidth,n=t.drawingBufferHeight;jo(t,{viewport:[0,0,e,n]}),t.clear(16640)}class I4 extends Pm{constructor(e,n){super(e,n),U(this,"shadowMap",void 0),U(this,"depthBuffer",void 0),U(this,"fbo",void 0),this.shadowMap=new _r(e,{width:1,height:1,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.depthBuffer=new Dc(e,{format:33189,width:1,height:1}),this.fbo=new hi(e,{id:"shadowmap",width:1,height:1,attachments:{[36064]:this.shadowMap,[36096]:this.depthBuffer}})}render(e){const n=this.fbo;vs(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const i=e.viewports[0],o=Kc(this.gl),u=i.width*o,f=i.height*o;(u!==n.width||f!==n.height)&&n.resize({width:u,height:f}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const P4={color:[255,255,255],intensity:1},yw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],C4=[0,0,0,200/255];class AS{constructor(e={}){U(this,"id","lighting-effect"),U(this,"props",null),U(this,"shadowColor",C4),U(this,"shadow",void 0),U(this,"ambientLight",null),U(this,"directionalLights",[]),U(this,"pointLights",[]),U(this,"shadowPasses",[]),U(this,"shadowMaps",[]),U(this,"dummyShadowMap",null),U(this,"programManager",void 0),U(this,"shadowMatrices",void 0);for(const n in e){const i=e[n];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow)}preRender(e,{layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f}){if(!!this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=vd.getDefaultProgramManager(e),k_&&this.programManager.addDefaultModule(k_)),this.dummyShadowMap||(this.dummyShadowMap=new _r(e,{width:1,height:1}));for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f,moduleParameters:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(i=>i.getProjectedLight({layer:e})),pointLights:this.pointLights.map(i=>i.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(k_),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const i=new ws().lookAt({eye:new fo(n.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const i=new I4(e);this.shadowPasses[n]=i,this.shadowMaps[n]=i.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:i}=this;!e&&n.length===0&&i.length===0&&(this.ambientLight=new v4(P4),this.directionalLights.push(new _w(yw[0]),new _w(yw[1])))}}class M4{constructor(e={}){U(this,"_pool",[]),U(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:i=1,type:o,padding:u=0,copy:f=!1,initialize:l=!1,maxCount:b}){const T=o||e&&e.constructor||Float32Array,C=n*i+u;if(ArrayBuffer.isView(e)){if(C<=e.length)return e;if(C*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new T(e.buffer,0,C)}let L=1/0;b&&(L=b*i+u);const k=this._allocate(T,C,l,L);return e&&f?k.set(e):l||k.fill(0,0,4),this._release(e),k}release(e){this._release(e)}_allocate(e,n,i,o){let u=Math.max(Math.ceil(n*this.opts.overAlloc),1);u>o&&(u=o);const f=this._pool,l=e.BYTES_PER_ELEMENT*u,b=f.findIndex(T=>T.byteLength>=l);if(b>=0){const T=new e(f.splice(b,1)[0],0,u);return i&&T.fill(0),T}return new e(u)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:i}=e,{byteLength:o}=i,u=n.findIndex(f=>f.byteLength>=o);u<0?n.push(i):(u>0||n.length<this.opts.poolSize)&&n.splice(u,0,i),n.length>this.opts.poolSize&&n.shift()}}const sd=new M4;function Th(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function k4(t,e){const n=t%e;return n<0?e+n:n}function L4(t){return[t[12],t[13],t[14]]}function R4(t){return{left:vc(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:vc(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:vc(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:vc(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:vc(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:vc(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const vw=new fo;function vc(t,e,n,i){vw.set(t,e,n);const o=vw.len();return{distance:i/o,normal:new fo(-t/o,-e/o,-n/o)}}function D4(t){return t-Math.fround(t)}let _h;function L_(t,e){const{size:n=1,startIndex:i=0}=e,o=e.endIndex!==void 0?e.endIndex:t.length,u=(o-i)/n;_h=sd.allocate(_h,u,{type:Float32Array,size:n*2});let f=i,l=0;for(;f<o;){for(let b=0;b<n;b++){const T=t[f++];_h[l+b]=T,_h[l+b+n]=D4(T)}l+=n*2}return _h.subarray(0,u*n*2)}const z4=Math.PI/180,O4=Th(),xw=[0,0,0],F4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function B4({width:t,height:e,orthographic:n,fovyRadians:i,focalDistance:o,padding:u,near:f,far:l}){const b=t/e,T=n?new ws().orthographic({fovy:i,aspect:b,focalDistance:o,near:f,far:l}):new ws().perspective({fovy:i,aspect:b,near:f,far:l});if(u){const{left:C=0,right:L=0,top:k=0,bottom:X=0}=u,te=Ni((C+t-L)/2,0,t)-t/2,ie=Ni((k+e-X)/2,0,e)-e/2;T[8]-=te*2/t,T[9]+=ie*2/e}return T}class Nl{constructor(e={}){U(this,"id",void 0),U(this,"x",void 0),U(this,"y",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"padding",void 0),U(this,"isGeospatial",void 0),U(this,"zoom",void 0),U(this,"focalDistance",void 0),U(this,"position",void 0),U(this,"modelMatrix",void 0),U(this,"distanceScales",void 0),U(this,"scale",void 0),U(this,"center",void 0),U(this,"cameraPosition",void 0),U(this,"projectionMatrix",void 0),U(this,"viewMatrix",void 0),U(this,"viewMatrixUncentered",void 0),U(this,"viewMatrixInverse",void 0),U(this,"viewProjectionMatrix",void 0),U(this,"pixelProjectionMatrix",void 0),U(this,"pixelUnprojectionMatrix",void 0),U(this,"resolution",void 0),U(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||F4,this.focalDistance=e.focalDistance||1,this.position=e.position||xw,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?co.WEB_MERCATOR:co.WEB_MERCATOR_AUTO_OFFSET:co.IDENTITY}equals(e){return e instanceof Nl?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&tu(e.projectionMatrix,this.projectionMatrix)&&tu(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const i=this.projectPosition(e),o=ES(i,this.pixelProjectionMatrix),[u,f]=o,l=n?f:this.height-f;return e.length===2?[u,l]:[u,l,o[2]]}unproject(e,{topLeft:n=!0,targetZ:i}={}){const[o,u,f]=e,l=n?u:this.height-u,b=i&&i*this.distanceScales.unitsPerMeter[2],T=Im([o,l,f],this.pixelUnprojectionMatrix,b),[C,L,k]=this.unprojectPosition(T);return Number.isFinite(f)?[C,L,k]:Number.isFinite(i)?[C,L,i]:[C,L]}projectPosition(e){const[n,i]=this.projectFlat(e),o=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,i,o]}unprojectPosition(e){const[n,i]=this.unprojectFlat(e),o=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,i,o]}projectFlat(e){if(this.isGeospatial){const n=Qp(e);return n[1]=Ni(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?iu(e):e}getBounds(e={}){const n={targetZ:e.z||0},i=this.unproject([0,0],n),o=this.unproject([this.width,0],n),u=this.unproject([0,this.height],n),f=this.unproject([this.width,this.height],n);return[Math.min(i[0],o[0],u[0],f[0]),Math.min(i[1],o[1],u[1],f[1]),Math.max(i[0],o[0],u[0],f[0]),Math.max(i[1],o[1],u[1],f[1])]}getDistanceScales(e){return e?Ky({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:i=1,height:o=1}){return e<this.x+this.width&&this.x<e+i&&n<this.y+this.height&&this.y<n+o}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,R4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=YO({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Ky({latitude:i,longitude:n}));const o=Math.pow(2,this.zoom);this.scale=o;const{position:u,modelMatrix:f}=e;let l=xw;if(u&&(l=f?new ws(f).transformAsVector(u,[]):u),this.isGeospatial){const b=this.projectPosition([n,i,0]);this.center=new fo(l).scale(this.distanceScales.unitsPerMeter).add(b)}else this.center=this.projectPosition(l)}_initMatrices(e){const{viewMatrix:n=O4,projectionMatrix:i=null,orthographic:o=!1,fovyRadians:u,fovy:f=75,near:l=.1,far:b=1e3,padding:T=null,focalDistance:C=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new ws().multiplyRight(n).translate(new fo(this.center).negate()),this.projectionMatrix=i||B4({width:this.width,height:this.height,orthographic:o,fovyRadians:u||f*z4,focalDistance:C,padding:T,near:l,far:b});const L=Th();Il(L,L,this.projectionMatrix),Il(L,L,this.viewMatrix),this.viewProjectionMatrix=L,this.viewMatrixInverse=$y([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=L4(this.viewMatrixInverse);const k=Th(),X=Th();pv(k,k,[this.width/2,-this.height/2,1]),Kp(k,k,[1,-1,0]),Il(X,k,this.viewProjectionMatrix),this.pixelProjectionMatrix=X,this.pixelUnprojectionMatrix=$y(Th(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||pn.warn("Pixel project matrix not invertible")()}}U(Nl,"displayName","Viewport");const N4=512,U4=4003e4,V4=Math.PI/180;function bw(t){const e=Math.cos(t*V4);return N4/U4/e}class Na extends Nl{constructor(e={}){const{latitude:n=0,longitude:i=0,zoom:o=0,pitch:u=0,bearing:f=0,nearZMultiplier:l=.1,farZMultiplier:b=1.01,orthographic:T=!1,projectionMatrix:C,repeat:L=!1,worldOffset:k=0,legacyMeterSizes:X=!1}=e;let{width:te,height:ie,altitude:ye=1.5}=e;const J=Math.pow(2,o);te=te||1,ie=ie||1;let W,Q=null;C?(ye=C[5]/2,W=em(ye)):(e.fovy?(W=e.fovy,ye=wS(W)):W=em(ye),Q=JO({width:te,height:ie,pitch:u,fovy:W,nearZMultiplier:l,farZMultiplier:b}));let _e=KO({height:ie,pitch:u,bearing:f,scale:J,altitude:ye});k&&(_e=new ws().translate([512*k,0,0]).multiplyLeft(_e)),super({...e,width:te,height:ie,viewMatrix:_e,longitude:i,latitude:n,zoom:o,...Q,fovy:W,focalDistance:ye}),U(this,"longitude",void 0),U(this,"latitude",void 0),U(this,"pitch",void 0),U(this,"bearing",void 0),U(this,"altitude",void 0),U(this,"fovy",void 0),U(this,"orthographic",void 0),U(this,"_subViewports",void 0),U(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=i,this.zoom=o,this.pitch=u,this.bearing=f,this.altitude=ye,this.fovy=W,this.orthographic=T,this._subViewports=L?[]:null,this._pseudoMeters=X,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let o=n;o<=i;o++){const u=o?new Na({...this,worldOffset:o}):this;this._subViewports.push(u)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,i]=this.projectFlat(e),o=(e[2]||0)*bw(e[1]);return[n,i,o]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,i]=this.unprojectFlat(e),o=(e[2]||0)/bw(i);return[n,i,o]}addMetersToLngLat(e,n){return bS(e,n)}panByPosition(e,n){const i=Im(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=Yp([],o,lS([],i)),f=Yp([],this.center,u),[l,b]=this.unprojectFlat(f);return{longitude:l,latitude:b}}getBounds(e={}){const n=e4(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:i,height:o}=this,{longitude:u,latitude:f,zoom:l}=TS({width:i,height:o,bounds:e,...n});return new Na({width:i,height:o,longitude:u,latitude:f,zoom:l})}}U(Na,"displayName","WebMercatorViewport");function R_(t,e,n=!1){const i=e.projectPosition(t);if(n&&e instanceof Na){const[o,u,f=0]=t,l=e.getDistanceScales([o,u]);i[2]=f*l.unitsPerMeter[2]}return i}function j4(t){const{viewport:e,modelMatrix:n,coordinateOrigin:i}=t;let{coordinateSystem:o,fromCoordinateSystem:u,fromCoordinateOrigin:f}=t;return o===fn.DEFAULT&&(o=e.isGeospatial?fn.LNGLAT:fn.CARTESIAN),u===void 0&&(u=o),f===void 0&&(f=i),{viewport:e,coordinateSystem:o,coordinateOrigin:i,modelMatrix:n,fromCoordinateSystem:u,fromCoordinateOrigin:f}}function IS(t,{viewport:e,modelMatrix:n,coordinateSystem:i,coordinateOrigin:o,offsetMode:u}){let[f,l,b=0]=t;switch(n&&([f,l,b]=yd([],[f,l,b,1],n)),i){case fn.LNGLAT:return R_([f,l,b],e,u);case fn.LNGLAT_OFFSETS:return R_([f+o[0],l+o[1],b+(o[2]||0)],e,u);case fn.METER_OFFSETS:return R_(bS(o,[f,l,b]),e,u);case fn.CARTESIAN:default:return e.isGeospatial?[f+o[0],l+o[1],b+o[2]]:e.projectPosition([f,l,b])}}function G4(t,e){const{viewport:n,coordinateSystem:i,coordinateOrigin:o,modelMatrix:u,fromCoordinateSystem:f,fromCoordinateOrigin:l}=j4(e),{geospatialOrigin:b,shaderCoordinateOrigin:T,offsetMode:C}=vS(n,i,o),L=IS(t,{viewport:n,modelMatrix:u,coordinateSystem:f,coordinateOrigin:l,offsetMode:C});if(C){const k=n.projectPosition(b||T);Cz(L,L,k)}return L}const bc={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},tm=Symbol.for("component"),Gc=Symbol.for("asyncPropDefaults"),Dl=Symbol.for("asyncPropOriginal"),Aa=Symbol.for("asyncPropResolved");function PS(t,e=()=>!0){return Array.isArray(t)?CS(t,e,[]):e(t)?[t]:[]}function CS(t,e,n){let i=-1;for(;++i<t.length;){const o=t[i];Array.isArray(o)?CS(o,e,n):e(o)&&n.push(o)}return n}function H4({target:t,source:e,start:n=0,count:i=1}){const o=e.length,u=i*o;let f=0;for(let l=n;f<o;f++)t[l++]=e[f];for(;f<u;)f<u-f?(t.copyWithin(n+f,n,n+f),f*=2):(t.copyWithin(n+f,n,n+u-f),f=u);return t}class $4{constructor(e,n,i){U(this,"id",void 0),U(this,"context",void 0),U(this,"isLoaded",void 0),U(this,"persistent",void 0),U(this,"_loadCount",0),U(this,"_subscribers",new Set),U(this,"_data",void 0),U(this,"_loader",void 0),U(this,"_error",void 0),U(this,"_content",void 0),this.id=e,this.context=i,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const i=++this._loadCount;let o=e;typeof e=="string"&&(o=Wp(e)),o instanceof Promise?(this.isLoaded=!1,this._loader=o.then(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=u)}).catch(u=>{this._loadCount===i&&(this.isLoaded=!0,this._error=u||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const u of this._subscribers)u.onChange(this.getData())}}class W4{constructor({gl:e,protocol:n}){U(this,"protocol",void 0),U(this,"_context",void 0),U(this,"_resources",void 0),U(this,"_consumers",void 0),U(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:i=!1,persistent:o=!0}){let u=this._resources[e];u?u.setData(n,i):(u=new $4(e,n,this._context),this._resources[e]=u),u.persistent=o}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const i in n){const o=n[i],u=this._resources[o.resourceId];u&&u.unsubscribe(o)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:i,requestId:o="default"}){const{_resources:u,protocol:f}=this;e.startsWith(f)&&(e=e.replace(f,""),u[e]||this.add({resourceId:e,data:null,persistent:!1}));const l=u[e];if(this._track(i,o,l,n),l)return l.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,i,o){const u=this._consumers,f=u[e]=u[e]||{},l=f[n]||{},b=l.resourceId&&this._resources[l.resourceId];b&&(b.unsubscribe(l),this.prune()),i&&(f[n]=l,l.onChange=o,l.resourceId=i.id,i.subscribe(l))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const q4="layerManager.setLayers",X4="layerManager.activateViewport";class Z4{constructor(e,{deck:n,stats:i,viewport:o,timeline:u}={}){U(this,"layers",void 0),U(this,"context",void 0),U(this,"resourceManager",void 0),U(this,"_lastRenderedLayers",[]),U(this,"_needsRedraw",!1),U(this,"_needsUpdate",!1),U(this,"_nextLayers",null),U(this,"_debug",!1),U(this,"activateViewport",f=>{pr(X4,this,f),f&&(this.context.viewport=f)}),this.layers=[],this.resourceManager=new W4({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&m4(e),stats:i||new tv({id:"deck.gl"}),viewport:o||new Nl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new mS,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const o=i.getNeedsRedraw(e);n=n||o}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(i=>n.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){pr(q4,this,n,e),this._lastRenderedLayers=e;const i=PS(e,Boolean);for(const o of i)o.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,i){i.raiseError(n,"".concat(e," of ").concat(i))}_updateLayers(e,n){const i={};for(const f of e)i[f.id]?pn.warn("Multiple old layers with same id ".concat(f.id))():i[f.id]=f;const o=[];this._updateSublayersRecursively(n,i,o),this._finalizeOldLayers(i);let u=!1;for(const f of o)if(f.hasUniformTransition()){u="Uniform transition in ".concat(f);break}this._needsUpdate=u,this.layers=o}_updateSublayersRecursively(e,n,i){for(const o of e){o.context=this.context;const u=n[o.id];u===null&&pn.warn("Multiple new layers with same id ".concat(o.id))(),n[o.id]=null;let f=null;try{this._debug&&u!==o&&o.validateProps(),u?(this._transferLayerState(u,o),this._updateLayer(o)):this._initializeLayer(o),i.push(o),f=o.isComposite?o.getSubLayers():null}catch(l){this._handleError("matching",l,o)}f&&this._updateSublayersRecursively(f,n,i)}}_finalizeOldLayers(e){for(const n in e){const i=e[n];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=bc.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=bc.MATCHED,n!==e&&(e.lifecycle=bc.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=bc.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=bc.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function hu(t,e){if(t===e)return!0;if(!t||!e)return!1;for(const n in t){const i=t[n],o=e[n];if(!(i===o||Array.isArray(i)&&Array.isArray(o)&&hu(i,o)))return!1}return!0}class Y4{constructor(e){U(this,"width",void 0),U(this,"height",void 0),U(this,"views",void 0),U(this,"viewState",void 0),U(this,"controllers",void 0),U(this,"timeline",void 0),U(this,"_viewports",void 0),U(this,"_viewportMap",void 0),U(this,"_isUpdating",void 0),U(this,"_needsRedraw",void 0),U(this,"_needsUpdate",void 0),U(this,"_eventManager",void 0),U(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,i=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,n){const i=this.getViewports(),o={x:e[0],y:e[1]};for(let u=i.length-1;u>=0;--u){const f=i[u];if(f.containsPixel(o)){const l=e.slice();return l[0]-=f.x,l[1]-=f.y,f.unproject(l,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=PS(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!hu(e,this.viewState)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):pn.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const i=n.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:u=>{var f;return(f=this.getView(e.id))===null||f===void 0?void 0:f.makeViewport({viewState:u,width:this.width,height:this.height})}})}_updateController(e,n,i,o){const u=e.controller;if(u){const f={...n,...u,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return o||(o=this._createController(e,f)),o&&o.setProps(f),o}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let o=e.length;o--;){const u=e[o],f=this.getViewState(u),l=u.makeViewport({viewState:f,width:this.width,height:this.height});let b=n[u.id];const T=Boolean(u.controller);T&&!b&&(i=!0),(i||!T)&&b&&(b.finalize(),b=null),this.controllers[u.id]=this._updateController(u,f,l,b),this._viewports.unshift(l)}for(const o in n){const u=n[o];u&&!this.controllers[o]&&u.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((i,o)=>!e[o].equals(n[o]))}}const K4=/([0-9]+\.?[0-9]*)(%|px)/;function ga(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=K4.exec(t);if(e&&e.length>=3){const n=e[2]==="%",i=parseFloat(e[1]);return{position:n?i/100:i,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function _a(t,e){return t.relative?Math.round(t.position*e):t.position}function Bi(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class zl{constructor(e){U(this,"id",void 0),U(this,"viewportInstance",void 0),U(this,"_x",void 0),U(this,"_y",void 0),U(this,"_width",void 0),U(this,"_height",void 0),U(this,"_padding",void 0),U(this,"props",void 0);const{id:n,x:i=0,y:o=0,width:u="100%",height:f="100%",padding:l=null,viewportInstance:b}=e||{};Bi(!b||b instanceof Nl),this.viewportInstance=b,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ga(i),this._y=ga(o),this._width=ga(u),this._height=ga(f),this._padding=l&&{left:ga(l.left||0),right:ga(l.right||0),top:ga(l.top||0),bottom:ga(l.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&hu(this.props,e.props)}makeViewport({width:e,height:n,viewState:i}){if(this.viewportInstance)return this.viewportInstance;i=this.filterViewState(i);const o=this.getDimensions({width:e,height:n});return new this.ViewportType({...i,...this.props,...o})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const i in this.props.viewState)i!=="id"&&(n[i]=this.props.viewState[i]);return n}return e}getDimensions({width:e,height:n}){const i={x:_a(this._x,e),y:_a(this._y,n),width:_a(this._width,e),height:_a(this._height,n)};return this._padding&&(i.padding={left:_a(this._padding.left,e),top:_a(this._padding.top,n),right:_a(this._padding.right,e),bottom:_a(this._padding.bottom,n)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class bd{constructor(e){U(this,"_inProgress",void 0),U(this,"_handle",void 0),U(this,"_timeline",void 0),U(this,"time",void 0),U(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,i;this.cancel(),this.settings=e,this._inProgress=!0,(n=(i=this.settings).onStart)===null||n===void 0||n.call(i,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:o}=this;this._handle=i.addChannel({delay:i.getTime(),duration:o.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const ww=()=>{},Jy={BREAK:1,SNAP_TO_END:2,IGNORE:3},J4=t=>t,Q4=Jy.BREAK;class eF{constructor(e){U(this,"getControllerState",void 0),U(this,"props",void 0),U(this,"propsInTransition",void 0),U(this,"transition",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"_onTransitionUpdate",n=>{const{time:i,settings:{interpolator:o,startProps:u,endProps:f,duration:l,easing:b}}=n,T=b(i/l),C=o.interpolateProps(u,f,T);this.propsInTransition=this.getControllerState({...this.props,...C}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new bd(e.timeline),this.onViewStateChange=e.onViewStateChange||ww,this.onStateChange=e.onStateChange||ww}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let o=i;if(this.transition.inProgress){const{interruption:u,endProps:f}=this.transition.settings;o={...i,...u===Jy.SNAP_TO_END?f:this.propsInTransition||i}}this._triggerTransition(o,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:i}=e;return(n>0||n==="auto")&&Boolean(i)}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Jy.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const i=this.getControllerState(e),o=this.getControllerState(n).shortestPathFrom(i),u=n.transitionInterpolator,f=u.getDuration?u.getDuration(e,n):n.transitionDuration;if(f===0)return;const l=u.initializeProps(e,o);this.propsInTransition={};const b={duration:f,easing:n.transitionEasing||J4,interpolator:u,interruption:n.transitionInterruption||Q4,startProps:l.start,endProps:l.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(b),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class tF{constructor(e){U(this,"_propsToCompare",void 0),U(this,"_propsToExtract",void 0),U(this,"_requiredProps",void 0);const{compare:n,extract:i,required:o}=e;this._propsToCompare=n,this._propsToExtract=i||n,this._requiredProps=o}arePropsEqual(e,n){for(const i of this._propsToCompare)if(!(i in e)||!(i in n)||!tu(e[i],n[i]))return!1;return!0}initializeProps(e,n){const i={},o={};for(const u of this._propsToExtract)(u in e||u in n)&&(i[u]=e[u],o[u]=n[u]);return this._checkRequiredProps(i),this._checkRequiredProps(o),{start:i,end:o}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){!this._requiredProps||this._requiredProps.forEach(n=>{const i=e[n];Bi(Number.isFinite(i)||Array.isArray(i),"".concat(n," is required for transition"))})}}const nF=["longitude","latitude","zoom","bearing","pitch"],iF=["longitude","latitude","zoom"];class yv extends tF{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:nF,required:iF},super(i.transitionProps),U(this,"opts",void 0),this.opts=i}initializeProps(e,n){const i=super.initializeProps(e,n),{makeViewport:o,around:u}=this.opts;if(o&&u){const f=o(e),l=o(n),b=f.unproject(u);i.start.around=u,Object.assign(i.end,{around:l.project(b),aroundPosition:b,width:n.width,height:n.height})}return i}interpolateProps(e,n,i){const o={};for(const u of this._propsToExtract)o[u]=Zp(e[u]||0,n[u]||0,i);if(n.aroundPosition&&this.opts.makeViewport){const u=this.opts.makeViewport({...n,...o});Object.assign(o,u.panByPosition(n.aroundPosition,Zp(e.around,n.around,i)))}return o}}const ya={transitionDuration:0},rF=300,Jf=t=>1-(1-t)*(1-t),xc={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},gl={};class MS{constructor(e){U(this,"props",void 0),U(this,"state",{}),U(this,"transitionManager",void 0),U(this,"eventManager",void 0),U(this,"onViewStateChange",void 0),U(this,"onStateChange",void 0),U(this,"makeViewport",void 0),U(this,"_controllerState",void 0),U(this,"_events",{}),U(this,"_interactionState",{isDragging:!1}),U(this,"_customEvents",[]),U(this,"_eventStartBlocked",null),U(this,"_panMove",!1),U(this,"invertPan",!1),U(this,"dragMode","rotate"),U(this,"inertia",0),U(this,"scrollZoom",!0),U(this,"dragPan",!0),U(this,"dragRotate",!0),U(this,"doubleClickZoom",!0),U(this,"touchZoom",!0),U(this,"touchRotate",!1),U(this,"keyboard",!0),this.transitionManager=new eF({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:i}=this.props,{offsetCenter:o}=e;return[o.x-n,o.y-i]}isPointInBounds(e,n){const{width:i,height:o}=this.props;if(n&&n.handled)return!1;const u=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=o;return u&&n&&n.stopPropagation(),u}isFunctionKeyPressed(e){const{srcEvent:n}=e;return Boolean(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?rF:0;const{scrollZoom:i=!0,dragPan:o=!0,dragRotate:u=!0,doubleClickZoom:f=!0,touchZoom:l=!0,touchRotate:b=!1,keyboard:T=!0}=e,C=Boolean(this.onViewStateChange);this.toggleEvents(xc.WHEEL,C&&i),this.toggleEvents(xc.PAN,C&&(o||u)),this.toggleEvents(xc.PINCH,C&&(l||b)),this.toggleEvents(xc.TRIPLE_PAN,C&&b),this.toggleEvents(xc.DOUBLE_TAP,C&&f),this.toggleEvents(xc.KEYBOARD,C&&T),this.scrollZoom=i,this.dragPan=o,this.dragRotate=u,this.doubleClickZoom=f,this.touchZoom=l,this.touchRotate=b,this.keyboard=T}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(i=>{this._events[i]!==n&&(this._events[i]=n,n?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,n=null,i={}){const o={...e.getViewportProps(),...n},u=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),u){const f=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:o,interactionState:this._interactionState,oldViewState:f})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const o=this.controllerState[i?"panStart":"rotateStart"]({pos:n});return this._panMove=i,this.updateViewport(o,ya,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),i=this.controllerState.pan({pos:n});return this.updateViewport(i,ya,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.pan({pos:o}).panEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Jf},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ya,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const i=this.getCenter(e),o=[i[0]+e.velocityX*n/2,i[1]+e.velocityY*n/2],u=this.controllerState.rotate({pos:o}).rotateEnd();this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Jf},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;e.srcEvent.preventDefault();const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const{speed:i=.01,smooth:o=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:u}=e;let f=2/(1+Math.exp(-Math.abs(u*i)));u<0&&f!==0&&(f=1/f);const l=this.controllerState.zoom({pos:n,scale:f});return this.updateViewport(l,{...this._getTransitionProps({around:n}),transitionDuration:o?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.rotateStart({pos:n});return this.updateViewport(i,ya,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const i=this.controllerState.rotate({pos:n});return this.updateViewport(i,ya,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const i=this.getCenter(e),o=[i[0],i[1]+=e.velocityY*n/2],u=this.controllerState.rotate({pos:o});this.updateViewport(u,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Jf},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return gl._startPinchRotation=e.rotation,gl._lastPinchEvent=e,this.updateViewport(i,ya,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:i}=e,o=this.getCenter(e);n=n.zoom({pos:o,scale:i})}if(this.touchRotate){const{rotation:i}=e;n=n.rotate({deltaAngleX:gl._startPinchRotation-i})}return this.updateViewport(n,ya,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),gl._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:i}=gl;if(this.touchZoom&&n&&i&&e.scale!==i.scale){const o=this.getCenter(e);let u=this.controllerState.rotateEnd();const f=Math.log2(e.scale),l=(f-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),b=Math.pow(2,f+l*n/2);u=u.zoom({pos:o,scale:b}).zoomEnd(),this.updateViewport(u,{...this._getTransitionProps({around:o}),transitionDuration:n,transitionEasing:Jf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const o=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(o,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return gl._startPinchRotation=null,gl._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const i=this.isFunctionKeyPressed(e),o=this.controllerState.zoom({pos:n,scale:i?.5:2});return this.updateViewport(o,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:o,rotateSpeedX:u,rotateSpeedY:f}=this.keyboard===!0?{}:this.keyboard,{controllerState:l}=this;let b;const T={};switch(e.srcEvent.code){case"Minus":b=n?l.zoomOut(i).zoomOut(i):l.zoomOut(i),T.isZooming=!0;break;case"Equal":b=n?l.zoomIn(i).zoomIn(i):l.zoomIn(i),T.isZooming=!0;break;case"ArrowLeft":n?(b=l.rotateLeft(u),T.isRotating=!0):(b=l.moveLeft(o),T.isPanning=!0);break;case"ArrowRight":n?(b=l.rotateRight(u),T.isRotating=!0):(b=l.moveRight(o),T.isPanning=!0);break;case"ArrowUp":n?(b=l.rotateUp(f),T.isRotating=!0):(b=l.moveUp(o),T.isPanning=!0);break;case"ArrowDown":n?(b=l.rotateDown(f),T.isRotating=!0):(b=l.moveDown(o),T.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),T),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?ya:e?{...n,transitionInterpolator:new yv({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class kS{constructor(e,n){U(this,"_viewportProps",void 0),U(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Ew=5,sF=1.2;class oF extends kS{constructor(e){const{width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l=0,pitch:b=0,altitude:T=1.5,position:C=[0,0,0],maxZoom:L=20,minZoom:k=0,maxPitch:X=60,minPitch:te=0,startPanLngLat:ie,startZoomLngLat:ye,startRotatePos:J,startBearing:W,startPitch:Q,startZoom:_e,normalize:we=!0}=e;Bi(Number.isFinite(u)),Bi(Number.isFinite(o)),Bi(Number.isFinite(f)),super({width:n,height:i,latitude:o,longitude:u,zoom:f,bearing:l,pitch:b,altitude:T,maxZoom:L,minZoom:k,maxPitch:X,minPitch:te,normalize:we,position:C},{startPanLngLat:ie,startZoomLngLat:ye,startRotatePos:J,startBearing:W,startPitch:Q,startZoom:_e}),U(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const i=this.getState().startPanLngLat||this._unproject(n);if(!i)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:o,startBearing:u,startPitch:f}=this.getState();if(!o||u===void 0||f===void 0)return this;let l;return e?l=this._getNewRotation(e,o,f,u):l={bearing:u+n,pitch:f+i},this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:o,startZoomLngLat:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(n)||this._unproject(e)),!u)return this;const{maxZoom:f,minZoom:l}=this.getViewportProps();let b=o+Math.log2(i);b=Ni(b,l,f);const T=this.makeViewport({...this.getViewportProps(),zoom:b});return this._getUpdatedState({zoom:b,...T.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{bearing:o,longitude:u}=i;return Math.abs(o-n.bearing)>180&&(i.bearing=o<0?o+360:o-360),Math.abs(u-n.longitude)>180&&(i.longitude=u<0?u+360:u-360),i}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:o}=e;e.zoom=Ni(o,i,n);const{maxPitch:u,minPitch:f,pitch:l}=e;e.pitch=Ni(l,f,u);const{normalize:b=!0}=e;return b&&Object.assign(e,t4(e)),e}_zoomFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.zoom({pos:[n/2,i/2],scale:e})}_panFromCenter(e){const{width:n,height:i}=this.getViewportProps();return this.pan({startPos:[n/2,i/2],pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,i,o){const u=e[0]-n[0],f=e[1]-n[1],l=e[1],b=n[1],{width:T,height:C}=this.getViewportProps(),L=u/T;let k=0;f>0?Math.abs(C-b)>Ew&&(k=f/(b-C)*sF):f<0&&b>Ew&&(k=1-l/b),k=Ni(k,-1,1);const{minPitch:X,maxPitch:te}=this.getViewportProps(),ie=o+180*L;let ye=i;return k>0?ye=i+k*(te-i):k<0&&(ye=i-k*(X-i)),{pitch:ye,bearing:ie}}}class aF extends MS{constructor(...e){super(...e),U(this,"ControllerState",oF),U(this,"transition",{transitionDuration:300,transitionInterpolator:new yv({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),U(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class LS extends zl{get ViewportType(){return Na}get ControllerType(){return aF}}U(LS,"displayName","MapView");class lF extends Pm{constructor(e,n){super(e,n),U(this,"maskMap",void 0),U(this,"fbo",void 0);const{mapSize:i=2048}=n;this.maskMap=new _r(e,{width:i,height:i,parameters:{[10241]:9729,[10240]:9729,[10242]:33071,[10243]:33071}}),this.fbo=new hi(e,{id:"maskmap",width:i,height:i,attachments:{[36064]:this.maskMap}})}render(e){const n=this.gl,i=[!1,!1,!1,!1];return i[e.channel]=!0,vs(n,{clearColor:[255,255,255,255],blend:!0,blendFunc:[0,1],blendEquation:32778,colorMask:i,depthTest:!1},()=>super.render({...e,target:this.fbo,pass:"mask"}))}shouldDrawLayer(e){return e.props.operation===xd.MASK}delete(){this.fbo.delete(),this.maskMap.delete()}}const cF=new ws().lookAt({eye:[0,0,1]});function uF({width:t,height:e,near:n,far:i,padding:o}){let u=-t/2,f=t/2,l=-e/2,b=e/2;if(o){const{left:T=0,right:C=0,top:L=0,bottom:k=0}=o,X=Ni((T+t-C)/2,0,t)-t/2,te=Ni((L+e-k)/2,0,e)-e/2;u-=X,f-=X,l+=te,b+=te}return new ws().ortho({left:u,right:f,bottom:l,top:b,near:n,far:i})}class hF extends Nl{constructor(e){const{width:n,height:i,near:o=.1,far:u=1e3,zoom:f=0,target:l=[0,0,0],padding:b=null,flipY:T=!0}=e,C=Array.isArray(f)?f[0]:f,L=Array.isArray(f)?f[1]:f,k=Math.min(C,L),X=Math.pow(2,k);let te;if(C!==L){const ie=Math.pow(2,C),ye=Math.pow(2,L);te={unitsPerMeter:[ie/X,ye/X,1],metersPerUnit:[X/ie,X/ye,1]}}super({...e,longitude:void 0,position:l,viewMatrix:cF.clone().scale([X,X*(T?-1:1),X]),projectionMatrix:uF({width:n||1,height:i||1,padding:b,near:o,far:u}),zoom:k,distanceScales:te})}projectFlat([e,n]){const{unitsPerMeter:i}=this.distanceScales;return[e*i[0],n*i[1]]}unprojectFlat([e,n]){const{metersPerUnit:i}=this.distanceScales;return[e*i[0],n*i[1]]}panByPosition(e,n){const i=Im(n,this.pixelUnprojectionMatrix),o=this.projectFlat(e),u=Yp([],o,lS([],i)),f=Yp([],this.center,u);return{target:this.unprojectFlat(f)}}}class dF extends kS{constructor(e){const{width:n,height:i,rotationX:o=0,rotationOrbit:u=0,target:f=[0,0,0],zoom:l=0,minRotationX:b=-90,maxRotationX:T=90,minZoom:C=-1/0,maxZoom:L=1/0,startPanPosition:k,startRotatePos:X,startRotationX:te,startRotationOrbit:ie,startZoomPosition:ye,startZoom:J}=e;super({width:n,height:i,rotationX:o,rotationOrbit:u,target:f,zoom:l,minRotationX:b,maxRotationX:T,minZoom:C,maxZoom:L},{startPanPosition:k,startRotatePos:X,startRotationX:te,startRotationOrbit:ie,startZoomPosition:ye,startZoom:J}),U(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanPosition:this._unproject(e)})}pan({pos:e,startPosition:n}){const i=this.getState().startPanPosition||n;if(!i)return this;const u=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(u)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:i=0}){const{startRotatePos:o,startRotationX:u,startRotationOrbit:f}=this.getState(),{width:l,height:b}=this.getViewportProps();if(!o||u===void 0||f===void 0)return this;let T;if(e){let C=(e[0]-o[0])/l;const L=(e[1]-o[1])/b;(u<-90||u>90)&&(C*=-1),T={rotationX:u+L*180,rotationOrbit:f+C*180}}else T={rotationX:u+i,rotationOrbit:f+n};return this._getUpdatedState(T)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(e){const n=e.getViewportProps(),i={...this.getViewportProps()},{rotationOrbit:o}=i;return Math.abs(o-n.rotationOrbit)>180&&(i.rotationOrbit=o<0?o+360:o-360),i}zoomStart({pos:e}){return this._getUpdatedState({startZoomPosition:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:i}){let{startZoom:o,startZoomPosition:u}=this.getState();if(u||(o=this.getViewportProps().zoom,u=this._unproject(n)||this._unproject(e)),!u)return this;const f=this._calculateNewZoom({scale:i,startZoom:o}),l=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...l.panByPosition(u,e)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:e})})}zoomOut(e=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/e})})}moveLeft(e=50){return this._panFromCenter([-e,0])}moveRight(e=50){return this._panFromCenter([e,0])}moveUp(e=50){return this._panFromCenter([0,-e])}moveDown(e=50){return this._panFromCenter([0,e])}rotateLeft(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-e})}rotateRight(e=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+e})}rotateUp(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-e})}rotateDown(e=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);const u=n+Math.log2(e);return Ni(u,o,i)}_panFromCenter(e){const{width:n,height:i,target:o}=this.getViewportProps();return this.pan({startPosition:o,pos:[n/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}applyConstraints(e){const{maxZoom:n,minZoom:i,zoom:o,maxRotationX:u,minRotationX:f,rotationOrbit:l}=e;return e.zoom=Array.isArray(o)?[Ni(o[0],i,n),Ni(o[1],i,n)]:Ni(o,i,n),e.rotationX=Ni(e.rotationX,f,u),(l<-180||l>180)&&(e.rotationOrbit=k4(l+180,360)-180),e}}class fF extends dF{constructor(e){super(e),U(this,"zoomAxis",void 0),this.zoomAxis=e.zoomAxis||"all"}_calculateNewZoom({scale:e,startZoom:n}){const{maxZoom:i,minZoom:o}=this.getViewportProps();n===void 0&&(n=this.getViewportProps().zoom);let u=Math.log2(e);if(Array.isArray(n)){let[f,l]=n;switch(this.zoomAxis){case"X":f=Ni(f+u,o,i);break;case"Y":l=Ni(l+u,o,i);break;default:let b=Math.min(f+u,l+u);b<o&&(u+=o-b),b=Math.max(f+u,l+u),b>i&&(u+=i-b),f+=u,l+=u}return[f,l]}return Ni(n+u,o,i)}}class pF extends MS{constructor(...e){super(...e),U(this,"ControllerState",fF),U(this,"transition",{transitionDuration:300,transitionInterpolator:new yv(["target","zoom"])}),U(this,"dragMode","pan")}_onPanRotate(){return!1}}class RS extends zl{get ViewportType(){return hF}get ControllerType(){return pF}}U(RS,"displayName","OrthographicView");function mF({layers:t,viewport:e}){let n=null;for(const u of t){const f=u.getBounds();f&&(n?(n[0]=Math.min(n[0],f[0][0]),n[1]=Math.min(n[1],f[0][1]),n[2]=Math.max(n[2],f[1][0]),n[3]=Math.max(n[3],f[1][1])):n=[f[0][0],f[0][1],f[1][0],f[1][1]])}const i=e.getBounds();if(!n)return i;const o=_F(i);return n[2]-n[0]<o[2]-o[0]||n[3]-n[1]<o[3]-o[1]||(n[0]=Math.max(n[0],o[0]),n[1]=Math.max(n[1],o[1]),n[2]=Math.min(n[2],o[2]),n[3]=Math.min(n[3],o[3])),n}function gF({bounds:t,viewport:e,width:n,height:i}){if(t[2]<=t[0]||t[3]<=t[1])return null;const o=1;if(n-=o*2,i-=o*2,e instanceof Na){const{longitude:l,latitude:b,zoom:T}=TS({width:n,height:i,bounds:[[t[0],t[1]],[t[2],t[3]]],maxZoom:20});return new Na({longitude:l,latitude:b,zoom:T,x:o,y:o,width:n,height:i})}const u=[(t[0]+t[2])/2,(t[1]+t[3])/2,0],f=Math.min(20,n/(t[2]-t[0]),i/(t[3]-t[1]));return new RS({x:o,y:o}).makeViewport({width:n,height:i,viewState:{target:u,zoom:Math.log2(f)}})}function _F(t){const e={x:t[2]-t[0],y:t[3]-t[1]},n={x:t[0]+.5*e.x,y:t[1]+.5*e.y};return[n.x-e.x,n.y-e.y,n.x+e.x,n.y+e.y]}class yF{constructor(){U(this,"id","mask-effect"),U(this,"props",null),U(this,"useInPicking",!0),U(this,"dummyMaskMap",void 0),U(this,"channels",[]),U(this,"masks",null),U(this,"maskPass",void 0),U(this,"maskMap",void 0),U(this,"lastViewport",void 0)}preRender(e,{layers:n,layerFilter:i,viewports:o,onViewportActive:u,views:f}){this.dummyMaskMap||(this.dummyMaskMap=new _r(e,{width:1,height:1}));const l=n.filter(L=>L.props.visible&&L.props.operation===xd.MASK);if(l.length===0){this.masks=null,this.channels.length=0;return}this.masks={},this.maskPass||(this.maskPass=new lF(e,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap);const b=this._sortMaskChannels(l),T=o[0],C=!this.lastViewport||!this.lastViewport.equals(T);for(const L in b)this._renderChannel(b[L],{layerFilter:i,onViewportActive:u,views:f,viewport:T,viewportChanged:C})}_renderChannel(e,{layerFilter:n,onViewportActive:i,views:o,viewport:u,viewportChanged:f}){const l=this.channels[e.index];if(!l)return;const b=e===l||l.layers.length!==e.layers.length||e.layerBounds.some((T,C)=>T!==l.layerBounds[C]);if(e.bounds=l.bounds,e.maskBounds=l.maskBounds,this.channels[e.index]=e,(b||f)&&(this.lastViewport=u,e.bounds=mF({layers:e.layers,viewport:u}),b||!tu(e.bounds,l.bounds))){const{maskPass:T,maskMap:C}=this,L=gF({bounds:e.bounds,viewport:u,width:C.width,height:C.height});e.maskBounds=L?L.getBounds():[0,0,1,1],T.render({pass:"mask",channel:e.index,layers:e.layers,layerFilter:n,viewports:L?[L]:[],onViewportActive:i,views:o,moduleParameters:{devicePixelRatio:1}})}this.masks[e.id]={index:e.index,bounds:e.maskBounds,coordinateOrigin:e.coordinateOrigin,coordinateSystem:e.coordinateSystem}}_sortMaskChannels(e){const n={};let i=0;for(const o of e){const{id:u}=o.root;let f=n[u];if(!f){if(++i>4){pn.warn("Too many mask layers. The max supported is 4")();continue}f={id:u,index:this.channels.findIndex(l=>(l==null?void 0:l.id)===u),layers:[],layerBounds:[],coordinateOrigin:o.root.props.coordinateOrigin,coordinateSystem:o.root.props.coordinateSystem},n[u]=f}f.layers.push(o),f.layerBounds.push(o.getBounds())}for(let o=0;o<4;o++){const u=this.channels[o];(!u||!(u.id in n))&&(this.channels[o]=null)}for(const o in n){const u=n[o];u.index<0&&(u.index=this.channels.findIndex(f=>!f),this.channels[u.index]=u)}return n}getModuleParameters(){return{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}}const vF=new AS;class xF{constructor(){U(this,"effects",void 0),U(this,"_internalEffects",void 0),U(this,"_needsRedraw",void 0),this.effects=[],this._internalEffects=[],this._needsRedraw="Initial render",this.setEffects()}setProps(e){"effects"in e&&(e.effects.length!==this.effects.length||!hu(e.effects,this.effects))&&(this.setEffects(e.effects),this._needsRedraw="effects changed")}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._internalEffects}finalize(){this.cleanup()}setEffects(e=[]){this.cleanup(),this.effects=e,this._internalEffects=e.slice(),this._internalEffects.push(new yF),e.some(n=>n instanceof AS)||this._internalEffects.push(vF)}cleanup(){for(const e of this.effects)e.cleanup();for(const e of this._internalEffects)e.cleanup();this.effects.length=0,this._internalEffects.length=0}}class bF extends Pm{shouldDrawLayer(e){return e.props.operation===xd.DRAW}}const Tw={blendFunc:[1,0,32771,0],blendEquation:32774};class DS extends Pm{constructor(...e){super(...e),U(this,"pickZ",void 0),U(this,"_colors",null)}render(e){return e.pickingFBO?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,pickingFBO:f,deviceRect:{x:l,y:b,width:T,height:C},cullRect:L,effects:k,pass:X="picking",pickZ:te}){const ie=this.gl;this.pickZ=te;const ye=te?null:{byLayer:new Map,byAlpha:[]};this._colors=ye;const J=vs(ie,{scissorTest:!0,scissor:[l,b,T,C],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...Tw,blend:!te},()=>super.render({target:f,layers:e,layerFilter:n,views:i,viewports:o,onViewportActive:u,cullRect:L,effects:k==null?void 0:k.filter(Q=>Q.useInPicking),pass:X}));return this._colors=null,{decodePickingColor:ye&&EF.bind(null,ye),stats:J}}shouldDrawLayer(e){return e.props.pickable&&e.props.operation===xd.DRAW}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,i){const o={...e.props.parameters};return this._colors?(Object.assign(o,Tw),o.blend=!0,o.blendColor=wF(this._colors,e,i)):o.blend=!1,o}}function wF(t,e,n){const{byLayer:i,byAlpha:o}=t;let u,f=i.get(e);return f?(f.viewports.push(n),u=f.a):(u=i.size+1,u<=255?(f={a:u,layer:e,viewports:[n]},i.set(e,f),o[u]=f):(pn.warn("Too many pickable layers, only picking the first 255")(),u=0)),[0,0,0,u/255]}function EF(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const TF="deckRenderer.renderLayers";class SF{constructor(e){this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new bF(e),this.pickLayersPass=new DS(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){"layerFilter"in e&&this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),"drawPickingColors"in e&&this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass;e.layerFilter=e.layerFilter||this.layerFilter,e.effects=e.effects||[],e.target=e.target||hi.getDefaultFramebuffer(this.gl),this._preRender(e.effects,e);const i=this.lastPostProcessEffect?this.renderBuffers[0]:e.target,o=n.render({...e,target:i});this._postRender(e.effects,e),this.renderCount++,pr(TF,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){let i=null;for(const o of e)o.preRender(this.gl,n),o.postRender&&(i=o);i&&this._resizeRenderBuffers(),this.lastPostProcessEffect=i}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new hi(this.gl),new hi(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:i}=this,o={inputBuffer:i[0],swapBuffer:i[1],target:null};for(const u of e)if(u.postRender){if(u===this.lastPostProcessEffect){o.target=n.target,u.postRender(this.gl,o);break}const f=u.postRender(this.gl,o);o.inputBuffer=f,o.swapBuffer=f===i[0]?i[1]:i[0]}}}const AF={pickedColor:null,pickedObjectIndex:-1};function IF({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:i,deviceRadius:o,deviceRect:u}){const{x:f,y:l,width:b,height:T}=u;let C=o*o,L=-1,k=0;for(let X=0;X<T;X++){const te=X+l-i,ie=te*te;if(ie>C)k+=4*b;else for(let ye=0;ye<b;ye++){if(t[k+3]-1>=0){const W=ye+f-n,Q=W*W+ie;Q<=C&&(C=Q,L=k)}k+=4}}if(L>=0){const X=t.slice(L,L+4),te=e(X);if(te){const ie=Math.floor(L/4/b),ye=L/4-ie*b;return{...te,pickedColor:X,pickedX:f+ye,pickedY:l+ie}}pn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return AF}function PF({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){const u=t.slice(i,i+4),f=u.join(",");if(!n.has(f)){const l=e(u);l?n.set(f,{...l,color:u}):pn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function zS({pickInfo:t,viewports:e,pixelRatio:n,x:i,y:o,z:u}){let f=e[0];e.length>1&&(f=MF((t==null?void 0:t.pickedViewports)||e,{x:i,y:o}));let l;if(f){const b=[i-f.x,o-f.y];u!==void 0&&(b[2]=u),l=f.unproject(b)}return{color:null,layer:null,viewport:f,index:-1,picked:!1,x:i,y:o,pixel:[i,o],coordinate:l,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function CF(t){const{pickInfo:e,lastPickedInfo:n,mode:i,layers:o}=t,{pickedColor:u,pickedLayer:f,pickedObjectIndex:l}=e,b=f?[f]:[];if(i==="hover"){const L=n.index,k=n.layerId,X=f?f.props.id:null;if(X!==k||l!==L){if(X!==k){const te=o.find(ie=>ie.props.id===k);te&&b.unshift(te)}n.layerId=X,n.index=l,n.info=null}}const T=zS(t),C=new Map;return C.set(null,T),b.forEach(L=>{let k={...T};L===f&&(k.color=u,k.index=l,k.picked=!0),k=OS({layer:L,info:k,mode:i});const X=k.layer;L===f&&i==="hover"&&(n.info=k),C.set(X.id,k),i==="hover"&&X.updateAutoHighlight(k)}),C}function OS({layer:t,info:e,mode:n}){for(;t&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:i}),t=t.parent}return e}function MF(t,e){for(let n=t.length-1;n>=0;n--){const i=t[n];if(i.containsPixel(e))return i}return t[0]}class kF{constructor(e){U(this,"gl",void 0),U(this,"pickingFBO",void 0),U(this,"depthFBO",void 0),U(this,"pickLayersPass",void 0),U(this,"layerFilter",void 0),U(this,"lastPickedInfo",void 0),U(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new DS(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:i,viewports:o},u=this.lastPickedInfo.info){const f=u&&u.layer&&u.layer.id,l=u&&u.viewport&&u.viewport.id,b=f?i.find(k=>k.id===f):null,T=l&&o.find(k=>k.id===l)||o[0],C=T&&T.unproject([e-T.x,n-T.y]);return{...u,...{x:e,y:n,viewport:T,coordinate:C,layer:b}}}_resizeBuffer(){var e,n;const{gl:i}=this;if(!this.pickingFBO&&(this.pickingFBO=new hi(i),hi.isSupported(i,{colorBufferFloat:!0}))){const o=new hi(i);o.attach({[36064]:new _r(i,{format:Xt(i)?34836:6408,type:5126})}),this.depthFBO=o}(e=this.pickingFBO)===null||e===void 0||e.resize({width:i.canvas.width,height:i.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:i.canvas.width,height:i.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(i=>i.isPickable()&&!i.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:i,x:o,y:u,radius:f=0,depth:l=1,mode:b="query",unproject3D:T,onViewportActive:C,effects:L}){const k=this._getPickable(e),X=Kc(this.gl);if(!k)return{result:[],emptyInfo:zS({viewports:i,x:o,y:u,pixelRatio:X})};this._resizeBuffer();const te=y_(this.gl,[o,u],!0),ie=[te.x+Math.floor(te.width/2),te.y+Math.floor(te.height/2)],ye=Math.round(f*X),{width:J,height:W}=this.pickingFBO,Q=this._getPickingRect({deviceX:ie[0],deviceY:ie[1],deviceRadius:ye,deviceWidth:J,deviceHeight:W}),_e={x:o-f,y:u-f,width:f*2+1,height:f*2+1};let we;const Ce=[],Oe=new Set;for(let Ue=0;Ue<l;Ue++){let st;if(Q){const xt=this._drawAndSample({layers:k,views:n,viewports:i,onViewportActive:C,deviceRect:Q,cullRect:_e,effects:L,pass:"picking:".concat(b)});st=IF({...xt,deviceX:ie[0],deviceY:ie[1],deviceRadius:ye,deviceRect:Q})}else st={pickedColor:null,pickedObjectIndex:-1};let Xe;st.pickedLayer&&T&&this.depthFBO&&(Xe=this._drawAndSample({layers:[st.pickedLayer],views:n,viewports:i,onViewportActive:C,deviceRect:{x:st.pickedX,y:st.pickedY,width:1,height:1},cullRect:_e,effects:L,pass:"picking:".concat(b,":z")},!0).pickedColors[0]),st.pickedLayer&&Ue+1<l&&(Oe.add(st.pickedLayer),st.pickedLayer.disablePickingIndex(st.pickedObjectIndex)),we=CF({pickInfo:st,lastPickedInfo:this.lastPickedInfo,mode:b,layers:k,viewports:i,x:o,y:u,z:Xe,pixelRatio:X});for(const xt of we.values())xt.layer&&Ce.push(xt);if(!st.pickedColor)break}for(const Ue of Oe)Ue.restorePickingColors();return{result:Ce,emptyInfo:we.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:i,x:o,y:u,width:f=1,height:l=1,mode:b="query",maxObjects:T=null,onViewportActive:C,effects:L}){const k=this._getPickable(e);if(!k)return[];this._resizeBuffer();const X=Kc(this.gl),te=y_(this.gl,[o,u],!0),ie=te.x,ye=te.y+te.height,J=y_(this.gl,[o+f,u+l],!0),W=J.x+J.width,Q=J.y,_e={x:ie,y:Q,width:W-ie,height:ye-Q},we=this._drawAndSample({layers:k,views:n,viewports:i,onViewportActive:C,deviceRect:_e,cullRect:{x:o,y:u,width:f,height:l},effects:L,pass:"picking:".concat(b)}),Ce=PF(we),Oe=new Map,Ue=Number.isFinite(T);for(let st=0;st<Ce.length&&!(Ue&&T&&Oe.size>=T);st++){const Xe=Ce[st];let xt={color:Xe.pickedColor,layer:null,index:Xe.pickedObjectIndex,picked:!0,x:o,y:u,pixelRatio:X};xt=OS({layer:Xe.pickedLayer,info:xt,mode:b}),Oe.has(xt.object)||Oe.set(xt.object,xt)}return Array.from(Oe.values())}_drawAndSample({layers:e,views:n,viewports:i,onViewportActive:o,deviceRect:u,cullRect:f,effects:l,pass:b},T=!1){const C=T?this.depthFBO:this.pickingFBO,{decodePickingColor:L}=this.pickLayersPass.render({layers:e,layerFilter:this.layerFilter,views:n,viewports:i,onViewportActive:o,pickingFBO:C,deviceRect:u,cullRect:f,effects:l,pass:b,pickZ:T}),{x:k,y:X,width:te,height:ie}=u,ye=new(T?Float32Array:Uint8Array)(te*ie*4);return Sm(C,{sourceX:k,sourceY:X,sourceWidth:te,sourceHeight:ie,target:ye}),{pickedColors:ye,decodePickingColor:L}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:i,deviceWidth:o,deviceHeight:u}){const f=Math.max(0,e-i),l=Math.max(0,n-i),b=Math.min(o,e+i+1)-f,T=Math.min(u,n+i+1)-l;return b<=0||T<=0?null:{x:f,y:l,width:b,height:T}}}const LF={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class RF{constructor(e){U(this,"el",null),U(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,LF),n.appendChild(this.el))}setTooltip(e,n,i){const o=this.el;if(!!o){if(typeof e=="string")o.innerText=e;else if(e)e.text&&(o.innerText=e.text),e.html&&(o.innerHTML=e.html),e.className&&(o.className=e.className),Object.assign(o.style,e.style);else{this.isVisible=!1,o.style.display="none";return}this.isVisible=!0,o.style.display="block",o.style.transform="translate(".concat(n,"px, ").concat(i,"px)")}}remove(){this.el&&(this.el.remove(),this.el=null)}}var du={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,i,o){var u=["","webkit","Moz","MS","ms","o"],f=n.createElement("div"),l="function",b=Math.round,T=Math.abs,C=Date.now;function L(j,Z,ce){return setTimeout(Q(j,ce),Z)}function k(j,Z,ce){return Array.isArray(j)?(X(j,ce[Z],ce),!0):!1}function X(j,Z,ce){var Se;if(!!j)if(j.forEach)j.forEach(Z,ce);else if(j.length!==o)for(Se=0;Se<j.length;)Z.call(ce,j[Se],Se,j),Se++;else for(Se in j)j.hasOwnProperty(Se)&&Z.call(ce,j[Se],Se,j)}function te(j,Z,ce){var Se="DEPRECATED METHOD: "+Z+`
`+ce+` AT 
`;return function(){var Be=new Error("get-stack-trace"),ot=Be&&Be.stack?Be.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ot=e.console&&(e.console.warn||e.console.log);return Ot&&Ot.call(e.console,Se,ot),j.apply(this,arguments)}}var ie;typeof Object.assign!="function"?ie=function(Z){if(Z===o||Z===null)throw new TypeError("Cannot convert undefined or null to object");for(var ce=Object(Z),Se=1;Se<arguments.length;Se++){var Be=arguments[Se];if(Be!==o&&Be!==null)for(var ot in Be)Be.hasOwnProperty(ot)&&(ce[ot]=Be[ot])}return ce}:ie=Object.assign;var ye=te(function(Z,ce,Se){for(var Be=Object.keys(ce),ot=0;ot<Be.length;)(!Se||Se&&Z[Be[ot]]===o)&&(Z[Be[ot]]=ce[Be[ot]]),ot++;return Z},"extend","Use `assign`."),J=te(function(Z,ce){return ye(Z,ce,!0)},"merge","Use `assign`.");function W(j,Z,ce){var Se=Z.prototype,Be;Be=j.prototype=Object.create(Se),Be.constructor=j,Be._super=Se,ce&&ie(Be,ce)}function Q(j,Z){return function(){return j.apply(Z,arguments)}}function _e(j,Z){return typeof j==l?j.apply(Z&&Z[0]||o,Z):j}function we(j,Z){return j===o?Z:j}function Ce(j,Z,ce){X(Xe(Z),function(Se){j.addEventListener(Se,ce,!1)})}function Oe(j,Z,ce){X(Xe(Z),function(Se){j.removeEventListener(Se,ce,!1)})}function Ue(j,Z){for(;j;){if(j==Z)return!0;j=j.parentNode}return!1}function st(j,Z){return j.indexOf(Z)>-1}function Xe(j){return j.trim().split(/\s+/g)}function xt(j,Z,ce){if(j.indexOf&&!ce)return j.indexOf(Z);for(var Se=0;Se<j.length;){if(ce&&j[Se][ce]==Z||!ce&&j[Se]===Z)return Se;Se++}return-1}function $t(j){return Array.prototype.slice.call(j,0)}function en(j,Z,ce){for(var Se=[],Be=[],ot=0;ot<j.length;){var Ot=Z?j[ot][Z]:j[ot];xt(Be,Ot)<0&&Se.push(j[ot]),Be[ot]=Ot,ot++}return ce&&(Z?Se=Se.sort(function(kt,Fn){return kt[Z]>Fn[Z]}):Se=Se.sort()),Se}function Dt(j,Z){for(var ce,Se,Be=Z[0].toUpperCase()+Z.slice(1),ot=0;ot<u.length;){if(ce=u[ot],Se=ce?ce+Be:Z,Se in j)return Se;ot++}return o}var ti=1;function vt(){return ti++}function vi(j){var Z=j.ownerDocument||j;return Z.defaultView||Z.parentWindow||e}var et=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in e,St=Dt(e,"PointerEvent")!==o,tn=wt&&et.test(navigator.userAgent),nn="touch",nr="pen",ni="mouse",xi="kinect",ii=25,ln=1,bi=2,Wt=4,zn=8,is=1,Ci=2,Xn=4,Lr=8,ji=16,di=Ci|Xn,Gi=Lr|ji,Vs=di|Gi,Vt=["x","y"],Mi=["clientX","clientY"];function On(j,Z){var ce=this;this.manager=j,this.callback=Z,this.element=j.element,this.target=j.options.inputTarget,this.domHandler=function(Se){_e(j.options.enable,[j])&&ce.handler(Se)},this.init()}On.prototype={handler:function(){},init:function(){this.evEl&&Ce(this.element,this.evEl,this.domHandler),this.evTarget&&Ce(this.target,this.evTarget,this.domHandler),this.evWin&&Ce(vi(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Oe(this.element,this.evEl,this.domHandler),this.evTarget&&Oe(this.target,this.evTarget,this.domHandler),this.evWin&&Oe(vi(this.element),this.evWin,this.domHandler)}};function rs(j){var Z,ce=j.options.inputClass;return ce?Z=ce:St?Z=ir:tn?Z=wr:wt?Z=Y:Z=Pt,new Z(j,po)}function po(j,Z,ce){var Se=ce.pointers.length,Be=ce.changedPointers.length,ot=Z&ln&&Se-Be===0,Ot=Z&(Wt|zn)&&Se-Be===0;ce.isFirst=!!ot,ce.isFinal=!!Ot,ot&&(j.session={}),ce.eventType=Z,Rr(j,ce),j.emit("hammer.input",ce),j.recognize(ce),j.session.prevInput=ce}function Rr(j,Z){var ce=j.session,Se=Z.pointers,Be=Se.length;ce.firstInput||(ce.firstInput=xr(Z)),Be>1&&!ce.firstMultiple?ce.firstMultiple=xr(Z):Be===1&&(ce.firstMultiple=!1);var ot=ce.firstInput,Ot=ce.firstMultiple,En=Ot?Ot.center:ot.center,kt=Z.center=Me(Se);Z.timeStamp=C(),Z.deltaTime=Z.timeStamp-ot.timeStamp,Z.angle=Bt(En,kt),Z.distance=wi(En,kt),Dr(ce,Z),Z.offsetDirection=ss(Z.deltaX,Z.deltaY);var Fn=He(Z.deltaTime,Z.deltaX,Z.deltaY);Z.overallVelocityX=Fn.x,Z.overallVelocityY=Fn.y,Z.overallVelocity=T(Fn.x)>T(Fn.y)?Fn.x:Fn.y,Z.scale=Ot?ki(Ot.pointers,Se):1,Z.rotation=Ot?Hi(Ot.pointers,Se):0,Z.maxPointers=ce.prevInput?Z.pointers.length>ce.prevInput.maxPointers?Z.pointers.length:ce.prevInput.maxPointers:Z.pointers.length,js(ce,Z);var rr=j.element;Ue(Z.srcEvent.target,rr)&&(rr=Z.srcEvent.target),Z.target=rr}function Dr(j,Z){var ce=Z.center,Se=j.offsetDelta||{},Be=j.prevDelta||{},ot=j.prevInput||{};(Z.eventType===ln||ot.eventType===Wt)&&(Be=j.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},Se=j.offsetDelta={x:ce.x,y:ce.y}),Z.deltaX=Be.x+(ce.x-Se.x),Z.deltaY=Be.y+(ce.y-Se.y)}function js(j,Z){var ce=j.lastInterval||Z,Se=Z.timeStamp-ce.timeStamp,Be,ot,Ot,En;if(Z.eventType!=zn&&(Se>ii||ce.velocity===o)){var kt=Z.deltaX-ce.deltaX,Fn=Z.deltaY-ce.deltaY,rr=He(Se,kt,Fn);ot=rr.x,Ot=rr.y,Be=T(rr.x)>T(rr.y)?rr.x:rr.y,En=ss(kt,Fn),j.lastInterval=Z}else Be=ce.velocity,ot=ce.velocityX,Ot=ce.velocityY,En=ce.direction;Z.velocity=Be,Z.velocityX=ot,Z.velocityY=Ot,Z.direction=En}function xr(j){for(var Z=[],ce=0;ce<j.pointers.length;)Z[ce]={clientX:b(j.pointers[ce].clientX),clientY:b(j.pointers[ce].clientY)},ce++;return{timeStamp:C(),pointers:Z,center:Me(Z),deltaX:j.deltaX,deltaY:j.deltaY}}function Me(j){var Z=j.length;if(Z===1)return{x:b(j[0].clientX),y:b(j[0].clientY)};for(var ce=0,Se=0,Be=0;Be<Z;)ce+=j[Be].clientX,Se+=j[Be].clientY,Be++;return{x:b(ce/Z),y:b(Se/Z)}}function He(j,Z,ce){return{x:Z/j||0,y:ce/j||0}}function ss(j,Z){return j===Z?is:T(j)>=T(Z)?j<0?Ci:Xn:Z<0?Lr:ji}function wi(j,Z,ce){ce||(ce=Vt);var Se=Z[ce[0]]-j[ce[0]],Be=Z[ce[1]]-j[ce[1]];return Math.sqrt(Se*Se+Be*Be)}function Bt(j,Z,ce){ce||(ce=Vt);var Se=Z[ce[0]]-j[ce[0]],Be=Z[ce[1]]-j[ce[1]];return Math.atan2(Be,Se)*180/Math.PI}function Hi(j,Z){return Bt(Z[1],Z[0],Mi)+Bt(j[1],j[0],Mi)}function ki(j,Z){return wi(Z[0],Z[1],Mi)/wi(j[0],j[1],Mi)}var Li={mousedown:ln,mousemove:bi,mouseup:Wt},os="mousedown",Ge="mousemove mouseup";function Pt(){this.evEl=os,this.evWin=Ge,this.pressed=!1,On.apply(this,arguments)}W(Pt,On,{handler:function(Z){var ce=Li[Z.type];ce&ln&&Z.button===0&&(this.pressed=!0),ce&bi&&Z.which!==1&&(ce=Wt),this.pressed&&(ce&Wt&&(this.pressed=!1),this.callback(this.manager,ce,{pointers:[Z],changedPointers:[Z],pointerType:ni,srcEvent:Z}))}});var It={pointerdown:ln,pointermove:bi,pointerup:Wt,pointercancel:zn,pointerout:zn},Zn={2:nn,3:nr,4:ni,5:xi},zr="pointerdown",At="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(zr="MSPointerDown",At="MSPointerMove MSPointerUp MSPointerCancel");function ir(){this.evEl=zr,this.evWin=At,On.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}W(ir,On,{handler:function(Z){var ce=this.store,Se=!1,Be=Z.type.toLowerCase().replace("ms",""),ot=It[Be],Ot=Zn[Z.pointerType]||Z.pointerType,En=Ot==nn,kt=xt(ce,Z.pointerId,"pointerId");ot&ln&&(Z.button===0||En)?kt<0&&(ce.push(Z),kt=ce.length-1):ot&(Wt|zn)&&(Se=!0),!(kt<0)&&(ce[kt]=Z,this.callback(this.manager,ot,{pointers:ce,changedPointers:[Z],pointerType:Ot,srcEvent:Z}),Se&&ce.splice(kt,1))}});var jn={touchstart:ln,touchmove:bi,touchend:Wt,touchcancel:zn},Gs="touchstart",Mn="touchstart touchmove touchend touchcancel";function ri(){this.evTarget=Gs,this.evWin=Mn,this.started=!1,On.apply(this,arguments)}W(ri,On,{handler:function(Z){var ce=jn[Z.type];if(ce===ln&&(this.started=!0),!!this.started){var Se=Jt.call(this,Z,ce);ce&(Wt|zn)&&Se[0].length-Se[1].length===0&&(this.started=!1),this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:nn,srcEvent:Z})}}});function Jt(j,Z){var ce=$t(j.touches),Se=$t(j.changedTouches);return Z&(Wt|zn)&&(ce=en(ce.concat(Se),"identifier",!0)),[ce,Se]}var Hs={touchstart:ln,touchmove:bi,touchend:Wt,touchcancel:zn},br="touchstart touchmove touchend touchcancel";function wr(){this.evTarget=br,this.targetIds={},On.apply(this,arguments)}W(wr,On,{handler:function(Z){var ce=Hs[Z.type],Se=Es.call(this,Z,ce);!Se||this.callback(this.manager,ce,{pointers:Se[0],changedPointers:Se[1],pointerType:nn,srcEvent:Z})}});function Es(j,Z){var ce=$t(j.touches),Se=this.targetIds;if(Z&(ln|bi)&&ce.length===1)return Se[ce[0].identifier]=!0,[ce,ce];var Be,ot,Ot=$t(j.changedTouches),En=[],kt=this.target;if(ot=ce.filter(function(Fn){return Ue(Fn.target,kt)}),Z===ln)for(Be=0;Be<ot.length;)Se[ot[Be].identifier]=!0,Be++;for(Be=0;Be<Ot.length;)Se[Ot[Be].identifier]&&En.push(Ot[Be]),Z&(Wt|zn)&&delete Se[Ot[Be].identifier],Be++;if(!!En.length)return[en(ot.concat(En),"identifier",!0),En]}var $s=2500,as=25;function Y(){On.apply(this,arguments);var j=Q(this.handler,this);this.touch=new wr(this.manager,j),this.mouse=new Pt(this.manager,j),this.primaryTouch=null,this.lastTouches=[]}W(Y,On,{handler:function(Z,ce,Se){var Be=Se.pointerType==nn,ot=Se.pointerType==ni;if(!(ot&&Se.sourceCapabilities&&Se.sourceCapabilities.firesTouchEvents)){if(Be)R.call(this,ce,Se);else if(ot&&$.call(this,Se))return;this.callback(Z,ce,Se)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function R(j,Z){j&ln?(this.primaryTouch=Z.changedPointers[0].identifier,F.call(this,Z)):j&(Wt|zn)&&F.call(this,Z)}function F(j){var Z=j.changedPointers[0];if(Z.identifier===this.primaryTouch){var ce={x:Z.clientX,y:Z.clientY};this.lastTouches.push(ce);var Se=this.lastTouches,Be=function(){var ot=Se.indexOf(ce);ot>-1&&Se.splice(ot,1)};setTimeout(Be,$s)}}function $(j){for(var Z=j.srcEvent.clientX,ce=j.srcEvent.clientY,Se=0;Se<this.lastTouches.length;Se++){var Be=this.lastTouches[Se],ot=Math.abs(Z-Be.x),Ot=Math.abs(ce-Be.y);if(ot<=as&&Ot<=as)return!0}return!1}var q=Dt(f.style,"touchAction"),le=q!==o,de="compute",ue="auto",ae="manipulation",fe="none",Ie="pan-x",ze="pan-y",Ae=Ze();function it(j,Z){this.manager=j,this.set(Z)}it.prototype={set:function(j){j==de&&(j=this.compute()),le&&this.manager.element.style&&Ae[j]&&(this.manager.element.style[q]=j),this.actions=j.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var j=[];return X(this.manager.recognizers,function(Z){_e(Z.options.enable,[Z])&&(j=j.concat(Z.getTouchAction()))}),at(j.join(" "))},preventDefaults:function(j){var Z=j.srcEvent,ce=j.offsetDirection;if(this.manager.session.prevented){Z.preventDefault();return}var Se=this.actions,Be=st(Se,fe)&&!Ae[fe],ot=st(Se,ze)&&!Ae[ze],Ot=st(Se,Ie)&&!Ae[Ie];if(Be){var En=j.pointers.length===1,kt=j.distance<2,Fn=j.deltaTime<250;if(En&&kt&&Fn)return}if(!(Ot&&ot)&&(Be||ot&&ce&di||Ot&&ce&Gi))return this.preventSrc(Z)},preventSrc:function(j){this.manager.session.prevented=!0,j.preventDefault()}};function at(j){if(st(j,fe))return fe;var Z=st(j,Ie),ce=st(j,ze);return Z&&ce?fe:Z||ce?Z?Ie:ze:st(j,ae)?ae:ue}function Ze(){if(!le)return!1;var j={},Z=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(ce){j[ce]=Z?e.CSS.supports("touch-action",ce):!0}),j}var mt=1,ht=2,Mt=4,yt=8,Tt=yt,zt=16,Nt=32;function un(j){this.options=ie({},this.defaults,j||{}),this.id=vt(),this.manager=null,this.options.enable=we(this.options.enable,!0),this.state=mt,this.simultaneous={},this.requireFail=[]}un.prototype={defaults:{},set:function(j){return ie(this.options,j),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(j){if(k(j,"recognizeWith",this))return this;var Z=this.simultaneous;return j=Or(j,this),Z[j.id]||(Z[j.id]=j,j.recognizeWith(this)),this},dropRecognizeWith:function(j){return k(j,"dropRecognizeWith",this)?this:(j=Or(j,this),delete this.simultaneous[j.id],this)},requireFailure:function(j){if(k(j,"requireFailure",this))return this;var Z=this.requireFail;return j=Or(j,this),xt(Z,j)===-1&&(Z.push(j),j.requireFailure(this)),this},dropRequireFailure:function(j){if(k(j,"dropRequireFailure",this))return this;j=Or(j,this);var Z=xt(this.requireFail,j);return Z>-1&&this.requireFail.splice(Z,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(j){return!!this.simultaneous[j.id]},emit:function(j){var Z=this,ce=this.state;function Se(Be){Z.manager.emit(Be,j)}ce<yt&&Se(Z.options.event+hn(ce)),Se(Z.options.event),j.additionalEvent&&Se(j.additionalEvent),ce>=yt&&Se(Z.options.event+hn(ce))},tryEmit:function(j){if(this.canEmit())return this.emit(j);this.state=Nt},canEmit:function(){for(var j=0;j<this.requireFail.length;){if(!(this.requireFail[j].state&(Nt|mt)))return!1;j++}return!0},recognize:function(j){var Z=ie({},j);if(!_e(this.options.enable,[this,Z])){this.reset(),this.state=Nt;return}this.state&(Tt|zt|Nt)&&(this.state=mt),this.state=this.process(Z),this.state&(ht|Mt|yt|zt)&&this.tryEmit(Z)},process:function(j){},getTouchAction:function(){},reset:function(){}};function hn(j){return j&zt?"cancel":j&yt?"end":j&Mt?"move":j&ht?"start":""}function Yn(j){return j==ji?"down":j==Lr?"up":j==Ci?"left":j==Xn?"right":""}function Or(j,Z){var ce=Z.manager;return ce?ce.get(j):j}function fi(){un.apply(this,arguments)}W(fi,un,{defaults:{pointers:1},attrTest:function(j){var Z=this.options.pointers;return Z===0||j.pointers.length===Z},process:function(j){var Z=this.state,ce=j.eventType,Se=Z&(ht|Mt),Be=this.attrTest(j);return Se&&(ce&zn||!Be)?Z|zt:Se||Be?ce&Wt?Z|yt:Z&ht?Z|Mt:ht:Nt}});function qt(){fi.apply(this,arguments),this.pX=null,this.pY=null}W(qt,fi,{defaults:{event:"pan",threshold:10,pointers:1,direction:Vs},getTouchAction:function(){var j=this.options.direction,Z=[];return j&di&&Z.push(ze),j&Gi&&Z.push(Ie),Z},directionTest:function(j){var Z=this.options,ce=!0,Se=j.distance,Be=j.direction,ot=j.deltaX,Ot=j.deltaY;return Be&Z.direction||(Z.direction&di?(Be=ot===0?is:ot<0?Ci:Xn,ce=ot!=this.pX,Se=Math.abs(j.deltaX)):(Be=Ot===0?is:Ot<0?Lr:ji,ce=Ot!=this.pY,Se=Math.abs(j.deltaY))),j.direction=Be,ce&&Se>Z.threshold&&Be&Z.direction},attrTest:function(j){return fi.prototype.attrTest.call(this,j)&&(this.state&ht||!(this.state&ht)&&this.directionTest(j))},emit:function(j){this.pX=j.deltaX,this.pY=j.deltaY;var Z=Yn(j.direction);Z&&(j.additionalEvent=this.options.event+Z),this._super.emit.call(this,j)}});function mo(){fi.apply(this,arguments)}W(mo,fi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.scale-1)>this.options.threshold||this.state&ht)},emit:function(j){if(j.scale!==1){var Z=j.scale<1?"in":"out";j.additionalEvent=this.options.event+Z}this._super.emit.call(this,j)}});function go(){un.apply(this,arguments),this._timer=null,this._input=null}W(go,un,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ue]},process:function(j){var Z=this.options,ce=j.pointers.length===Z.pointers,Se=j.distance<Z.threshold,Be=j.deltaTime>Z.time;if(this._input=j,!Se||!ce||j.eventType&(Wt|zn)&&!Be)this.reset();else if(j.eventType&ln)this.reset(),this._timer=L(function(){this.state=Tt,this.tryEmit()},Z.time,this);else if(j.eventType&Wt)return Tt;return Nt},reset:function(){clearTimeout(this._timer)},emit:function(j){this.state===Tt&&(j&&j.eventType&Wt?this.manager.emit(this.options.event+"up",j):(this._input.timeStamp=C(),this.manager.emit(this.options.event,this._input)))}});function qo(){fi.apply(this,arguments)}W(qo,fi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fe]},attrTest:function(j){return this._super.attrTest.call(this,j)&&(Math.abs(j.rotation)>this.options.threshold||this.state&ht)}});function Xo(){fi.apply(this,arguments)}W(Xo,fi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:di|Gi,pointers:1},getTouchAction:function(){return qt.prototype.getTouchAction.call(this)},attrTest:function(j){var Z=this.options.direction,ce;return Z&(di|Gi)?ce=j.overallVelocity:Z&di?ce=j.overallVelocityX:Z&Gi&&(ce=j.overallVelocityY),this._super.attrTest.call(this,j)&&Z&j.offsetDirection&&j.distance>this.options.threshold&&j.maxPointers==this.options.pointers&&T(ce)>this.options.velocity&&j.eventType&Wt},emit:function(j){var Z=Yn(j.offsetDirection);Z&&this.manager.emit(this.options.event+Z,j),this.manager.emit(this.options.event,j)}});function Ws(){un.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}W(Ws,un,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ae]},process:function(j){var Z=this.options,ce=j.pointers.length===Z.pointers,Se=j.distance<Z.threshold,Be=j.deltaTime<Z.time;if(this.reset(),j.eventType&ln&&this.count===0)return this.failTimeout();if(Se&&Be&&ce){if(j.eventType!=Wt)return this.failTimeout();var ot=this.pTime?j.timeStamp-this.pTime<Z.interval:!0,Ot=!this.pCenter||wi(this.pCenter,j.center)<Z.posThreshold;this.pTime=j.timeStamp,this.pCenter=j.center,!Ot||!ot?this.count=1:this.count+=1,this._input=j;var En=this.count%Z.taps;if(En===0)return this.hasRequireFailures()?(this._timer=L(function(){this.state=Tt,this.tryEmit()},Z.interval,this),ht):Tt}return Nt},failTimeout:function(){return this._timer=L(function(){this.state=Nt},this.options.interval,this),Nt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Tt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Fr(j,Z){return Z=Z||{},Z.recognizers=we(Z.recognizers,Fr.defaults.preset),new Ko(j,Z)}Fr.VERSION="2.0.7",Fr.defaults={domEvents:!1,touchAction:de,enable:!0,inputTarget:null,inputClass:null,preset:[[qo,{enable:!1}],[mo,{enable:!1},["rotate"]],[Xo,{direction:di}],[qt,{direction:di},["swipe"]],[Ws],[Ws,{event:"doubletap",taps:2},["tap"]],[go]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Zo=1,Yo=2;function Ko(j,Z){this.options=ie({},Fr.defaults,Z||{}),this.options.inputTarget=this.options.inputTarget||j,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=j,this.input=rs(this),this.touchAction=new it(this,this.options.touchAction),Ga(this,!0),X(this.options.recognizers,function(ce){var Se=this.add(new ce[0](ce[1]));ce[2]&&Se.recognizeWith(ce[2]),ce[3]&&Se.requireFailure(ce[3])},this)}Ko.prototype={set:function(j){return ie(this.options,j),j.touchAction&&this.touchAction.update(),j.inputTarget&&(this.input.destroy(),this.input.target=j.inputTarget,this.input.init()),this},stop:function(j){this.session.stopped=j?Yo:Zo},recognize:function(j){var Z=this.session;if(!Z.stopped){this.touchAction.preventDefaults(j);var ce,Se=this.recognizers,Be=Z.curRecognizer;(!Be||Be&&Be.state&Tt)&&(Be=Z.curRecognizer=null);for(var ot=0;ot<Se.length;)ce=Se[ot],Z.stopped!==Yo&&(!Be||ce==Be||ce.canRecognizeWith(Be))?ce.recognize(j):ce.reset(),!Be&&ce.state&(ht|Mt|yt)&&(Be=Z.curRecognizer=ce),ot++}},get:function(j){if(j instanceof un)return j;for(var Z=this.recognizers,ce=0;ce<Z.length;ce++)if(Z[ce].options.event==j)return Z[ce];return null},add:function(j){if(k(j,"add",this))return this;var Z=this.get(j.options.event);return Z&&this.remove(Z),this.recognizers.push(j),j.manager=this,this.touchAction.update(),j},remove:function(j){if(k(j,"remove",this))return this;if(j=this.get(j),j){var Z=this.recognizers,ce=xt(Z,j);ce!==-1&&(Z.splice(ce,1),this.touchAction.update())}return this},on:function(j,Z){if(j!==o&&Z!==o){var ce=this.handlers;return X(Xe(j),function(Se){ce[Se]=ce[Se]||[],ce[Se].push(Z)}),this}},off:function(j,Z){if(j!==o){var ce=this.handlers;return X(Xe(j),function(Se){Z?ce[Se]&&ce[Se].splice(xt(ce[Se],Z),1):delete ce[Se]}),this}},emit:function(j,Z){this.options.domEvents&&Vl(j,Z);var ce=this.handlers[j]&&this.handlers[j].slice();if(!(!ce||!ce.length)){Z.type=j,Z.preventDefault=function(){Z.srcEvent.preventDefault()};for(var Se=0;Se<ce.length;)ce[Se](Z),Se++}},destroy:function(){this.element&&Ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ga(j,Z){var ce=j.element;if(!!ce.style){var Se;X(j.options.cssProps,function(Be,ot){Se=Dt(ce.style,ot),Z?(j.oldCssProps[Se]=ce.style[Se],ce.style[Se]=Be):ce.style[Se]=j.oldCssProps[Se]||""}),Z||(j.oldCssProps={})}}function Vl(j,Z){var ce=n.createEvent("Event");ce.initEvent(j,!0,!0),ce.gesture=Z,Z.target.dispatchEvent(ce)}ie(Fr,{INPUT_START:ln,INPUT_MOVE:bi,INPUT_END:Wt,INPUT_CANCEL:zn,STATE_POSSIBLE:mt,STATE_BEGAN:ht,STATE_CHANGED:Mt,STATE_ENDED:yt,STATE_RECOGNIZED:Tt,STATE_CANCELLED:zt,STATE_FAILED:Nt,DIRECTION_NONE:is,DIRECTION_LEFT:Ci,DIRECTION_RIGHT:Xn,DIRECTION_UP:Lr,DIRECTION_DOWN:ji,DIRECTION_HORIZONTAL:di,DIRECTION_VERTICAL:Gi,DIRECTION_ALL:Vs,Manager:Ko,Input:On,TouchAction:it,TouchInput:wr,MouseInput:Pt,PointerEventInput:ir,TouchMouseInput:Y,SingleTouchInput:ri,Recognizer:un,AttrRecognizer:fi,Tap:Ws,Pan:qt,Swipe:Xo,Pinch:mo,Rotate:qo,Press:go,on:Ce,off:Oe,each:X,merge:J,extend:ye,assign:ie,inherit:W,bindFn:Q,prefixed:Dt});var Ts=typeof e<"u"?e:typeof self<"u"?self:{};Ts.Hammer=Fr,typeof o=="function"&&o.amd?o(function(){return Fr}):t.exports?t.exports=Fr:e[i]=Fr})(window,document,"Hammer")})(du);const DF=du.exports,ro=YI({__proto__:null,default:DF},[du.exports]),FS=1,BS=2,Qy=4,zF={mousedown:FS,mousemove:BS,mouseup:Qy};function OF(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function FF(t){const e=t.prototype.handler;t.prototype.handler=function(i){const o=this.store;i.button>0&&i.type==="pointerdown"&&(OF(o,u=>u.pointerId===i.pointerId)||o.push(i)),e.call(this,i)}}function BF(t){t.prototype.handler=function(n){let i=zF[n.type];i&FS&&n.button>=0&&(this.pressed=!0),i&BS&&n.which===0&&(i=Qy),this.pressed&&(i&Qy&&(this.pressed=!1),this.callback(this.manager,i,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}FF(du.exports.PointerEventInput);BF(du.exports.MouseInput);const NF=du.exports.Manager;class Cm{constructor(e,n,i){this.element=e,this.callback=n,this.options={enable:!0,...i}}}const UF=ro?[[ro.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[ro.Rotate,{enable:!1}],[ro.Pinch,{enable:!1}],[ro.Swipe,{enable:!1}],[ro.Pan,{threshold:0,enable:!1}],[ro.Press,{enable:!1}],[ro.Tap,{event:"doubletap",taps:2,enable:!1}],[ro.Tap,{event:"anytap",enable:!1}],[ro.Tap,{enable:!1}]]:null,Sw={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},VF={doubletap:["tap"]},jF={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},vv={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},GF={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},Aw={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},HF=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",zc=typeof window<"u"?window:global;let e0=!1;try{const t={get passive(){return e0=!0,!0}};zc.addEventListener("test",null,t),zc.removeEventListener("test",null)}catch{e0=!1}const $F=HF.indexOf("firefox")!==-1,{WHEEL_EVENTS:WF}=vv,Iw="wheel",Pw=4.000244140625,qF=40,XF=.25;class ZF extends Cm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{if(!this.options.enable)return;let u=o.deltaY;zc.WheelEvent&&($F&&o.deltaMode===zc.WheelEvent.DOM_DELTA_PIXEL&&(u/=zc.devicePixelRatio),o.deltaMode===zc.WheelEvent.DOM_DELTA_LINE&&(u*=qF)),u!==0&&u%Pw===0&&(u=Math.floor(u/Pw)),o.shiftKey&&u&&(u=u*XF),this.callback({type:Iw,center:{x:o.clientX,y:o.clientY},delta:-u,srcEvent:o,pointerType:"mouse",target:o.target})},this.events=(this.options.events||[]).concat(WF),this.events.forEach(o=>e.addEventListener(o,this.handleEvent,e0?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Iw&&(this.options.enable=n)}}const{MOUSE_EVENTS:YF}=vv,Cw="pointermove",Mw="pointerover",kw="pointerout",Lw="pointerenter",Rw="pointerleave";class KF extends Cm{constructor(e,n,i){super(e,n,i),this.handleEvent=u=>{this.handleOverEvent(u),this.handleOutEvent(u),this.handleEnterEvent(u),this.handleLeaveEvent(u),this.handleMoveEvent(u)},this.pressed=!1;const{enable:o}=this.options;this.enableMoveEvent=o,this.enableLeaveEvent=o,this.enableEnterEvent=o,this.enableOutEvent=o,this.enableOverEvent=o,this.events=(this.options.events||[]).concat(YF),this.events.forEach(u=>e.addEventListener(u,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Cw&&(this.enableMoveEvent=n),e===Mw&&(this.enableOverEvent=n),e===kw&&(this.enableOutEvent=n),e===Lw&&(this.enableEnterEvent=n),e===Rw&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Mw,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(kw,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(Lw,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Rw,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(Cw,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:JF}=vv,Dw="keydown",zw="keyup";class QF extends Cm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{const u=o.target||o.srcElement;u.tagName==="INPUT"&&u.type==="text"||u.tagName==="TEXTAREA"||(this.enableDownEvent&&o.type==="keydown"&&this.callback({type:Dw,srcEvent:o,key:o.key,target:o.target}),this.enableUpEvent&&o.type==="keyup"&&this.callback({type:zw,srcEvent:o,key:o.key,target:o.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(JF),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Dw&&(this.enableDownEvent=n),e===zw&&(this.enableUpEvent=n)}}const Ow="contextmenu";class eB extends Cm{constructor(e,n,i){super(e,n,i),this.handleEvent=o=>{!this.options.enable||this.callback({type:Ow,center:{x:o.clientX,y:o.clientY},srcEvent:o,pointerType:"mouse",target:o.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Ow&&(this.options.enable=n)}}const t0=1,nm=2,n0=4,tB={pointerdown:t0,pointermove:nm,pointerup:n0,mousedown:t0,mousemove:nm,mouseup:n0},nB=1,iB=2,rB=3,sB=0,oB=1,aB=2,lB=1,cB=2,uB=4;function hB(t){const e=tB[t.srcEvent.type];if(!e)return null;const{buttons:n,button:i,which:o}=t.srcEvent;let u=!1,f=!1,l=!1;return e===n0||e===nm&&!Number.isFinite(n)?(u=o===nB,f=o===iB,l=o===rB):e===nm?(u=Boolean(n&lB),f=Boolean(n&uB),l=Boolean(n&cB)):e===t0&&(u=i===sB,f=i===oB,l=i===aB),{leftButton:u,middleButton:f,rightButton:l}}function dB(t,e){const n=t.center;if(!n)return null;const i=e.getBoundingClientRect(),o=i.width/e.offsetWidth||1,u=i.height/e.offsetHeight||1,f={x:(n.x-i.left-e.clientLeft)/o,y:(n.y-i.top-e.clientTop)/u};return{center:n,offsetCenter:f}}const D_={srcElement:"root",priority:0};class fB{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const i=this._normalizeEvent(n);let o=n.srcEvent.target;for(;o&&o!==i.rootElement;){if(this._emit(i,o),i.handled)return;o=o.parentNode}this._emit(i,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,i,o=!1,u=!1){const{handlers:f,handlersByElement:l}=this;let b=D_;typeof i=="string"||i&&i.addEventListener?b={...D_,srcElement:i}:i&&(b={...D_,...i});let T=l.get(b.srcElement);T||(T=[],l.set(b.srcElement,T));const C={type:e,handler:n,srcElement:b.srcElement,priority:b.priority};o&&(C.once=!0),u&&(C.passive=!0),f.push(C),this._active=this._active||!C.passive;let L=T.length-1;for(;L>=0&&!(T[L].priority>=C.priority);)L--;T.splice(L+1,0,C)}remove(e,n){const{handlers:i,handlersByElement:o}=this;for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.type===e&&f.handler===n){i.splice(u,1);const l=o.get(f.srcElement);l.splice(l.indexOf(f),1),l.length===0&&o.delete(f.srcElement)}}this._active=i.some(u=>!u.passive)}_emit(e,n){const i=this.handlersByElement.get(n);if(i){let o=!1;const u=()=>{e.handled=!0},f=()=>{e.handled=!0,o=!0},l=[];for(let b=0;b<i.length;b++){const{type:T,handler:C,once:L}=i[b];if(C({...e,type:T,stopPropagation:u,stopImmediatePropagation:f}),L&&l.push(i[b]),o)break}for(let b=0;b<l.length;b++){const{type:T,handler:C}=l[b];this.remove(T,C)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hB(e),...dB(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const pB={events:null,recognizers:null,recognizerOptions:{},Manager:NF,touchAction:"none",tabIndex:0};class mB{constructor(e=null,n){this._onBasicInput=o=>{const{srcEvent:u}=o,f=jF[u.type];f&&this.manager.emit(f,o)},this._onOtherEvent=o=>{this.manager.emit(o.type,o)},this.options={...pB,...n},this.events=new Map,this.setElement(e);const{events:i}=this.options;i&&this.on(i)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,i=n.Manager;this.manager=new i(e,{touchAction:n.touchAction,recognizers:n.recognizers||UF}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(Sw).forEach(o=>{const u=this.manager.get(o);u&&Sw[o].forEach(f=>{u.recognizeWith(f)})});for(const o in n.recognizerOptions){const u=this.manager.get(o);if(u){const f=n.recognizerOptions[o];delete f.enable,u.set(f)}}this.wheelInput=new ZF(e,this._onOtherEvent,{enable:!1}),this.moveInput=new KF(e,this._onOtherEvent,{enable:!1}),this.keyInput=new QF(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new eB(e,this._onOtherEvent,{enable:!1});for(const[o,u]of this.events)u.isEmpty()||(this._toggleRecognizer(u.recognizerName,!0),this.manager.on(o,u.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,i){this._addEventHandler(e,n,i,!1)}once(e,n,i){this._addEventHandler(e,n,i,!0)}watch(e,n,i){this._addEventHandler(e,n,i,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:i}=this;if(!i)return;const o=i.get(e);if(o&&o.options.enable!==n){o.set({enable:n});const u=VF[e];u&&!this.options.recognizers&&u.forEach(f=>{const l=i.get(f);n?(l.requireFailure(e),o.dropRequireFailure(f)):l.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,i,o,u){if(typeof e!="string"){i=n;for(const C in e)this._addEventHandler(C,e[C],i,o,u);return}const{manager:f,events:l}=this,b=Aw[e]||e;let T=l.get(b);T||(T=new fB(this),l.set(b,T),T.recognizerName=GF[b]||b,f&&f.on(b,T.handleEvent)),T.add(e,n,i,o,u),T.isEmpty()||this._toggleRecognizer(T.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const f in e)this._removeEventHandler(f,e[f]);return}const{events:i}=this,o=Aw[e]||e,u=i.get(o);if(!!u&&(u.remove(e,n),u.isEmpty())){const{recognizerName:f}=u;let l=!1;for(const b of i.values())if(b.recognizerName===f&&!b.isEmpty()){l=!0;break}l||this._toggleRecognizer(f,!1)}}}function _l(){}const gB=({isDragging:t})=>t?"grabbing":"grab",NS={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:_l,onResize:_l,onViewStateChange:_l,onInteractionStateChange:_l,onBeforeRender:_l,onAfterRender:_l,onLoad:_l,onError:t=>pn.error(t.message)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:gB,getTooltip:null,debug:!1,drawPickingColors:!1};class Mm{constructor(e){U(this,"props",void 0),U(this,"width",0),U(this,"height",0),U(this,"userData",{}),U(this,"canvas",null),U(this,"viewManager",null),U(this,"layerManager",null),U(this,"effectManager",null),U(this,"deckRenderer",null),U(this,"deckPicker",null),U(this,"eventManager",null),U(this,"tooltip",null),U(this,"metrics",void 0),U(this,"animationLoop",void 0),U(this,"stats",void 0),U(this,"viewState",void 0),U(this,"cursorState",void 0),U(this,"_needsRedraw",void 0),U(this,"_pickRequest",void 0),U(this,"_lastPointerDownInfo",null),U(this,"_metricsCounter",void 0),U(this,"_onPointerMove",n=>{const{_pickRequest:i}=this;if(n.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(n.leftButton||n.rightButton)return;{const o=n.offsetCenter;if(!o)return;i.x=o.x,i.y=o.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=n}),U(this,"_onEvent",n=>{const i=hw[n.type],o=n.offsetCenter;if(!i||!o||!this.layerManager)return;const u=this.layerManager.getLayers(),f=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:u,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:l}=f,b=l&&(l[i.handler]||l.props[i.handler]),T=this.props[i.handler];let C=!1;b&&(C=b.call(l,f,n)),!C&&T&&T(f,n)}),U(this,"_onPointerDown",n=>{const i=n.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo}),this.props={...NS,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&pn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),_T()==="IE"&&pn.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new tv({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&sd.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,i,o,u,f,l;if(this.animationLoop.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(e=this.layerManager)===null||e===void 0||e.finalize(),this.layerManager=null,(n=this.viewManager)===null||n===void 0||n.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(o=this.deckRenderer)===null||o===void 0||o.finalize(),this.deckRenderer=null,(u=this.deckPicker)===null||u===void 0||u.finalize(),this.deckPicker=null,(f=this.eventManager)===null||f===void 0||f.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var b;(b=this.canvas.parentElement)===null||b===void 0||b.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&pn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&pn.removed("onLayerClick","onClick")(),e.initialViewState&&!hu(this.props.initialViewState,e.initialViewState)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),o=this.layerManager.needsRedraw(e),u=this.effectManager.needsRedraw(e),f=this.deckRenderer.needsRedraw(e);return n=n||i||o||u||f,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Bi(this.viewManager),this.viewManager.views}getViewports(e){return Bi(this.viewManager),this.viewManager.getViewports(e)}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_pick(e,n,i){Bi(this.deckPicker);const{stats:o}=this;o.get("Pick Count").incrementCount(),o.get(n).timeStart();const u=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return o.get(n).timeEnd(),u}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Bi(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:i}=e;if(n||n===0){const u=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=u}if(i||i===0){var o;const u=Number.isFinite(i)?"".concat(i,"px"):i;this.canvas.style.position=((o=e.style)===null||o===void 0?void 0:o.position)||"absolute",this.canvas.style.height=u}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const n=e.clientWidth||e.width,i=e.clientHeight||e.height;if(n!==this.width||i!==this.height){var o;this.width=n,this.height=i,(o=this.viewManager)===null||o===void 0||o.setProps({width:n,height:i}),this.props.onResize({width:n,height:i})}}_createAnimationLoop(e){const{width:n,height:i,gl:o,glOptions:u,debug:f,onError:l,onBeforeRender:b,onAfterRender:T,useDevicePixels:C}=e;return new mD({width:n,height:i,useDevicePixels:C,autoResizeViewport:!1,gl:o,onCreateContext:L=>FT({...u,...L,canvas:this.canvas,debug:f,onContextLost:()=>this._onContextLost()}),onInitialize:L=>this._setGLContext(L.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:b,onAfterRender:T,onError:l})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new LS({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:i,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=i.length>0;let u=o,f=!1;for(const l of i){var n;u=l,f=((n=l.layer)===null||n===void 0?void 0:n.onHover(l,e.event))||f}if(!f&&this.props.onHover&&this.props.onHover(u,e.event),this.props.getTooltip&&this.tooltip){const l=this.props.getTooltip(u);this.tooltip.setTooltip(l,u.x,u.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,lv(e,{enable:!0,copyState:!0})),this.tooltip=new RF(this.canvas),jo(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new mS;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new mB(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in hw)this.eventManager.on(o,this._onEvent);this.viewManager=new Y4({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new Z4(e,{deck:this,stats:this.stats,viewport:i,timeline:n}),this.effectManager=new xF,this.deckRenderer=new SF(e),this.deckPicker=new kF(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:i}=this.layerManager.context;jo(i,this.props.parameters),this.props.onBeforeRender({gl:i}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",redrawReason:e,effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:i})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),pn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const i=Tl.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}U(Mm,"defaultProps",NS);U(Mm,"VERSION",xL.VERSION);class z_{constructor(e,n){U(this,"opts",void 0),U(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:i}=this.source,{size:o}=n;let u=i;if(i&&i.length!==o){u=new Float32Array(o);const f=n.elementOffset||0;for(let l=0;l<o;++l)u[l]=i[f+l]}return u}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function _B(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function _p(t){return t.stride||t.size*t.bytesPerElement}function US(t,e){e.offset&&pn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=_p(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,o=e.elementOffset||0,u=i*n+o*t.bytesPerElement+(t.offset||0);return{...e,offset:u,stride:n}}function yB(t,e){const n=US(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class vB{constructor(e,n,i){U(this,"gl",void 0),U(this,"id",void 0),U(this,"size",void 0),U(this,"settings",void 0),U(this,"value",void 0),U(this,"doublePrecision",void 0),U(this,"_buffer",void 0),U(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const o=n.logicalType||n.type,u=o===5130;let{defaultValue:f}=n;f=Number.isFinite(f)?[f]:f||new Array(this.size).fill(0);let l;u?l=5126:!o&&n.isIndexed?l=e&&$3(e,Rn.ELEMENT_INDEX_UINT32)?5125:5123:l=o||5126;let b=_B(o||l||5126);this.doublePrecision=u,u&&n.fp64===!1&&(b=Float32Array),this.value=null,this.settings={...n,defaultType:b,defaultValue:f,logicalType:o,type:l,size:this.size,bytesPerElement:b.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new wn(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*_p(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),sd.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const i={},o=this.value instanceof Float64Array,u=yB(this.getAccessor(),n||{});return i[e]=new z_(this,u.high),i["".concat(e,"64Low")]=o?new z_(this,u.low):new Float32Array(this.size),i}if(n){const i=US(this.getAccessor(),n);return{[e]:new z_(this,i)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:i,size:o}=this,u=i*o;if(n&&u&&n.length>=u){const f=new Array(o).fill(1/0),l=new Array(o).fill(-1/0);for(let b=0;b<u;)for(let T=0;T<o;T++){const C=n[b++];C<f[T]&&(f[T]=C),C>l[T]&&(l[T]=C)}e=[f,l]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof wn?i={buffer:e}:i=e;const o={...this.settings,...i};if(n.bufferAccessor=o,n.bounds=null,i.constant){let u=i.value;if(u=this._normalizeValue(u,[],0),this.settings.normalized&&(u=this.normalizeConstant(u)),!(!n.constant||!this._areValuesEqual(u,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=u}else if(i.buffer){const u=i.buffer;n.externalBuffer=u,n.constant=!1,this.value=i.value||null;const f=i.value instanceof Float64Array;o.type=i.type||u.accessor.type,o.bytesPerElement=u.accessor.BYTES_PER_ELEMENT*(f?2:1),o.stride=_p(o)}else if(i.value){this._checkExternalBuffer(i);let u=i.value;n.externalBuffer=null,n.constant=!1,this.value=u,o.bytesPerElement=u.BYTES_PER_ELEMENT,o.stride=_p(o);const{buffer:f,byteOffset:l}=this;this.doublePrecision&&u instanceof Float64Array&&(u=L_(u,o));const b=u.byteLength+l+o.stride*2;f.byteLength<b&&f.reallocate(b),f.setAccessor(null),f.subData({data:u,offset:l}),o.type=i.type||f.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:i=0,endOffset:o}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?L_(n,{size:this.size,startIndex:i,endIndex:o}):n.subarray(i,o),offset:i*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:i}=this,o=i.allocatedValue,u=sd.allocate(o,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=u;const{buffer:f,byteOffset:l}=this;return f.byteLength<u.byteLength+l&&(f.reallocate(u.byteLength+l),n&&o&&f.subData({data:o instanceof Float64Array?L_(o,this):o,offset:l})),i.allocatedValue=u,i.constant=!1,i.externalBuffer=null,i.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const i=this.settings.defaultType;let o=!1;if(this.doublePrecision&&(o=n.BYTES_PER_ELEMENT<4),o)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof i)&&this.settings.normalized&&!("normalized"in e)&&pn.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,i){const{defaultValue:o,size:u}=this.settings;if(Number.isFinite(e))return n[i]=e,n;if(!e)return n[i]=o[0],n;switch(u){case 4:n[i+3]=Number.isFinite(e[3])?e[3]:o[3];case 3:n[i+2]=Number.isFinite(e[2])?e[2]:o[2];case 2:n[i+1]=Number.isFinite(e[1])?e[1]:o[1];case 1:n[i+0]=Number.isFinite(e[0])?e[0]:o[0];break;default:let f=u;for(;--f>=0;)n[i+f]=Number.isFinite(e[f])?e[f]:o[f]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:i}=this;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}}const Fw=[],Bw=[];function VS(t,e=0,n=1/0){let i=Fw;const o={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(Bw.length=t.length,i=Bw):i=Fw,(e>0||Number.isFinite(n))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,n),o.index=e-1),{iterable:i,objectInfo:o}}function jS(t){return t&&t[Symbol.asyncIterator]}function xB(t,e){const{size:n,stride:i,offset:o,startIndices:u,nested:f}=e,l=t.BYTES_PER_ELEMENT,b=i?i/l:n,T=o?o/l:0,C=Math.floor((t.length-T)/b);return(L,{index:k,target:X})=>{if(!u){const J=k*b+T;for(let W=0;W<n;W++)X[W]=t[J+W];return X}const te=u[k],ie=u[k+1]||C;let ye;if(f){ye=new Array(ie-te);for(let J=te;J<ie;J++){const W=J*b+T;X=new Array(n);for(let Q=0;Q<n;Q++)X[Q]=t[W+Q];ye[J-te]=X}}else if(b===n)ye=t.subarray(te*n+T,ie*n+T);else{ye=new t.constructor((ie-te)*n);let J=0;for(let W=te;W<ie;W++){const Q=W*b+T;for(let _e=0;_e<n;_e++)ye[J++]=t[Q+_e]}}return ye}}const bB=[],yp=[[0,1/0]];function wB(t,e){if(t===yp||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],i=t.length;let o=0;for(let u=0;u<i;u++){const f=t[u];f[1]<e[0]?(n.push(f),o=u+1):f[0]>e[1]?n.push(f):e=[Math.min(f[0],e[0]),Math.max(f[1],e[1])]}return n.splice(o,0,e),n}function O_(t){const{source:e,target:n,start:i=0,size:o,getData:u}=t,f=t.end||n.length,l=e.length,b=f-i;if(l>b){n.set(e.subarray(0,b),i);return}if(n.set(e,i),!u)return;let T=l;for(;T<b;){const C=u(T,e);for(let L=0;L<o;L++)n[i+T]=C[L]||0,T++}}function EB({source:t,target:e,size:n,getData:i,sourceStartIndices:o,targetStartIndices:u}){if(!Array.isArray(u))return O_({source:t,target:e,size:n,getData:i}),e;let f=0,l=0;const b=i&&((C,L)=>i(C+l,L)),T=Math.min(o.length,u.length);for(let C=1;C<T;C++){const L=o[C]*n,k=u[C]*n;O_({source:t.subarray(f,L),target:e,start:l,end:k,size:n,getData:b}),f=L,l=k}return l<e.length&&O_({source:[],target:e,start:l,size:n,getData:b}),e}const TB={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function GS(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...TB[n],...e,...t,type:n}}function HS(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function $S(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function WS(t){t.push(t.shift())}function xv(t,e){const{doublePrecision:n,settings:i,value:o,size:u}=t,f=n&&o instanceof Float64Array?2:1;return(i.noAlloc?o.length:e*u)*f}function qS({buffer:t,numInstances:e,attribute:n,fromLength:i,fromStartIndices:o,getData:u=f=>f}){const f=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*f,b=n.byteOffset,T=n.startIndices,C=o&&T,L=xv(n,e),k=n.isConstant;if(!C&&i>=L)return;const X=k?n.value:n.getBuffer().getData({srcByteOffset:b});if(n.settings.normalized&&!k){const J=u;u=(W,Q)=>n.normalizeConstant(J(W,Q))}const te=k?(J,W)=>u(X,W):(J,W)=>u(X.subarray(J,J+l),W),ie=t.getData({length:i}),ye=new Float32Array(L);EB({source:ie,target:ye,sourceStartIndices:o,targetStartIndices:T,size:l,getData:te}),t.byteLength<ye.byteLength+b&&t.reallocate(ye.byteLength+b),t.subData({data:ye,offset:b})}class bv extends vB{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:yp}),U(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,i=this.settings.transition,o=Array.isArray(n)?e[n.find(u=>e[u])]:e[n];return GS(o,i)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:i=0,endRow:o=1/0}=n;this.state.updateRanges=wB(this.state.updateRanges,[i,o])}else this.state.updateRanges=yp}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=bB}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,n.updateRanges!==yp),!0):!1}updateBuffer({numInstances:e,data:n,props:i,context:o}){if(!this.needsUpdate())return!1;const{state:{updateRanges:u},settings:{update:f,noAlloc:l}}=this;let b=!0;if(f){for(const[T,C]of u)f.call(o,this,{data:n,startRow:T,endRow:C,props:i,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[T,C]of u){const L=Number.isFinite(T)?this.getVertexOffset(T):0,k=Number.isFinite(C)?this.getVertexOffset(C):l||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:L,endOffset:k})}this._checkAttributeArray()}else b=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),b}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:i,settings:o}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(o.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),o.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const f=e;Bi(ArrayBuffer.isView(f.value),"invalid ".concat(o.accessor));const l=Boolean(f.size)&&f.size!==this.size;return i.binaryAccessor=xB(f.value,{size:f.size||this.size,stride:f.stride,offset:f.offset,startIndices:n,nested:l}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?n[e]:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const i in e)Object.assign(n,super.getShaderAttributes(i,e[i]));return n}_autoUpdater(e,{data:n,startRow:i,endRow:o,props:u,numInstances:f}){if(e.constant)return;const{settings:l,state:b,value:T,size:C,startIndices:L}=e,{accessor:k,transform:X}=l,te=b.binaryAccessor||(typeof k=="function"?k:u[k]);Bi(typeof te=="function",'accessor "'.concat(k,'" is not a function'));let ie=e.getVertexOffset(i);const{iterable:ye,objectInfo:J}=VS(n,i,o);for(const W of ye){J.index++;let Q=te(W,J);if(X&&(Q=X.call(this,Q)),L){const _e=(J.index<L.length-1?L[J.index+1]:f)-L[J.index];if(Q&&Array.isArray(Q[0])){let we=ie;for(const Ce of Q)e._normalizeValue(Ce,T,we),we+=C}else Q&&Q.length>C?T.set(Q,ie):(e._normalizeValue(Q,J.target,0),H4({target:T,source:J.target,start:ie,count:_e}));ie+=_e*C}else e._normalizeValue(Q,T,ie),ie+=C}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let i=!0;switch(n){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class SB{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","interpolation"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.transition=new bd(i),this.attribute=n,this.attributeInTransition=new bv(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=IB(e,n);const o={byteLength:0,usage:35050};this.buffers=[new wn(e,o),new wn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:i,buffers:o,attribute:u}=this;WS(o);const f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)qS({buffer:l,...f});this.currentStartIndices=u.startIndices,this.currentLength=xv(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aFrom:o[0],aTo:HS(i,u)},feedbackBuffers:{vCurrent:o[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:i}=this.settings,{time:o}=this.transition;let u=o/n;i&&(u=i(u)),this.transform.run({uniforms:{time:u}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const AB=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function IB(t,e){const n=$S(e.size);return new mv(t,{vs:AB,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class PB{constructor({gl:e,attribute:n,timeline:i}){U(this,"gl",void 0),U(this,"type","spring"),U(this,"attributeInTransition",void 0),U(this,"settings",void 0),U(this,"attribute",void 0),U(this,"transition",void 0),U(this,"currentStartIndices",void 0),U(this,"currentLength",void 0),U(this,"texture",void 0),U(this,"framebuffer",void 0),U(this,"transform",void 0),U(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new bd(i),this.attribute=n,this.attributeInTransition=new bv(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=MB(e),this.framebuffer=kB(e,this.texture),this.transform=CB(e,n,this.framebuffer);const o={byteLength:0,usage:35050};this.buffers=[new wn(e,o),new wn(e,o),new wn(e,o)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:i,buffers:o,attribute:u}=this,f={numInstances:n,attribute:u,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const l of o)qS({buffer:l,...f});this.settings=e,this.currentStartIndices=u.startIndices,this.currentLength=xv(u,n),this.attributeInTransition.setData({buffer:o[1],value:u.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/u.size),sourceBuffers:{aTo:HS(i,u)}})}update(){const{buffers:e,transform:n,framebuffer:i,transition:o}=this;if(!o.update())return!1;const f=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:i,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:f.stiffness,damping:f.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),WS(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),Sm(i)[0]>0||o.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function CB(t,e,n){const i=$S(e.size);return new mv(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:i},varyings:["vNext"]})}function MB(t){return new _r(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function kB(t,e){return new hi(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{[36064]:e}})}const LB={interpolation:SB,spring:PB};class RB{constructor(e,{id:n,timeline:i}){U(this,"id",void 0),U(this,"isSupported",void 0),U(this,"gl",void 0),U(this,"timeline",void 0),U(this,"transitions",void 0),U(this,"needsRedraw",void 0),U(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=mv.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:i}){this.numInstances=i||1;for(const o in e){const u=e[o],f=u.getTransitionSetting(n);!f||this._updateAttribute(o,u,f)}for(const o in this.transitions){const u=e[o];(!u||!u.getTransitionSetting(n))&&this._removeTransition(o)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const i=this.transitions[n];i.inProgress&&(e[n]=i.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,i){const o=this.transitions[e];let u=!o||o.type!==i.type;if(u){if(!this.isSupported){pn.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}o&&this._removeTransition(e);const f=LB[i.type];f?this.transitions[e]=new f({attribute:n,timeline:this.timeline,gl:this.gl}):(pn.error("unsupported transition type '".concat(i.type,"'"))(),u=!1)}(u||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Nw="attributeManager.invalidate",DB="attributeManager.updateStart",zB="attributeManager.updateEnd",OB="attribute.updateStart",FB="attribute.allocate",BB="attribute.updateEnd";class NB{constructor(e,{id:n="attribute-manager",stats:i,timeline:o}={}){U(this,"id",void 0),U(this,"gl",void 0),U(this,"attributes",void 0),U(this,"updateTriggers",void 0),U(this,"needsRedraw",void 0),U(this,"userData",void 0),U(this,"stats",void 0),U(this,"attributeTransitionManager",void 0),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new RB(e,{id:"".concat(n,"-transitions"),timeline:o}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const i=this._invalidateTrigger(e,n);pr(Nw,this,e,i)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);pr(Nw,this,"all")}update({data:e,numInstances:n,startIndices:i=null,transitions:o,props:u={},buffers:f={},context:l={}}){let b=!1;pr(DB,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const T in this.attributes){const C=this.attributes[T],L=C.settings.accessor;C.startIndices=i,C.numInstances=n,u[T]&&pn.removed("props.".concat(T),"data.attributes.".concat(T))(),C.setExternalBuffer(f[T])||C.setBinaryValue(typeof L=="string"?f[L]:void 0,e.startIndices)||typeof L=="string"&&!f[L]&&C.setConstantValue(u[L])||C.needsUpdate()&&(b=!0,this._updateAttribute({attribute:C,numInstances:n,data:e,props:u,context:l})),this.needsRedraw=this.needsRedraw||C.needsRedraw()}b&&pr(zB,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:o})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:i}=this,o={...i.getAttributes()};for(const u in n){const f=n[u];f.needsRedraw(e)&&!i.hasAttribute(u)&&(o[u]=f)}return o}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const i={};for(const o in e)n[o]||Object.assign(i,e[o].getShaderAttributes());return i}_add(e,n={}){for(const i in e){const o=e[i];this.attributes[i]=this._createAttribute(i,o,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,i){const o={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:i.instanced?1:n.divisor||0};return new bv(this.gl,o)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(o=>{e[o]||(e[o]=[]),e[o].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:i,updateTriggers:o}=this,u=o[e];return u&&u.forEach(f=>{const l=i[f];l&&l.setNeedsUpdate(l.id,n)}),u}_updateAttribute(e){const{attribute:n,numInstances:i}=e;if(pr(OB,n),n.constant){n.setConstantValue(n.value);return}n.allocate(i)&&pr(FB,n,i),n.updateBuffer(e)&&(this.needsRedraw=!0,pr(BB,n,i))}}class UB extends bd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:i,duration:o,easing:u}}=this,f=u(e/o);this._value=Zp(n,i,f)}}const Uw=1e-5;function Vw(t,e,n,i,o){const u=e-t,l=(n-e)*o,b=-u*i;return l+b+u+e}function VB(t,e,n,i,o){if(Array.isArray(n)){const u=[];for(let f=0;f<n.length;f++)u[f]=Vw(t[f],e[f],n[f],i,o);return u}return Vw(t,e,n,i,o)}function jw(t,e){if(Array.isArray(t)){let n=0;for(let i=0;i<t.length;i++){const o=t[i]-e[i];n+=o*o}return Math.sqrt(n)}return Math.abs(t-e)}class jB extends bd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:i,stiffness:o}=this.settings,{_prevValue:u=e,_currValue:f=e}=this;let l=VB(u,f,n,i,o);const b=jw(l,n),T=jw(l,f);b<Uw&&T<Uw&&(l=n,this.end()),this._prevValue=f,this._currValue=l}}const GB={interpolation:UB,spring:jB};class HB{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,i,o){const{transitions:u}=this;if(u.has(e)){const b=u.get(e),{value:T=b.settings.fromValue}=b;n=T,this.remove(e)}if(o=GS(o),!o)return;const f=GB[o.type];if(!f){pn.error("unsupported transition type '".concat(o.type,"'"))();return}const l=new f(this.timeline);l.start({...o,fromValue:n,toValue:i}),u.set(e,l)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,i]of this.transitions)i.update(),e[n]=i.value,i.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function $B(t){const e=wv(t);for(const n in e){const i=e[n],{validate:o}=i;if(o&&!o(t[n],i))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function WB(t,e){const n=XS({newProps:t,oldProps:e,propTypes:wv(t),ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=XB(t,e);let o=!1;return i||(o=ZB(t,e)),{dataChanged:i,propsChanged:n,updateTriggersChanged:o,extensionsChanged:YB(t,e),transitionsChanged:qB(t,e)}}function qB(t,e){if(!t.transitions)return!1;const n={},i=wv(t);let o=!1;for(const u in t.transitions){const f=i[u],l=f&&f.type;(l==="number"||l==="color"||l==="array")&&i0(t[u],e[u],f)&&(n[u]=!0,o=!0)}return o?n:!1}function XS({newProps:t,oldProps:e,ignoreProps:n={},propTypes:i={},triggerName:o="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(o," changed shallowly");for(const u of Object.keys(t))if(!(u in n)){if(!(u in e))return"".concat(o,".").concat(u," added");const f=i0(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}for(const u of Object.keys(e))if(!(u in n)){if(!(u in t))return"".concat(o,".").concat(u," dropped");if(!Object.hasOwnProperty.call(t,u)){const f=i0(t[u],e[u],i[u]);if(f)return"".concat(o,".").concat(u," ").concat(f)}}return!1}function i0(t,e,n){let i=n&&n.equal;return i&&!i(t,e,n)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function XB(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:i,_dataDiff:o}=t;return i?i(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&o&&(n=o(t.data,e.data)||n),n}function ZB(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Gw(t,e,"all"))return{all:!0};const n={};let i=!1;for(const o in t.updateTriggers)o!=="all"&&Gw(t,e,o)&&(n[o]=!0,i=!0);return i?n:!1}function YB(t,e){if(e===null)return!0;const n=e.extensions,{extensions:i}=t;if(i===n)return!1;if(!n||!i||i.length!==n.length)return!0;for(let o=0;o<i.length;o++)if(!i[o].equals(n[o]))return!0;return!1}function Gw(t,e,n){let i=t.updateTriggers[n];i=i==null?{}:i;let o=e.updateTriggers[n];return o=o==null?{}:o,XS({oldProps:o,newProps:i,triggerName:n})}function wv(t){const e=t[tm],n=e&&e.constructor;return n?n._propTypes:{}}const KB="count(): argument not an object",JB="count(): argument not a container";function QB(t){if(!t5(t))throw new Error(KB);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(e5(t))return Object.keys(t).length;throw new Error(JB)}function e5(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function t5(t){return t!==null&&typeof t=="object"}function n5(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=n.modules.findIndex(o=>o.name==="project32");i>=0&&n.modules.splice(i,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const i={...t.inject};for(const o in e.inject)i[o]=(i[o]||"")+e.inject[o];n.inject=i}return n}const i5={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071},r0={};function r5(t,e){const n=t.context&&t.context.gl;if(!n||!e)return null;if(e instanceof _r)return e;e.constructor&&e.constructor.name!=="Object"&&(e={data:e});let i=null;e.compressed&&(i={[10241]:e.data.length>1?9985:9729});const o=new _r(n,{...e,parameters:{...i5,...i,...t.props.textureParameters}});return r0[o.id]=!0,o}function s5(t){!t||!(t instanceof _r)||r0[t.id]&&(t.delete(),delete r0[t.id])}const o5={boolean:{validate(t,e){return!0},equal(t,e,n){return Boolean(t)===Boolean(e)}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||od(t)&&(t.length===3||t.length===4)},equal(t,e,n){return F_(t,e)}},accessor:{validate(t,e){const n=im(t);return n==="function"||n===im(e.value)},equal(t,e,n){return typeof e=="function"?!0:F_(t,e)}},array:{validate(t,e){return e.optional&&!t||od(t)},equal(t,e,n){return n.compare?F_(t,e):t===e}},object:{equal(t,e,n){return n.compare?hu(t,e):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:i}=n.props;return i&&t?i(t):t}},image:{transform:(t,e,n)=>r5(n,t),release:t=>{s5(t)}}};function F_(t,e){if(t===e)return!0;if(!od(t)||!od(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}function a5(t){const e={},n={},i={};for(const[o,u]of Object.entries(t)){const f=u==null?void 0:u.deprecatedFor;if(f)i[o]=Array.isArray(f)?f:[f];else{const l=l5(o,u);e[o]=l,n[o]=l.value}}return{propTypes:e,defaultProps:n,deprecatedProps:i}}function l5(t,e){switch(im(e)){case"object":return yh(t,e);case"array":return yh(t,{type:"array",value:e,compare:!1});case"boolean":return yh(t,{type:"boolean",value:e});case"number":return yh(t,{type:"number",value:e});case"function":return yh(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function yh(t,e){return"type"in e?{name:t,...o5[e.type],...e}:"value"in e?{name:t,type:im(e.value),...e}:{name:t,type:"object",value:e}}function od(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function im(t){return od(t)?"array":t===null?"null":typeof t}function c5(t,e){const n=ZS(t.constructor),i=Object.create(n);i[tm]=t,i[Dl]={},i[Aa]={};for(let o=0;o<e.length;++o){const u=e[o];for(const f in u)i[f]=u[f]}return Object.freeze(i),i}function ZS(t){const e=rm(t,"_mergedDefaultProps");return e||(u5(t),t._mergedDefaultProps)}function u5(t){if(!t.prototype)return;const n=Object.getPrototypeOf(t),i=ZS(n),o=rm(t,"defaultProps")||{},u=a5(o),f=h5(u.defaultProps,i,t),l={...n._propTypes,...u.propTypes};f5(f,l);const b={...n._deprecatedProps,...u.deprecatedProps};d5(f,b),t._mergedDefaultProps=f,t._propTypes=l,t._deprecatedProps=b}function h5(t,e,n){const i=Object.create(null);Object.assign(i,e,t);const o=m5(n);return delete t.id,Object.defineProperties(i,{id:{writable:!0,value:o}}),i}function d5(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(i){const o="".concat(this.id,": ").concat(n);for(const u of e[n])YS(this,u)||(this[u]=i);pn.deprecated(o,e[n].join("/"))()}})}function f5(t,e){const n={},i={};for(const o in e){const u=e[o],{name:f,value:l}=u;u.async&&(n[f]=l,i[f]=p5(f))}t[Gc]=n,t[Dl]={},Object.defineProperties(t,i)}function p5(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||jS(e)?this[Dl][t]=e:this[Aa][t]=e},get(){if(this[Aa]){if(t in this[Aa])return this[Aa][t]||this[Gc][t];if(t in this[Dl]){const e=this[tm]&&this[tm].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Gc][t]}}return this[Gc][t]}}}function YS(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function rm(t,e){return YS(t,e)&&t[e]}function m5(t){const e=rm(t,"layerName")||rm(t,"componentName");return e||pn.once(0,"".concat(t.name,".componentName not specified"))(),e||t.name}let g5=0;class Ev{constructor(...e){U(this,"id",void 0),U(this,"props",void 0),U(this,"count",void 0),this.props=c5(this,e),this.id=this.props.id,this.count=g5++}clone(e){const{props:n}=this,i={};for(const o in n[Gc])o in n[Aa]?i[o]=n[Aa][o]:o in n[Dl]&&(i[o]=n[Dl][o]);return new this.constructor({...n,...i,...e})}}U(Ev,"componentName","Component");U(Ev,"defaultProps",{});const _5=Object.freeze({});class y5{constructor(e){U(this,"component",void 0),U(this,"onAsyncPropUpdated",void 0),U(this,"asyncProps",void 0),U(this,"oldProps",void 0),U(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}}getOldProps(){return this.oldAsyncProps||this.oldProps||_5}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component.props}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return Boolean(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){const n=e[Aa]||{},i=e[Dl]||e,o=e[Gc]||{};for(const u in n){const f=n[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f),n[u]=this.getAsyncProp(u)}for(const u in i){const f=i[u];this._createAsyncPropData(u,o[u]),this._updateAsyncProp(u,f)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(!!this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(jS(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const i=this.asyncProps[e];return n===i.resolvedValue||n===i.lastValue?!1:(i.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(n=this._postProcessValue(i,n),i.resolvedValue=n,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,n,i){const o=this.asyncProps[e];o&&i>=o.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),o.resolvedValue=n,o.resolvedLoadCount=i,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const o=i.pendingLoadCount;n.then(u=>{u=this._postProcessValue(i,u),this._setAsyncPropValue(e,u,o),this._onResolve(e,u)}).catch(u=>{this._onError(e,u)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const o=i.pendingLoadCount;let u=[],f=0;for await(const l of n){const{dataTransform:b}=this.component.props;b?u=b(l,u):u=u.concat(l),Object.defineProperty(u,"__diff",{enumerable:!1,value:[{startRow:f,endRow:u.length}]}),f=u.length,this._setAsyncPropValue(e,u,o)}this._onResolve(e,u)}_postProcessValue(e,n){const i=e.type;return i&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(n,i,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const o=this.component&&this.component.constructor._propTypes;this.asyncProps[e]={type:o&&o[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class v5 extends y5{constructor({attributeManager:e,layer:n}){super(n),U(this,"attributeManager",void 0),U(this,"needsRedraw",void 0),U(this,"needsUpdate",void 0),U(this,"subLayers",void 0),U(this,"usesPickingColorCache",void 0),U(this,"changeFlags",void 0),U(this,"viewport",void 0),U(this,"uniformTransitions",void 0),U(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}set layer(e){this.component=e}_fetch(e,n){const i=this.component.props.fetch;return i?i(n,{propName:e,layer:this.layer}):super._fetch(e,n)}_onResolve(e,n){const i=this.component.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:this.layer})}_onError(e,n){this.layer.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const x5="layer.changeFlag",b5="layer.initialize",w5="layer.update",E5="layer.finalize",T5="layer.matched",Hw=2**24-1,S5=Object.freeze([]),A5=Am(({oldViewport:t,viewport:e})=>t.equals(e));let so=new Uint8ClampedArray(0);const I5={data:{type:"data",value:S5,async:!0},dataComparator:{type:"function",value:null,compare:!1,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,compare:!1,optional:!0},dataTransform:{type:"function",value:null,compare:!1,optional:!0},onDataLoad:{type:"function",value:null,compare:!1,optional:!0},onError:{type:"function",value:null,compare:!1,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:i,loadOptions:o,signal:u})=>{const{resourceManager:f}=n.context;if(o=o||n.getLoadOptions(),i=i||n.props.loaders,u){var l;o={...o,fetch:{...(l=o)===null||l===void 0?void 0:l.fetch,signal:u}}}let b=f.contains(t);return!b&&!o&&(f.add({resourceId:t,data:Wp(t,i),persistent:!1}),b=!0),b?f.subscribe({resourceId:t,onChange:T=>{var C;return(C=n.internalState)===null||C===void 0?void 0:C.reloadAsyncProp(e,T)},consumerId:n.id,requestId:e}):Wp(t,i,o)},compare:!1},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:xd.DRAW,onHover:{type:"function",value:null,compare:!1,optional:!0},onClick:{type:"function",value:null,compare:!1,optional:!0},onDragStart:{type:"function",value:null,compare:!1,optional:!0},onDrag:{type:"function",value:null,compare:!1,optional:!0},onDragEnd:{type:"function",value:null,compare:!1,optional:!0},coordinateSystem:fn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,compare:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100],compare:!1},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class km extends Ev{constructor(...e){super(...e),U(this,"internalState",null),U(this,"lifecycle",bc.NO_STATE),U(this,"context",void 0),U(this,"state",void 0),U(this,"parent",null)}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Bi(this.internalState);const n=this.internalState.viewport||this.context.viewport,i=IS(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[o,u,f]=ES(i,n.pixelProjectionMatrix);return e.length===2?[o,u]:[o,u,f]}unproject(e){return Bi(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Bi(this.internalState);const i=this.internalState.viewport||this.context.viewport;return G4(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===fn.DEFAULT||e===fn.LNGLAT||e===fn.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Bi(e instanceof Uint8Array);const[n,i,o]=e;return n+i*256+o*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:QB(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;const n=this.getAttributeManager();if(!n)return null;const{positions:i,instancePositions:o}=n.attributes;return(e=i||o)===null||e===void 0?void 0:e.getBounds()}getShaders(e){for(const n of this.props.extensions)e=n5(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&n)if(Array.isArray(i))for(const b of i)n.invalidateAll(b);else n.invalidateAll();const{props:o,oldProps:u}=e,f=Number.isInteger(u.highlightedObjectIndex)||u.pickable,l=Number.isInteger(o.highlightedObjectIndex)||o.pickable;if(f!==l&&n){const{pickingColors:b,instancePickingColors:T}=n.attributes,C=b||T;C&&(l&&C.constant&&(C.constant=!1,n.invalidate(C.id)),!C.value&&!l&&(C.constant=!0,C.value=[0,0,0]))}}finalizeState(e){for(const i of this.getModels())i.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:i}){const{index:o}=e;return o>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[o]),e}raiseError(e,n){var i,o;if(n&&(e.message="".concat(n,": ").concat(e.message)),!((i=(o=this.props).onError)!==null&&i!==void 0&&i.call(o,e))){var u,f;(u=this.context)===null||u===void 0||(f=u.onError)===null||f===void 0||f.call(u,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!A5({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();!n||(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,i=this.getNumInstances(),o=this.getStartIndices();e.update({data:n.data,numInstances:i,startIndices:o,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const u=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(u)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),i=Object.create(this.props);for(const o in n)Object.defineProperty(i,o,{value:n[o]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const i=Math.floor(so.length/3);if(this.internalState.usesPickingColorCache=!0,i<n){n>Hw&&pn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),so=sd.allocate(so,n,{size:3,copy:!0,maxCount:Math.max(n,Hw)});const o=Math.floor(so.length/3),u=[];for(let f=i;f<o;f++)this.encodePickingColor(f,u),so[f*3+0]=u[0],so[f*3+1]=u[1],so[f*3+2]=u[2]}e.value=so.subarray(0,n*3)}_setModelAttributes(e,n){const i=this.getAttributeManager(),o=e.userData.excludeAttributes||{},u=i.getShaderAttributes(n,o);e.setAttributes(u)}disablePickingIndex(e){this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:i}=this.getAttributeManager().attributes,o=n||i;if(!o)return;const u=o.getVertexOffset(e),f=o.getVertexOffset(e+1);o.buffer.subData({data:new Uint8Array(f-u),offset:u})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,i=e||n;!i||(this.internalState.usesPickingColorCache&&i.value.buffer!==so.buffer&&(i.value=so.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Bi(!this.internalState),Bi(Number.isFinite(this.props.coordinateSystem)),pr(b5,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new v5({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(pn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.layer=this,this.internalState.uniformTransitions=new HB(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){pr(T5,this,this===e);const{state:n,internalState:i}=e;this!==e&&(this.internalState=i,this.internalState.layer=this,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(pr(w5,this,e),!e)return;const n=this.props,i=this.context,o=this.internalState,u=i.viewport,f=this._updateUniformTransition();o.propsInTransition=f,i.viewport=o.viewport||u,this.props=f;try{const l=this._getUpdateParams(),b=this.getModels();if(i.gl)this.updateState(l);else try{this.updateState(l)}catch{}for(const C of this.props.extensions)C.updateState.call(this,l,C);const T=this.getModels()[0]!==b[0];this._postUpdate(l,T)}finally{i.viewport=u,this.props=n,this._clearChangeFlags(),o.needsUpdate=!1,o.resetOldProps()}}_finalize(){pr(E5,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:i={}}){this._updateAttributeTransition();const o=this.props,u=this.context;this.props=this.internalState.propsInTransition||o;const f=this.props.opacity;n.opacity=Math.pow(f,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:l}=this.props,b=l&&l(n)||[0,0];jo(u.gl,{polygonOffset:b}),vs(u.gl,i,()=>{const T={moduleParameters:e,uniforms:n,parameters:i,context:u};for(const C of this.props.extensions)C.draw.call(this,T,C);this.draw(T)})}finally{this.props=o}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const o in e)if(e[o]){let u=!1;switch(o){case"dataChanged":const f=e[o],l=n[o];f&&Array.isArray(l)&&(n.dataChanged=Array.isArray(f)?l.concat(f):f,u=!0);default:n[o]||(n[o]=e[o],u=!0)}u&&pr(x5,this,o,e)}const i=Boolean(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=i,n.somethingChanged=i||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const i=WB(e,n);if(i.updateTriggersChanged)for(const u in i.updateTriggersChanged)i.updateTriggersChanged[u]&&this.invalidateAttribute(u);if(i.transitionsChanged)for(const u in i.transitionsChanged){var o;this.internalState.uniformTransitions.add(u,n[u],e[u],(o=e.transitions)===null||o===void 0?void 0:o[u])}return this.setChangeFlags(i)}validateProps(){$B(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(n.pickingHighlightColor=i(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new NB(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:i,oldProps:o}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:u}=this.state;u==null||u.setInstanceCount(this.getNumInstances());const{autoHighlight:f,highlightedObjectIndex:l,highlightColor:b}=i;if(n||o.autoHighlight!==f||o.highlightedObjectIndex!==l||o.highlightColor!==b){const T={};f||(T.pickingSelectedColor=null),Array.isArray(b)&&(T.pickingHighlightColor=b),Number.isInteger(l)&&(T.pickingSelectedColor=Number.isFinite(l)&&l>=0?this.encodePickingColor(l):null),this.setModuleParameters(T)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id,this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags;const i=this.getAttributeManager(),o=i?i.getNeedsRedraw(e):!1;return n=n||o,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}U(km,"defaultProps",I5);U(km,"layerName","Layer");const P5=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  // convert size in meters to pixels, then scaled and clamp
 
  // project meters to pixels and clamp to limits 
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );

  // scale icon height to match instanceSize
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;

  // scale and rotate vertex in "pixel" value and convert back to fraction in clipspace
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,C5=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);

  // if colorMode == 0, use pixel color from the texture
  // if colorMode == 1 or rendering picking buffer, use texture as transparency mask
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  // Take the global opacity and the alpha from vColor into account for the alpha component
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,M5=1024,k5=4,$w=()=>{},Ww={[10241]:9987,[10240]:9729,[10242]:33071,[10243]:33071};function L5(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function R5(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}function ad(t){return t&&(t.id||t.url)}function D5(t,e,n,i){const o=t.width,u=t.height,f=new _r(t.gl,{width:e,height:n,parameters:i});return V3(t,f,{targetY:0,width:o,height:u}),t.delete(),f}function qw(t,e,n){for(let i=0;i<e.length;i++){const{icon:o,xOffset:u}=e[i],f=ad(o);t[f]={...o,x:u,y:n}}}function z5({icons:t,buffer:e,mapping:n={},xOffset:i=0,yOffset:o=0,rowHeight:u=0,canvasWidth:f}){let l=[];for(let b=0;b<t.length;b++){const T=t[b],C=ad(T);if(!n[C]){const{height:L,width:k}=T;i+k+e>f&&(qw(n,l,o),i=0,o=u+o+e,u=0,l=[]),l.push({icon:T,xOffset:i}),i=i+k+e,u=Math.max(u,L)}}return l.length>0&&qw(n,l,o),{mapping:n,rowHeight:u,xOffset:i,yOffset:o,canvasWidth:f,canvasHeight:L5(u+o+e)}}function O5(t,e,n){if(!t||!e)return null;n=n||{};const i={},{iterable:o,objectInfo:u}=VS(t);for(const f of o){u.index++;const l=e(f,u),b=ad(l);if(!l)throw new Error("Icon is missing.");if(!l.url)throw new Error("Icon url is missing.");!i[b]&&(!n[b]||l.url!==n[b].url)&&(i[b]={...l,source:f,sourceIndex:u.index})}return i}class F5{constructor(e,{onUpdate:n=$w,onError:i=$w}){U(this,"gl",void 0),U(this,"onUpdate",void 0),U(this,"onError",void 0),U(this,"_loadOptions",null),U(this,"_texture",null),U(this,"_externalTexture",null),U(this,"_mapping",{}),U(this,"_textureParameters",null),U(this,"_pendingCount",0),U(this,"_autoPacking",!1),U(this,"_xOffset",0),U(this,"_yOffset",0),U(this,"_rowHeight",0),U(this,"_buffer",k5),U(this,"_canvasWidth",M5),U(this,"_canvasHeight",0),U(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=i}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?ad(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:i,iconMapping:o,textureParameters:u}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),o&&(this._mapping=o),i){var f;(f=this._texture)===null||f===void 0||f.delete(),this._texture=null,this._externalTexture=i}u&&(this._textureParameters=u)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const i=Object.values(O5(e,n,this._mapping)||{});if(i.length>0){const{mapping:o,xOffset:u,yOffset:f,rowHeight:l,canvasHeight:b}=z5({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=l,this._mapping=o,this._xOffset=u,this._yOffset=f,this._canvasHeight=b,this._texture||(this._texture=new _r(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Ww})),this._texture.height!==this._canvasHeight&&(this._texture=D5(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Ww)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){const n=this._canvas.getContext("2d");for(const i of e)this._pendingCount++,Wp(i.url,kT,this._loadOptions).then(o=>{const u=ad(i),{x:f,y:l,width:b,height:T}=this._mapping[u],C=R5(n,o,b,T);this._texture.setSubImageData({data:C,x:f,y:l,width:b,height:T}),this._texture.generateMipmap(),this.onUpdate()}).catch(o=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:o})}).finally(()=>{this._pendingCount--})}}const KS=[0,0,0,255],B5={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:KS},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,compare:!1,optional:!0}};class Tv extends km{constructor(...e){super(...e),U(this,"state",void 0)}getShaders(){return super.getShaders({vs:P5,fs:C5,modules:[$O,d4]})}initializeState(){this.state={iconManager:new F5(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:KS},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:i,changeFlags:o}=e,u=this.getAttributeManager(),{iconAtlas:f,iconMapping:l,data:b,getIcon:T,textureParameters:C}=n,{iconManager:L}=this.state,k=f||this.internalState.isAsyncPropLoading("iconAtlas");if(L.setProps({loadOptions:n.loadOptions,autoPacking:!k,iconAtlas:f,iconMapping:k?l:null,textureParameters:C}),k?i.iconMapping!==n.iconMapping&&u.invalidate("getIcon"):(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&L.packIcons(b,T),o.extensionsChanged){var X;const{gl:te}=this.context;(X=this.state.model)===null||X===void 0||X.delete(),this.state.model=this._getModel(te),u.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,sizeUnits:u,billboard:f,alphaCutoff:l}=this.props,{iconManager:b}=this.state,T=b.getTexture();T&&this.state.model.setUniforms(e).setUniforms({iconsTexture:T,iconsTextureDim:[T.width,T.height],sizeUnits:qy[u],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o,billboard:f,alphaCutoff:l}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new pS(e,{...this.getShaders(),id:this.props.id,geometry:new SO({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const i=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;i?i(e):pn.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:i,anchorX:o=n/2,anchorY:u=i/2}=this.state.iconManager.getIconMapping(e);return[n/2-o,i/2-u]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:i,width:o,height:u}=this.state.iconManager.getIconMapping(e);return[n,i,o,u]}}U(Tv,"defaultProps",B5);U(Tv,"layerName","IconLayer");const N5=typeof window<"u"?ft.exports.useLayoutEffect:ft.exports.useEffect,U5=N5;function sm(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const V5={position:"absolute",zIndex:-1};function JS(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>JS(n,e));if(Lm(t)){if(j5(t))return e.style=V5,ft.exports.cloneElement(t,e);if(G5(t))return ft.exports.cloneElement(t,e)}return t}function Lm(t){return t&&typeof t=="object"&&"type"in t||!1}function j5(t){const e=t.type,n=e&&e.defaultProps;return n&&n.mapStyle}function G5(t){const e=t.type;return e&&e.deckGLViewProps}function s0(t){if(typeof t=="function")return ft.exports.createElement(zl,{},t);if(Array.isArray(t))return t.map(s0);if(Lm(t)){if(t.type===ft.exports.Fragment)return s0(t.props.children);if(sm(t.type,zl))return t}return t}function H5({children:t,layers:e=[],views:n=null}){const i=[],o=[],u={};return ft.exports.Children.forEach(s0(t),f=>{if(Lm(f)){const l=f.type;if(sm(l,km)){const b=$5(l,f.props);o.push(b)}else i.push(f);if(sm(l,zl)&&l!==zl&&f.props.id){const b=new l(f.props);u[b.id]=b}}else f&&i.push(f)}),Object.keys(u).length>0&&(Array.isArray(n)?n.forEach(f=>{u[f.id]=f}):n&&(u[n.id]=n),n=Object.values(u)),e=o.length>0?[...o,...e]:e,{layers:e,children:i,views:n}}function $5(t,e){const n={},i=t.defaultProps||{};for(const o in e)i[o]!==e[o]&&(n[o]=e[o]);return new t(n)}function W5({children:t,deck:e,ContextProvider:n}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const o={},u=i.views[0].id;for(const f of t){let l=u,b=f;Lm(f)&&sm(f.type,zl)&&(l=f.props.id||u,b=f.props.children);const T=i.getViewport(l),C=i.getViewState(l);if(T){C.padding=T.padding;const{x:L,y:k,width:X,height:te}=T;b=JS(b,{x:L,y:k,width:X,height:te,viewport:T,viewState:C}),o[l]||(o[l]={viewport:T,children:[]}),o[l].children.push(b)}}return Object.keys(o).map(f=>{const{viewport:l,children:b}=o[f],{x:T,y:C,width:L,height:k}=l,X={position:"absolute",left:T,top:C,width:L,height:k},te="view-".concat(f),ie=ft.exports.createElement("div",{key:te,id:te,style:X},...b);if(n){const ye={viewport:l,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:J=>{J.viewId=f,e._onViewStateChange(J)}};return ft.exports.createElement(n,{key:te,value:ye},ie)}return ie})}const q5={mixBlendMode:null};function X5({width:t,height:e,style:n}){const i={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},o={left:0,top:0};if(n)for(const u in n)u in q5?o[u]=n[u]:i[u]=n[u];return{containerStyle:i,canvasStyle:o}}function Z5(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function QS(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function Y5(t,e,n){const i=new e({...n,_customRender:o=>{t.redrawReason=o;const u=i.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():QS(t)}});return i}const eA=ft.exports.forwardRef((t,e)=>{const[n,i]=ft.exports.useState(0),u=ft.exports.useRef({control:null,version:n,forceUpdate:()=>i(we=>we+1)}).current,f=ft.exports.useRef(null),l=ft.exports.useRef(null),b=ft.exports.useMemo(()=>H5(t),[t.layers,t.views,t.children]);let T=!0;const C=we=>{var Ce;return T&&t.viewState?(u.viewStateUpdateRequested=we,null):(u.viewStateUpdateRequested=null,(Ce=t.onViewStateChange)===null||Ce===void 0?void 0:Ce.call(t,we))},L=we=>{if(T)u.interactionStateUpdateRequested=we;else{var Ce;u.interactionStateUpdateRequested=null,(Ce=t.onInteractionStateChange)===null||Ce===void 0||Ce.call(t,we)}},k=ft.exports.useMemo(()=>{const we={...t,style:null,width:"100%",height:"100%",parent:f.current,canvas:l.current,layers:b.layers,views:b.views,onViewStateChange:C,onInteractionStateChange:L};return delete we._customRender,u.deck&&u.deck.setProps(we),we},[t]);ft.exports.useEffect(()=>{const we=t.Deck||Mm;return u.deck=Y5(u,we,{...k,parent:f.current,canvas:l.current}),()=>{var Ce;return(Ce=u.deck)===null||Ce===void 0?void 0:Ce.finalize()}},[]),U5(()=>{QS(u);const{viewStateUpdateRequested:we,interactionStateUpdateRequested:Ce}=u;we&&C(we),Ce&&L(Ce)}),ft.exports.useImperativeHandle(e,()=>Z5(u),[]);const X=u.deck&&u.deck.isInitialized?u.deck.getViewports():void 0,{ContextProvider:te,width:ie,height:ye,id:J,style:W}=t,{containerStyle:Q,canvasStyle:_e}=ft.exports.useMemo(()=>X5({width:ie,height:ye,style:W}),[ie,ye,W]);if(!u.viewStateUpdateRequested&&u.lastRenderedViewports===X||u.version!==n){u.lastRenderedViewports=X,u.version=n;const we=W5({children:b.children,deck:u.deck,ContextProvider:te}),Ce=ft.exports.createElement("canvas",{key:"canvas",id:J||"deckgl-overlay",ref:l,style:_e});u.control=ft.exports.createElement("div",{id:"".concat(J||"deckgl","-wrapper"),ref:f,style:Q},[Ce,we])}return T=!1,u.control});eA.defaultProps=Mm.defaultProps;const K5=eA;var tA={exports:{}};(function(t,e){(function(n,i){t.exports=i()})(KI,function(){var n,i,o;function u(l,b){if(!n)n=b;else if(!i)i=b;else{var T="var sharedChunk = {}; ("+n+")(sharedChunk); ("+i+")(sharedChunk);",C={};n(C),o=b(C),typeof window<"u"&&(o.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}u(["exports"],function(l){var b=T;function T(a,r,c,d){this.cx=3*a,this.bx=3*(c-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=c,this.p2y=d}function C(a,r,c,d){const g=new b(a,r,c,d);return function(y){return g.solve(y)}}T.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var c=a,d=0;d<8;d++){var g=this.sampleCurveX(c)-a;if(Math.abs(g)<r)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=g/y}var x=0,E=1;for(c=a,d=0;d<20&&(g=this.sampleCurveX(c),!(Math.abs(g-a)<r));d++)a>g?x=c:E=c,c=.5*(E-x)+x;return c},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};const L=C(.25,.1,.25,1);function k(a,r,c){return Math.min(c,Math.max(r,a))}function X(a,r,c){const d=c-r,g=((a-r)%d+d)%d+r;return g===r?c:g}function te(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}let ie=1;function ye(a,r){a.forEach(c=>{r[c]&&(r[c]=r[c].bind(r))})}function J(a,r,c){const d={};for(const g in a)d[g]=r.call(c||this,a[g],g,a);return d}function W(a,r,c){const d={};for(const g in a)r.call(c||this,a[g],g,a)&&(d[g]=a[g]);return d}function Q(a){return Array.isArray(a)?a.map(Q):typeof a=="object"&&a?J(a,Q):a}const _e={};function we(a){_e[a]||(typeof console<"u"&&console.warn(a),_e[a]=!0)}function Ce(a,r,c){return(c.y-a.y)*(r.x-a.x)>(r.y-a.y)*(c.x-a.x)}function Oe(a){let r=0;for(let c,d,g=0,y=a.length,x=y-1;g<y;x=g++)c=a[g],d=a[x],r+=(d.x-c.x)*(c.y+d.y);return r}function Ue(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function st(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,d,g,y)=>{const x=g||y;return r[d]=!x||x.toLowerCase(),""}),r["max-age"]){const c=parseInt(r["max-age"],10);isNaN(c)?delete r["max-age"]:r["max-age"]=c}return r}let Xe,xt,$t=null;function en(a){if($t==null){const r=a.navigator?a.navigator.userAgent:null;$t=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return $t}function Dt(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ti={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(a){const r=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(a,r=0){const c=window.document.createElement("canvas"),d=c.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return c.width=a.width,c.height=a.height,d.drawImage(a,0,0,a.width,a.height),d.getImageData(-r,-r,a.width+2*r,a.height+2*r)},resolveURL:a=>(Xe||(Xe=document.createElement("a")),Xe.href=a,Xe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(xt==null&&(xt=matchMedia("(prefers-reduced-motion: reduce)")),xt.matches)}};var vt=vi;function vi(a,r){this.x=a,this.y=r}vi.prototype={clone:function(){return new vi(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,c=a.y-this.y;return r*r+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),c=Math.sin(a),d=c*this.x+r*this.y;return this.x=r*this.x-c*this.y,this.y=d,this},_rotateAround:function(a,r){var c=Math.cos(a),d=Math.sin(a),g=r.y+d*(this.x-r.x)+c*(this.y-r.y);return this.x=r.x+c*(this.x-r.x)-d*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vi.convert=function(a){return a instanceof vi?a:Array.isArray(a)?new vi(a[0],a[1]):a};const et={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},wt="mapbox-tiles";let St,tn,nn=500,nr=50;function ni(){typeof caches>"u"||St||(St=caches.open(wt))}let xi=1/0;const ii={supported:!1,testSupport:function(a){!Wt&&bi&&(zn?is(a):ln=a)}};let ln,bi,Wt=!1,zn=!1;function is(a){const r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,bi),a.isContextLost())return;ii.supported=!0}catch{}a.deleteTexture(r),Wt=!0}typeof document<"u"&&(bi=document.createElement("img"),bi.onload=function(){ln&&is(ln),ln=null,zn=!0},bi.onerror=function(){Wt=!0,ln=null},bi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ci={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ci);class Xn extends Error{constructor(r,c,d,g){super(`AJAXError: ${c} (${r}): ${d}`),this.status=r,this.statusText=c,this.url=d,this.body=g}}const Lr=Ue()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function ji(a,r){const c=new AbortController,d=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Lr(),signal:c.signal});let g=!1,y=!1;return a.type==="json"&&d.headers.set("Accept","application/json"),((x,E,S)=>{if(y)return;const P=Date.now();fetch(d).then(D=>D.ok?((O,N,G)=>{(a.type==="arrayBuffer"?O.arrayBuffer():a.type==="json"?O.json():O.text()).then(H=>{y||(N&&G&&function(oe,se,ge){if(ni(),!St)return;const Te={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach((be,De)=>Te.headers.set(De,be));const me=st(se.headers.get("Cache-Control")||"");me["no-store"]||(me["max-age"]&&Te.headers.set("Expires",new Date(ge+1e3*me["max-age"]).toUTCString()),new Date(Te.headers.get("Expires")).getTime()-ge<42e4||function(be,De){if(tn===void 0)try{new Response(new ReadableStream),tn=!0}catch{tn=!1}tn?De(be.body):be.blob().then(De)}(se,be=>{const De=new Response(be,Te);ni(),St&&St.then(Re=>Re.put(function(nt){const lt=nt.indexOf("?");return lt<0?nt:nt.slice(0,lt)}(oe.url),De)).catch(Re=>we(Re.message))}))}(d,N,G),g=!0,r(null,H,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(H=>{y||r(new Error(H.message))})})(D,null,P):D.blob().then(O=>r(new Xn(D.status,D.statusText,a.url,O)))).catch(D=>{D.code!==20&&r(new Error(D.message))})})(),{cancel:()=>{y=!0,g||c.abort()}}}const di=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r);if(!Ue()){const d=a.url.substring(0,a.url.indexOf("://"));return(et.REGISTERED_PROTOCOLS[d]||ji)(a,r)}}if(!(/^file:/.test(c=a.url)||/^file:/.test(Lr())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ji(a,r);if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,r,void 0,!0)}var c;return function(d,g){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const x in d.headers)y.setRequestHeader(x,d.headers[x]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let x=y.response;if(d.type==="json")try{x=JSON.parse(y.response)}catch(E){return g(E)}g(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const x=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new Xn(y.status,y.statusText,d.url,x))}},y.send(d.body),{cancel:()=>y.abort()}}(a,r)},Gi=function(a,r){return di(te(a,{type:"arrayBuffer"}),r)};function Vs(a){const r=window.document.createElement("a");return r.href=a,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}const Vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Mi,On;Mi=[],On=0;const rs=function(a,r){if(ii.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),On>=et.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:a,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Mi.push(y),y}On++;let c=!1;const d=()=>{if(!c)for(c=!0,On--;Mi.length&&On<et.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Mi.shift(),{requestParameters:x,callback:E,cancelled:S}=y;S||(y.cancel=rs(x,E).cancel)}},g=Gi(a,(y,x,E,S)=>{d(),y?r(y):x&&function(P,D){typeof createImageBitmap=="function"?function(O,N){const G=new Blob([new Uint8Array(O)],{type:"image/png"});createImageBitmap(G).then(H=>{N(null,H)}).catch(H=>{N(new Error(`Could not load image because of ${H.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(P,D):function(O,N){const G=new Image;G.onload=()=>{N(null,G),URL.revokeObjectURL(G.src),G.onload=null,window.requestAnimationFrame(()=>{G.src=Vt})},G.onerror=()=>N(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new Blob([new Uint8Array(O)],{type:"image/png"});G.src=O.byteLength?URL.createObjectURL(H):Vt}(P,D)}(x,(P,D)=>{P!=null?r(P):D!=null&&r(null,D,{cacheControl:E,expires:S})})});return{cancel:()=>{g.cancel(),d()}}};function po(a,r,c){c[a]&&c[a].indexOf(r)!==-1||(c[a]=c[a]||[],c[a].push(r))}function Rr(a,r,c){if(c&&c[a]){const d=c[a].indexOf(r);d!==-1&&c[a].splice(d,1)}}class Dr{constructor(r,c={}){te(this,c),this.type=r}}class js extends Dr{constructor(r,c={}){super("error",te({error:r},c))}}class xr{on(r,c){return this._listeners=this._listeners||{},po(r,c,this._listeners),this}off(r,c){return Rr(r,c,this._listeners),Rr(r,c,this._oneTimeListeners),this}once(r,c){return this._oneTimeListeners=this._oneTimeListeners||{},po(r,c,this._oneTimeListeners),this}fire(r,c){typeof r=="string"&&(r=new Dr(r,c||{}));const d=r.type;if(this.listens(d)){r.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of g)E.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of y)Rr(d,E,this._oneTimeListeners),E.call(this,r);const x=this._eventedParent;x&&(te(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(r))}else r instanceof js&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,c){return this._eventedParent=r,this._eventedParentData=c,this}}var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class He{constructor(r,c,d,g){this.message=(r?`${r}: `:"")+d,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function ss(a){const r=a.value;return r?[new He(a.key,r,"constants have been deprecated as of v8")]:[]}function wi(a,...r){for(const c of r)for(const d in c)a[d]=c[d];return a}function Bt(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Hi(a){if(Array.isArray(a))return a.map(Hi);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const c in a)r[c]=Hi(a[c]);return r}return Bt(a)}class ki extends Error{constructor(r,c){super(c),this.message=c,this.key=r}}class Li{constructor(r,c=[]){this.parent=r,this.bindings={};for(const[d,g]of c)this.bindings[d]=g}concat(r){return new Li(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const os={kind:"null"},Ge={kind:"number"},Pt={kind:"string"},It={kind:"boolean"},Zn={kind:"color"},zr={kind:"object"},At={kind:"value"},ir={kind:"collator"},jn={kind:"formatted"},Gs={kind:"padding"},Mn={kind:"resolvedImage"};function ri(a,r){return{kind:"array",itemType:a,N:r}}function Jt(a){if(a.kind==="array"){const r=Jt(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const Hs=[os,Ge,Pt,It,Zn,jn,zr,ri(At),Gs,Mn];function br(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!br(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const c of Hs)if(!br(c,r))return null}}return`Expected ${Jt(a)} but found ${Jt(r)} instead.`}function wr(a,r){return r.some(c=>c.kind===a.kind)}function Es(a,r){return r.some(c=>c==="null"?a===null:c==="array"?Array.isArray(a):c==="object"?a&&!Array.isArray(a)&&typeof a=="object":c===typeof a)}var $s,as={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Y(a){return(a=Math.round(a))<0?0:a>255?255:a}function R(a){return Y(a[a.length-1]==="%"?parseFloat(a)/100*255:parseInt(a))}function F(a){return(r=a[a.length-1]==="%"?parseFloat(a)/100:parseFloat(a))<0?0:r>1?1:r;var r}function $(a,r,c){return c<0?c+=1:c>1&&(c-=1),6*c<1?a+(r-a)*c*6:2*c<1?r:3*c<2?a+(r-a)*(2/3-c)*6:a}try{$s={}.parseCSSColor=function(a){var r,c=a.replace(/ /g,"").toLowerCase();if(c in as)return as[c].slice();if(c[0]==="#")return c.length===4?(r=parseInt(c.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:c.length===7&&(r=parseInt(c.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var d=c.indexOf("("),g=c.indexOf(")");if(d!==-1&&g+1===c.length){var y=c.substr(0,d),x=c.substr(d+1,g-(d+1)).split(","),E=1;switch(y){case"rgba":if(x.length!==4)return null;E=F(x.pop());case"rgb":return x.length!==3?null:[R(x[0]),R(x[1]),R(x[2]),E];case"hsla":if(x.length!==4)return null;E=F(x.pop());case"hsl":if(x.length!==3)return null;var S=(parseFloat(x[0])%360+360)%360/360,P=F(x[1]),D=F(x[2]),O=D<=.5?D*(P+1):D+P-D*P,N=2*D-O;return[Y(255*$(N,O,S+1/3)),Y(255*$(N,O,S)),Y(255*$(N,O,S-1/3)),E];default:return null}}return null}}catch{}class q{constructor(r,c,d,g=1){this.r=r,this.g=c,this.b=d,this.a=g}static parse(r){if(!r)return;if(r instanceof q)return r;if(typeof r!="string")return;const c=$s(r);return c?new q(c[0]/255*c[3],c[1]/255*c[3],c[2]/255*c[3],c[3]):void 0}toString(){const[r,c,d,g]=this.toArray();return`rgba(${Math.round(r)},${Math.round(c)},${Math.round(d)},${g})`}toArray(){const{r,g:c,b:d,a:g}=this;return g===0?[0,0,0,0]:[255*r/g,255*c/g,255*d/g,g]}}q.black=new q(0,0,0,1),q.white=new q(1,1,1,1),q.transparent=new q(0,0,0,0),q.red=new q(1,0,0,1);class le{constructor(r,c,d){this.sensitivity=r?c?"variant":"case":c?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,c){return this.collator.compare(r,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(r,c,d,g,y){this.text=r,this.image=c,this.scale=d,this.fontStack=g,this.textColor=y}}class ue{constructor(r){this.sections=r}static fromString(r){return new ue([new de(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof ue?r:ue.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class ae{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ae)return r;if(typeof r=="number")return new ae([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const c of r)if(typeof c!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new ae(r)}}toString(){return JSON.stringify(this.values)}}class fe{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new fe({name:r,available:!1}):null}}function Ie(a,r,c,d){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof c=="number"&&c>=0&&c<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,r,c,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,r,c,d]:[a,r,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ze(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof q||a instanceof le||a instanceof ue||a instanceof ae||a instanceof fe)return!0;if(Array.isArray(a)){for(const r of a)if(!ze(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!ze(a[r]))return!1;return!0}return!1}function Ae(a){if(a===null)return os;if(typeof a=="string")return Pt;if(typeof a=="boolean")return It;if(typeof a=="number")return Ge;if(a instanceof q)return Zn;if(a instanceof le)return ir;if(a instanceof ue)return jn;if(a instanceof ae)return Gs;if(a instanceof fe)return Mn;if(Array.isArray(a)){const r=a.length;let c;for(const d of a){const g=Ae(d);if(c){if(c===g)continue;c=At;break}c=g}return ri(c||At,r)}return zr}function it(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof q||a instanceof ue||a instanceof ae||a instanceof fe?a.toString():JSON.stringify(a)}class at{constructor(r,c){this.type=r,this.value=c}static parse(r,c){if(r.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!ze(r[1]))return c.error("invalid value");const d=r[1];let g=Ae(d);const y=c.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new at(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ze{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const mt={string:Pt,number:Ge,boolean:It,object:zr};class ht{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");let d,g=1;const y=r[0];if(y==="array"){let E,S;if(r.length>2){const P=r[1];if(typeof P!="string"||!(P in mt)||P==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);E=mt[P],g++}else E=At;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return c.error('The length argument to "array" must be a positive integer literal',2);S=r[2],g++}d=ri(E,S)}else{if(!mt[y])throw new Error(`Types doesn't contain name = ${y}`);d=mt[y]}const x=[];for(;g<r.length;g++){const E=c.parse(r[g],g,At);if(!E)return null;x.push(E)}return new ht(d,x)}evaluate(r){for(let c=0;c<this.args.length;c++){const d=this.args[c].evaluate(r);if(!br(this.type,Ae(d)))return d;if(c===this.args.length-1)throw new Ze(`Expected value to be of type ${Jt(this.type)}, but found ${Jt(Ae(d))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Mt={"to-boolean":It,"to-color":Zn,"to-number":Ge,"to-string":Pt};class yt{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[0];if(!Mt[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&r.length!==2)return c.error("Expected one argument.");const g=Mt[d],y=[];for(let x=1;x<r.length;x++){const E=c.parse(r[x],x,At);if(!E)return null;y.push(E)}return new yt(g,y)}evaluate(r){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(r));if(this.type.kind==="color"){let c,d;for(const g of this.args){if(c=g.evaluate(r),d=null,c instanceof q)return c;if(typeof c=="string"){const y=r.parseColor(c);if(y)return y}else if(Array.isArray(c)&&(d=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Ie(c[0],c[1],c[2],c[3]),!d))return new q(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ze(d||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="padding"){let c;for(const d of this.args){c=d.evaluate(r);const g=ae.parse(c);if(g)return g}throw new Ze(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}if(this.type.kind==="number"){let c=null;for(const d of this.args){if(c=d.evaluate(r),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new Ze(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?ue.fromString(it(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?fe.fromString(it(this.args[0].evaluate(r))):it(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Tt=["Unknown","Point","LineString","Polygon"];class zt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Tt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let c=this._parseColorCache[r];return c||(c=this._parseColorCache[r]=q.parse(r)),c}}class Nt{constructor(r,c,d,g){this.name=r,this.type=c,this._evaluate=d,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,c){const d=r[0],g=Nt.definitions[d];if(!g)return c.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=x.filter(([P])=>!Array.isArray(P)||P.length===r.length-1);let S=null;for(const[P,D]of E){S=new Be(c.registry,c.path,null,c.scope);const O=[];let N=!1;for(let G=1;G<r.length;G++){const H=r[G],oe=Array.isArray(P)?P[G-1]:P.type,se=S.parse(H,1+O.length,oe);if(!se){N=!0;break}O.push(se)}if(!N)if(Array.isArray(P)&&P.length!==O.length)S.error(`Expected ${P.length} arguments, but found ${O.length} instead.`);else{for(let G=0;G<O.length;G++){const H=Array.isArray(P)?P[G]:P.type,oe=O[G];S.concat(G+1).checkSubtype(H,oe.type)}if(S.errors.length===0)return new Nt(d,y,D,O)}}if(E.length===1)c.errors.push(...S.errors);else{const P=(E.length?E:x).map(([O])=>{return N=O,Array.isArray(N)?`(${N.map(Jt).join(", ")})`:`(${Jt(N.type)}...)`;var N}).join(" | "),D=[];for(let O=1;O<r.length;O++){const N=c.parse(r[O],1+D.length);if(!N)return null;D.push(Jt(N.type))}c.error(`Expected arguments of type ${P}, but found (${D.join(", ")}) instead.`)}return null}static register(r,c){Nt.definitions=c;for(const d in c)r[d]=Nt}}class un{constructor(r,c,d){this.type=ir,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=c}static parse(r,c){if(r.length!==2)return c.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return c.error("Collator options argument must be an object.");const g=c.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,It);if(!g)return null;const y=c.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,It);if(!y)return null;let x=null;return d.locale&&(x=c.parse(d.locale,1,Pt),!x)?null:new un(g,y,x)}evaluate(r){return new le(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const hn=8192;function Yn(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Or(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function fi(a,r){const c=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(c*g*hn),Math.round(d*g*hn)]}function qt(a,r,c){const d=a[0]-r[0],g=a[1]-r[1],y=a[0]-c[0],x=a[1]-c[1];return d*x-y*g==0&&d*y<=0&&g*x<=0}function mo(a,r){let c=!1;for(let x=0,E=r.length;x<E;x++){const S=r[x];for(let P=0,D=S.length;P<D-1;P++){if(qt(a,S[P],S[P+1]))return!1;(g=S[P])[1]>(d=a)[1]!=(y=S[P+1])[1]>d[1]&&d[0]<(y[0]-g[0])*(d[1]-g[1])/(y[1]-g[1])+g[0]&&(c=!c)}}var d,g,y;return c}function go(a,r){for(let c=0;c<r.length;c++)if(mo(a,r[c]))return!0;return!1}function qo(a,r,c,d){const g=d[0]-c[0],y=d[1]-c[1],x=(a[0]-c[0])*y-g*(a[1]-c[1]),E=(r[0]-c[0])*y-g*(r[1]-c[1]);return x>0&&E<0||x<0&&E>0}function Xo(a,r,c){for(const P of c)for(let D=0;D<P.length-1;++D)if((E=[(x=P[D+1])[0]-(y=P[D])[0],x[1]-y[1]])[0]*(S=[(g=r)[0]-(d=a)[0],g[1]-d[1]])[1]-E[1]*S[0]!=0&&qo(d,g,y,x)&&qo(y,x,d,g))return!0;var d,g,y,x,E,S;return!1}function Ws(a,r){for(let c=0;c<a.length;++c)if(!mo(a[c],r))return!1;for(let c=0;c<a.length-1;++c)if(Xo(a[c],a[c+1],r))return!1;return!0}function Fr(a,r){for(let c=0;c<r.length;c++)if(Ws(a,r[c]))return!0;return!1}function Zo(a,r,c){const d=[];for(let g=0;g<a.length;g++){const y=[];for(let x=0;x<a[g].length;x++){const E=fi(a[g][x],c);Yn(r,E),y.push(E)}d.push(y)}return d}function Yo(a,r,c){const d=[];for(let g=0;g<a.length;g++){const y=Zo(a[g],r,c);d.push(y)}return d}function Ko(a,r,c,d){if(a[0]<c[0]||a[0]>c[2]){const g=.5*d;let y=a[0]-c[0]>g?-d:c[0]-a[0]>g?d:0;y===0&&(y=a[0]-c[2]>g?-d:c[2]-a[0]>g?d:0),a[0]+=y}Yn(r,a)}function Ga(a,r,c,d){const g=Math.pow(2,d.z)*hn,y=[d.x*hn,d.y*hn],x=[];for(const E of a)for(const S of E){const P=[S.x+y[0],S.y+y[1]];Ko(P,r,c,g),x.push(P)}return x}function Vl(a,r,c,d){const g=Math.pow(2,d.z)*hn,y=[d.x*hn,d.y*hn],x=[];for(const S of a){const P=[];for(const D of S){const O=[D.x+y[0],D.y+y[1]];Yn(r,O),P.push(O)}x.push(P)}if(r[2]-r[0]<=g/2){(E=r)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const S of x)for(const P of S)Ko(P,r,c,g)}var E;return x}class Ts{constructor(r,c){this.type=It,this.geojson=r,this.geometries=c}static parse(r,c){if(r.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(ze(r[1])){const d=r[1];if(d.type==="FeatureCollection")for(let g=0;g<d.features.length;++g){const y=d.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ts(d,d.features[g].geometry)}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ts(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Ts(d,d)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const E=Zo(d.coordinates,y,x),S=Ga(c.geometry(),g,y,x);if(!Or(g,y))return!1;for(const P of S)if(!mo(P,E))return!1}if(d.type==="MultiPolygon"){const E=Yo(d.coordinates,y,x),S=Ga(c.geometry(),g,y,x);if(!Or(g,y))return!1;for(const P of S)if(!go(P,E))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(c,d){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(d.type==="Polygon"){const E=Zo(d.coordinates,y,x),S=Vl(c.geometry(),g,y,x);if(!Or(g,y))return!1;for(const P of S)if(!Ws(P,E))return!1}if(d.type==="MultiPolygon"){const E=Yo(d.coordinates,y,x),S=Vl(c.geometry(),g,y,x);if(!Or(g,y))return!1;for(const P of S)if(!Fr(P,E))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function j(a){if(a instanceof Nt&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ts)return!1;let r=!0;return a.eachChild(c=>{r&&!j(c)&&(r=!1)}),r}function Z(a){if(a instanceof Nt&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(c=>{r&&!Z(c)&&(r=!1)}),r}function ce(a,r){if(a instanceof Nt&&r.indexOf(a.name)>=0)return!1;let c=!0;return a.eachChild(d=>{c&&!ce(d,r)&&(c=!1)}),c}class Se{constructor(r,c){this.type=c.type,this.name=r,this.boundExpression=c}static parse(r,c){if(r.length!==2||typeof r[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const d=r[1];return c.scope.has(d)?new Se(d,c.scope.get(d)):c.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Be{constructor(r,c=[],d,g=new Li,y=[]){this.registry=r,this.path=c,this.key=c.map(x=>`[${x}]`).join(""),this.scope=g,this.errors=y,this.expectedType=d}parse(r,c,d,g,y={}){return c?this.concat(c,d,g)._parse(r,y):this._parse(r,y)}_parse(r,c){function d(g,y,x){return x==="assert"?new ht(y,[g]):x==="coerce"?new yt(y,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let x=y.parse(r,this);if(!x)return null;if(this.expectedType){const E=this.expectedType,S=x.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||S.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(E.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(E,S))return null}else x=d(x,E,c.typeAnnotation||"coerce");else x=d(x,E,c.typeAnnotation||"coerce");else x=d(x,E,c.typeAnnotation||"assert")}if(!(x instanceof at)&&x.type.kind!=="resolvedImage"&&ot(x)){const E=new zt;try{x=new at(x.type,x.evaluate(E))}catch(S){return this.error(S.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,c,d){const g=typeof r=="number"?this.path.concat(r):this.path,y=d?this.scope.concat(d):this.scope;return new Be(this.registry,g,c||null,y,this.errors)}error(r,...c){const d=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new ki(d,r))}checkSubtype(r,c){const d=br(r,c);return d&&this.error(d),d}}function ot(a){if(a instanceof Se)return ot(a.boundExpression);if(a instanceof Nt&&a.name==="error"||a instanceof un||a instanceof Ts)return!1;const r=a instanceof yt||a instanceof ht;let c=!0;return a.eachChild(d=>{c=r?c&&ot(d):c&&d instanceof at}),!!c&&j(a)&&ce(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ot(a,r){const c=a.length-1;let d,g,y=0,x=c,E=0;for(;y<=x;)if(E=Math.floor((y+x)/2),d=a[E],g=a[E+1],d<=r){if(E===c||r<g)return E;y=E+1}else{if(!(d>r))throw new Ze("Input is not a number.");x=E-1}return 0}class En{constructor(r,c,d){this.type=r,this.input=c,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static parse(r,c){if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");const d=c.parse(r[1],1,Ge);if(!d)return null;const g=[];let y=null;c.expectedType&&c.expectedType.kind!=="value"&&(y=c.expectedType);for(let x=1;x<r.length;x+=2){const E=x===1?-1/0:r[x],S=r[x+1],P=x,D=x+1;if(typeof E!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=E)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const O=c.parse(S,D,y);if(!O)return null;y=y||O.type,g.push([E,O])}return new En(y,d,g)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=c[0])return d[0].evaluate(r);const y=c.length;return g>=c[y-1]?d[y-1].evaluate(r):d[Ot(c,g)].evaluate(r)}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function kt(a,r,c){return a*(1-c)+r*c}var Fn=Object.freeze({__proto__:null,number:kt,color:function(a,r,c){return new q(kt(a.r,r.r,c),kt(a.g,r.g,c),kt(a.b,r.b,c),kt(a.a,r.a,c))},array:function(a,r,c){return a.map((d,g)=>kt(d,r[g],c))},padding:function(a,r,c){const d=a.values,g=r.values;return new ae([kt(d[0],g[0],c),kt(d[1],g[1],c),kt(d[2],g[2],c),kt(d[3],g[3],c)])}});const rr=.95047,Ed=1.08883,fu=4/29,jl=6/29,Td=3*jl*jl,zm=Math.PI/180,Om=180/Math.PI;function pu(a){return a>.008856451679035631?Math.pow(a,1/3):a/Td+fu}function mu(a){return a>jl?a*a*a:Td*(a-fu)}function gu(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function _u(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Yt(a){const r=_u(a.r),c=_u(a.g),d=_u(a.b),g=pu((.4124564*r+.3575761*c+.1804375*d)/rr),y=pu((.2126729*r+.7151522*c+.072175*d)/1);return{l:116*y-16,a:500*(g-y),b:200*(y-pu((.0193339*r+.119192*c+.9503041*d)/Ed)),alpha:a.a}}function Sd(a){let r=(a.l+16)/116,c=isNaN(a.a)?r:r+a.a/500,d=isNaN(a.b)?r:r-a.b/200;return r=1*mu(r),c=rr*mu(c),d=Ed*mu(d),new q(gu(3.2404542*c-1.5371385*r-.4985314*d),gu(-.969266*c+1.8760108*r+.041556*d),gu(.0556434*c-.2040259*r+1.0572252*d),a.alpha)}function Fm(a,r,c){const d=r-a;return a+c*(d>180||d<-180?d-360*Math.round(d/360):d)}const Ha={forward:Yt,reverse:Sd,interpolate:function(a,r,c){return{l:kt(a.l,r.l,c),a:kt(a.a,r.a,c),b:kt(a.b,r.b,c),alpha:kt(a.alpha,r.alpha,c)}}},$a={forward:function(a){const{l:r,a:c,b:d}=Yt(a),g=Math.atan2(d,c)*Om;return{h:g<0?g+360:g,c:Math.sqrt(c*c+d*d),l:r,alpha:a.a}},reverse:function(a){const r=a.h*zm,c=a.c;return Sd({l:a.l,a:Math.cos(r)*c,b:Math.sin(r)*c,alpha:a.alpha})},interpolate:function(a,r,c){return{h:Fm(a.h,r.h,c),c:kt(a.c,r.c,c),l:kt(a.l,r.l,c),alpha:kt(a.alpha,r.alpha,c)}}};var Ad=Object.freeze({__proto__:null,lab:Ha,hcl:$a});class sr{constructor(r,c,d,g,y){this.type=r,this.operator=c,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[x,E]of y)this.labels.push(x),this.outputs.push(E)}static interpolationFactor(r,c,d,g){let y=0;if(r.name==="exponential")y=yu(c,r.base,d,g);else if(r.name==="linear")y=yu(c,1,d,g);else if(r.name==="cubic-bezier"){const x=r.controlPoints;y=new b(x[0],x[1],x[2],x[3]).solve(yu(c,1,d,g))}return y}static parse(r,c){let[d,g,y,...x]=r;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(D=>typeof D!="number"||D<0||D>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(r.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(y=c.parse(y,2,Ge),!y)return null;const E=[];let S=null;d==="interpolate-hcl"||d==="interpolate-lab"?S=Zn:c.expectedType&&c.expectedType.kind!=="value"&&(S=c.expectedType);for(let P=0;P<x.length;P+=2){const D=x[P],O=x[P+1],N=P+3,G=P+4;if(typeof D!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(E.length&&E[E.length-1][0]>=D)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const H=c.parse(O,G,S);if(!H)return null;S=S||H.type,E.push([D,H])}return S.kind==="number"||S.kind==="color"||S.kind==="padding"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new sr(S,d,g,y,E):c.error(`Type ${Jt(S)} is not interpolatable.`)}evaluate(r){const c=this.labels,d=this.outputs;if(c.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=c[0])return d[0].evaluate(r);const y=c.length;if(g>=c[y-1])return d[y-1].evaluate(r);const x=Ot(c,g),E=sr.interpolationFactor(this.interpolation,g,c[x],c[x+1]),S=d[x].evaluate(r),P=d[x+1].evaluate(r);return this.operator==="interpolate"?Fn[this.type.kind.toLowerCase()](S,P,E):this.operator==="interpolate-hcl"?$a.reverse($a.interpolate($a.forward(S),$a.forward(P),E)):Ha.reverse(Ha.interpolate(Ha.forward(S),Ha.forward(P),E))}eachChild(r){r(this.input);for(const c of this.outputs)r(c)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function yu(a,r,c,d){const g=d-c,y=a-c;return g===0?0:r===1?y/g:(Math.pow(r,y)-1)/(Math.pow(r,g)-1)}class Gl{constructor(r,c){this.type=r,this.args=c}static parse(r,c){if(r.length<2)return c.error("Expectected at least one argument.");let d=null;const g=c.expectedType;g&&g.kind!=="value"&&(d=g);const y=[];for(const E of r.slice(1)){const S=c.parse(E,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!S)return null;d=d||S.type,y.push(S)}if(!d)throw new Error("No output type");const x=g&&y.some(E=>br(g,E.type));return new Gl(x?At:d,y)}evaluate(r){let c,d=null,g=0;for(const y of this.args)if(g++,d=y.evaluate(r),d&&d instanceof fe&&!d.available&&(c||(c=d.name),d=null,g===this.args.length&&(d=c)),d!==null)break;return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class Hl{constructor(r,c){this.type=c.type,this.bindings=[].concat(r),this.result=c}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const c of this.bindings)r(c[1]);r(this.result)}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let y=1;y<r.length-1;y+=2){const x=r[y];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",y);const E=c.parse(r[y+1],y+1);if(!E)return null;d.push([x,E])}const g=c.parse(r[r.length-1],r.length-1,c.expectedType,d);return g?new Hl(d,g):null}outputDefined(){return this.result.outputDefined()}}class vu{constructor(r,c,d){this.type=r,this.index=c,this.input=d}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,Ge),g=c.parse(r[2],2,ri(c.expectedType||At));return d&&g?new vu(g.type.itemType,d,g):null}evaluate(r){const c=this.index.evaluate(r),d=this.input.evaluate(r);if(c<0)throw new Ze(`Array index out of bounds: ${c} < 0.`);if(c>=d.length)throw new Ze(`Array index out of bounds: ${c} > ${d.length-1}.`);if(c!==Math.floor(c))throw new Ze(`Array index must be an integer, but found ${c} instead.`);return d[c]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class xu{constructor(r,c){this.type=It,this.needle=r,this.haystack=c}static parse(r,c){if(r.length!==3)return c.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,At);return d&&g?wr(d.type,[It,Pt,Ge,os,At])?new xu(d,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(d.type)} instead`):null}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!d)return!1;if(!Es(c,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(Ae(c))} instead.`);if(!Es(d,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Jt(Ae(d))} instead.`);return d.indexOf(c)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class $l{constructor(r,c,d){this.type=Ge,this.needle=r,this.haystack=c,this.fromIndex=d}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,At);if(!d||!g)return null;if(!wr(d.type,[It,Pt,Ge,os,At]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,Ge);return y?new $l(d,g,y):null}return new $l(d,g)}evaluate(r){const c=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!Es(c,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Jt(Ae(c))} instead.`);if(!Es(d,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Jt(Ae(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return d.indexOf(c,g)}return d.indexOf(c)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class bu{constructor(r,c,d,g,y,x){this.inputType=r,this.type=c,this.input=d,this.cases=g,this.outputs=y,this.otherwise=x}static parse(r,c){if(r.length<5)return c.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return c.error("Expected an even number of arguments.");let d,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const y={},x=[];for(let P=2;P<r.length-1;P+=2){let D=r[P];const O=r[P+1];Array.isArray(D)||(D=[D]);const N=c.concat(P);if(D.length===0)return N.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return N.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,Ae(H)))return null}else d=Ae(H);if(y[String(H)]!==void 0)return N.error("Branch labels must be unique.");y[String(H)]=x.length}const G=c.parse(O,P,g);if(!G)return null;g=g||G.type,x.push(G)}const E=c.parse(r[1],1,At);if(!E)return null;const S=c.parse(r[r.length-1],r.length-1,g);return S?E.type.kind!=="value"&&c.concat(1).checkSubtype(d,E.type)?null:new bu(d,g,E,y,x,S):null}evaluate(r){const c=this.input.evaluate(r);return(Ae(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class wu{constructor(r,c,d){this.type=r,this.branches=c,this.otherwise=d}static parse(r,c){if(r.length<4)return c.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return c.error("Expected an odd number of arguments.");let d;c.expectedType&&c.expectedType.kind!=="value"&&(d=c.expectedType);const g=[];for(let x=1;x<r.length-1;x+=2){const E=c.parse(r[x],x,It);if(!E)return null;const S=c.parse(r[x+1],x+1,d);if(!S)return null;g.push([E,S]),d=d||S.type}const y=c.parse(r[r.length-1],r.length-1,d);if(!y)return null;if(!d)throw new Error("Can't infer output type");return new wu(d,g,y)}evaluate(r){for(const[c,d]of this.branches)if(c.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[c,d]of this.branches)r(c),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class Wl{constructor(r,c,d,g){this.type=r,this.input=c,this.beginIndex=d,this.endIndex=g}static parse(r,c){if(r.length<=2||r.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=c.parse(r[1],1,At),g=c.parse(r[2],2,Ge);if(!d||!g)return null;if(!wr(d.type,[ri(At),Pt,At]))return c.error(`Expected first argument to be of type array or string, but found ${Jt(d.type)} instead`);if(r.length===4){const y=c.parse(r[3],3,Ge);return y?new Wl(d.type,d,g,y):null}return new Wl(d.type,d,g)}evaluate(r){const c=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!Es(c,["string","array"]))throw new Ze(`Expected first argument to be of type array or string, but found ${Jt(Ae(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return c.slice(d,g)}return c.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Id(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Pd(a,r,c,d){return d.compare(r,c)===0}function Jo(a,r,c){const d=a!=="=="&&a!=="!=";return class nA{constructor(y,x,E){this.type=It,this.lhs=y,this.rhs=x,this.collator=E,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}static parse(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");const E=y[0];let S=x.parse(y[1],1,At);if(!S)return null;if(!Id(E,S.type))return x.concat(1).error(`"${E}" comparisons are not supported for type '${Jt(S.type)}'.`);let P=x.parse(y[2],2,At);if(!P)return null;if(!Id(E,P.type))return x.concat(2).error(`"${E}" comparisons are not supported for type '${Jt(P.type)}'.`);if(S.type.kind!==P.type.kind&&S.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${Jt(S.type)}' and '${Jt(P.type)}'.`);d&&(S.type.kind==="value"&&P.type.kind!=="value"?S=new ht(P.type,[S]):S.type.kind!=="value"&&P.type.kind==="value"&&(P=new ht(S.type,[P])));let D=null;if(y.length===4){if(S.type.kind!=="string"&&P.type.kind!=="string"&&S.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(y[3],3,ir),!D)return null}return new nA(S,P,D)}evaluate(y){const x=this.lhs.evaluate(y),E=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const S=Ae(x),P=Ae(E);if(S.kind!==P.kind||S.kind!=="string"&&S.kind!=="number")throw new Ze(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${S.kind}, ${P.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const S=Ae(x),P=Ae(E);if(S.kind!=="string"||P.kind!=="string")return r(y,x,E)}return this.collator?c(y,x,E,this.collator.evaluate(y)):r(y,x,E)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Bm=Jo("==",function(a,r,c){return r===c},Pd),Nm=Jo("!=",function(a,r,c){return r!==c},function(a,r,c,d){return!Pd(0,r,c,d)}),Um=Jo("<",function(a,r,c){return r<c},function(a,r,c,d){return d.compare(r,c)<0}),Vm=Jo(">",function(a,r,c){return r>c},function(a,r,c,d){return d.compare(r,c)>0}),jm=Jo("<=",function(a,r,c){return r<=c},function(a,r,c,d){return d.compare(r,c)<=0}),Gm=Jo(">=",function(a,r,c){return r>=c},function(a,r,c,d){return d.compare(r,c)>=0});class Eu{constructor(r,c,d,g,y){this.type=Pt,this.number=r,this.locale=c,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,c){if(r.length!==3)return c.error("Expected two arguments.");const d=c.parse(r[1],1,Ge);if(!d)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=c.parse(g.locale,1,Pt),!y))return null;let x=null;if(g.currency&&(x=c.parse(g.currency,1,Pt),!x))return null;let E=null;if(g["min-fraction-digits"]&&(E=c.parse(g["min-fraction-digits"],1,Ge),!E))return null;let S=null;return g["max-fraction-digits"]&&(S=c.parse(g["max-fraction-digits"],1,Ge),!S)?null:new Eu(d,y,x,E,S)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class ql{constructor(r){this.type=jn,this.sections=r}static parse(r,c){if(r.length<2)return c.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return c.error("First argument must be an image or text section.");const g=[];let y=!1;for(let x=1;x<=r.length-1;++x){const E=r[x];if(y&&typeof E=="object"&&!Array.isArray(E)){y=!1;let S=null;if(E["font-scale"]&&(S=c.parse(E["font-scale"],1,Ge),!S))return null;let P=null;if(E["text-font"]&&(P=c.parse(E["text-font"],1,ri(Pt)),!P))return null;let D=null;if(E["text-color"]&&(D=c.parse(E["text-color"],1,Zn),!D))return null;const O=g[g.length-1];O.scale=S,O.font=P,O.textColor=D}else{const S=c.parse(r[x],1,At);if(!S)return null;const P=S.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:S,scale:null,font:null,textColor:null})}}return new ql(g)}evaluate(r){return new ue(this.sections.map(c=>{const d=c.content.evaluate(r);return Ae(d)===Mn?new de("",d,null,null,null):new de(it(d),null,c.scale?c.scale.evaluate(r):null,c.font?c.font.evaluate(r).join(","):null,c.textColor?c.textColor.evaluate(r):null)}))}eachChild(r){for(const c of this.sections)r(c.content),c.scale&&r(c.scale),c.font&&r(c.font),c.textColor&&r(c.textColor)}outputDefined(){return!1}}class Tu{constructor(r){this.type=Mn,this.input=r}static parse(r,c){if(r.length!==2)return c.error("Expected two arguments.");const d=c.parse(r[1],1,Pt);return d?new Tu(d):c.error("No image name provided.")}evaluate(r){const c=this.input.evaluate(r),d=fe.fromString(c);return d&&r.availableImages&&(d.available=r.availableImages.indexOf(c)>-1),d}eachChild(r){r(this.input)}outputDefined(){return!1}}class Su{constructor(r){this.type=Ge,this.input=r}static parse(r,c){if(r.length!==2)return c.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=c.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Jt(d.type)} instead.`):new Su(d):null}evaluate(r){const c=this.input.evaluate(r);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ze(`Expected value to be of type string or array, but found ${Jt(Ae(c))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Qo={"==":Bm,"!=":Nm,">":Vm,"<":Um,">=":Gm,"<=":jm,array:ht,at:vu,boolean:ht,case:wu,coalesce:Gl,collator:un,format:ql,image:Tu,in:xu,"index-of":$l,interpolate:sr,"interpolate-hcl":sr,"interpolate-lab":sr,length:Su,let:Hl,literal:at,match:bu,number:ht,"number-format":Eu,object:ht,slice:Wl,step:En,string:ht,"to-boolean":yt,"to-color":yt,"to-number":yt,"to-string":yt,var:Se,within:Ts};function Cd(a,[r,c,d,g]){r=r.evaluate(a),c=c.evaluate(a),d=d.evaluate(a);const y=g?g.evaluate(a):1,x=Ie(r,c,d,y);if(x)throw new Ze(x);return new q(r/255*y,c/255*y,d/255*y,y)}function Md(a,r){return a in r}function Xl(a,r){const c=r[a];return c===void 0?null:c}function _o(a){return{type:a}}function kd(a){return{result:"success",value:a}}function ea(a){return{result:"error",value:a}}function gn(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Ld(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function jt(a){return!!a.expression&&a.expression.interpolated}function Kt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function dn(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function yn(a){return a}function Wa(a,r){const c=r.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",g=d||!(d||a.property!==void 0),y=a.type||(jt(r)?"exponential":"interval");if(c||r.type==="padding"){const P=c?q.parse:ae.parse;(a=wi({},a)).stops&&(a.stops=a.stops.map(D=>[D[0],P(D[1])])),a.default=P(a.default?a.default:r.default)}if(a.colorSpace&&a.colorSpace!=="rgb"&&!Ad[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let x,E,S;if(y==="exponential")x=Rd;else if(y==="interval")x=$m;else if(y==="categorical"){x=Hm,E=Object.create(null);for(const P of a.stops)E[P[0]]=P[1];S=typeof a.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);x=Wm}if(d){const P={},D=[];for(let G=0;G<a.stops.length;G++){const H=a.stops[G],oe=H[0].zoom;P[oe]===void 0&&(P[oe]={zoom:oe,type:a.type,property:a.property,default:a.default,stops:[]},D.push(oe)),P[oe].stops.push([H[0].value,H[1]])}const O=[];for(const G of D)O.push([P[G].zoom,Wa(P[G],r)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:sr.interpolationFactor.bind(void 0,N),zoomStops:O.map(G=>G[0]),evaluate:({zoom:G},H)=>Rd({stops:O,base:a.base},r,G).evaluate(G,H)}}if(g){const P=y==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:sr.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(D=>D[0]),evaluate:({zoom:D})=>x(a,r,D,E,S)}}return{kind:"source",evaluate(P,D){const O=D&&D.properties?D.properties[a.property]:void 0;return O===void 0?ta(a.default,r.default):x(a,r,O,E,S)}}}function ta(a,r,c){return a!==void 0?a:r!==void 0?r:c!==void 0?c:void 0}function Hm(a,r,c,d,g){return ta(typeof c===g?d[c]:void 0,a.default,r.default)}function $m(a,r,c){if(Kt(c)!=="number")return ta(a.default,r.default);const d=a.stops.length;if(d===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[d-1][0])return a.stops[d-1][1];const g=Ot(a.stops.map(y=>y[0]),c);return a.stops[g][1]}function Rd(a,r,c){const d=a.base!==void 0?a.base:1;if(Kt(c)!=="number")return ta(a.default,r.default);const g=a.stops.length;if(g===1||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[g-1][0])return a.stops[g-1][1];const y=Ot(a.stops.map(D=>D[0]),c),x=function(D,O,N,G){const H=G-N,oe=D-N;return H===0?0:O===1?oe/H:(Math.pow(O,oe)-1)/(Math.pow(O,H)-1)}(c,d,a.stops[y][0],a.stops[y+1][0]),E=a.stops[y][1],S=a.stops[y+1][1];let P=Fn[r.type]||yn;if(a.colorSpace&&a.colorSpace!=="rgb"){const D=Ad[a.colorSpace];P=(O,N)=>D.reverse(D.interpolate(D.forward(O),D.forward(N),x))}return typeof E.evaluate=="function"?{evaluate(...D){const O=E.evaluate.apply(void 0,D),N=S.evaluate.apply(void 0,D);if(O!==void 0&&N!==void 0)return P(O,N,x)}}:P(E,S,x)}function Wm(a,r,c){switch(r.type){case"color":c=q.parse(c);break;case"formatted":c=ue.fromString(c.toString());break;case"resolvedImage":c=fe.fromString(c.toString());break;case"padding":c=ae.parse(c);break;default:Kt(c)===r.type||r.type==="enum"&&r.values[c]||(c=void 0)}return ta(c,a.default,r.default)}Nt.register(Qo,{error:[{kind:"error"},[Pt],(a,[r])=>{throw new Ze(r.evaluate(a))}],typeof:[Pt,[At],(a,[r])=>Jt(Ae(r.evaluate(a)))],"to-rgba":[ri(Ge,4),[Zn],(a,[r])=>r.evaluate(a).toArray()],rgb:[Zn,[Ge,Ge,Ge],Cd],rgba:[Zn,[Ge,Ge,Ge,Ge],Cd],has:{type:It,overloads:[[[Pt],(a,[r])=>Md(r.evaluate(a),a.properties())],[[Pt,zr],(a,[r,c])=>Md(r.evaluate(a),c.evaluate(a))]]},get:{type:At,overloads:[[[Pt],(a,[r])=>Xl(r.evaluate(a),a.properties())],[[Pt,zr],(a,[r,c])=>Xl(r.evaluate(a),c.evaluate(a))]]},"feature-state":[At,[Pt],(a,[r])=>Xl(r.evaluate(a),a.featureState||{})],properties:[zr,[],a=>a.properties()],"geometry-type":[Pt,[],a=>a.geometryType()],id:[At,[],a=>a.id()],zoom:[Ge,[],a=>a.globals.zoom],"heatmap-density":[Ge,[],a=>a.globals.heatmapDensity||0],"line-progress":[Ge,[],a=>a.globals.lineProgress||0],accumulated:[At,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Ge,_o(Ge),(a,r)=>{let c=0;for(const d of r)c+=d.evaluate(a);return c}],"*":[Ge,_o(Ge),(a,r)=>{let c=1;for(const d of r)c*=d.evaluate(a);return c}],"-":{type:Ge,overloads:[[[Ge,Ge],(a,[r,c])=>r.evaluate(a)-c.evaluate(a)],[[Ge],(a,[r])=>-r.evaluate(a)]]},"/":[Ge,[Ge,Ge],(a,[r,c])=>r.evaluate(a)/c.evaluate(a)],"%":[Ge,[Ge,Ge],(a,[r,c])=>r.evaluate(a)%c.evaluate(a)],ln2:[Ge,[],()=>Math.LN2],pi:[Ge,[],()=>Math.PI],e:[Ge,[],()=>Math.E],"^":[Ge,[Ge,Ge],(a,[r,c])=>Math.pow(r.evaluate(a),c.evaluate(a))],sqrt:[Ge,[Ge],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[Ge,[Ge],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[Ge,[Ge],(a,[r])=>Math.log(r.evaluate(a))],log2:[Ge,[Ge],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[Ge,[Ge],(a,[r])=>Math.sin(r.evaluate(a))],cos:[Ge,[Ge],(a,[r])=>Math.cos(r.evaluate(a))],tan:[Ge,[Ge],(a,[r])=>Math.tan(r.evaluate(a))],asin:[Ge,[Ge],(a,[r])=>Math.asin(r.evaluate(a))],acos:[Ge,[Ge],(a,[r])=>Math.acos(r.evaluate(a))],atan:[Ge,[Ge],(a,[r])=>Math.atan(r.evaluate(a))],min:[Ge,_o(Ge),(a,r)=>Math.min(...r.map(c=>c.evaluate(a)))],max:[Ge,_o(Ge),(a,r)=>Math.max(...r.map(c=>c.evaluate(a)))],abs:[Ge,[Ge],(a,[r])=>Math.abs(r.evaluate(a))],round:[Ge,[Ge],(a,[r])=>{const c=r.evaluate(a);return c<0?-Math.round(-c):Math.round(c)}],floor:[Ge,[Ge],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[Ge,[Ge],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[It,[Pt,At],(a,[r,c])=>a.properties()[r.value]===c.value],"filter-id-==":[It,[At],(a,[r])=>a.id()===r.value],"filter-type-==":[It,[Pt],(a,[r])=>a.geometryType()===r.value],"filter-<":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d<g}],"filter-id-<":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<d}],"filter->":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d>g}],"filter-id->":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>d}],"filter-<=":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c<=d}],"filter->=":[It,[Pt,At],(a,[r,c])=>{const d=a.properties()[r.value],g=c.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[It,[At],(a,[r])=>{const c=a.id(),d=r.value;return typeof c==typeof d&&c>=d}],"filter-has":[It,[At],(a,[r])=>r.value in a.properties()],"filter-has-id":[It,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[It,[ri(Pt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[It,[ri(At)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[It,[Pt,ri(At)],(a,[r,c])=>c.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[It,[Pt,ri(At)],(a,[r,c])=>function(d,g,y,x){for(;y<=x;){const E=y+x>>1;if(g[E]===d)return!0;g[E]>d?x=E-1:y=E+1}return!1}(a.properties()[r.value],c.value,0,c.value.length-1)],all:{type:It,overloads:[[[It,It],(a,[r,c])=>r.evaluate(a)&&c.evaluate(a)],[_o(It),(a,r)=>{for(const c of r)if(!c.evaluate(a))return!1;return!0}]]},any:{type:It,overloads:[[[It,It],(a,[r,c])=>r.evaluate(a)||c.evaluate(a)],[_o(It),(a,r)=>{for(const c of r)if(c.evaluate(a))return!0;return!1}]]},"!":[It,[It],(a,[r])=>!r.evaluate(a)],"is-supported-script":[It,[Pt],(a,[r])=>{const c=a.globals&&a.globals.isSupportedScript;return!c||c(r.evaluate(a))}],upcase:[Pt,[Pt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Pt,[Pt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Pt,_o(At),(a,r)=>r.map(c=>it(c.evaluate(a))).join("")],"resolved-locale":[Pt,[ir],(a,[r])=>r.evaluate(a).resolvedLocale()]});class Zl{constructor(r,c){this.expression=r,this._warningHistory={},this._evaluator=new zt,this._defaultValue=c?function(d){return d.type==="color"&&dn(d.default)?new q(0,0,0,0):d.type==="color"?q.parse(d.default)||null:d.type==="padding"?ae.parse(d.default)||null:d.default===void 0?null:d.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._evaluator.globals=r,this._evaluator.feature=c,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(r,c,d,g,y,x){this._evaluator.globals=r,this._evaluator.feature=c||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Ze(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function qa(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Qo}function Xa(a,r){const c=new Be(Qo,[],r?function(g){const y={color:Zn,string:Pt,number:Ge,enum:Pt,boolean:It,formatted:jn,padding:Gs,resolvedImage:Mn};return g.type==="array"?ri(y[g.value]||At,g.length):y[g.type]}(r):void 0),d=c.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?kd(new Zl(d,r)):ea(c.errors)}class Za{constructor(r,c){this.kind=r,this._styleExpression=c,this.isStateDependent=r!=="constant"&&!Z(c.expression)}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,g,y,x)}evaluate(r,c,d,g,y,x){return this._styleExpression.evaluate(r,c,d,g,y,x)}}class Au{constructor(r,c,d,g){this.kind=r,this.zoomStops=d,this._styleExpression=c,this.isStateDependent=r!=="camera"&&!Z(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,c,d,g,y,x){return this._styleExpression.evaluateWithoutErrorHandling(r,c,d,g,y,x)}evaluate(r,c,d,g,y,x){return this._styleExpression.evaluate(r,c,d,g,y,x)}interpolationFactor(r,c,d){return this.interpolationType?sr.interpolationFactor(this.interpolationType,r,c,d):0}}function Dd(a,r){const c=Xa(a,r);if(c.result==="error")return c;const d=c.value.expression,g=j(d);if(!g&&!gn(r))return ea([new ki("","data expressions not supported")]);const y=ce(d,["zoom"]);if(!y&&!Ld(r))return ea([new ki("","zoom expressions not supported")]);const x=Kl(d);return x||y?x instanceof ki?ea([x]):x instanceof sr&&!jt(r)?ea([new ki("",'"interpolate" expressions cannot be used with this property')]):kd(x?new Au(g?"camera":"composite",c.value,x.labels,x instanceof sr?x.interpolation:void 0):new Za(g?"constant":"source",c.value)):ea([new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Yl{constructor(r,c){this._parameters=r,this._specification=c,wi(this,Wa(this._parameters,this._specification))}static deserialize(r){return new Yl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Kl(a){let r=null;if(a instanceof Hl)r=Kl(a.result);else if(a instanceof Gl){for(const c of a.args)if(r=Kl(c),r)break}else(a instanceof En||a instanceof sr)&&a.input instanceof Nt&&a.input.name==="zoom"&&(r=a);return r instanceof ki||a.eachChild(c=>{const d=Kl(c);d instanceof ki?r=d:!r&&d?r=new ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&d&&r!==d&&(r=new ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Br(a){const r=a.key,c=a.value,d=a.valueSpec||{},g=a.objectElementValidators||{},y=a.style,x=a.styleSpec;let E=[];const S=Kt(c);if(S!=="object")return[new He(r,c,`object expected, ${S} found`)];for(const P in c){const D=P.split(".")[0],O=d[D]||d["*"];let N;if(g[D])N=g[D];else if(d[D])N=ar;else if(g["*"])N=g["*"];else{if(!d["*"]){E.push(new He(r,c[P],`unknown property "${P}"`));continue}N=ar}E=E.concat(N({key:(r&&`${r}.`)+P,value:c[P],valueSpec:O,style:y,styleSpec:x,object:c,objectKey:P},c))}for(const P in d)g[P]||d[P].required&&d[P].default===void 0&&c[P]===void 0&&E.push(new He(r,c,`missing required property "${P}"`));return E}function zd(a){const r=a.value,c=a.valueSpec,d=a.style,g=a.styleSpec,y=a.key,x=a.arrayElementValidator||ar;if(Kt(r)!=="array")return[new He(y,r,`array expected, ${Kt(r)} found`)];if(c.length&&r.length!==c.length)return[new He(y,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new He(y,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let E={type:c.value,values:c.values};g.$version<7&&(E.function=c.function),Kt(c.value)==="object"&&(E=c.value);let S=[];for(let P=0;P<r.length;P++)S=S.concat(x({array:r,arrayIndex:P,value:r[P],valueSpec:E,style:d,styleSpec:g,key:`${y}[${P}]`}));return S}function Iu(a){const r=a.key,c=a.value,d=a.valueSpec;let g=Kt(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new He(r,c,`number expected, ${g} found`)]:"minimum"in d&&c<d.minimum?[new He(r,c,`${c} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&c>d.maximum?[new He(r,c,`${c} is greater than the maximum value ${d.maximum}`)]:[]}function Od(a){const r=a.valueSpec,c=Bt(a.value.type);let d,g,y,x={};const E=c!=="categorical"&&a.value.property===void 0,S=!E,P=Kt(a.value.stops)==="array"&&Kt(a.value.stops[0])==="array"&&Kt(a.value.stops[0][0])==="object",D=Br({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(G){if(c==="identity")return[new He(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const oe=G.value;return H=H.concat(zd({key:G.key,value:oe,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:O})),Kt(oe)==="array"&&oe.length===0&&H.push(new He(G.key,oe,"array must have at least one stop")),H},default:function(G){return ar({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return c==="identity"&&E&&D.push(new He(a.key,a.value,'missing required property "property"')),c==="identity"||a.value.stops||D.push(new He(a.key,a.value,'missing required property "stops"')),c==="exponential"&&a.valueSpec.expression&&!jt(a.valueSpec)&&D.push(new He(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(S&&!gn(a.valueSpec)?D.push(new He(a.key,a.value,"property functions not supported")):E&&!Ld(a.valueSpec)&&D.push(new He(a.key,a.value,"zoom functions not supported"))),c!=="categorical"&&!P||a.value.property!==void 0||D.push(new He(a.key,a.value,'"property" property is required')),D;function O(G){let H=[];const oe=G.value,se=G.key;if(Kt(oe)!=="array")return[new He(se,oe,`array expected, ${Kt(oe)} found`)];if(oe.length!==2)return[new He(se,oe,`array length 2 expected, length ${oe.length} found`)];if(P){if(Kt(oe[0])!=="object")return[new He(se,oe,`object expected, ${Kt(oe[0])} found`)];if(oe[0].zoom===void 0)return[new He(se,oe,"object stop key must have zoom")];if(oe[0].value===void 0)return[new He(se,oe,"object stop key must have value")];if(y&&y>Bt(oe[0].zoom))return[new He(se,oe[0].zoom,"stop zoom values must appear in ascending order")];Bt(oe[0].zoom)!==y&&(y=Bt(oe[0].zoom),g=void 0,x={}),H=H.concat(Br({key:`${se}[0]`,value:oe[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Iu,value:N}}))}else H=H.concat(N({key:`${se}[0]`,value:oe[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},oe));return qa(Hi(oe[1]))?H.concat([new He(`${se}[1]`,oe[1],"expressions are not allowed in function stops.")]):H.concat(ar({key:`${se}[1]`,value:oe[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function N(G,H){const oe=Kt(G.value),se=Bt(G.value),ge=G.value!==null?G.value:H;if(d){if(oe!==d)return[new He(G.key,ge,`${oe} stop domain type must match previous stop domain type ${d}`)]}else d=oe;if(oe!=="number"&&oe!=="string"&&oe!=="boolean")return[new He(G.key,ge,"stop domain value must be a number, string, or boolean")];if(oe!=="number"&&c!=="categorical"){let Te=`number expected, ${oe} found`;return gn(r)&&c===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(G.key,ge,Te)]}return c!=="categorical"||oe!=="number"||isFinite(se)&&Math.floor(se)===se?c!=="categorical"&&oe==="number"&&g!==void 0&&se<g?[new He(G.key,ge,"stop domain values must appear in ascending order")]:(g=se,c==="categorical"&&se in x?[new He(G.key,ge,"stop domain values must be unique")]:(x[se]=!0,[])):[new He(G.key,ge,`integer expected, found ${se}`)]}}function yo(a){const r=(a.expressionContext==="property"?Dd:Xa)(Hi(a.value),a.valueSpec);if(r.result==="error")return r.value.map(d=>new He(`${a.key}${d.key}`,a.value,d.message));const c=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!c.outputDefined())return[new He(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Z(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Z(c))return[new He(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!ce(c,["zoom","feature-state"]))return[new He(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!j(c))return[new He(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ya(a){const r=a.key,c=a.value,d=a.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(Bt(c))===-1&&g.push(new He(r,c,`expected one of [${d.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(d.values).indexOf(Bt(c))===-1&&g.push(new He(r,c,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function na(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!na(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const qm={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Jl(a){if(a==null)return{filter:()=>!0,needGeometry:!1};na(a)||(a=Ka(a));const r=Xa(a,qm);if(r.result==="error")throw new Error(r.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,d,g)=>r.value.evaluate(c,d,{},g),needGeometry:Bd(a)}}function Fd(a,r){return a<r?-1:a>r?1:0}function Bd(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(Bd(a[r]))return!0;return!1}function Ka(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Pu(a[1],a[2],"=="):r==="!="?ia(Pu(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Pu(a[1],a[2],r):r==="any"?(c=a.slice(1),["any"].concat(c.map(Ka))):r==="all"?["all"].concat(a.slice(1).map(Ka)):r==="none"?["all"].concat(a.slice(1).map(Ka).map(ia)):r==="in"?Ql(a[1],a.slice(2)):r==="!in"?ia(Ql(a[1],a.slice(2))):r==="has"?Ja(a[1]):r==="!has"?ia(Ja(a[1])):r!=="within"||a;var c}function Pu(a,r,c){switch(a){case"$type":return[`filter-type-${c}`,r];case"$id":return[`filter-id-${c}`,r];default:return[`filter-${c}`,a,r]}}function Ql(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(c=>typeof c!=typeof r[0])?["filter-in-large",a,["literal",r.sort(Fd)]]:["filter-in-small",a,["literal",r]]}}function Ja(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ia(a){return["!",a]}function Qa(a){return na(Hi(a.value))?yo(wi({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Nd(a)}function Nd(a){const r=a.value,c=a.key;if(Kt(r)!=="array")return[new He(c,r,`array expected, ${Kt(r)} found`)];const d=a.styleSpec;let g,y=[];if(r.length<1)return[new He(c,r,"filter array must have at least 1 element")];switch(y=y.concat(Ya({key:`${c}[0]`,value:r[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),Bt(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Bt(r[1])==="$type"&&y.push(new He(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new He(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Kt(r[1]),g!=="string"&&y.push(new He(`${c}[1]`,r[1],`string expected, ${g} found`)));for(let x=2;x<r.length;x++)g=Kt(r[x]),Bt(r[1])==="$type"?y=y.concat(Ya({key:`${c}[${x}]`,value:r[x],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new He(`${c}[${x}]`,r[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)y=y.concat(Nd({key:`${c}[${x}]`,value:r[x],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=Kt(r[1]),r.length!==2?y.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new He(`${c}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Kt(r[1]),r.length!==2?y.push(new He(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new He(`${c}[1]`,r[1],`object expected, ${g} found`))}return y}function el(a,r){const c=a.key,d=a.style,g=a.styleSpec,y=a.value,x=a.objectKey,E=g[`${r}_${a.layerType}`];if(!E)return[];const S=x.match(/^(.*)-transition$/);if(r==="paint"&&S&&E[S[1]]&&E[S[1]].transition)return ar({key:c,value:y,valueSpec:g.transition,style:d,styleSpec:g});const P=a.valueSpec||E[x];if(!P)return[new He(c,y,`unknown property "${x}"`)];let D;if(Kt(y)==="string"&&gn(P)&&!P.tokens&&(D=/^{([^}]+)}$/.exec(y)))return[new He(c,y,`"${x}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return a.layerType==="symbol"&&(x==="text-field"&&d&&!d.glyphs&&O.push(new He(c,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&dn(Hi(y))&&Bt(y.type)==="identity"&&O.push(new He(c,y,'"text-font" does not support identity functions'))),O.concat(ar({key:a.key,value:y,valueSpec:P,style:d,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:x}))}function Ud(a){return el(a,"paint")}function Vd(a){return el(a,"layout")}function jd(a){let r=[];const c=a.value,d=a.key,g=a.style,y=a.styleSpec;c.type||c.ref||r.push(new He(d,c,'either "type" or "ref" is required'));let x=Bt(c.type);const E=Bt(c.ref);if(c.id){const S=Bt(c.id);for(let P=0;P<a.arrayIndex;P++){const D=g.layers[P];Bt(D.id)===S&&r.push(new He(d,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let S;["type","source","source-layer","filter","layout"].forEach(P=>{P in c&&r.push(new He(d,c[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{Bt(P.id)===E&&(S=P)}),S?S.ref?r.push(new He(d,c.ref,"ref cannot reference another ref layer")):x=Bt(S.type):r.push(new He(d,c.ref,`ref layer "${E}" not found`))}else if(x!=="background")if(c.source){const S=g.sources&&g.sources[c.source],P=S&&Bt(S.type);S?P==="vector"&&x==="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a raster source`)):P==="raster"&&x!=="raster"?r.push(new He(d,c.source,`layer "${c.id}" requires a vector source`)):P!=="vector"||c["source-layer"]?P==="raster-dem"&&x!=="hillshade"?r.push(new He(d,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||P==="geojson"&&S.lineMetrics||r.push(new He(d,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new He(d,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new He(d,c.source,`source "${c.source}" not found`))}else r.push(new He(d,c,'missing required property "source"'));return r=r.concat(Br({key:d,value:c,valueSpec:y.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ar({key:`${d}.type`,value:c.type,valueSpec:y.layer.type,style:a.style,styleSpec:a.styleSpec,object:c,objectKey:"type"}),filter:Qa,layout:S=>Br({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>Vd(wi({layerType:x},P))}}),paint:S=>Br({layer:c,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":P=>Ud(wi({layerType:x},P))}})}})),r}function ra(a){const r=a.value,c=a.key,d=Kt(r);return d!=="string"?[new He(c,r,`string expected, ${d} found`)]:[]}const Gd={promoteId:function({key:a,value:r}){if(Kt(r)==="string")return ra({key:a,value:r});{const c=[];for(const d in r)c.push(...ra({key:`${a}.${d}`,value:r[d]}));return c}}};function tl(a){const r=a.value,c=a.key,d=a.styleSpec,g=a.style;if(!r.type)return[new He(c,r,'"type" is required')];const y=Bt(r.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=Br({key:c,value:r,valueSpec:d[`source_${y.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Gd}),x;case"geojson":if(x=Br({key:c,value:r,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Gd}),r.cluster)for(const E in r.clusterProperties){const[S,P]=r.clusterProperties[E],D=typeof S=="string"?[S,["accumulated"],["get",E]]:S;x.push(...yo({key:`${c}.${E}.map`,value:P,expressionContext:"cluster-map"})),x.push(...yo({key:`${c}.${E}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return x;case"video":return Br({key:c,value:r,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return Br({key:c,value:r,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new He(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ya({key:`${c}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function nl(a){const r=a.value,c=a.styleSpec,d=c.light,g=a.style;let y=[];const x=Kt(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new He("light",r,`object expected, ${x} found`)]),y;for(const E in r){const S=E.match(/^(.*)-transition$/);y=y.concat(S&&d[S[1]]&&d[S[1]].transition?ar({key:E,value:r[E],valueSpec:c.transition,style:g,styleSpec:c}):d[E]?ar({key:E,value:r[E],valueSpec:d[E],style:g,styleSpec:c}):[new He(E,r[E],`unknown property "${E}"`)])}return y}function or(a){const r=a.value,c=a.styleSpec,d=c.terrain,g=a.style;let y=[];const x=Kt(r);if(r===void 0)return y;if(x!=="object")return y=y.concat([new He("terrain",r,`object expected, ${x} found`)]),y;for(const E in r)y=y.concat(d[E]?ar({key:E,value:r[E],valueSpec:d[E],style:g,styleSpec:c}):[new He(E,r[E],`unknown property "${E}"`)]);return y}const il={"*":()=>[],array:zd,boolean:function(a){const r=a.value,c=a.key,d=Kt(r);return d!=="boolean"?[new He(c,r,`boolean expected, ${d} found`)]:[]},number:Iu,color:function(a){const r=a.key,c=a.value,d=Kt(c);return d!=="string"?[new He(r,c,`color expected, ${d} found`)]:$s(c)===null?[new He(r,c,`color expected, "${c}" found`)]:[]},constants:ss,enum:Ya,filter:Qa,function:Od,layer:jd,object:Br,source:tl,light:nl,terrain:or,string:ra,formatted:function(a){return ra(a).length===0?[]:yo(a)},resolvedImage:function(a){return ra(a).length===0?[]:yo(a)},padding:function(a){const r=a.key,c=a.value;if(Kt(c)==="array"){if(c.length<1||c.length>4)return[new He(r,c,`padding requires 1 to 4 values; ${c.length} values found`)];const d={type:"number"};let g=[];for(let y=0;y<c.length;y++)g=g.concat(ar({key:`${r}[${y}]`,value:c[y],valueSpec:d}));return g}return Iu({key:r,value:c,valueSpec:{}})}};function ar(a){const r=a.value,c=a.valueSpec,d=a.styleSpec;return c.expression&&dn(Bt(r))?Od(a):c.expression&&qa(Hi(r))?yo(a):c.type&&il[c.type]?il[c.type](a):Br(wi({},a,{valueSpec:c.type?d[c.type]:c}))}function Xm(a){const r=a.value,c=a.key,d=ra(a);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new He(c,r,'"glyphs" url must include a "{range}" token'))),d}function qs(a,r=Me){let c=[];return c=c.concat(ar({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,objectElementValidators:{glyphs:Xm,"*":()=>[]}})),a.constants&&(c=c.concat(ss({key:"constants",value:a.constants,style:a,styleSpec:r}))),Hd(c)}function Hd(a){return[].concat(a).sort((r,c)=>r.line-c.line)}function Ss(a){return function(...r){return Hd(a.apply(this,r))}}qs.source=Ss(tl),qs.light=Ss(nl),qs.terrain=Ss(or),qs.layer=Ss(jd),qs.filter=Ss(Qa),qs.paintProperty=Ss(Ud),qs.layoutProperty=Ss(Vd);const rl=qs,Cu=rl.light,Zm=rl.paintProperty,Ym=rl.layoutProperty;function ec(a,r){let c=!1;if(r&&r.length)for(const d of r)a.fire(new js(new Error(d.message))),c=!0;return c}class sl{constructor(r,c,d){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const x=new Int32Array(this.arrayBuffer);r=x[0],this.d=(c=x[1])+2*(d=x[2]);for(let S=0;S<this.d*this.d;S++){const P=x[3+S],D=x[3+S+1];g.push(P===D?null:x.subarray(P,D))}const E=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],E),this.bboxes=x.subarray(E),this.insert=this._insertReadonly}else{this.d=c+2*d;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=r,this.padding=d,this.scale=c/r,this.uid=0;const y=d/c*r;this.min=-y,this.max=r+y}insert(r,c,d,g,y){this._forEachCell(c,d,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,c,d,g,y,x){this.cells[y].push(x)}query(r,c,d,g,y){const x=this.min,E=this.max;if(r<=x&&c<=x&&E<=d&&E<=g&&!y)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(r,c,d,g,this._queryCell,S,{},y),S}}_queryCell(r,c,d,g,y,x,E,S){const P=this.cells[y];if(P!==null){const D=this.keys,O=this.bboxes;for(let N=0;N<P.length;N++){const G=P[N];if(E[G]===void 0){const H=4*G;(S?S(O[H+0],O[H+1],O[H+2],O[H+3]):r<=O[H+2]&&c<=O[H+3]&&d>=O[H+0]&&g>=O[H+1])?(E[G]=!0,x.push(D[G])):E[G]=!1}}}}_forEachCell(r,c,d,g,y,x,E,S){const P=this._convertToCellCoord(r),D=this._convertToCellCoord(c),O=this._convertToCellCoord(d),N=this._convertToCellCoord(g);for(let G=P;G<=O;G++)for(let H=D;H<=N;H++){const oe=this.d*H+G;if((!S||S(this._convertFromCellCoord(G),this._convertFromCellCoord(H),this._convertFromCellCoord(G+1),this._convertFromCellCoord(H+1)))&&y.call(this,r,c,d,g,oe,x,E,S))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,c=3+this.cells.length+1+1;let d=0;for(let x=0;x<this.cells.length;x++)d+=this.cells[x].length;const g=new Int32Array(c+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=c;for(let x=0;x<r.length;x++){const E=r[x];g[3+x]=y,g.set(E,y),y+=E.length}return g[3+r.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+r.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(r,c){const d=r.toArrayBuffer();return c&&c.push(d),{buffer:d}}static deserialize(r){return new sl(r.buffer)}}const As={};function rt(a,r,c={}){if(As[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),As[a]={klass:r,omit:c.omit||[],shallow:c.shallow||[]}}rt("Object",Object),rt("TransferableGridIndex",sl),rt("Color",q),rt("Error",Error),rt("AJAXError",Xn),rt("ResolvedImage",fe),rt("StylePropertyFunction",Yl),rt("StyleExpression",Zl,{omit:["_evaluator"]}),rt("ZoomDependentExpression",Au),rt("ZoomConstantExpression",Za),rt("CompoundExpression",Nt,{omit:["_evaluate"]});for(const a in Qo)Qo[a]._classRegistryKey||rt(`Expression_${a}`,Qo[a]);function $d(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function vo(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob)return a;if($d(a)||Dt(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const c=a;return r&&r.push(c.buffer),c}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const c=[];for(const d of a)c.push(vo(d,r));return c}if(typeof a=="object"){const c=a.constructor,d=c._classRegistryKey;if(!d)throw new Error("can't serialize object of unregistered class");if(!As[d])throw new Error(`${d} is not registered.`);const g=c.serialize?c.serialize(a,r):{};if(c.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in a){if(!a.hasOwnProperty(y)||As[d].omit.indexOf(y)>=0)continue;const x=a[y];g[y]=As[d].shallow.indexOf(y)>=0?x:vo(x,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof a)}function Xs(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||$d(a)||Dt(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Xs);if(typeof a=="object"){const r=a.$name||"Object";if(!As[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:c}=As[r];if(!c)throw new Error(`can't deserialize unregistered class ${r}`);if(c.deserialize)return c.deserialize(a);const d=Object.create(c.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const y=a[g];d[g]=As[r].shallow.indexOf(g)>=0?y:Xs(y)}return d}throw new Error("can't deserialize object of type "+typeof a)}class Mu{constructor(){this.first=!0}update(r,c){const d=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=c),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=d,!0))}}const Ye={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function tc(a){for(const r of a)if(Lu(r.charCodeAt(0)))return!0;return!1}function Km(a){for(const r of a)if(!ku(r.charCodeAt(0)))return!1;return!0}function ku(a){return!(Ye.Arabic(a)||Ye["Arabic Supplement"](a)||Ye["Arabic Extended-A"](a)||Ye["Arabic Presentation Forms-A"](a)||Ye["Arabic Presentation Forms-B"](a))}function Lu(a){return!(a!==746&&a!==747&&(a<4352||!(Ye["Bopomofo Extended"](a)||Ye.Bopomofo(a)||Ye["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ye["CJK Compatibility Ideographs"](a)||Ye["CJK Compatibility"](a)||Ye["CJK Radicals Supplement"](a)||Ye["CJK Strokes"](a)||!(!Ye["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ye["CJK Unified Ideographs Extension A"](a)||Ye["CJK Unified Ideographs"](a)||Ye["Enclosed CJK Letters and Months"](a)||Ye["Hangul Compatibility Jamo"](a)||Ye["Hangul Jamo Extended-A"](a)||Ye["Hangul Jamo Extended-B"](a)||Ye["Hangul Jamo"](a)||Ye["Hangul Syllables"](a)||Ye.Hiragana(a)||Ye["Ideographic Description Characters"](a)||Ye.Kanbun(a)||Ye["Kangxi Radicals"](a)||Ye["Katakana Phonetic Extensions"](a)||Ye.Katakana(a)&&a!==12540||!(!Ye["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ye["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ye["Unified Canadian Aboriginal Syllabics"](a)||Ye["Unified Canadian Aboriginal Syllabics Extended"](a)||Ye["Vertical Forms"](a)||Ye["Yijing Hexagram Symbols"](a)||Ye["Yi Syllables"](a)||Ye["Yi Radicals"](a))))}function Wd(a){return!(Lu(a)||function(r){return!!(Ye["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ye["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ye["Letterlike Symbols"](r)||Ye["Number Forms"](r)||Ye["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ye["Control Pictures"](r)&&r!==9251||Ye["Optical Character Recognition"](r)||Ye["Enclosed Alphanumerics"](r)||Ye["Geometric Shapes"](r)||Ye["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ye["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ye["CJK Symbols and Punctuation"](r)||Ye.Katakana(r)||Ye["Private Use Area"](r)||Ye["CJK Compatibility Forms"](r)||Ye["Small Form Variants"](r)||Ye["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function qd(a){return a>=1424&&a<=2303||Ye["Arabic Presentation Forms-A"](a)||Ye["Arabic Presentation Forms-B"](a)}function Jm(a,r){return!(!r&&qd(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ye.Khmer(a))}function Xd(a){for(const r of a)if(qd(r.charCodeAt(0)))return!0;return!1}const Ru="deferred",Du="loading",zu="loaded";let Ou=null,$i="unavailable",Zs=null;const Zd=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&($i="error"),Ou&&Ou(a)};function sa(){Fu.fire(new Dr("pluginStateChange",{pluginStatus:$i,pluginURL:Zs}))}const Fu=new xr,ol=function(){return $i},Yd=function(){if($i!==Ru||!Zs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");$i=Du,sa(),Zs&&Gi({url:Zs},a=>{a?Zd(a):($i=zu,sa())})},Er={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>$i===zu||Er.applyArabicShaping!=null,isLoading:()=>$i===Du,setState(a){if(!Ue())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");$i=a.pluginStatus,Zs=a.pluginURL},isParsed(){if(!Ue())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Er.applyArabicShaping!=null&&Er.processBidirectionalText!=null&&Er.processStyledBidirectionalText!=null},getPluginURL(){if(!Ue())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Zs}};class vn{constructor(r,c){this.zoom=r,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mu,this.transition={})}isSupportedScript(r){return function(c,d){for(const g of c)if(!Jm(g.charCodeAt(0),d))return!1;return!0}(r,Er.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,c=r-Math.floor(r),d=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*c}}}class al{constructor(r,c){this.property=r,this.value=c,this.expression=function(d,g){if(dn(d))return new Yl(d,g);if(qa(d)){const y=Dd(d,g);if(y.result==="error")throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=d;return g.type==="color"&&typeof d=="string"?y=q.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)||(y=ae.parse(d)),{kind:"constant",evaluate:()=>y}}}(c===void 0?r.specification.default:c,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,c,d){return this.property.possiblyEvaluate(this,r,c,d)}}class nc{constructor(r){this.property=r,this.value=new al(r,void 0)}transitioned(r,c){return new Jd(this.property,this.value,c,te({},r.transition,this.transition),r.now)}untransitioned(){return new Jd(this.property,this.value,null,{},0)}}class Kd{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Q(this._values[r].value.value)}setValue(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new nc(this._values[r].property)),this._values[r].value=new al(this._values[r].property,c===null?void 0:Q(c))}getTransition(r){return Q(this._values[r].transition)}setTransition(r,c){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new nc(this._values[r].property)),this._values[r].transition=Q(c)||void 0}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d);const g=this.getTransition(c);g!==void 0&&(r[`${c}-transition`]=g)}return r}transitioned(r,c){const d=new Qd(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(r,c._values[g]);return d}untransitioned(){const r=new Qd(this._properties);for(const c of Object.keys(this._values))r._values[c]=this._values[c].untransitioned();return r}}class Jd{constructor(r,c,d,g,y){this.property=r,this.value=c,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(r,c,d){const g=r.now||0,y=this.value.possiblyEvaluate(r,c,d),x=this.prior;if(x){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return x.possiblyEvaluate(r,c,d);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(r,c,d),y,function(S){if(S<=0)return 0;if(S>=1)return 1;const P=S*S,D=P*S;return 4*(S<.5?D:3*(S-P)+D-.75)}(E))}}return y}}class Qd{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,c,d){const g=new ll(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,c,d);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Qm{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Q(this._values[r].value)}setValue(r,c){this._values[r]=new al(this._values[r].property,c===null?void 0:Q(c))}serialize(){const r={};for(const c of Object.keys(this._values)){const d=this.getValue(c);d!==void 0&&(r[c]=d)}return r}possiblyEvaluate(r,c,d){const g=new ll(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,c,d);return g}}class ls{constructor(r,c,d){this.property=r,this.value=c,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,c,d,g){return this.property.evaluate(this.value,this.parameters,r,c,d,g)}}class ll{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ut{constructor(r){this.specification=r}possiblyEvaluate(r,c){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(c)}interpolate(r,c,d){const g=Fn[this.specification.type];return g?g(r,c,d):r}}class bt{constructor(r,c){this.specification=r,this.overrides=c}possiblyEvaluate(r,c,d,g){return new ls(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(c,null,{},d,g)}:r.expression,c)}interpolate(r,c,d){if(r.value.kind!=="constant"||c.value.kind!=="constant")return r;if(r.value.value===void 0||c.value.value===void 0)return new ls(this,{kind:"constant",value:void 0},r.parameters);const g=Fn[this.specification.type];return g?new ls(this,{kind:"constant",value:g(r.value.value,c.value.value,d)},r.parameters):r}evaluate(r,c,d,g,y,x){return r.kind==="constant"?r.value:r.evaluate(c,d,g,y,x)}}class oa extends bt{possiblyEvaluate(r,c,d,g){if(r.value===void 0)return new ls(this,{kind:"constant",value:void 0},c);if(r.expression.kind==="constant"){const y=r.expression.evaluate(c,null,{},d,g),x=r.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,E=this._calculate(x,x,x,c);return new ls(this,{kind:"constant",value:E},c)}if(r.expression.kind==="camera"){const y=this._calculate(r.expression.evaluate({zoom:c.zoom-1}),r.expression.evaluate({zoom:c.zoom}),r.expression.evaluate({zoom:c.zoom+1}),c);return new ls(this,{kind:"constant",value:y},c)}return new ls(this,r.expression,c)}evaluate(r,c,d,g,y,x){if(r.kind==="source"){const E=r.evaluate(c,d,g,y,x);return this._calculate(E,E,E,c)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(c.zoom)-1},d,g),r.evaluate({zoom:Math.floor(c.zoom)},d,g),r.evaluate({zoom:Math.floor(c.zoom)+1},d,g),c):r.value}_calculate(r,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class Bu{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const y=r.expression.evaluate(c,null,{},d,g);return this._calculate(y,y,y,c)}return this._calculate(r.expression.evaluate(new vn(Math.floor(c.zoom-1),c)),r.expression.evaluate(new vn(Math.floor(c.zoom),c)),r.expression.evaluate(new vn(Math.floor(c.zoom+1),c)),c)}}_calculate(r,c,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:c}:{from:d,to:c}}interpolate(r){return r}}class Ys{constructor(r){this.specification=r}possiblyEvaluate(r,c,d,g){return!!r.expression.evaluate(c,null,{},d,g)}interpolate(){return!1}}class pi{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in r){const d=r[c];d.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new al(d,void 0),y=this.defaultTransitionablePropertyValues[c]=new nc(d);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}rt("DataDrivenProperty",bt),rt("DataConstantProperty",ut),rt("CrossFadedDataDrivenProperty",oa),rt("CrossFadedProperty",Bu),rt("ColorRampProperty",Ys);const Ks="-transition";class cs extends xr{constructor(r,c){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),c.layout&&(this._unevaluatedLayout=new Qm(c.layout)),c.paint)){this._transitionablePaint=new Kd(c.paint);for(const d in r.paint)this.setPaintProperty(d,r.paint[d],{validate:!1});for(const d in r.layout)this.setLayoutProperty(d,r.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ll(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,c,d={}){c!=null&&this._validate(Ym,`layers.${this.id}.layout.${r}`,r,c,d)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,c):this.visibility=c)}getPaintProperty(r){return r.endsWith(Ks)?this._transitionablePaint.getTransition(r.slice(0,-Ks.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,c,d={}){if(c!=null&&this._validate(Zm,`layers.${this.id}.paint.${r}`,r,c,d))return!1;if(r.endsWith(Ks))return this._transitionablePaint.setTransition(r.slice(0,-Ks.length),c||void 0),!1;{const g=this._transitionablePaint._values[r],y=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(r,c),this._handleSpecialPaintPropertyUpdate(r);const S=this._transitionablePaint._values[r].value;return S.isDataDriven()||x||y||this._handleOverridablePaintPropertyUpdate(r,E,S)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,c,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,c){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,c)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),W(r,(c,d)=>!(c===void 0||d==="layout"&&!Object.keys(c).length||d==="paint"&&!Object.keys(c).length))}_validate(r,c,d,g,y={}){return(!y||y.validate!==!1)&&ec(this,r.call(rl,{key:c,layerType:this.type,objectKey:d,value:g,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const c=this.paint.get(r);if(c instanceof ls&&gn(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const ef={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Js{constructor(r,c){this._structArray=r,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class kn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,c){return r._trim(),c&&(r.isTransferred=!0,c.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const c=Object.create(this.prototype);return c.arrayBuffer=r.arrayBuffer,c.length=r.length,c.capacity=r.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gn(a,r=1){let c=0,d=0;return{members:a.map(g=>{const y=ef[g.type].BYTES_PER_ELEMENT,x=c=Nu(c,Math.max(r,y)),E=g.components||1;return d=Math.max(d,y),c+=y*E,{name:g.name,type:g.type,components:E,offset:x}}),size:Nu(c,Math.max(d,r)),alignment:r}}function Nu(a,r){return Math.ceil(a/r)*r}class xo extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.int16[g+0]=c,this.int16[g+1]=d,r}}xo.prototype.bytesPerElement=4,rt("StructArrayLayout2i4",xo);class m extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=4*r;return this.int16[x+0]=c,this.int16[x+1]=d,this.int16[x+2]=g,this.int16[x+3]=y,r}}m.prototype.bytesPerElement=8,rt("StructArrayLayout4i8",m);class s extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,E){const S=6*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=x,this.int16[S+5]=E,r}}s.prototype.bytesPerElement=12,rt("StructArrayLayout2i4i12",s);class h extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,E){const S=4*r,P=8*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.uint8[P+4]=g,this.uint8[P+5]=y,this.uint8[P+6]=x,this.uint8[P+7]=E,r}}h.prototype.bytesPerElement=8,rt("StructArrayLayout2i4ub8",h);class p extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.float32[g+0]=c,this.float32[g+1]=d,r}}p.prototype.bytesPerElement=8,rt("StructArrayLayout2f8",p);class _ extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,E,S,P,D){const O=this.length;return this.resize(O+1),this.emplace(O,r,c,d,g,y,x,E,S,P,D)}emplace(r,c,d,g,y,x,E,S,P,D,O){const N=10*r;return this.uint16[N+0]=c,this.uint16[N+1]=d,this.uint16[N+2]=g,this.uint16[N+3]=y,this.uint16[N+4]=x,this.uint16[N+5]=E,this.uint16[N+6]=S,this.uint16[N+7]=P,this.uint16[N+8]=D,this.uint16[N+9]=O,r}}_.prototype.bytesPerElement=20,rt("StructArrayLayout10ui20",_);class v extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,E,S,P,D,O,N){const G=this.length;return this.resize(G+1),this.emplace(G,r,c,d,g,y,x,E,S,P,D,O,N)}emplace(r,c,d,g,y,x,E,S,P,D,O,N,G){const H=12*r;return this.int16[H+0]=c,this.int16[H+1]=d,this.int16[H+2]=g,this.int16[H+3]=y,this.uint16[H+4]=x,this.uint16[H+5]=E,this.uint16[H+6]=S,this.uint16[H+7]=P,this.int16[H+8]=D,this.int16[H+9]=O,this.int16[H+10]=N,this.int16[H+11]=G,r}}v.prototype.bytesPerElement=24,rt("StructArrayLayout4i4ui4i24",v);class w extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.float32[y+0]=c,this.float32[y+1]=d,this.float32[y+2]=g,r}}w.prototype.bytesPerElement=12,rt("StructArrayLayout3f12",w);class A extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint32[1*r+0]=c,r}}A.prototype.bytesPerElement=4,rt("StructArrayLayout1ul4",A);class I extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,E,S,P){const D=this.length;return this.resize(D+1),this.emplace(D,r,c,d,g,y,x,E,S,P)}emplace(r,c,d,g,y,x,E,S,P,D){const O=10*r,N=5*r;return this.int16[O+0]=c,this.int16[O+1]=d,this.int16[O+2]=g,this.int16[O+3]=y,this.int16[O+4]=x,this.int16[O+5]=E,this.uint32[N+3]=S,this.uint16[O+8]=P,this.uint16[O+9]=D,r}}I.prototype.bytesPerElement=20,rt("StructArrayLayout6i1ul2ui20",I);class M extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x){const E=this.length;return this.resize(E+1),this.emplace(E,r,c,d,g,y,x)}emplace(r,c,d,g,y,x,E){const S=6*r;return this.int16[S+0]=c,this.int16[S+1]=d,this.int16[S+2]=g,this.int16[S+3]=y,this.int16[S+4]=x,this.int16[S+5]=E,r}}M.prototype.bytesPerElement=12,rt("StructArrayLayout2i2i2i12",M);class z extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y){const x=this.length;return this.resize(x+1),this.emplace(x,r,c,d,g,y)}emplace(r,c,d,g,y,x){const E=4*r,S=8*r;return this.float32[E+0]=c,this.float32[E+1]=d,this.float32[E+2]=g,this.int16[S+6]=y,this.int16[S+7]=x,r}}z.prototype.bytesPerElement=16,rt("StructArrayLayout2f1f2i16",z);class B extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=12*r,E=3*r;return this.uint8[x+0]=c,this.uint8[x+1]=d,this.float32[E+1]=g,this.float32[E+2]=y,r}}B.prototype.bytesPerElement=12,rt("StructArrayLayout2ub2f12",B);class V extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.uint16[y+0]=c,this.uint16[y+1]=d,this.uint16[y+2]=g,r}}V.prototype.bytesPerElement=6,rt("StructArrayLayout3ui6",V);class ne extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge){const Te=this.length;return this.resize(Te+1),this.emplace(Te,r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge)}emplace(r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge,Te){const me=24*r,be=12*r,De=48*r;return this.int16[me+0]=c,this.int16[me+1]=d,this.uint16[me+2]=g,this.uint16[me+3]=y,this.uint32[be+2]=x,this.uint32[be+3]=E,this.uint32[be+4]=S,this.uint16[me+10]=P,this.uint16[me+11]=D,this.uint16[me+12]=O,this.float32[be+7]=N,this.float32[be+8]=G,this.uint8[De+36]=H,this.uint8[De+37]=oe,this.uint8[De+38]=se,this.uint32[be+10]=ge,this.int16[me+22]=Te,r}}ne.prototype.bytesPerElement=48,rt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ne);class K extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge,Te,me,be,De,Re,nt,lt,Ke,We,je,Je){const qe=this.length;return this.resize(qe+1),this.emplace(qe,r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge,Te,me,be,De,Re,nt,lt,Ke,We,je,Je)}emplace(r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe,se,ge,Te,me,be,De,Re,nt,lt,Ke,We,je,Je,qe){const Ne=34*r,_t=17*r;return this.int16[Ne+0]=c,this.int16[Ne+1]=d,this.int16[Ne+2]=g,this.int16[Ne+3]=y,this.int16[Ne+4]=x,this.int16[Ne+5]=E,this.int16[Ne+6]=S,this.int16[Ne+7]=P,this.uint16[Ne+8]=D,this.uint16[Ne+9]=O,this.uint16[Ne+10]=N,this.uint16[Ne+11]=G,this.uint16[Ne+12]=H,this.uint16[Ne+13]=oe,this.uint16[Ne+14]=se,this.uint16[Ne+15]=ge,this.uint16[Ne+16]=Te,this.uint16[Ne+17]=me,this.uint16[Ne+18]=be,this.uint16[Ne+19]=De,this.uint16[Ne+20]=Re,this.uint16[Ne+21]=nt,this.uint16[Ne+22]=lt,this.uint32[_t+12]=Ke,this.float32[_t+13]=We,this.float32[_t+14]=je,this.float32[_t+15]=Je,this.float32[_t+16]=qe,r}}K.prototype.bytesPerElement=68,rt("StructArrayLayout8i15ui1ul4f68",K);class ee extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.float32[1*r+0]=c,r}}ee.prototype.bytesPerElement=4,rt("StructArrayLayout1f4",ee);class he extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=3*r;return this.int16[y+0]=c,this.int16[y+1]=d,this.int16[y+2]=g,r}}he.prototype.bytesPerElement=6,rt("StructArrayLayout3i6",he);class pe extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,c,d)}emplace(r,c,d,g){const y=4*r;return this.uint32[2*r+0]=c,this.uint16[y+2]=d,this.uint16[y+3]=g,r}}pe.prototype.bytesPerElement=8,rt("StructArrayLayout1ul2ui8",pe);class ve extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,c){const d=this.length;return this.resize(d+1),this.emplace(d,r,c)}emplace(r,c,d){const g=2*r;return this.uint16[g+0]=c,this.uint16[g+1]=d,r}}ve.prototype.bytesPerElement=4,rt("StructArrayLayout2ui4",ve);class re extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const c=this.length;return this.resize(c+1),this.emplace(c,r)}emplace(r,c){return this.uint16[1*r+0]=c,r}}re.prototype.bytesPerElement=2,rt("StructArrayLayout1ui2",re);class Ee extends kn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,c,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,c,d,g)}emplace(r,c,d,g,y){const x=4*r;return this.float32[x+0]=c,this.float32[x+1]=d,this.float32[x+2]=g,this.float32[x+3]=y,r}}Ee.prototype.bytesPerElement=16,rt("StructArrayLayout4f16",Ee);class xe extends Js{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new vt(this.anchorPointX,this.anchorPointY)}}xe.prototype.size=20;class ke extends I{get(r){return new xe(this,r)}}rt("CollisionBoxArray",ke);class Le extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Le.prototype.size=48;class Fe extends ne{get(r){return new Le(this,r)}}rt("PlacedSymbolArray",Fe);class Pe extends Js{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Pe.prototype.size=68;class Qe extends K{get(r){return new Pe(this,r)}}rt("SymbolInstanceArray",Qe);class $e extends ee{getoffsetX(r){return this.float32[1*r+0]}}rt("GlyphOffsetArray",$e);class tt extends he{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}rt("SymbolLineVertexArray",tt);class Ct extends Js{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Ct.prototype.size=8;class Lt extends pe{get(r){return new Ct(this,r)}}rt("FeatureIndexArray",Lt);class gt extends xo{}class rn extends xo{}class sn extends xo{}class Gt extends s{}class Ht extends h{}class an extends p{}class si extends _{}class us extends v{}class Nr extends w{}class hs extends A{}class Qs extends M{}class Tr extends B{}class Wi extends V{}class Is extends ve{}const ic=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kn}=ic;class Ft{constructor(r=[]){this.segments=r}prepareSegment(r,c,d,g){let y=this.segments[this.segments.length-1];return r>Ft.MAX_VERTEX_ARRAY_LENGTH&&we(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>Ft.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:c.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const r of this.segments)for(const c in r.vaos)r.vaos[c].destroy()}static simpleSegment(r,c,d,g){return new Ft([{vertexOffset:r,primitiveOffset:c,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function Qt(a,r){return 256*(a=k(Math.floor(a),0,255))+k(Math.floor(r),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rt("SegmentVector",Ft);const oi=Gn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ai={exports:{}},xn={exports:{}};xn.exports=function(a,r){var c,d,g,y,x,E,S,P;for(d=a.length-(c=3&a.length),g=r,x=3432918353,E=461845907,P=0;P<d;)S=255&a.charCodeAt(P)|(255&a.charCodeAt(++P))<<8|(255&a.charCodeAt(++P))<<16|(255&a.charCodeAt(++P))<<24,++P,g=27492+(65535&(y=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&a.charCodeAt(P+2))<<16;case 2:S^=(255&a.charCodeAt(P+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&a.charCodeAt(P)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*E+(((S>>>16)*E&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Sr={exports:{}};Sr.exports=function(a,r){for(var c,d=a.length,g=r^d,y=0;d>=4;)c=1540483477*(65535&(c=255&a.charCodeAt(y)|(255&a.charCodeAt(++y))<<8|(255&a.charCodeAt(++y))<<16|(255&a.charCodeAt(++y))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),d-=4,++y;switch(d){case 3:g^=(255&a.charCodeAt(y+2))<<16;case 2:g^=(255&a.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var bo=xn.exports,Uu=Sr.exports;ai.exports=bo,ai.exports.murmur3=bo,ai.exports.murmur2=Uu;class aa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,c,d,g){this.ids.push(tf(r)),this.positions.push(c,d,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=tf(r);let d=0,g=this.ids.length-1;for(;d<g;){const x=d+g>>1;this.ids[x]>=c?g=x:d=x+1}const y=[];for(;this.ids[d]===c;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(r,c){const d=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Vu(d,g,0,d.length-1),c&&c.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(r){const c=new aa;return c.ids=r.ids,c.positions=r.positions,c.indexed=!0,c}}function tf(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:ai.exports(String(a))}function Vu(a,r,c,d){for(;c<d;){const g=a[c+d>>1];let y=c-1,x=d+1;for(;;){do y++;while(a[y]<g);do x--;while(a[x]>g);if(y>=x)break;eo(a,y,x),eo(r,3*y,3*x),eo(r,3*y+1,3*x+1),eo(r,3*y+2,3*x+2)}x-c<d-x?(Vu(a,r,c,x),c=x+1):(Vu(a,r,x+1,d),d=x)}}function eo(a,r,c){const d=a[r];a[r]=a[c],a[c]=d}rt("FeaturePositionMap",aa);class wo{constructor(r,c){this.gl=r.gl,this.location=c}}class Eo extends wo{constructor(r,c){super(r,c),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class rc extends wo{constructor(r,c){super(r,c),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Av extends wo{constructor(r,c){super(r,c),this.current=q.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const lA=new Float32Array(16);function eg(a){return[Qt(255*a.r,255*a.g),Qt(255*a.b,255*a.a)]}class ju{constructor(r,c,d){this.value=r,this.uniformNames=c.map(g=>`u_${g}`),this.type=d}setUniform(r,c,d){r.set(d.constantOr(this.value))}getBinding(r,c,d){return this.type==="color"?new Av(r,c):new Eo(r,c)}}class sc{constructor(r,c){this.uniformNames=c.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=r.tlbr}setUniform(r,c,d,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&r.set(y)}getBinding(r,c,d){return d.substr(0,9)==="u_pattern"?new rc(r,c):new Eo(r,c)}}class To{constructor(r,c,d,g){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=c.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,c,d,g,y){const x=this.paintVertexArray.length,E=this.expression.evaluate(new vn(0),c,{},g,[],y);this.paintVertexArray.resize(r),this._setPaintValue(x,r,E)}updatePaintArray(r,c,d,g){const y=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(r,c,y)}_setPaintValue(r,c,d){if(this.type==="color"){const g=eg(d);for(let y=r;y<c;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<c;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ps{constructor(r,c,d,g,y,x){this.expression=r,this.uniformNames=c.map(E=>`u_${E}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=c.map(E=>({name:`a_${E}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(r,c,d,g,y){const x=this.expression.evaluate(new vn(this.zoom),c,{},g,[],y),E=this.expression.evaluate(new vn(this.zoom+1),c,{},g,[],y),S=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(S,r,x,E)}updatePaintArray(r,c,d,g){const y=this.expression.evaluate({zoom:this.zoom},d,g),x=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(r,c,y,x)}_setPaintValue(r,c,d,g){if(this.type==="color"){const y=eg(d),x=eg(g);for(let E=r;E<c;E++)this.paintVertexArray.emplace(E,y[0],y[1],x[0],x[1])}else{for(let y=r;y<c;y++)this.paintVertexArray.emplace(y,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,c){const d=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=k(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,c,d){return new Eo(r,c)}}class la{constructor(r,c,d,g,y,x){this.expression=r,this.type=c,this.useIntegerZoom=d,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,c,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,c.patterns&&c.patterns[this.layerId],d)}updatePaintArray(r,c,d,g,y){this._setPaintValues(r,c,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(r,c,d,g){if(!g||!d)return;const{min:y,mid:x,max:E}=d,S=g[y],P=g[x],D=g[E];if(S&&P&&D)for(let O=r;O<c;O++)this.zoomInPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],P.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,P.tl[0],P.tl[1],P.br[0],P.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],P.pixelRatio,D.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,oi.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,oi.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Iv{constructor(r,c,d){this.binders={},this._buffers=[];const g=[];for(const y in r.paint._values){if(!d(y))continue;const x=r.paint.get(y);if(!(x instanceof ls&&gn(x.property.specification)))continue;const E=cA(y,r.type),S=x.value,P=x.property.specification.type,D=x.property.useIntegerZoom,O=x.property.specification["property-type"],N=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[y]=N?new sc(S.value,E):new ju(S.value,E,P),g.push(`/u_${y}`);else if(S.kind==="source"||N){const G=Pv(y,P,"source");this.binders[y]=N?new la(S,P,D,c,G,r.id):new To(S,E,P,G),g.push(`/a_${y}`)}else{const G=Pv(y,P,"composite");this.binders[y]=new Ps(S,E,P,D,c,G),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const c=this.binders[r];return c instanceof To||c instanceof Ps?c.maxValue:0}populatePaintArrays(r,c,d,g,y){for(const x in this.binders){const E=this.binders[x];(E instanceof To||E instanceof Ps||E instanceof la)&&E.populatePaintArray(r,c,d,g,y)}}setConstantPatternPositions(r,c){for(const d in this.binders){const g=this.binders[d];g instanceof sc&&g.setConstantPatternPositions(r,c)}}updatePaintArrays(r,c,d,g,y){let x=!1;for(const E in r){const S=c.getPositions(E);for(const P of S){const D=d.feature(P.index);for(const O in this.binders){const N=this.binders[O];if((N instanceof To||N instanceof Ps||N instanceof la)&&N.expression.isStateDependent===!0){const G=g.paint.get(O);N.expression=G.value,N.updatePaintArray(P.start,P.end,D,r[E],y),x=!0}}}}return x}defines(){const r=[];for(const c in this.binders){const d=this.binders[c];(d instanceof ju||d instanceof sc)&&r.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof To||d instanceof Ps)for(let g=0;g<d.paintVertexAttributes.length;g++)r.push(d.paintVertexAttributes[g].name);else if(d instanceof la)for(let g=0;g<oi.members.length;g++)r.push(oi.members[g].name)}return r}getBinderUniforms(){const r=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof ju||d instanceof sc||d instanceof Ps)for(const g of d.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,c){const d=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof ju||y instanceof sc||y instanceof Ps){for(const x of y.uniformNames)if(c[x]){const E=y.getBinding(r,c[x],x);d.push({name:x,property:g,binding:E})}}}return d}setUniforms(r,c,d,g){for(const{name:y,property:x,binding:E}of c)this.binders[x].setUniform(E,g,d.get(x),y)}updatePaintBuffers(r){this._buffers=[];for(const c in this.binders){const d=this.binders[c];if(r&&d instanceof la){const g=r.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof To||d instanceof Ps)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(r){for(const c in this.binders){const d=this.binders[c];(d instanceof To||d instanceof Ps||d instanceof la)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const c=this.binders[r];(c instanceof To||c instanceof Ps||c instanceof la)&&c.destroy()}}}class cl{constructor(r,c,d=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Iv(g,c,d);this.needsUpload=!1,this._featureMap=new aa,this._bufferOffset=0}populatePaintArrays(r,c,d,g,y,x){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,c,g,y,x);c.id!==void 0&&this._featureMap.add(c.id,d,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,c,d,g){for(const y of d)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,c,y,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function cA(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function Pv(a,r,c){const d={color:{source:p,composite:Ee},number:{source:ee,composite:p}},g=function(y){return{"line-pattern":{source:si,composite:si},"fill-pattern":{source:si,composite:si},"fill-extrusion-pattern":{source:si,composite:si}}[y]}(a);return g&&g[c]||d[r][c]}rt("ConstantBinder",ju),rt("CrossFadedConstantBinder",sc),rt("SourceExpressionBinder",To),rt("CrossFadedCompositeBinder",la),rt("CompositeExpressionBinder",Ps),rt("ProgramConfiguration",Iv,{omit:["_buffers"]}),rt("ProgramConfigurationSet",cl);var Jn=8192;const tg=Math.pow(2,14)-1,Cv=-tg-1;function ul(a){const r=Jn/a.extent,c=a.loadGeometry();for(let d=0;d<c.length;d++){const g=c[d];for(let y=0;y<g.length;y++){const x=g[y],E=Math.round(x.x*r),S=Math.round(x.y*r);x.x=k(E,Cv,tg),x.y=k(S,Cv,tg),(E<x.x||E>x.x+1||S<x.y||S>x.y+1)&&we("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function hl(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?ul(a):[]}}function nf(a,r,c,d,g){a.emplaceBack(2*r+(d+1)/2,2*c+(g+1)/2)}class ng{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new rn,this.indexArray=new Wi,this.segments=new Ft,this.programConfigurations=new cl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){const g=this.layers[0],y=[];let x=null,E=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),E=!x.isConstant());for(const{feature:S,id:P,index:D,sourceLayerIndex:O}of r){const N=this.layers[0]._featureFilter.needGeometry,G=hl(S,N);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),G,d))continue;const H=E?x.evaluate(G,{},d):void 0,oe={id:P,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:N?G.geometry:ul(S),patterns:{},sortKey:H};y.push(oe)}E&&y.sort((S,P)=>S.sortKey-P.sortKey);for(const S of y){const{geometry:P,index:D,sourceLayerIndex:O}=S,N=r[D].feature;this.addFeature(S,P,D,d),c.featureIndex.insert(N,P,D,O,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Kn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,c,d,g){for(const y of c)for(const x of y){const E=x.x,S=x.y;if(E<0||E>=Jn||S<0||S>=Jn)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),D=P.vertexLength;nf(this.layoutVertexArray,E,S,-1,-1),nf(this.layoutVertexArray,E,S,1,-1),nf(this.layoutVertexArray,E,S,1,1),nf(this.layoutVertexArray,E,S,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},g)}}function Mv(a,r){for(let c=0;c<a.length;c++)if(oc(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(oc(a,r[c]))return!0;return!!ig(a,r)}function uA(a,r,c){return!!oc(a,r)||!!rg(r,a,c)}function kv(a,r){if(a.length===1)return Rv(r,a[0]);for(let c=0;c<r.length;c++){const d=r[c];for(let g=0;g<d.length;g++)if(oc(a,d[g]))return!0}for(let c=0;c<a.length;c++)if(Rv(r,a[c]))return!0;for(let c=0;c<r.length;c++)if(ig(a,r[c]))return!0;return!1}function hA(a,r,c){if(a.length>1){if(ig(a,r))return!0;for(let d=0;d<r.length;d++)if(rg(r[d],a,c))return!0}for(let d=0;d<a.length;d++)if(rg(a[d],r,c))return!0;return!1}function ig(a,r){if(a.length===0||r.length===0)return!1;for(let c=0;c<a.length-1;c++){const d=a[c],g=a[c+1];for(let y=0;y<r.length-1;y++)if(dA(d,g,r[y],r[y+1]))return!0}return!1}function dA(a,r,c,d){return Ce(a,c,d)!==Ce(r,c,d)&&Ce(a,r,c)!==Ce(a,r,d)}function rg(a,r,c){const d=c*c;if(r.length===1)return a.distSqr(r[0])<d;for(let g=1;g<r.length;g++)if(Lv(a,r[g-1],r[g])<d)return!0;return!1}function Lv(a,r,c){const d=r.distSqr(c);if(d===0)return a.distSqr(r);const g=((a.x-r.x)*(c.x-r.x)+(a.y-r.y)*(c.y-r.y))/d;return a.distSqr(g<0?r:g>1?c:c.sub(r)._mult(g)._add(r))}function Rv(a,r){let c,d,g,y=!1;for(let x=0;x<a.length;x++){c=a[x];for(let E=0,S=c.length-1;E<c.length;S=E++)d=c[E],g=c[S],d.y>r.y!=g.y>r.y&&r.x<(g.x-d.x)*(r.y-d.y)/(g.y-d.y)+d.x&&(y=!y)}return y}function oc(a,r){let c=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const y=a[d],x=a[g];y.y>r.y!=x.y>r.y&&r.x<(x.x-y.x)*(r.y-y.y)/(x.y-y.y)+y.x&&(c=!c)}return c}function fA(a,r,c){const d=c[0],g=c[2];if(a.x<d.x&&r.x<d.x||a.x>g.x&&r.x>g.x||a.y<d.y&&r.y<d.y||a.y>g.y&&r.y>g.y)return!1;const y=Ce(a,r,c[0]);return y!==Ce(a,r,c[1])||y!==Ce(a,r,c[2])||y!==Ce(a,r,c[3])}function Gu(a,r,c){const d=r.paint.get(a).value;return d.kind==="constant"?d.value:c.programConfigurations.get(r.id).getMaxValue(a)}function rf(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function sf(a,r,c,d,g){if(!r[0]&&!r[1])return a;const y=vt.convert(r)._mult(g);c==="viewport"&&y._rotate(-d);const x=[];for(let E=0;E<a.length;E++)x.push(a[E].sub(y));return x}rt("CircleBucket",ng,{omit:["layers"]});const pA=new pi({"circle-sort-key":new bt(Me.layout_circle["circle-sort-key"])});var mA={paint:new pi({"circle-radius":new bt(Me.paint_circle["circle-radius"]),"circle-color":new bt(Me.paint_circle["circle-color"]),"circle-blur":new bt(Me.paint_circle["circle-blur"]),"circle-opacity":new bt(Me.paint_circle["circle-opacity"]),"circle-translate":new ut(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new ut(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ut(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ut(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(Me.paint_circle["circle-stroke-opacity"])}),layout:pA},qi=1e-6,Xi=typeof Float32Array<"u"?Float32Array:Array;function Dv(){var a=new Xi(9);return Xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function sg(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function zv(a,r,c){var d=r[0],g=r[1],y=r[2],x=r[3],E=r[4],S=r[5],P=r[6],D=r[7],O=r[8],N=r[9],G=r[10],H=r[11],oe=r[12],se=r[13],ge=r[14],Te=r[15],me=c[0],be=c[1],De=c[2],Re=c[3];return a[0]=me*d+be*E+De*O+Re*oe,a[1]=me*g+be*S+De*N+Re*se,a[2]=me*y+be*P+De*G+Re*ge,a[3]=me*x+be*D+De*H+Re*Te,a[4]=(me=c[4])*d+(be=c[5])*E+(De=c[6])*O+(Re=c[7])*oe,a[5]=me*g+be*S+De*N+Re*se,a[6]=me*y+be*P+De*G+Re*ge,a[7]=me*x+be*D+De*H+Re*Te,a[8]=(me=c[8])*d+(be=c[9])*E+(De=c[10])*O+(Re=c[11])*oe,a[9]=me*g+be*S+De*N+Re*se,a[10]=me*y+be*P+De*G+Re*ge,a[11]=me*x+be*D+De*H+Re*Te,a[12]=(me=c[12])*d+(be=c[13])*E+(De=c[14])*O+(Re=c[15])*oe,a[13]=me*g+be*S+De*N+Re*se,a[14]=me*y+be*P+De*G+Re*ge,a[15]=me*x+be*D+De*H+Re*Te,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var Hu,gA=zv;function Ov(){var a=new Xi(3);return Xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Fv(a,r,c){var d=new Xi(3);return d[0]=a,d[1]=r,d[2]=c,d}function of(a,r,c){var d=r[0],g=r[1],y=r[2],x=r[3];return a[0]=c[0]*d+c[4]*g+c[8]*y+c[12]*x,a[1]=c[1]*d+c[5]*g+c[9]*y+c[13]*x,a[2]=c[2]*d+c[6]*g+c[10]*y+c[14]*x,a[3]=c[3]*d+c[7]*g+c[11]*y+c[15]*x,a}function Bv(){var a=new Xi(4);return Xi!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Nv(a,r){const c=of([],[a.x,a.y,0,1],r);return new vt(c[0]/c[3],c[1]/c[3])}Ov(),Hu=new Xi(4),Xi!=Float32Array&&(Hu[0]=0,Hu[1]=0,Hu[2]=0,Hu[3]=0),Ov(),Fv(1,0,0),Fv(0,1,0),Bv(),Bv(),Dv(),function(){var a;a=new Xi(2),Xi!=Float32Array&&(a[0]=0,a[1]=0)}();class Uv extends ng{}rt("HeatmapBucket",Uv,{omit:["layers"]});var _A={paint:new pi({"heatmap-radius":new bt(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ut(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ys(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ut(Me.paint_heatmap["heatmap-opacity"])})};function og(a,{width:r,height:c},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*c*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*c*d}`)}else g=new Uint8Array(r*c*d);return a.width=r,a.height=c,a.data=g,a}function Vv(a,{width:r,height:c},d){if(r===a.width&&c===a.height)return;const g=og({},{width:r,height:c},d);ag(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,c)},d),a.width=r,a.height=c,a.data=g.data}function ag(a,r,c,d,g,y){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||c.x>a.width-g.width||c.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||d.x>r.width-g.width||d.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=a.data,E=r.data;if(x===E)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<g.height;S++){const P=((c.y+S)*a.width+c.x)*y,D=((d.y+S)*r.width+d.x)*y;for(let O=0;O<g.width*y;O++)E[D+O]=x[P+O]}return r}class $u{constructor(r,c){og(this,r,1,c)}resize(r){Vv(this,r,1)}clone(){return new $u({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,g,y){ag(r,c,d,g,y,1)}}class Ur{constructor(r,c){og(this,r,4,c)}resize(r){Vv(this,r,4)}replace(r,c){c?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ur({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,c,d,g,y){ag(r,c,d,g,y,4)}}function jv(a){const r={},c=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new Ur({width:c,height:d});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const y=(x,E,S)=>{r[a.evaluationKey]=S;const P=a.expression.evaluate(r);g.data[x+E+0]=Math.floor(255*P.r/P.a),g.data[x+E+1]=Math.floor(255*P.g/P.a),g.data[x+E+2]=Math.floor(255*P.b/P.a),g.data[x+E+3]=Math.floor(255*P.a)};if(a.clips)for(let x=0,E=0;x<d;++x,E+=4*c)for(let S=0,P=0;S<c;S++,P+=4){const D=S/(c-1),{start:O,end:N}=a.clips[x];y(E,P,O*(1-D)+N*D)}else for(let x=0,E=0;x<c;x++,E+=4)y(0,E,x/(c-1));return g}rt("AlphaImage",$u),rt("RGBAImage",Ur);var yA={paint:new pi({"hillshade-illumination-direction":new ut(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ut(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ut(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ut(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ut(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ut(Me.paint_hillshade["hillshade-accent-color"])})};const vA=Gn([{name:"a_pos",components:2,type:"Int16"}],4),{members:xA}=vA;var af={exports:{}};function lf(a,r,c){c=c||2;var d,g,y,x,E,S,P,D=r&&r.length,O=D?r[0]*c:a.length,N=Gv(a,0,O,c,!0),G=[];if(!N||N.next===N.prev)return G;if(D&&(N=function(oe,se,ge,Te){var me,be,De,Re=[];for(me=0,be=se.length;me<be;me++)(De=Gv(oe,se[me]*Te,me<be-1?se[me+1]*Te:oe.length,Te,!1))===De.next&&(De.steiner=!0),Re.push(PA(De));for(Re.sort(SA),me=0;me<Re.length;me++)ge=AA(Re[me],ge);return ge}(a,r,N,c)),a.length>80*c){d=y=a[0],g=x=a[1];for(var H=c;H<O;H+=c)(E=a[H])<d&&(d=E),(S=a[H+1])<g&&(g=S),E>y&&(y=E),S>x&&(x=S);P=(P=Math.max(y-d,x-g))!==0?32767/P:0}return Wu(N,G,c,d,g,P,0),G}function Gv(a,r,c,d,g){var y,x;if(g===ug(a,r,c,d)>0)for(y=r;y<c;y+=d)x=Wv(y,a[y],a[y+1],x);else for(y=c-d;y>=r;y-=d)x=Wv(y,a[y],a[y+1],x);return x&&cf(x,x.next)&&(Xu(x),x=x.next),x}function dl(a,r){if(!a)return a;r||(r=a);var c,d=a;do if(c=!1,d.steiner||!cf(d,d.next)&&Bn(d.prev,d,d.next)!==0)d=d.next;else{if(Xu(d),(d=r=d.prev)===d.next)break;c=!0}while(c||d!==r);return r}function Wu(a,r,c,d,g,y,x){if(a){!x&&y&&function(D,O,N,G){var H=D;do H.z===0&&(H.z=lg(H.x,H.y,O,N,G)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next;while(H!==D);H.prevZ.nextZ=null,H.prevZ=null,function(oe){var se,ge,Te,me,be,De,Re,nt,lt=1;do{for(ge=oe,oe=null,be=null,De=0;ge;){for(De++,Te=ge,Re=0,se=0;se<lt&&(Re++,Te=Te.nextZ);se++);for(nt=lt;Re>0||nt>0&&Te;)Re!==0&&(nt===0||!Te||ge.z<=Te.z)?(me=ge,ge=ge.nextZ,Re--):(me=Te,Te=Te.nextZ,nt--),be?be.nextZ=me:oe=me,me.prevZ=be,be=me;ge=Te}be.nextZ=null,lt*=2}while(De>1)}(H)}(a,d,g,y);for(var E,S,P=a;a.prev!==a.next;)if(E=a.prev,S=a.next,y?wA(a,d,g,y):bA(a))r.push(E.i/c|0),r.push(a.i/c|0),r.push(S.i/c|0),Xu(a),a=S.next,P=S.next;else if((a=S)===P){x?x===1?Wu(a=EA(dl(a),r,c),r,c,d,g,y,2):x===2&&TA(a,r,c,d,g,y):Wu(dl(a),r,c,d,g,y,1);break}}}function bA(a){var r=a.prev,c=a,d=a.next;if(Bn(r,c,d)>=0)return!1;for(var g=r.x,y=c.x,x=d.x,E=r.y,S=c.y,P=d.y,D=g<y?g<x?g:x:y<x?y:x,O=E<S?E<P?E:P:S<P?S:P,N=g>y?g>x?g:x:y>x?y:x,G=E>S?E>P?E:P:S>P?S:P,H=d.next;H!==r;){if(H.x>=D&&H.x<=N&&H.y>=O&&H.y<=G&&ac(g,E,y,S,x,P,H.x,H.y)&&Bn(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function wA(a,r,c,d){var g=a.prev,y=a,x=a.next;if(Bn(g,y,x)>=0)return!1;for(var E=g.x,S=y.x,P=x.x,D=g.y,O=y.y,N=x.y,G=E<S?E<P?E:P:S<P?S:P,H=D<O?D<N?D:N:O<N?O:N,oe=E>S?E>P?E:P:S>P?S:P,se=D>O?D>N?D:N:O>N?O:N,ge=lg(G,H,r,c,d),Te=lg(oe,se,r,c,d),me=a.prevZ,be=a.nextZ;me&&me.z>=ge&&be&&be.z<=Te;){if(me.x>=G&&me.x<=oe&&me.y>=H&&me.y<=se&&me!==g&&me!==x&&ac(E,D,S,O,P,N,me.x,me.y)&&Bn(me.prev,me,me.next)>=0||(me=me.prevZ,be.x>=G&&be.x<=oe&&be.y>=H&&be.y<=se&&be!==g&&be!==x&&ac(E,D,S,O,P,N,be.x,be.y)&&Bn(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;me&&me.z>=ge;){if(me.x>=G&&me.x<=oe&&me.y>=H&&me.y<=se&&me!==g&&me!==x&&ac(E,D,S,O,P,N,me.x,me.y)&&Bn(me.prev,me,me.next)>=0)return!1;me=me.prevZ}for(;be&&be.z<=Te;){if(be.x>=G&&be.x<=oe&&be.y>=H&&be.y<=se&&be!==g&&be!==x&&ac(E,D,S,O,P,N,be.x,be.y)&&Bn(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function EA(a,r,c){var d=a;do{var g=d.prev,y=d.next.next;!cf(g,y)&&Hv(g,d,d.next,y)&&qu(g,y)&&qu(y,g)&&(r.push(g.i/c|0),r.push(d.i/c|0),r.push(y.i/c|0),Xu(d),Xu(d.next),d=a=y),d=d.next}while(d!==a);return dl(d)}function TA(a,r,c,d,g,y){var x=a;do{for(var E=x.next.next;E!==x.prev;){if(x.i!==E.i&&CA(x,E)){var S=$v(x,E);return x=dl(x,x.next),S=dl(S,S.next),Wu(x,r,c,d,g,y,0),void Wu(S,r,c,d,g,y,0)}E=E.next}x=x.next}while(x!==a)}function SA(a,r){return a.x-r.x}function AA(a,r){var c=function(g,y){var x,E=y,S=g.x,P=g.y,D=-1/0;do{if(P<=E.y&&P>=E.next.y&&E.next.y!==E.y){var O=E.x+(P-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(O<=S&&O>D&&(D=O,x=E.x<E.next.x?E:E.next,O===S))return x}E=E.next}while(E!==y);if(!x)return null;var N,G=x,H=x.x,oe=x.y,se=1/0;E=x;do S>=E.x&&E.x>=H&&S!==E.x&&ac(P<oe?S:D,P,H,oe,P<oe?D:S,P,E.x,E.y)&&(N=Math.abs(P-E.y)/(S-E.x),qu(E,g)&&(N<se||N===se&&(E.x>x.x||E.x===x.x&&IA(x,E)))&&(x=E,se=N)),E=E.next;while(E!==G);return x}(a,r);if(!c)return r;var d=$v(c,a);return dl(d,d.next),dl(c,c.next)}function IA(a,r){return Bn(a.prev,a,r.prev)<0&&Bn(r.next,a,a.next)<0}function lg(a,r,c,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-c)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function PA(a){var r=a,c=a;do(r.x<c.x||r.x===c.x&&r.y<c.y)&&(c=r),r=r.next;while(r!==a);return c}function ac(a,r,c,d,g,y,x,E){return(g-x)*(r-E)>=(a-x)*(y-E)&&(a-x)*(d-E)>=(c-x)*(r-E)&&(c-x)*(y-E)>=(g-x)*(d-E)}function CA(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(c,d){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==d.i&&g.next.i!==d.i&&Hv(g,g.next,c,d))return!0;g=g.next}while(g!==c);return!1}(a,r)&&(qu(a,r)&&qu(r,a)&&function(c,d){var g=c,y=!1,x=(c.x+d.x)/2,E=(c.y+d.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&x<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==c);return y}(a,r)&&(Bn(a.prev,a,r.prev)||Bn(a,r.prev,r))||cf(a,r)&&Bn(a.prev,a,a.next)>0&&Bn(r.prev,r,r.next)>0)}function Bn(a,r,c){return(r.y-a.y)*(c.x-r.x)-(r.x-a.x)*(c.y-r.y)}function cf(a,r){return a.x===r.x&&a.y===r.y}function Hv(a,r,c,d){var g=hf(Bn(a,r,c)),y=hf(Bn(a,r,d)),x=hf(Bn(c,d,a)),E=hf(Bn(c,d,r));return g!==y&&x!==E||!(g!==0||!uf(a,c,r))||!(y!==0||!uf(a,d,r))||!(x!==0||!uf(c,a,d))||!(E!==0||!uf(c,r,d))}function uf(a,r,c){return r.x<=Math.max(a.x,c.x)&&r.x>=Math.min(a.x,c.x)&&r.y<=Math.max(a.y,c.y)&&r.y>=Math.min(a.y,c.y)}function hf(a){return a>0?1:a<0?-1:0}function qu(a,r){return Bn(a.prev,a,a.next)<0?Bn(a,r,a.next)>=0&&Bn(a,a.prev,r)>=0:Bn(a,r,a.prev)<0||Bn(a,a.next,r)<0}function $v(a,r){var c=new cg(a.i,a.x,a.y),d=new cg(r.i,r.x,r.y),g=a.next,y=r.prev;return a.next=r,r.prev=a,c.next=g,g.prev=c,d.next=c,c.prev=d,y.next=d,d.prev=y,d}function Wv(a,r,c,d){var g=new cg(a,r,c);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Xu(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function cg(a,r,c){this.i=a,this.x=r,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ug(a,r,c,d){for(var g=0,y=r,x=c-d;y<c;y+=d)g+=(a[x]-a[y])*(a[y+1]+a[x+1]),x=y;return g}function MA(a,r,c,d,g){qv(a,r,c||0,d||a.length-1,g||kA)}function qv(a,r,c,d,g){for(;d>c;){if(d-c>600){var y=d-c+1,x=r-c+1,E=Math.log(y),S=.5*Math.exp(2*E/3),P=.5*Math.sqrt(E*S*(y-S)/y)*(x-y/2<0?-1:1);qv(a,r,Math.max(c,Math.floor(r-x*S/y+P)),Math.min(d,Math.floor(r+(y-x)*S/y+P)),g)}var D=a[r],O=c,N=d;for(Zu(a,c,r),g(a[d],D)>0&&Zu(a,c,d);O<N;){for(Zu(a,O,N),O++,N--;g(a[O],D)<0;)O++;for(;g(a[N],D)>0;)N--}g(a[c],D)===0?Zu(a,c,N):Zu(a,++N,d),N<=r&&(c=N+1),r<=N&&(d=N-1)}}function Zu(a,r,c){var d=a[r];a[r]=a[c],a[c]=d}function kA(a,r){return a<r?-1:a>r?1:0}function hg(a,r){const c=a.length;if(c<=1)return[a];const d=[];let g,y;for(let x=0;x<c;x++){const E=Oe(a[x]);E!==0&&(a[x].area=Math.abs(E),y===void 0&&(y=E<0),y===E<0?(g&&d.push(g),g=[a[x]]):g.push(a[x]))}if(g&&d.push(g),r>1)for(let x=0;x<d.length;x++)d[x].length<=r||(MA(d[x],r,1,d[x].length-1,LA),d[x]=d[x].slice(0,r));return d}function LA(a,r){return r.area-a.area}function dg(a,r,c){const d=c.patternDependencies;let g=!1;for(const y of r){const x=y.paint.get(`${a}-pattern`);x.isConstant()||(g=!0);const E=x.constantOr(null);E&&(g=!0,d[E.to]=!0,d[E.from]=!0)}return g}function fg(a,r,c,d,g){const y=g.patternDependencies;for(const x of r){const E=x.paint.get(`${a}-pattern`).value;if(E.kind!=="constant"){let S=E.evaluate({zoom:d-1},c,{},g.availableImages),P=E.evaluate({zoom:d},c,{},g.availableImages),D=E.evaluate({zoom:d+1},c,{},g.availableImages);S=S&&S.name?S.name:S,P=P&&P.name?P.name:P,D=D&&D.name?D.name:D,y[S]=!0,y[P]=!0,y[D]=!0,c.patterns[x.id]={min:S,mid:P,max:D}}}return c}af.exports=lf,af.exports.default=lf,lf.deviation=function(a,r,c,d){var g=r&&r.length,y=Math.abs(ug(a,0,g?r[0]*c:a.length,c));if(g)for(var x=0,E=r.length;x<E;x++)y-=Math.abs(ug(a,r[x]*c,x<E-1?r[x+1]*c:a.length,c));var S=0;for(x=0;x<d.length;x+=3){var P=d[x]*c,D=d[x+1]*c,O=d[x+2]*c;S+=Math.abs((a[P]-a[O])*(a[D+1]-a[P+1])-(a[P]-a[D])*(a[O+1]-a[P+1]))}return y===0&&S===0?0:Math.abs((S-y)/y)},lf.flatten=function(a){for(var r=a[0][0].length,c={vertices:[],holes:[],dimensions:r},d=0,g=0;g<a.length;g++){for(var y=0;y<a[g].length;y++)for(var x=0;x<r;x++)c.vertices.push(a[g][y][x]);g>0&&c.holes.push(d+=a[g-1].length)}return c};class pg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new sn,this.indexArray=new Wi,this.indexArray2=new Is,this.programConfigurations=new cl(r.layers,r.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=dg("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),x=[];for(const{feature:E,id:S,index:P,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,N=hl(E,O);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d,c.availableImages):void 0,H={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:P,geometry:O?N.geometry:ul(E),patterns:{},sortKey:G};x.push(H)}y&&x.sort((E,S)=>E.sortKey-S.sortKey);for(const E of x){const{geometry:S,index:P,sourceLayerIndex:D}=E;if(this.hasPattern){const O=fg("fill",this.layers,E,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(E,S,P,d,{});c.featureIndex.insert(r[P].feature,S,P,D,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,xA),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,c,d,g,y){for(const x of hg(c,500)){let E=0;for(const G of x)E+=G.length;const S=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),P=S.vertexLength,D=[],O=[];for(const G of x){if(G.length===0)continue;G!==x[0]&&O.push(D.length/2);const H=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),oe=H.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(oe+G.length-1,oe),D.push(G[0].x),D.push(G[0].y);for(let se=1;se<G.length;se++)this.layoutVertexArray.emplaceBack(G[se].x,G[se].y),this.indexArray2.emplaceBack(oe+se-1,oe+se),D.push(G[se].x),D.push(G[se].y);H.vertexLength+=G.length,H.primitiveLength+=G.length}const N=af.exports(D,O);for(let G=0;G<N.length;G+=3)this.indexArray.emplaceBack(P+N[G],P+N[G+1],P+N[G+2]);S.vertexLength+=E,S.primitiveLength+=N.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}}rt("FillBucket",pg,{omit:["layers","patternFeatures"]});const RA=new pi({"fill-sort-key":new bt(Me.layout_fill["fill-sort-key"])});var DA={paint:new pi({"fill-antialias":new ut(Me.paint_fill["fill-antialias"]),"fill-opacity":new bt(Me.paint_fill["fill-opacity"]),"fill-color":new bt(Me.paint_fill["fill-color"]),"fill-outline-color":new bt(Me.paint_fill["fill-outline-color"]),"fill-translate":new ut(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new ut(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new oa(Me.paint_fill["fill-pattern"])}),layout:RA};const zA=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),OA=Gn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:FA}=zA;var ca={},BA=vt,Xv=lc;function lc(a,r,c,d,g){this.properties={},this.extent=c,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=g,a.readFields(NA,this,r)}function NA(a,r,c){a==1?r.id=c.readVarint():a==2?function(d,g){for(var y=d.readVarint()+d.pos;d.pos<y;){var x=g._keys[d.readVarint()],E=g._values[d.readVarint()];g.properties[x]=E}}(c,r):a==3?r.type=c.readVarint():a==4&&(r._geometry=c.pos)}function UA(a){for(var r,c,d=0,g=0,y=a.length,x=y-1;g<y;x=g++)d+=((c=a[x]).x-(r=a[g]).x)*(r.y+c.y);return d}lc.types=["Unknown","Point","LineString","Polygon"],lc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,c=a.readVarint()+a.pos,d=1,g=0,y=0,x=0,E=[];a.pos<c;){if(g<=0){var S=a.readVarint();d=7&S,g=S>>3}if(g--,d===1||d===2)y+=a.readSVarint(),x+=a.readSVarint(),d===1&&(r&&E.push(r),r=[]),r.push(new BA(y,x));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&E.push(r),E},lc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,c=1,d=0,g=0,y=0,x=1/0,E=-1/0,S=1/0,P=-1/0;a.pos<r;){if(d<=0){var D=a.readVarint();c=7&D,d=D>>3}if(d--,c===1||c===2)(g+=a.readSVarint())<x&&(x=g),g>E&&(E=g),(y+=a.readSVarint())<S&&(S=y),y>P&&(P=y);else if(c!==7)throw new Error("unknown command "+c)}return[x,S,E,P]},lc.prototype.toGeoJSON=function(a,r,c){var d,g,y=this.extent*Math.pow(2,c),x=this.extent*a,E=this.extent*r,S=this.loadGeometry(),P=lc.types[this.type];function D(G){for(var H=0;H<G.length;H++){var oe=G[H];G[H]=[360*(oe.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(oe.y+E)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(d=0;d<S.length;d++)O[d]=S[d][0];D(S=O);break;case 2:for(d=0;d<S.length;d++)D(S[d]);break;case 3:for(S=function(G){var H=G.length;if(H<=1)return[G];for(var oe,se,ge=[],Te=0;Te<H;Te++){var me=UA(G[Te]);me!==0&&(se===void 0&&(se=me<0),se===me<0?(oe&&ge.push(oe),oe=[G[Te]]):oe.push(G[Te]))}return oe&&ge.push(oe),ge}(S),d=0;d<S.length;d++)for(g=0;g<S[d].length;g++)D(S[d][g])}S.length===1?S=S[0]:P="Multi"+P;var N={type:"Feature",geometry:{type:P,coordinates:S},properties:this.properties};return"id"in this&&(N.id=this.id),N};var VA=Xv,Zv=Yv;function Yv(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(jA,this,r),this.length=this._features.length}function jA(a,r,c){a===15?r.version=c.readVarint():a===1?r.name=c.readString():a===5?r.extent=c.readVarint():a===2?r._features.push(c.pos):a===3?r._keys.push(c.readString()):a===4&&r._values.push(function(d){for(var g=null,y=d.readVarint()+d.pos;d.pos<y;){var x=d.readVarint()>>3;g=x===1?d.readString():x===2?d.readFloat():x===3?d.readDouble():x===4?d.readVarint64():x===5?d.readVarint():x===6?d.readSVarint():x===7?d.readBoolean():null}return g}(c))}Yv.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new VA(this._pbf,r,this.extent,this._keys,this._values)};var GA=Zv;function HA(a,r,c){if(a===3){var d=new GA(c,c.readVarint()+c.pos);d.length&&(r[d.name]=d)}}ca.VectorTile=function(a,r){this.layers=a.readFields(HA,{},r)},ca.VectorTileFeature=Xv,ca.VectorTileLayer=Zv;const $A=ca.VectorTileFeature.types,mg=Math.pow(2,13);function Yu(a,r,c,d,g,y,x,E){a.emplaceBack(r,c,2*Math.floor(d*mg)+x,g*mg*2,y*mg*2,Math.round(E))}class gg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new Gt,this.centroidVertexArray=new gt,this.indexArray=new Wi,this.programConfigurations=new cl(r.layers,r.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.features=[],this.hasPattern=dg("fill-extrusion",this.layers,c);for(const{feature:g,id:y,index:x,sourceLayerIndex:E}of r){const S=this.layers[0]._featureFilter.needGeometry,P=hl(g,S);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),P,d))continue;const D={id:y,sourceLayerIndex:E,index:x,geometry:S?P.geometry:ul(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(fg("fill-extrusion",this.layers,D,this.zoom,c)):this.addFeature(D,D.geometry,x,d,{}),c.featureIndex.insert(g,D.geometry,x,E,this.index,!0)}}addFeatures(r,c,d){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,c,d)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,FA),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,OA.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,c,d,g,y){const x={x:0,y:0,vertexCount:0};for(const E of hg(c,500)){let S=0;for(const H of E)S+=H.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const H of E){if(H.length===0||qA(H))continue;let oe=0;for(let se=0;se<H.length;se++){const ge=H[se];if(se>=1){const Te=H[se-1];if(!WA(ge,Te)){P.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const me=ge.sub(Te)._perp()._unit(),be=Te.dist(ge);oe+be>32768&&(oe=0),Yu(this.layoutVertexArray,ge.x,ge.y,me.x,me.y,0,0,oe),Yu(this.layoutVertexArray,ge.x,ge.y,me.x,me.y,0,1,oe),x.x+=2*ge.x,x.y+=2*ge.y,x.vertexCount+=2,oe+=be,Yu(this.layoutVertexArray,Te.x,Te.y,me.x,me.y,0,0,oe),Yu(this.layoutVertexArray,Te.x,Te.y,me.x,me.y,0,1,oe),x.x+=2*Te.x,x.y+=2*Te.y,x.vertexCount+=2;const De=P.vertexLength;this.indexArray.emplaceBack(De,De+2,De+1),this.indexArray.emplaceBack(De+1,De+2,De+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+S>Ft.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),$A[r.type]!=="Polygon")continue;const D=[],O=[],N=P.vertexLength;for(const H of E)if(H.length!==0){H!==E[0]&&O.push(D.length/2);for(let oe=0;oe<H.length;oe++){const se=H[oe];Yu(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),x.x+=se.x,x.y+=se.y,x.vertexCount+=1,D.push(se.x),D.push(se.y)}}const G=af.exports(D,O);for(let H=0;H<G.length;H+=3)this.indexArray.emplaceBack(N+G[H],N+G[H+2],N+G[H+1]);P.primitiveLength+=G.length/3,P.vertexLength+=S}for(let E=0;E<x.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}}function WA(a,r){return a.x===r.x&&(a.x<0||a.x>Jn)||a.y===r.y&&(a.y<0||a.y>Jn)}function qA(a){return a.every(r=>r.x<0)||a.every(r=>r.x>Jn)||a.every(r=>r.y<0)||a.every(r=>r.y>Jn)}rt("FillExtrusionBucket",gg,{omit:["layers","features"]});var XA={paint:new pi({"fill-extrusion-opacity":new ut(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ut(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ut(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new oa(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ut(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Ku(a,r){return a.x*r.x+a.y*r.y}function Kv(a,r){if(a.length===1){let c=0;const d=r[c++];let g;for(;!g||d.equals(g);)if(g=r[c++],!g)return 1/0;for(;c<r.length;c++){const y=r[c],x=a[0],E=g.sub(d),S=y.sub(d),P=x.sub(d),D=Ku(E,E),O=Ku(E,S),N=Ku(S,S),G=Ku(P,E),H=Ku(P,S),oe=D*N-O*O,se=(N*G-O*H)/oe,ge=(D*H-O*G)/oe,Te=d.z*(1-se-ge)+g.z*se+y.z*ge;if(isFinite(Te))return Te}return 1/0}{let c=1/0;for(const d of r)c=Math.min(c,d.z);return c}}const ZA=Gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:YA}=ZA,KA=Gn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:JA}=KA,QA=ca.VectorTileFeature.types,eI=Math.cos(Math.PI/180*37.5),Jv=Math.pow(2,14)/.5;class _g{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(c=>c.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new Ht,this.layoutVertexArray2=new an,this.indexArray=new Wi,this.programConfigurations=new cl(r.layers,r.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(r,c,d){this.hasPattern=dg("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),x=[];for(const{feature:E,id:S,index:P,sourceLayerIndex:D}of r){const O=this.layers[0]._featureFilter.needGeometry,N=hl(E,O);if(!this.layers[0]._featureFilter.filter(new vn(this.zoom),N,d))continue;const G=y?g.evaluate(N,{},d):void 0,H={id:S,properties:E.properties,type:E.type,sourceLayerIndex:D,index:P,geometry:O?N.geometry:ul(E),patterns:{},sortKey:G};x.push(H)}y&&x.sort((E,S)=>E.sortKey-S.sortKey);for(const E of x){const{geometry:S,index:P,sourceLayerIndex:D}=E;if(this.hasPattern){const O=fg("line",this.layers,E,this.zoom,c);this.patternFeatures.push(O)}else this.addFeature(E,S,P,d,{});c.featureIndex.insert(r[P].feature,S,P,D,this.index)}}update(r,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,c,this.stateDependentLayers,d)}addFeatures(r,c,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,JA)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,YA),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,c,d,g,y){const x=this.layers[0].layout,E=x.get("line-join").evaluate(r,{}),S=x.get("line-cap"),P=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const O of c)this.addLine(O,r,E,S,P,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,y,g)}addLine(r,c,d,g,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ge=0;ge<r.length-1;ge++)this.totalDistance+=r[ge].dist(r[ge+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=QA[c.type]==="Polygon";let S=r.length;for(;S>=2&&r[S-1].equals(r[S-2]);)S--;let P=0;for(;P<S-1&&r[P].equals(r[P+1]);)P++;if(S<(E?3:2))return;d==="bevel"&&(y=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let N,G,H,oe,se;this.e1=this.e2=-1,E&&(N=r[S-2],se=r[P].sub(N)._unit()._perp());for(let ge=P;ge<S;ge++){if(H=ge===S-1?E?r[P+1]:void 0:r[ge+1],H&&r[ge].equals(H))continue;se&&(oe=se),N&&(G=N),N=r[ge],se=H?H.sub(N)._unit()._perp():oe,oe=oe||se;let Te=oe.add(se);Te.x===0&&Te.y===0||Te._unit();const me=oe.x*se.x+oe.y*se.y,be=Te.x*se.x+Te.y*se.y,De=be!==0?1/be:1/0,Re=2*Math.sqrt(2-2*be),nt=be<eI&&G&&H,lt=oe.x*se.y-oe.y*se.x>0;if(nt&&ge>P){const je=N.dist(G);if(je>2*D){const Je=N.sub(N.sub(G)._mult(D/je)._round());this.updateDistance(G,Je),this.addCurrentVertex(Je,oe,0,0,O),G=Je}}const Ke=G&&H;let We=Ke?d:E?"butt":g;if(Ke&&We==="round"&&(De<x?We="miter":De<=2&&(We="fakeround")),We==="miter"&&De>y&&(We="bevel"),We==="bevel"&&(De>2&&(We="flipbevel"),De<y&&(We="miter")),G&&this.updateDistance(G,N),We==="miter")Te._mult(De),this.addCurrentVertex(N,Te,0,0,O);else if(We==="flipbevel"){if(De>100)Te=se.mult(-1);else{const je=De*oe.add(se).mag()/oe.sub(se).mag();Te._perp()._mult(je*(lt?-1:1))}this.addCurrentVertex(N,Te,0,0,O),this.addCurrentVertex(N,Te.mult(-1),0,0,O)}else if(We==="bevel"||We==="fakeround"){const je=-Math.sqrt(De*De-1),Je=lt?je:0,qe=lt?0:je;if(G&&this.addCurrentVertex(N,oe,Je,qe,O),We==="fakeround"){const Ne=Math.round(180*Re/Math.PI/20);for(let _t=1;_t<Ne;_t++){let dt=_t/Ne;if(dt!==.5){const _n=dt-.5;dt+=dt*_n*(dt-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*_n*_n+(.848013+me*(.215638*me-1.06021)))}const Rt=se.sub(oe)._mult(dt)._add(oe)._unit()._mult(lt?-1:1);this.addHalfVertex(N,Rt.x,Rt.y,!1,lt,0,O)}}H&&this.addCurrentVertex(N,se,-Je,-qe,O)}else if(We==="butt")this.addCurrentVertex(N,Te,0,0,O);else if(We==="square"){const je=G?1:-1;this.addCurrentVertex(N,Te,je,je,O)}else We==="round"&&(G&&(this.addCurrentVertex(N,oe,0,0,O),this.addCurrentVertex(N,oe,1,1,O,!0)),H&&(this.addCurrentVertex(N,se,-1,-1,O,!0),this.addCurrentVertex(N,se,0,0,O)));if(nt&&ge<S-1){const je=N.dist(H);if(je>2*D){const Je=N.add(H.sub(N)._mult(D/je)._round());this.updateDistance(N,Je),this.addCurrentVertex(Je,se,0,0,O),N=Je}}}}addCurrentVertex(r,c,d,g,y,x=!1){const E=c.y*g-c.x,S=-c.y-c.x*g;this.addHalfVertex(r,c.x+c.y*d,c.y-c.x*d,x,!1,d,y),this.addHalfVertex(r,E,S,x,!0,-g,y),this.distance>Jv/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(r,c,d,g,y,x))}addHalfVertex({x:r,y:c},d,g,y,x,E,S){const P=.5*(this.lineClips?this.scaledDistance*(Jv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(c<<1)+(x?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,c){this.distance+=r.dist(c),this.updateScaledDistance()}}rt("LineBucket",_g,{omit:["layers","patternFeatures"]});const tI=new pi({"line-cap":new ut(Me.layout_line["line-cap"]),"line-join":new bt(Me.layout_line["line-join"]),"line-miter-limit":new ut(Me.layout_line["line-miter-limit"]),"line-round-limit":new ut(Me.layout_line["line-round-limit"]),"line-sort-key":new bt(Me.layout_line["line-sort-key"])});var Qv={paint:new pi({"line-opacity":new bt(Me.paint_line["line-opacity"]),"line-color":new bt(Me.paint_line["line-color"]),"line-translate":new ut(Me.paint_line["line-translate"]),"line-translate-anchor":new ut(Me.paint_line["line-translate-anchor"]),"line-width":new bt(Me.paint_line["line-width"]),"line-gap-width":new bt(Me.paint_line["line-gap-width"]),"line-offset":new bt(Me.paint_line["line-offset"]),"line-blur":new bt(Me.paint_line["line-blur"]),"line-dasharray":new Bu(Me.paint_line["line-dasharray"]),"line-pattern":new oa(Me.paint_line["line-pattern"]),"line-gradient":new Ys(Me.paint_line["line-gradient"])}),layout:tI};const ex=new class extends bt{possiblyEvaluate(a,r){return r=new vn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(a,r)}evaluate(a,r,c,d){return r=te({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(a,r,c,d)}}(Qv.paint.properties["line-width"].specification);function tx(a,r){return r>0?r+2*a:a}ex.useIntegerZoom=!0;const nI=Gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),iI=Gn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rI=Gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nx=Gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sI=Gn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function oI(a,r,c){return a.sections.forEach(d=>{d.text=function(g,y,x){const E=y.layout.get("text-transform").evaluate(x,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Er.applyArabicShaping&&(g=Er.applyArabicShaping(g)),g}(d.text,r,c)}),a}Gn([{name:"triangle",components:3,type:"Uint16"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Gn([{type:"Float32",name:"offsetX"}]),Gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ju={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var mi=24,yg=cn,ix=function(a,r,c,d,g){var y,x,E=8*g-d-1,S=(1<<E)-1,P=S>>1,D=-7,O=c?g-1:0,N=c?-1:1,G=a[r+O];for(O+=N,y=G&(1<<-D)-1,G>>=-D,D+=E;D>0;y=256*y+a[r+O],O+=N,D-=8);for(x=y&(1<<-D)-1,y>>=-D,D+=d;D>0;x=256*x+a[r+O],O+=N,D-=8);if(y===0)y=1-P;else{if(y===S)return x?NaN:1/0*(G?-1:1);x+=Math.pow(2,d),y-=P}return(G?-1:1)*x*Math.pow(2,y-d)},rx=function(a,r,c,d,g,y){var x,E,S,P=8*y-g-1,D=(1<<P)-1,O=D>>1,N=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=d?0:y-1,H=d?1:-1,oe=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(E=isNaN(r)?1:0,x=D):(x=Math.floor(Math.log(r)/Math.LN2),r*(S=Math.pow(2,-x))<1&&(x--,S*=2),(r+=x+O>=1?N/S:N*Math.pow(2,1-O))*S>=2&&(x++,S/=2),x+O>=D?(E=0,x=D):x+O>=1?(E=(r*S-1)*Math.pow(2,g),x+=O):(E=r*Math.pow(2,O-1)*Math.pow(2,g),x=0));g>=8;a[c+G]=255&E,G+=H,E/=256,g-=8);for(x=x<<g|E,P+=g;P>0;a[c+G]=255&x,G+=H,x/=256,P-=8);a[c+G-H]|=128*oe};function cn(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}cn.Varint=0,cn.Fixed64=1,cn.Bytes=2,cn.Fixed32=5;var ua,vg=4294967296,sx=1/vg,ox=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function So(a){return a.type===cn.Bytes?a.readVarint()+a.pos:a.pos+1}function cc(a,r,c){return c?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function ax(a,r,c){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));c.realloc(d);for(var g=c.pos-1;g>=a;g--)c.buf[g+d]=c.buf[g]}function aI(a,r){for(var c=0;c<a.length;c++)r.writeVarint(a[c])}function lI(a,r){for(var c=0;c<a.length;c++)r.writeSVarint(a[c])}function cI(a,r){for(var c=0;c<a.length;c++)r.writeFloat(a[c])}function uI(a,r){for(var c=0;c<a.length;c++)r.writeDouble(a[c])}function hI(a,r){for(var c=0;c<a.length;c++)r.writeBoolean(a[c])}function dI(a,r){for(var c=0;c<a.length;c++)r.writeFixed32(a[c])}function fI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed32(a[c])}function pI(a,r){for(var c=0;c<a.length;c++)r.writeFixed64(a[c])}function mI(a,r){for(var c=0;c<a.length;c++)r.writeSFixed64(a[c])}function df(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function uc(a,r,c){a[c]=r,a[c+1]=r>>>8,a[c+2]=r>>>16,a[c+3]=r>>>24}function lx(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}function gI(a,r,c){a===1&&c.readMessage(_I,r)}function _I(a,r,c){if(a===3){const{id:d,bitmap:g,width:y,height:x,left:E,top:S,advance:P}=c.readMessage(yI,{});r.push({id:d,bitmap:new $u({width:y+6,height:x+6},g),metrics:{width:y,height:x,left:E,top:S,advance:P}})}}function yI(a,r,c){a===1?r.id=c.readVarint():a===2?r.bitmap=c.readBytes():a===3?r.width=c.readVarint():a===4?r.height=c.readVarint():a===5?r.left=c.readSVarint():a===6?r.top=c.readSVarint():a===7&&(r.advance=c.readVarint())}function cx(a){let r=0,c=0;for(const x of a)r+=x.w*x.h,c=Math.max(c,x.w);a.sort((x,E)=>E.h-x.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),c),h:1/0}];let g=0,y=0;for(const x of a)for(let E=d.length-1;E>=0;E--){const S=d[E];if(!(x.w>S.w||x.h>S.h)){if(x.x=S.x,x.y=S.y,y=Math.max(y,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===S.w&&x.h===S.h){const P=d.pop();E<d.length&&(d[E]=P)}else x.h===S.h?(S.x+=x.w,S.w-=x.w):x.w===S.w?(S.y+=x.h,S.h-=x.h):(d.push({x:S.x+x.w,y:S.y,w:S.w-x.w,h:x.h}),S.y+=x.h,S.h-=x.h);break}}return{w:g,h:y,fill:r/(g*y)||0}}cn.prototype={destroy:function(){this.buf=null},readFields:function(a,r,c){for(c=c||this.length;this.pos<c;){var d=this.readVarint(),g=d>>3,y=this.pos;this.type=7&d,a(g,r,this),this.pos===y&&this.skip(d)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=df(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=lx(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=df(this.buf,this.pos)+df(this.buf,this.pos+4)*vg;return this.pos+=8,a},readSFixed64:function(){var a=df(this.buf,this.pos)+lx(this.buf,this.pos+4)*vg;return this.pos+=8,a},readFloat:function(){var a=ix(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=ix(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,c,d=this.buf;return r=127&(c=d[this.pos++]),c<128?r:(r|=(127&(c=d[this.pos++]))<<7,c<128?r:(r|=(127&(c=d[this.pos++]))<<14,c<128?r:(r|=(127&(c=d[this.pos++]))<<21,c<128?r:function(g,y,x){var E,S,P=x.buf;if(E=(112&(S=P[x.pos++]))>>4,S<128||(E|=(127&(S=P[x.pos++]))<<3,S<128)||(E|=(127&(S=P[x.pos++]))<<10,S<128)||(E|=(127&(S=P[x.pos++]))<<17,S<128)||(E|=(127&(S=P[x.pos++]))<<24,S<128)||(E|=(1&(S=P[x.pos++]))<<31,S<128))return cc(g,E,y);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(c=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&ox?function(c,d,g){return ox.decode(c.subarray(d,g))}(this.buf,r,a):function(c,d,g){for(var y="",x=d;x<g;){var E,S,P,D=c[x],O=null,N=D>239?4:D>223?3:D>191?2:1;if(x+N>g)break;N===1?D<128&&(O=D):N===2?(192&(E=c[x+1]))==128&&(O=(31&D)<<6|63&E)<=127&&(O=null):N===3?(S=c[x+2],(192&(E=c[x+1]))==128&&(192&S)==128&&((O=(15&D)<<12|(63&E)<<6|63&S)<=2047||O>=55296&&O<=57343)&&(O=null)):N===4&&(S=c[x+2],P=c[x+3],(192&(E=c[x+1]))==128&&(192&S)==128&&(192&P)==128&&((O=(15&D)<<18|(63&E)<<12|(63&S)<<6|63&P)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,N=1):O>65535&&(O-=65536,y+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),y+=String.fromCharCode(O),x+=N}return y}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==cn.Bytes)return a.push(this.readVarint(r));var c=So(this);for(a=a||[];this.pos<c;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==cn.Bytes)return a.push(this.readSVarint());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==cn.Bytes)return a.push(this.readBoolean());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==cn.Bytes)return a.push(this.readFloat());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==cn.Bytes)return a.push(this.readDouble());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed32());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed32());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readFixed64());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==cn.Bytes)return a.push(this.readSFixed64());var r=So(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===cn.Varint)for(;this.buf[this.pos++]>127;);else if(r===cn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===cn.Fixed32)this.pos+=4;else{if(r!==cn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var c=new Uint8Array(r);c.set(this.buf),this.buf=c,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),uc(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),uc(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),uc(this.buf,-1&a,this.pos),uc(this.buf,Math.floor(a*sx),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),uc(this.buf,-1&a,this.pos),uc(this.buf,Math.floor(a*sx),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,c){var d,g;if(r>=0?(d=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(y,x,E){E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7)}(d,0,c),function(y,x){var E=(7&y)<<4;x.buf[x.pos++]|=E|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(g,c)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(d,g,y){for(var x,E,S=0;S<g.length;S++){if((x=g.charCodeAt(S))>55295&&x<57344){if(!E){x>56319||S+1===g.length?(d[y++]=239,d[y++]=191,d[y++]=189):E=x;continue}if(x<56320){d[y++]=239,d[y++]=191,d[y++]=189,E=x;continue}x=E-55296<<10|x-56320|65536,E=null}else E&&(d[y++]=239,d[y++]=191,d[y++]=189,E=null);x<128?d[y++]=x:(x<2048?d[y++]=x>>6|192:(x<65536?d[y++]=x>>12|224:(d[y++]=x>>18|240,d[y++]=x>>12&63|128),d[y++]=x>>6&63|128),d[y++]=63&x|128)}return y}(this.buf,a,this.pos);var c=this.pos-r;c>=128&&ax(r,c,this),this.pos=r-1,this.writeVarint(c),this.pos+=c},writeFloat:function(a){this.realloc(4),rx(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),rx(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var c=0;c<r;c++)this.buf[this.pos++]=a[c]},writeRawMessage:function(a,r){this.pos++;var c=this.pos;a(r,this);var d=this.pos-c;d>=128&&ax(c,d,this),this.pos=c-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,r,c){this.writeTag(a,cn.Bytes),this.writeRawMessage(r,c)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,aI,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,lI,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,hI,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,cI,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,uI,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,dI,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,fI,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,pI,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,mI,r)},writeBytesField:function(a,r){this.writeTag(a,cn.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,cn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,cn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,cn.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,cn.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,cn.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,cn.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,Boolean(r))}};class xg{constructor(r,{pixelRatio:c,version:d,stretchX:g,stretchY:y,content:x}){this.paddedRect=r,this.pixelRatio=c,this.stretchX=g,this.stretchY=y,this.content=x,this.version=d}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ux{constructor(r,c){const d={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,d,y),this.addImages(c,g,y);const{w:x,h:E}=cx(y),S=new Ur({width:x||1,height:E||1});for(const P in r){const D=r[P],O=d[P].paddedRect;Ur.copy(D.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const P in c){const D=c[P],O=g[P].paddedRect,N=O.x+1,G=O.y+1,H=D.data.width,oe=D.data.height;Ur.copy(D.data,S,{x:0,y:0},{x:N,y:G},D.data),Ur.copy(D.data,S,{x:0,y:oe-1},{x:N,y:G-1},{width:H,height:1}),Ur.copy(D.data,S,{x:0,y:0},{x:N,y:G+oe},{width:H,height:1}),Ur.copy(D.data,S,{x:H-1,y:0},{x:N-1,y:G},{width:1,height:oe}),Ur.copy(D.data,S,{x:0,y:0},{x:N+H,y:G},{width:1,height:oe})}this.image=S,this.iconPositions=d,this.patternPositions=g}addImages(r,c,d){for(const g in r){const y=r[g],x={x:0,y:0,w:y.data.width+2,h:y.data.height+2};d.push(x),c[g]=new xg(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,c){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in r.updatedImages)this.patchUpdatedImage(this.iconPositions[d],r.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],r.getImage(d),c)}patchUpdatedImage(r,c,d){if(!r||!c||r.version===c.version)return;r.version=c.version;const[g,y]=r.tl;d.update(c.data,void 0,{x:g,y})}}rt("ImagePosition",xg),rt("ImageAtlas",ux),l.WritingMode=void 0,(ua=l.WritingMode||(l.WritingMode={}))[ua.none=0]="none",ua[ua.horizontal=1]="horizontal",ua[ua.vertical=2]="vertical",ua[ua.horizontalOnly=3]="horizontalOnly";const ff=-17;class Qu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,c){const d=new Qu;return d.scale=r||1,d.fontStack=c,d}static forImage(r){const c=new Qu;return c.imageName=r,c}}class hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,c){const d=new hc;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?d.addImageSection(y):d.addTextSection(y,c)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let c="";for(let d=0;d<r.length;d++){const g=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;c+=g&&Wd(g)&&!Ju[r[d+1]]||y&&Wd(y)&&!Ju[r[d-1]]||!Ju[r[d]]?r[d]:Ju[r[d]]}return c}(this.text)}trim(){let r=0;for(let d=0;d<this.text.length&&mf[this.text.charCodeAt(d)];d++)r++;let c=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&mf[this.text.charCodeAt(d)];d--)c--;this.text=this.text.substring(r,c),this.sectionIndex=this.sectionIndex.slice(r,c)}substring(r,c){const d=new hc;return d.text=this.text.substring(r,c),d.sectionIndex=this.sectionIndex.slice(r,c),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,c)=>Math.max(r,this.sections[c].scale),0)}addTextSection(r,c){this.text+=r.text,this.sections.push(Qu.forText(r.scale,r.fontStack||c));const d=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(d)}addImageSection(r){const c=r.image?r.image.name:"";if(c.length===0)return void we("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Qu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):we("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pf(a,r,c,d,g,y,x,E,S,P,D,O,N,G,H,oe){const se=hc.fromFeature(a,g);let ge;O===l.WritingMode.vertical&&se.verticalizePunctuation();const{processBidirectionalText:Te,processStyledBidirectionalText:me}=Er;if(Te&&se.sections.length===1){ge=[];const Re=Te(se.toString(),bg(se,P,y,r,d,G,H));for(const nt of Re){const lt=new hc;lt.text=nt,lt.sections=se.sections;for(let Ke=0;Ke<nt.length;Ke++)lt.sectionIndex.push(0);ge.push(lt)}}else if(me){ge=[];const Re=me(se.text,se.sectionIndex,bg(se,P,y,r,d,G,H));for(const nt of Re){const lt=new hc;lt.text=nt[0],lt.sectionIndex=nt[1],lt.sections=se.sections,ge.push(lt)}}else ge=function(Re,nt){const lt=[],Ke=Re.text;let We=0;for(const je of nt)lt.push(Re.substring(We,je)),We=je;return We<Ke.length&&lt.push(Re.substring(We,Ke.length)),lt}(se,bg(se,P,y,r,d,G,H));const be=[],De={positionedLines:be,text:se.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return function(Re,nt,lt,Ke,We,je,Je,qe,Ne,_t,dt,Rt){let _n=0,bn=ff,Qn=0,jr=0;const Ei=qe==="right"?1:qe==="left"?0:.5;let Hn=0;for(const $n of We){$n.trim();const Si=$n.getMaxScale(),Di=(Si-1)*mi,Zi={positionedGlyphs:[],lineOffset:0};Re.positionedLines[Hn]=Zi;const cr=Zi.positionedGlyphs;let ur=0;if(!$n.length()){bn+=je,++Hn;continue}for(let ci=0;ci<$n.length();ci++){const Ut=$n.getSection(ci),Ar=$n.getSectionIndex(ci),Ai=$n.getCharCode(ci);let zi=0,ds=null,Cs=null,Ms=null,Io=mi;const fs=!(Ne===l.WritingMode.horizontal||!dt&&!Lu(Ai)||dt&&(mf[Ai]||(li=Ai,Ye.Arabic(li)||Ye["Arabic Supplement"](li)||Ye["Arabic Extended-A"](li)||Ye["Arabic Presentation Forms-A"](li)||Ye["Arabic Presentation Forms-B"](li))));if(Ut.imageName){const Gr=Ke[Ut.imageName];if(!Gr)continue;Ms=Ut.imageName,Re.iconsInText=Re.iconsInText||!0,Cs=Gr.paddedRect;const hr=Gr.displaySize;Ut.scale=Ut.scale*mi/Rt,ds={width:hr[0],height:hr[1],left:1,top:-3,advance:fs?hr[1]:hr[0]},zi=Di+(mi-hr[1]*Ut.scale),Io=ds.advance;const Po=fs?hr[0]*Ut.scale-mi*Si:hr[1]*Ut.scale-mi*Si;Po>0&&Po>ur&&(ur=Po)}else{const Gr=lt[Ut.fontStack],hr=Gr&&Gr[Ai];if(hr&&hr.rect)Cs=hr.rect,ds=hr.metrics;else{const Po=nt[Ut.fontStack],nh=Po&&Po[Ai];if(!nh)continue;ds=nh.metrics}zi=(Si-Ut.scale)*mi}fs?(Re.verticalizable=!0,cr.push({glyph:Ai,imageName:Ms,x:_n,y:bn+zi,vertical:fs,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Ar,metrics:ds,rect:Cs}),_n+=Io*Ut.scale+_t):(cr.push({glyph:Ai,imageName:Ms,x:_n,y:bn+zi,vertical:fs,scale:Ut.scale,fontStack:Ut.fontStack,sectionIndex:Ar,metrics:ds,rect:Cs}),_n+=ds.advance*Ut.scale+_t)}cr.length!==0&&(Qn=Math.max(_n-_t,Qn),bI(cr,0,cr.length-1,Ei,ur)),_n=0;const Tn=je*Si+ur;Zi.lineOffset=Math.max(ur,Di),bn+=Tn,jr=Math.max(Tn,jr),++Hn}var li;const Ti=bn-ff,{horizontalAlign:Ri,verticalAlign:lr}=wg(Je);(function($n,Si,Di,Zi,cr,ur,Tn,ci,Ut){const Ar=(Si-Di)*cr;let Ai=0;Ai=ur!==Tn?-ci*Zi-ff:(-Zi*Ut+.5)*Tn;for(const zi of $n)for(const ds of zi.positionedGlyphs)ds.x+=Ar,ds.y+=Ai})(Re.positionedLines,Ei,Ri,lr,Qn,jr,je,Ti,We.length),Re.top+=-lr*Ti,Re.bottom=Re.top+Ti,Re.left+=-Ri*Qn,Re.right=Re.left+Qn}(De,r,c,d,ge,x,E,S,O,P,N,oe),!function(Re){for(const nt of Re)if(nt.positionedGlyphs.length!==0)return!1;return!0}(be)&&De}const mf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hx(a,r,c,d,g,y){if(r.imageName){const x=d[r.imageName];return x?x.displaySize[0]*r.scale*mi/y+g:0}{const x=c[r.fontStack],E=x&&x[a];return E?E.metrics.advance*r.scale+g:0}}function dx(a,r,c,d){const g=Math.pow(a-r,2);return d?a<r?g/2:2*g:g+Math.abs(c)*c}function xI(a,r,c){let d=0;return a===10&&(d-=1e4),c&&(d+=150),a!==40&&a!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function fx(a,r,c,d,g,y){let x=null,E=dx(r,c,g,y);for(const S of d){const P=dx(r-S.x,c,g,y)+S.badness;P<=E&&(x=S,E=P)}return{index:a,x:r,priorBreak:x,badness:E}}function px(a){return a?px(a.priorBreak).concat(a.index):[]}function bg(a,r,c,d,g,y,x){if(y!=="point")return[];if(!a)return[];const E=[],S=function(N,G,H,oe,se,ge){let Te=0;for(let me=0;me<N.length();me++){const be=N.getSection(me);Te+=hx(N.getCharCode(me),be,oe,se,G,ge)}return Te/Math.max(1,Math.ceil(Te/H))}(a,r,c,d,g,x),P=a.text.indexOf("\u200B")>=0;let D=0;for(let N=0;N<a.length();N++){const G=a.getSection(N),H=a.getCharCode(N);if(mf[H]||(D+=hx(H,G,d,g,r,x)),N<a.length()-1){const oe=!((O=H)<11904||!(Ye["Bopomofo Extended"](O)||Ye.Bopomofo(O)||Ye["CJK Compatibility Forms"](O)||Ye["CJK Compatibility Ideographs"](O)||Ye["CJK Compatibility"](O)||Ye["CJK Radicals Supplement"](O)||Ye["CJK Strokes"](O)||Ye["CJK Symbols and Punctuation"](O)||Ye["CJK Unified Ideographs Extension A"](O)||Ye["CJK Unified Ideographs"](O)||Ye["Enclosed CJK Letters and Months"](O)||Ye["Halfwidth and Fullwidth Forms"](O)||Ye.Hiragana(O)||Ye["Ideographic Description Characters"](O)||Ye["Kangxi Radicals"](O)||Ye["Katakana Phonetic Extensions"](O)||Ye.Katakana(O)||Ye["Vertical Forms"](O)||Ye["Yi Radicals"](O)||Ye["Yi Syllables"](O)));(vI[H]||oe||G.imageName)&&E.push(fx(N+1,D,S,E,xI(H,a.getCharCode(N+1),oe&&P),!1))}}var O;return px(fx(a.length(),D,S,E,0,!0))}function wg(a){let r=.5,c=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:r,verticalAlign:c}}function bI(a,r,c,d,g){if(!d&&!g)return;const y=a[c],x=(a[c].x+y.metrics.advance*y.scale)*d;for(let E=r;E<=c;E++)a[E].x-=x,a[E].y+=g}function wI(a,r,c){const{horizontalAlign:d,verticalAlign:g}=wg(c),y=r[0]-a.displaySize[0]*d,x=r[1]-a.displaySize[1]*g;return{image:a,top:x,bottom:x+a.displaySize[1],left:y,right:y+a.displaySize[0]}}function mx(a,r,c,d,g,y){const x=a.image;let E;if(x.content){const se=x.content,ge=x.pixelRatio||1;E=[se[0]/ge,se[1]/ge,x.displaySize[0]-se[2]/ge,x.displaySize[1]-se[3]/ge]}const S=r.left*y,P=r.right*y;let D,O,N,G;c==="width"||c==="both"?(G=g[0]+S-d[3],O=g[0]+P+d[1]):(G=g[0]+(S+P-x.displaySize[0])/2,O=G+x.displaySize[0]);const H=r.top*y,oe=r.bottom*y;return c==="height"||c==="both"?(D=g[1]+H-d[0],N=g[1]+oe+d[2]):(D=g[1]+(H+oe-x.displaySize[1])/2,N=D+x.displaySize[1]),{image:x,top:D,right:O,bottom:N,left:G,collisionPadding:E}}const Ao=128;function gx(a,r){const{expression:c}=r;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new vn(a+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=c;let y=0;for(;y<d.length&&d[y]<=a;)y++;y=Math.max(0,y-1);let x=y;for(;x<d.length&&d[x]<a+1;)x++;x=Math.min(d.length-1,x);const E=d[y],S=d[x];return c.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:S,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:S,minSize:c.evaluate(new vn(E)),maxSize:c.evaluate(new vn(S)),interpolationType:g}}}class ha extends vt{constructor(r,c,d,g){super(r,c),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new ha(this.x,this.y,this.angle,this.segment)}}function _x(a,r,c,d,g){if(r.segment===void 0)return!0;let y=r,x=r.segment+1,E=0;for(;E>-c/2;){if(x--,x<0)return!1;E-=a[x].dist(y),y=a[x]}E+=a[x].dist(a[x+1]),x++;const S=[];let P=0;for(;E<c/2;){const D=a[x],O=a[x+1];if(!O)return!1;let N=a[x-1].angleTo(D)-D.angleTo(O);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:E,angleDelta:N}),P+=N;E-S[0].distance>d;)P-=S.shift().angleDelta;if(P>g)return!1;x++,E+=D.dist(O)}return!0}function yx(a){let r=0;for(let c=0;c<a.length-1;c++)r+=a[c].dist(a[c+1]);return r}function vx(a,r,c){return a?.6*r*c:0}function xx(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function EI(a,r,c,d,g,y){const x=vx(c,g,y),E=xx(c,d)*y;let S=0;const P=yx(a)/2;for(let D=0;D<a.length-1;D++){const O=a[D],N=a[D+1],G=O.dist(N);if(S+G>P){const H=(P-S)/G,oe=kt(O.x,N.x,H),se=kt(O.y,N.y,H),ge=new ha(oe,se,N.angleTo(O),D);return ge._round(),!x||_x(a,ge,E,x,r)?ge:void 0}S+=G}}function TI(a,r,c,d,g,y,x,E,S){const P=vx(d,y,x),D=xx(d,g),O=D*x,N=a[0].x===0||a[0].x===S||a[0].y===0||a[0].y===S;return r-O<r/4&&(r=O+r/4),bx(a,N?r/2*E%r:(D/2+2*y)*x*E%r,r,P,c,O,N,!1,S)}function bx(a,r,c,d,g,y,x,E,S){const P=y/2,D=yx(a);let O=0,N=r-c,G=[];for(let H=0;H<a.length-1;H++){const oe=a[H],se=a[H+1],ge=oe.dist(se),Te=se.angleTo(oe);for(;N+c<O+ge;){N+=c;const me=(N-O)/ge,be=kt(oe.x,se.x,me),De=kt(oe.y,se.y,me);if(be>=0&&be<S&&De>=0&&De<S&&N-P>=0&&N+P<=D){const Re=new ha(be,De,Te,H);Re._round(),d&&!_x(a,Re,y,d,g)||G.push(Re)}}O+=ge}return E||G.length||x||(G=bx(a,O/2,c,d,g,y,x,!0,S)),G}function wx(a,r,c,d,g){const y=[];for(let x=0;x<a.length;x++){const E=a[x];let S;for(let P=0;P<E.length-1;P++){let D=E[P],O=E[P+1];D.x<r&&O.x<r||(D.x<r?D=new vt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<r&&(O=new vt(r,D.y+(r-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<c&&O.y<c||(D.y<c?D=new vt(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round():O.y<c&&(O=new vt(D.x+(c-D.y)/(O.y-D.y)*(O.x-D.x),c)._round()),D.x>=d&&O.x>=d||(D.x>=d?D=new vt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=d&&(O=new vt(d,D.y+(d-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=g&&O.y>=g||(D.y>=g?D=new vt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round():O.y>=g&&(O=new vt(D.x+(g-D.y)/(O.y-D.y)*(O.x-D.x),g)._round()),S&&D.equals(S[S.length-1])||(S=[D],y.push(S)),S.push(O)))))}}return y}function Ex(a,r,c,d){const g=[],y=a.image,x=y.pixelRatio,E=y.paddedRect.w-2,S=y.paddedRect.h-2,P=a.right-a.left,D=a.bottom-a.top,O=y.stretchX||[[0,E]],N=y.stretchY||[[0,S]],G=(je,Je)=>je+Je[1]-Je[0],H=O.reduce(G,0),oe=N.reduce(G,0),se=E-H,ge=S-oe;let Te=0,me=H,be=0,De=oe,Re=0,nt=se,lt=0,Ke=ge;if(y.content&&d){const je=y.content;Te=gf(O,0,je[0]),be=gf(N,0,je[1]),me=gf(O,je[0],je[2]),De=gf(N,je[1],je[3]),Re=je[0]-Te,lt=je[1]-be,nt=je[2]-je[0]-me,Ke=je[3]-je[1]-De}const We=(je,Je,qe,Ne)=>{const _t=_f(je.stretch-Te,me,P,a.left),dt=yf(je.fixed-Re,nt,je.stretch,H),Rt=_f(Je.stretch-be,De,D,a.top),_n=yf(Je.fixed-lt,Ke,Je.stretch,oe),bn=_f(qe.stretch-Te,me,P,a.left),Qn=yf(qe.fixed-Re,nt,qe.stretch,H),jr=_f(Ne.stretch-be,De,D,a.top),Ei=yf(Ne.fixed-lt,Ke,Ne.stretch,oe),Hn=new vt(_t,Rt),li=new vt(bn,Rt),Ti=new vt(bn,jr),Ri=new vt(_t,jr),lr=new vt(dt/x,_n/x),$n=new vt(Qn/x,Ei/x),Si=r*Math.PI/180;if(Si){const cr=Math.sin(Si),ur=Math.cos(Si),Tn=[ur,-cr,cr,ur];Hn._matMult(Tn),li._matMult(Tn),Ri._matMult(Tn),Ti._matMult(Tn)}const Di=je.stretch+je.fixed,Zi=Je.stretch+Je.fixed;return{tl:Hn,tr:li,bl:Ri,br:Ti,tex:{x:y.paddedRect.x+1+Di,y:y.paddedRect.y+1+Zi,w:qe.stretch+qe.fixed-Di,h:Ne.stretch+Ne.fixed-Zi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:$n,minFontScaleX:nt/x/P,minFontScaleY:Ke/x/D,isSDF:c}};if(d&&(y.stretchX||y.stretchY)){const je=Tx(O,se,H),Je=Tx(N,ge,oe);for(let qe=0;qe<je.length-1;qe++){const Ne=je[qe],_t=je[qe+1];for(let dt=0;dt<Je.length-1;dt++)g.push(We(Ne,Je[dt],_t,Je[dt+1]))}}else g.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:S+1}));return g}function gf(a,r,c){let d=0;for(const g of a)d+=Math.max(r,Math.min(c,g[1]))-Math.max(r,Math.min(c,g[0]));return d}function Tx(a,r,c){const d=[{fixed:-1,stretch:0}];for(const[g,y]of a){const x=d[d.length-1];d.push({fixed:g-x.stretch,stretch:x.stretch}),d.push({fixed:g-x.stretch,stretch:x.stretch+(y-g)})}return d.push({fixed:r+1,stretch:c}),d}function _f(a,r,c,d){return a/r*c+d}function yf(a,r,c,d){return a-r*c/d}rt("Anchor",ha);class vf{constructor(r,c,d,g,y,x,E,S,P,D){if(this.boxStartIndex=r.length,P){let O=x.top,N=x.bottom;const G=x.collisionPadding;G&&(O-=G[1],N+=G[3]);let H=N-O;H>0&&(H=Math.max(10,H),this.circleDiameter=H)}else{let O=x.top*E-S[0],N=x.bottom*E+S[2],G=x.left*E-S[3],H=x.right*E+S[1];const oe=x.collisionPadding;if(oe&&(G-=oe[0]*E,O-=oe[1]*E,H+=oe[2]*E,N+=oe[3]*E),D){const se=new vt(G,O),ge=new vt(H,O),Te=new vt(G,N),me=new vt(H,N),be=D*Math.PI/180;se._rotate(be),ge._rotate(be),Te._rotate(be),me._rotate(be),G=Math.min(se.x,ge.x,Te.x,me.x),H=Math.max(se.x,ge.x,Te.x,me.x),O=Math.min(se.y,ge.y,Te.y,me.y),N=Math.max(se.y,ge.y,Te.y,me.y)}r.emplaceBack(c.x,c.y,G,O,H,N,d,g,y)}this.boxEndIndex=r.length}}class SI{constructor(r=[],c=AI){if(this.data=r,this.length=this.data.length,this.compare=c,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:c,compare:d}=this,g=c[r];for(;r>0;){const y=r-1>>1,x=c[y];if(d(g,x)>=0)break;c[r]=x,r=y}c[r]=g}_down(r){const{data:c,compare:d}=this,g=this.length>>1,y=c[r];for(;r<g;){let x=1+(r<<1),E=c[x];const S=x+1;if(S<this.length&&d(c[S],E)<0&&(x=S,E=c[S]),d(E,y)>=0)break;c[r]=E,r=x}c[r]=y}}function AI(a,r){return a<r?-1:a>r?1:0}function II(a,r=1,c=!1){let d=1/0,g=1/0,y=-1/0,x=-1/0;const E=a[0];for(let G=0;G<E.length;G++){const H=E[G];(!G||H.x<d)&&(d=H.x),(!G||H.y<g)&&(g=H.y),(!G||H.x>y)&&(y=H.x),(!G||H.y>x)&&(x=H.y)}const S=Math.min(y-d,x-g);let P=S/2;const D=new SI([],PI);if(S===0)return new vt(d,g);for(let G=d;G<y;G+=S)for(let H=g;H<x;H+=S)D.push(new dc(G+P,H+P,P,a));let O=function(G){let H=0,oe=0,se=0;const ge=G[0];for(let Te=0,me=ge.length,be=me-1;Te<me;be=Te++){const De=ge[Te],Re=ge[be],nt=De.x*Re.y-Re.x*De.y;oe+=(De.x+Re.x)*nt,se+=(De.y+Re.y)*nt,H+=3*nt}return new dc(oe/H,se/H,0,G)}(a),N=D.length;for(;D.length;){const G=D.pop();(G.d>O.d||!O.d)&&(O=G,c&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,N)),G.max-O.d<=r||(P=G.h/2,D.push(new dc(G.p.x-P,G.p.y-P,P,a)),D.push(new dc(G.p.x+P,G.p.y-P,P,a)),D.push(new dc(G.p.x-P,G.p.y+P,P,a)),D.push(new dc(G.p.x+P,G.p.y+P,P,a)),N+=4)}return c&&(console.log(`num probes: ${N}`),console.log(`best distance: ${O.d}`)),O.p}function PI(a,r){return r.max-a.max}function dc(a,r,c,d){this.p=new vt(a,r),this.h=c,this.d=function(g,y){let x=!1,E=1/0;for(let S=0;S<y.length;S++){const P=y[S];for(let D=0,O=P.length,N=O-1;D<O;N=D++){const G=P[D],H=P[N];G.y>g.y!=H.y>g.y&&g.x<(H.x-G.x)*(g.y-G.y)/(H.y-G.y)+G.x&&(x=!x),E=Math.min(E,Lv(g,G,H))}}return(x?1:-1)*Math.sqrt(E)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}const Eg=Number.POSITIVE_INFINITY;function Sx(a,r){return r[1]!==Eg?function(c,d,g){let y=0,x=0;switch(d=Math.abs(d),g=Math.abs(g),c){case"top-right":case"top-left":case"top":x=g-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-g}switch(c){case"top-right":case"bottom-right":case"right":y=-d;break;case"top-left":case"bottom-left":case"left":y=d}return[y,x]}(a,r[0],r[1]):function(c,d){let g=0,y=0;d<0&&(d=0);const x=d/Math.sqrt(2);switch(c){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-d;break;case"top":y=d-7}switch(c){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=d;break;case"right":g=-d}return[g,y]}(a,r[0])}function Tg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function CI(a,r,c,d,g,y,x,E,S,P,D){let O=y.textMaxSize.evaluate(r,{});O===void 0&&(O=x);const N=a.layers[0].layout,G=N.get("icon-offset").evaluate(r,{},D),H=Ix(c.horizontal),oe=x/24,se=a.tilePixelRatio*oe,ge=a.tilePixelRatio*O/24,Te=a.tilePixelRatio*E,me=a.tilePixelRatio*N.get("symbol-spacing"),be=N.get("text-padding")*a.tilePixelRatio,De=function(Ne,_t,dt,Rt=1){const _n=Ne.get("icon-padding").evaluate(_t,{},dt),bn=_n&&_n.values;return[bn[0]*Rt,bn[1]*Rt,bn[2]*Rt,bn[3]*Rt]}(N,r,D,a.tilePixelRatio),Re=N.get("text-max-angle")/180*Math.PI,nt=N.get("text-rotation-alignment")!=="viewport"&&N.get("symbol-placement")!=="point",lt=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Ke=N.get("symbol-placement"),We=me/2,je=N.get("icon-text-fit");let Je;d&&je!=="none"&&(a.allowVerticalPlacement&&c.vertical&&(Je=mx(d,c.vertical,je,N.get("icon-text-fit-padding"),G,oe)),H&&(d=mx(d,H,je,N.get("icon-text-fit-padding"),G,oe)));const qe=(Ne,_t)=>{_t.x<0||_t.x>=Jn||_t.y<0||_t.y>=Jn||function(dt,Rt,_n,bn,Qn,jr,Ei,Hn,li,Ti,Ri,lr,$n,Si,Di,Zi,cr,ur,Tn,ci,Ut,Ar,Ai,zi,ds){const Cs=dt.addToLineVertexArray(Rt,_n);let Ms,Io,fs,Gr,hr=0,Po=0,nh=0,Gx=0,Dg=-1,zg=-1;const Co={};let Hx=ai.exports(""),Og=0,Fg=0;if(Hn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Og,Fg]=Hn.layout.get("text-offset").evaluate(Ut,{},zi).map(dr=>dr*mi):(Og=Hn.layout.get("text-radial-offset").evaluate(Ut,{},zi)*mi,Fg=Eg),dt.allowVerticalPlacement&&bn.vertical){const dr=Hn.layout.get("text-rotate").evaluate(Ut,{},zi)+90;fs=new vf(li,Rt,Ti,Ri,lr,bn.vertical,$n,Si,Di,dr),Ei&&(Gr=new vf(li,Rt,Ti,Ri,lr,Ei,cr,ur,Di,dr))}if(Qn){const dr=Hn.layout.get("icon-rotate").evaluate(Ut,{}),to=Hn.layout.get("icon-text-fit")!=="none",ih=Ex(Qn,dr,Ai,to),rh=Ei?Ex(Ei,dr,Ai,to):void 0;Io=new vf(li,Rt,Ti,Ri,lr,Qn,cr,ur,!1,dr),hr=4*ih.length;const qx=dt.iconSizeData;let pl=null;qx.kind==="source"?(pl=[Ao*Hn.layout.get("icon-size").evaluate(Ut,{})],pl[0]>da&&we(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):qx.kind==="composite"&&(pl=[Ao*Ar.compositeIconSizes[0].evaluate(Ut,{},zi),Ao*Ar.compositeIconSizes[1].evaluate(Ut,{},zi)],(pl[0]>da||pl[1]>da)&&we(`${dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,ih,pl,ci,Tn,Ut,l.WritingMode.none,Rt,Cs.lineStartIndex,Cs.lineLength,-1,zi),Dg=dt.icon.placedSymbolArray.length-1,rh&&(Po=4*rh.length,dt.addSymbols(dt.icon,rh,pl,ci,Tn,Ut,l.WritingMode.vertical,Rt,Cs.lineStartIndex,Cs.lineLength,-1,zi),zg=dt.icon.placedSymbolArray.length-1)}const $x=Object.keys(bn.horizontal);for(const dr of $x){const to=bn.horizontal[dr];if(!Ms){Hx=ai.exports(to.text);const rh=Hn.layout.get("text-rotate").evaluate(Ut,{},zi);Ms=new vf(li,Rt,Ti,Ri,lr,to,$n,Si,Di,rh)}const ih=to.positionedLines.length===1;if(nh+=Ax(dt,Rt,to,jr,Hn,Di,Ut,Zi,Cs,bn.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,ih?$x:[dr],Co,Dg,Ar,zi),ih)break}bn.vertical&&(Gx+=Ax(dt,Rt,bn.vertical,jr,Hn,Di,Ut,Zi,Cs,l.WritingMode.vertical,["vertical"],Co,zg,Ar,zi));const jI=Ms?Ms.boxStartIndex:dt.collisionBoxArray.length,GI=Ms?Ms.boxEndIndex:dt.collisionBoxArray.length,HI=fs?fs.boxStartIndex:dt.collisionBoxArray.length,$I=fs?fs.boxEndIndex:dt.collisionBoxArray.length,WI=Io?Io.boxStartIndex:dt.collisionBoxArray.length,qI=Io?Io.boxEndIndex:dt.collisionBoxArray.length,XI=Gr?Gr.boxStartIndex:dt.collisionBoxArray.length,ZI=Gr?Gr.boxEndIndex:dt.collisionBoxArray.length;let ks=-1;const Tf=(dr,to)=>dr&&dr.circleDiameter?Math.max(dr.circleDiameter,to):to;ks=Tf(Ms,ks),ks=Tf(fs,ks),ks=Tf(Io,ks),ks=Tf(Gr,ks);const Wx=ks>-1?1:0;Wx&&(ks*=ds/mi),dt.glyphOffsetArray.length>=fc.MAX_GLYPHS&&we("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&dt.addToSortKeyRanges(dt.symbolInstances.length,Ut.sortKey),dt.symbolInstances.emplaceBack(Rt.x,Rt.y,Co.right>=0?Co.right:-1,Co.center>=0?Co.center:-1,Co.left>=0?Co.left:-1,Co.vertical||-1,Dg,zg,Hx,jI,GI,HI,$I,WI,qI,XI,ZI,Ti,nh,Gx,hr,Po,Wx,0,$n,Og,Fg,ks)}(a,_t,Ne,c,d,g,Je,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,se,[be,be,be,be],nt,S,Te,De,lt,G,r,y,P,D,x)};if(Ke==="line")for(const Ne of wx(r.geometry,0,0,Jn,Jn)){const _t=TI(Ne,me,Re,c.vertical||H,d,24,ge,a.overscaling,Jn);for(const dt of _t){const Rt=H;Rt&&MI(a,Rt.text,We,dt)||qe(Ne,dt)}}else if(Ke==="line-center"){for(const Ne of r.geometry)if(Ne.length>1){const _t=EI(Ne,Re,c.vertical||H,d,24,ge);_t&&qe(Ne,_t)}}else if(r.type==="Polygon")for(const Ne of hg(r.geometry,0)){const _t=II(Ne,16);qe(Ne[0],new ha(_t.x,_t.y,0))}else if(r.type==="LineString")for(const Ne of r.geometry)qe(Ne,new ha(Ne[0].x,Ne[0].y,0));else if(r.type==="Point")for(const Ne of r.geometry)for(const _t of Ne)qe([_t],new ha(_t.x,_t.y,0))}const da=32640;function Ax(a,r,c,d,g,y,x,E,S,P,D,O,N,G,H){const oe=function(Te,me,be,De,Re,nt,lt,Ke){const We=De.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,je=[];for(const Je of me.positionedLines)for(const qe of Je.positionedGlyphs){if(!qe.rect)continue;const Ne=qe.rect||{};let _t=4,dt=!0,Rt=1,_n=0;const bn=(Re||Ke)&&qe.vertical,Qn=qe.metrics.advance*qe.scale/2;if(Ke&&me.verticalizable){const Tn=(qe.scale-1)*mi,ci=(mi-qe.metrics.width*qe.scale)/2;_n=Je.lineOffset/2-(qe.imageName?-ci:Tn)}if(qe.imageName){const Tn=lt[qe.imageName];dt=Tn.sdf,Rt=Tn.pixelRatio,_t=1/Rt}const jr=Re?[qe.x+Qn,qe.y]:[0,0];let Ei=Re?[0,0]:[qe.x+Qn+be[0],qe.y+be[1]-_n],Hn=[0,0];bn&&(Hn=Ei,Ei=[0,0]);const li=(qe.metrics.left-_t)*qe.scale-Qn+Ei[0],Ti=(-qe.metrics.top-_t)*qe.scale+Ei[1],Ri=li+Ne.w*qe.scale/Rt,lr=Ti+Ne.h*qe.scale/Rt,$n=new vt(li,Ti),Si=new vt(Ri,Ti),Di=new vt(li,lr),Zi=new vt(Ri,lr);if(bn){const Tn=new vt(-Qn,Qn-ff),ci=-Math.PI/2,Ut=12-Qn,Ar=new vt(22-Ut,-(qe.imageName?Ut:0)),Ai=new vt(...Hn);$n._rotateAround(ci,Tn)._add(Ar)._add(Ai),Si._rotateAround(ci,Tn)._add(Ar)._add(Ai),Di._rotateAround(ci,Tn)._add(Ar)._add(Ai),Zi._rotateAround(ci,Tn)._add(Ar)._add(Ai)}if(We){const Tn=Math.sin(We),ci=Math.cos(We),Ut=[ci,-Tn,Tn,ci];$n._matMult(Ut),Si._matMult(Ut),Di._matMult(Ut),Zi._matMult(Ut)}const cr=new vt(0,0),ur=new vt(0,0);je.push({tl:$n,tr:Si,bl:Di,br:Zi,tex:Ne,writingMode:me.writingMode,glyphOffset:jr,sectionIndex:qe.sectionIndex,isSDF:dt,pixelOffsetTL:cr,pixelOffsetBR:ur,minFontScaleX:0,minFontScaleY:0})}return je}(0,c,E,g,y,x,d,a.allowVerticalPlacement),se=a.textSizeData;let ge=null;se.kind==="source"?(ge=[Ao*g.layout.get("text-size").evaluate(x,{})],ge[0]>da&&we(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):se.kind==="composite"&&(ge=[Ao*G.compositeTextSizes[0].evaluate(x,{},H),Ao*G.compositeTextSizes[1].evaluate(x,{},H)],(ge[0]>da||ge[1]>da)&&we(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,oe,ge,E,y,x,P,r,S.lineStartIndex,S.lineLength,N,H);for(const Te of D)O[Te]=a.text.placedSymbolArray.length-1;return 4*oe.length}function Ix(a){for(const r in a)return a[r];return null}function MI(a,r,c,d){const g=a.compareText;if(r in g){const y=g[r];for(let x=y.length-1;x>=0;x--)if(d.dist(y[x])<c)return!0}else g[r]=[];return g[r].push(d),!1}const kI=ca.VectorTileFeature.types,LI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xf(a,r,c,d,g,y,x,E,S,P,D,O,N){const G=E?Math.min(da,Math.round(E[0])):0,H=E?Math.min(da,Math.round(E[1])):0;a.emplaceBack(r,c,Math.round(32*d),Math.round(32*g),y,x,(G<<1)+(S?1:0),H,16*P,16*D,256*O,256*N)}function Sg(a,r,c){a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c),a.emplaceBack(r.x,r.y,c)}function RI(a){for(const r of a.sections)if(Xd(r.text))return!0;return!1}class Ag{constructor(r){this.layoutVertexArray=new us,this.indexArray=new Wi,this.programConfigurations=r,this.segments=new Ft,this.dynamicLayoutVertexArray=new Nr,this.opacityVertexArray=new hs,this.placedSymbolArray=new Fe}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,c,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,nI.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,iI.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,LI,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}rt("SymbolBuffers",Ag);class Ig{constructor(r,c,d){this.layoutVertexArray=new r,this.layoutAttributes=c,this.indexArray=new d,this.segments=new Ft,this.collisionVertexArray=new Tr}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,rI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}rt("CollisionBuffers",Ig);class fc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(x=>x.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=sg([]),this.placementViewportMatrix=sg([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gx(this.zoom,c["text-size"]),this.iconSizeData=gx(this.zoom,c["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=Cg(d,"text-overlap","text-allow-overlap")!=="never"||Cg(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(x=>l.WritingMode[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=r.sourceID}createArrays(){this.text=new Ag(new cl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Ag(new cl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new $e,this.lineVertexArray=new tt,this.symbolInstances=new Qe}calculateGlyphDependencies(r,c,d,g,y){for(let x=0;x<r.length;x++)if(c[r.charCodeAt(x)]=!0,(d||g)&&y){const E=Ju[r.charAt(x)];E&&(c[E.charCodeAt(0)]=!0)}}populate(r,c,d){const g=this.layers[0],y=g.layout,x=y.get("text-font"),E=y.get("text-field"),S=y.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof ue&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=y.get("symbol-sort-key");if(this.features=[],!P&&!D)return;const N=c.iconDependencies,G=c.glyphDependencies,H=c.availableImages,oe=new vn(this.zoom);for(const{feature:se,id:ge,index:Te,sourceLayerIndex:me}of r){const be=g._featureFilter.needGeometry,De=hl(se,be);if(!g._featureFilter.filter(oe,De,d))continue;let Re,nt;if(be||(De.geometry=ul(se)),P){const Ke=g.getValueAndResolveTokens("text-field",De,d,H),We=ue.factory(Ke);RI(We)&&(this.hasRTLText=!0),(!this.hasRTLText||ol()==="unavailable"||this.hasRTLText&&Er.isParsed())&&(Re=oI(We,g,De))}if(D){const Ke=g.getValueAndResolveTokens("icon-image",De,d,H);nt=Ke instanceof fe?Ke:fe.fromString(Ke)}if(!Re&&!nt)continue;const lt=this.sortFeaturesByKey?O.evaluate(De,{},d):void 0;if(this.features.push({id:ge,text:Re,icon:nt,index:Te,sourceLayerIndex:me,geometry:De.geometry,properties:se.properties,type:kI[se.type],sortKey:lt}),nt&&(N[nt.name]=!0),Re){const Ke=x.evaluate(De,{},d).join(","),We=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const je of Re.sections)if(je.image)N[je.image.name]=!0;else{const Je=tc(Re.toString()),qe=je.fontStack||Ke,Ne=G[qe]=G[qe]||{};this.calculateGlyphDependencies(je.text,Ne,We,this.allowVerticalPlacement,Je)}}}y.get("symbol-placement")==="line"&&(this.features=function(se){const ge={},Te={},me=[];let be=0;function De(Ke){me.push(se[Ke]),be++}function Re(Ke,We,je){const Je=Te[Ke];return delete Te[Ke],Te[We]=Je,me[Je].geometry[0].pop(),me[Je].geometry[0]=me[Je].geometry[0].concat(je[0]),Je}function nt(Ke,We,je){const Je=ge[We];return delete ge[We],ge[Ke]=Je,me[Je].geometry[0].shift(),me[Je].geometry[0]=je[0].concat(me[Je].geometry[0]),Je}function lt(Ke,We,je){const Je=je?We[0][We[0].length-1]:We[0][0];return`${Ke}:${Je.x}:${Je.y}`}for(let Ke=0;Ke<se.length;Ke++){const We=se[Ke],je=We.geometry,Je=We.text?We.text.toString():null;if(!Je){De(Ke);continue}const qe=lt(Je,je),Ne=lt(Je,je,!0);if(qe in Te&&Ne in ge&&Te[qe]!==ge[Ne]){const _t=nt(qe,Ne,je),dt=Re(qe,Ne,me[_t].geometry);delete ge[qe],delete Te[Ne],Te[lt(Je,me[dt].geometry,!0)]=dt,me[_t].geometry=null}else qe in Te?Re(qe,Ne,je):Ne in ge?nt(qe,Ne,je):(De(Ke),ge[qe]=be-1,Te[Ne]=be-1)}return me.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,ge)=>se.sortKey-ge.sortKey)}update(r,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,c,this.layers,d),this.icon.programConfigurations.updatePaintArrays(r,c,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,c){const d=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(c[r.segment+1]),y=r.dist(c[r.segment]);const x={};for(let E=r.segment+1;E<c.length;E++)x[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:g},E<c.length-1&&(g+=c[E+1].dist(c[E]));for(let E=r.segment||0;E>=0;E--)x[E]={x:c[E].x,y:c[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=c[E-1].dist(c[E]));for(let E=0;E<c.length;E++){const S=x[E];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,c,d,g,y,x,E,S,P,D,O,N){const G=r.indexArray,H=r.layoutVertexArray,oe=r.segments.prepareSegment(4*c.length,H,G,this.canOverlap?x.sortKey:void 0),se=this.glyphOffsetArray.length,ge=oe.vertexLength,Te=this.allowVerticalPlacement&&E===l.WritingMode.vertical?Math.PI/2:0,me=x.text&&x.text.sections;for(let be=0;be<c.length;be++){const{tl:De,tr:Re,bl:nt,br:lt,tex:Ke,pixelOffsetTL:We,pixelOffsetBR:je,minFontScaleX:Je,minFontScaleY:qe,glyphOffset:Ne,isSDF:_t,sectionIndex:dt}=c[be],Rt=oe.vertexLength,_n=Ne[1];xf(H,S.x,S.y,De.x,_n+De.y,Ke.x,Ke.y,d,_t,We.x,We.y,Je,qe),xf(H,S.x,S.y,Re.x,_n+Re.y,Ke.x+Ke.w,Ke.y,d,_t,je.x,We.y,Je,qe),xf(H,S.x,S.y,nt.x,_n+nt.y,Ke.x,Ke.y+Ke.h,d,_t,We.x,je.y,Je,qe),xf(H,S.x,S.y,lt.x,_n+lt.y,Ke.x+Ke.w,Ke.y+Ke.h,d,_t,je.x,je.y,Je,qe),Sg(r.dynamicLayoutVertexArray,S,Te),G.emplaceBack(Rt,Rt+1,Rt+2),G.emplaceBack(Rt+1,Rt+2,Rt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ne[0]),be!==c.length-1&&dt===c[be+1].sectionIndex||r.programConfigurations.populatePaintArrays(H.length,x,x.index,{},N,me&&me[dt])}r.placedSymbolArray.emplaceBack(S.x,S.y,se,this.glyphOffsetArray.length-se,ge,P,D,S.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],E,0,!1,0,O)}_addCollisionDebugVertex(r,c,d,g,y,x){return c.emplaceBack(0,0),r.emplaceBack(d.x,d.y,g,y,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(r,c,d,g,y,x,E){const S=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),P=S.vertexLength,D=y.layoutVertexArray,O=y.collisionVertexArray,N=E.anchorX,G=E.anchorY;this._addCollisionDebugVertex(D,O,x,N,G,new vt(r,c)),this._addCollisionDebugVertex(D,O,x,N,G,new vt(d,c)),this._addCollisionDebugVertex(D,O,x,N,G,new vt(d,g)),this._addCollisionDebugVertex(D,O,x,N,G,new vt(r,g)),S.vertexLength+=4;const H=y.indexArray;H.emplaceBack(P,P+1),H.emplaceBack(P+1,P+2),H.emplaceBack(P+2,P+3),H.emplaceBack(P+3,P),S.primitiveLength+=4}addDebugCollisionBoxes(r,c,d,g){for(let y=r;y<c;y++){const x=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ig(Qs,nx.members,Is),this.iconCollisionBox=new Ig(Qs,nx.members,Is);for(let r=0;r<this.symbolInstances.length;r++){const c=this.symbolInstances.get(r);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(r,c,d,g,y,x,E,S,P){const D={};for(let O=c;O<d;O++){const N=r.get(O);D.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.textFeatureIndex=N.featureIndex;break}for(let O=g;O<y;O++){const N=r.get(O);D.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalTextFeatureIndex=N.featureIndex;break}for(let O=x;O<E;O++){const N=r.get(O);D.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.iconFeatureIndex=N.featureIndex;break}for(let O=S;O<P;O++){const N=r.get(O);D.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,anchorPointX:N.anchorPointX,anchorPointY:N.anchorPointY},D.verticalIconFeatureIndex=N.featureIndex;break}return D}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,c){const d=r.placedSymbolArray.get(c),g=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<g;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(r),d=Math.cos(r),g=[],y=[],x=[];for(let E=0;E<this.symbolInstances.length;++E){x.push(E);const S=this.symbolInstances.get(E);g.push(0|Math.round(c*S.anchorX+d*S.anchorY)),y.push(S.featureIndex)}return x.sort((E,S)=>g[E]-g[S]||y[S]-y[E]),x}addToSortKeyRanges(r,c){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===c?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const d=this.symbolInstances.get(c);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,y,x)=>{g>=0&&x.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rt("SymbolBucket",fc,{omit:["layers","collisionBoxArray","features","compareText"]}),fc.MAX_GLYPHS=65535,fc.addDynamicAttributes=Sg;const DI=new pi({"symbol-placement":new ut(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new ut(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ut(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ut(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ut(Me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ut(Me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ut(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new ut(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ut(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(Me.layout_symbol["icon-size"]),"icon-text-fit":new ut(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ut(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(Me.layout_symbol["icon-image"]),"icon-rotate":new bt(Me.layout_symbol["icon-rotate"]),"icon-padding":new bt(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new ut(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(Me.layout_symbol["icon-offset"]),"icon-anchor":new bt(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ut(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ut(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ut(Me.layout_symbol["text-rotation-alignment"]),"text-field":new bt(Me.layout_symbol["text-field"]),"text-font":new bt(Me.layout_symbol["text-font"]),"text-size":new bt(Me.layout_symbol["text-size"]),"text-max-width":new bt(Me.layout_symbol["text-max-width"]),"text-line-height":new ut(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(Me.layout_symbol["text-letter-spacing"]),"text-justify":new bt(Me.layout_symbol["text-justify"]),"text-radial-offset":new bt(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ut(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new bt(Me.layout_symbol["text-anchor"]),"text-max-angle":new ut(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new ut(Me.layout_symbol["text-writing-mode"]),"text-rotate":new bt(Me.layout_symbol["text-rotate"]),"text-padding":new ut(Me.layout_symbol["text-padding"]),"text-keep-upright":new ut(Me.layout_symbol["text-keep-upright"]),"text-transform":new bt(Me.layout_symbol["text-transform"]),"text-offset":new bt(Me.layout_symbol["text-offset"]),"text-allow-overlap":new ut(Me.layout_symbol["text-allow-overlap"]),"text-overlap":new ut(Me.layout_symbol["text-overlap"]),"text-ignore-placement":new ut(Me.layout_symbol["text-ignore-placement"]),"text-optional":new ut(Me.layout_symbol["text-optional"])});var Pg={paint:new pi({"icon-opacity":new bt(Me.paint_symbol["icon-opacity"]),"icon-color":new bt(Me.paint_symbol["icon-color"]),"icon-halo-color":new bt(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new ut(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new ut(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(Me.paint_symbol["text-opacity"]),"text-color":new bt(Me.paint_symbol["text-color"],{runtimeType:Zn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new bt(Me.paint_symbol["text-halo-color"]),"text-halo-width":new bt(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(Me.paint_symbol["text-halo-blur"]),"text-translate":new ut(Me.paint_symbol["text-translate"]),"text-translate-anchor":new ut(Me.paint_symbol["text-translate-anchor"])}),layout:DI};class Px{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:os,this.defaultValue=r}evaluate(r){if(r.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(r.formattedSection))return c.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rt("FormatSectionOverride",Px,{omit:["defaultValue"]});class bf extends cs{constructor(r){super(r,Pg)}recalculate(r,c){if(super.recalculate(r,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const y of d)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,c,d,g){const y=this.layout.get(r).evaluate(c,{},d,g),x=this._unevaluatedLayout._values[r];return x.isDataDriven()||qa(x.value)||!y?y:function(E,S){return S.replace(/{([^{}]+)}/g,(P,D)=>D in E?String(E[D]):"")}(c.properties,y)}createBucket(r){return new fc(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Pg.paint.overridableProperties){if(!bf.hasPaintOverride(this.layout,r))continue;const c=this.paint.get(r),d=new Px(c),g=new Zl(d,c.property.specification);let y=null;y=c.value.kind==="constant"||c.value.kind==="source"?new Za("source",g):new Au("composite",g,c.value.zoomStops),this.paint._values[r]=new ls(c.property,y,c.parameters)}}_handleOverridablePaintPropertyUpdate(r,c,d){return!(!this.layout||c.isDataDriven()||d.isDataDriven())&&bf.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,c){const d=r.get("text-field"),g=Pg.paint.properties[c];let y=!1;const x=E=>{for(const S of E)if(g.overrides&&g.overrides.hasOverride(S))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ue)x(d.value.value.sections);else if(d.value.kind==="source"){const E=P=>{y||(P instanceof at&&Ae(P.value)===jn?x(P.value.sections):P instanceof ql?x(P.sections):P.eachChild(E))},S=d.value;S._styleExpression&&E(S._styleExpression.expression)}return y}}function Cg(a,r,c){let d="never";const g=a.get(r);return g?d=g:a.get(c)&&(d="always"),d}var zI={paint:new pi({"background-color":new ut(Me.paint_background["background-color"]),"background-pattern":new Bu(Me.paint_background["background-pattern"]),"background-opacity":new ut(Me.paint_background["background-opacity"])})},OI={paint:new pi({"raster-opacity":new ut(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new ut(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ut(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ut(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new ut(Me.paint_raster["raster-saturation"]),"raster-contrast":new ut(Me.paint_raster["raster-contrast"]),"raster-resampling":new ut(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new ut(Me.paint_raster["raster-fade-duration"])})};class FI extends cs{constructor(r){super(r,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const BI={circle:class extends cs{constructor(a){super(a,mA)}createBucket(a){return new ng(a)}queryRadius(a){const r=a;return Gu("circle-radius",this,r)+Gu("circle-stroke-width",this,r)+rf(this.paint.get("circle-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x,E){const S=sf(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,x),P=this.paint.get("circle-radius").evaluate(r,c)+this.paint.get("circle-stroke-width").evaluate(r,c),D=this.paint.get("circle-pitch-alignment")==="map",O=D?S:function(G,H){return G.map(oe=>Nv(oe,H))}(S,E),N=D?P*x:P;for(const G of d)for(const H of G){const oe=D?H:Nv(H,E);let se=N;const ge=of([],[H.x,H.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?se*=ge[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(se*=y.cameraToCenterDistance/ge[3]),uA(O,oe,se))return!0}return!1}},heatmap:class extends cs{constructor(a){super(a,_A),this._updateColorRamp()}createBucket(a){return new Uv(a)}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends cs{constructor(a){super(a,yA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends cs{constructor(a){super(a,DA)}recalculate(a,r){super.recalculate(a,r);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new pg(a)}queryRadius(){return rf(this.paint.get("fill-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x){return kv(sf(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,x),d)}isTileClipped(){return!0}},"fill-extrusion":class extends cs{constructor(a){super(a,XA)}createBucket(a){return new gg(a)}queryRadius(){return rf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,r,c,d,g,y,x,E){const S=sf(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,x),P=this.paint.get("fill-extrusion-height").evaluate(r,c),D=this.paint.get("fill-extrusion-base").evaluate(r,c),O=function(G,H,oe,se){const ge=[];for(const Te of G){const me=[Te.x,Te.y,0,1];of(me,me,H),ge.push(new vt(me[0]/me[3],me[1]/me[3]))}return ge}(S,E),N=function(G,H,oe,se){const ge=[],Te=[],me=se[8]*H,be=se[9]*H,De=se[10]*H,Re=se[11]*H,nt=se[8]*oe,lt=se[9]*oe,Ke=se[10]*oe,We=se[11]*oe;for(const je of G){const Je=[],qe=[];for(const Ne of je){const _t=Ne.x,dt=Ne.y,Rt=se[0]*_t+se[4]*dt+se[12],_n=se[1]*_t+se[5]*dt+se[13],bn=se[2]*_t+se[6]*dt+se[14],Qn=se[3]*_t+se[7]*dt+se[15],jr=bn+De,Ei=Qn+Re,Hn=Rt+nt,li=_n+lt,Ti=bn+Ke,Ri=Qn+We,lr=new vt((Rt+me)/Ei,(_n+be)/Ei);lr.z=jr/Ei,Je.push(lr);const $n=new vt(Hn/Ri,li/Ri);$n.z=Ti/Ri,qe.push($n)}ge.push(Je),Te.push(qe)}return[ge,Te]}(d,D,P,E);return function(G,H,oe){let se=1/0;kv(oe,H)&&(se=Kv(oe,H[0]));for(let ge=0;ge<H.length;ge++){const Te=H[ge],me=G[ge];for(let be=0;be<Te.length-1;be++){const De=Te[be],Re=[De,Te[be+1],me[be+1],me[be],De];Mv(oe,Re)&&(se=Math.min(se,Kv(oe,Re)))}}return se!==1/0&&se}(N[0],N[1],O)}},line:class extends cs{constructor(a){super(a,Qv),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof En,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,r){super.recalculate(a,r),this.paint._values["line-floorwidth"]=ex.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new _g(a)}queryRadius(a){const r=a,c=tx(Gu("line-width",this,r),Gu("line-gap-width",this,r)),d=Gu("line-offset",this,r);return c/2+Math.abs(d)+rf(this.paint.get("line-translate"))}queryIntersectsFeature(a,r,c,d,g,y,x){const E=sf(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,x),S=x/2*tx(this.paint.get("line-width").evaluate(r,c),this.paint.get("line-gap-width").evaluate(r,c)),P=this.paint.get("line-offset").evaluate(r,c);return P&&(d=function(D,O){const N=[];for(let G=0;G<D.length;G++){const H=D[G],oe=[];for(let se=0;se<H.length;se++){const ge=H[se-1],Te=H[se],me=H[se+1],be=se===0?new vt(0,0):Te.sub(ge)._unit()._perp(),De=se===H.length-1?new vt(0,0):me.sub(Te)._unit()._perp(),Re=be._add(De)._unit(),nt=Re.x*De.x+Re.y*De.y;nt!==0&&Re._mult(1/nt),oe.push(Re._mult(O)._add(Te))}N.push(oe)}return N}(d,P*x)),function(D,O,N){for(let G=0;G<O.length;G++){const H=O[G];if(D.length>=3){for(let oe=0;oe<H.length;oe++)if(oc(D,H[oe]))return!0}if(hA(D,H,N))return!0}return!1}(E,d,S)}isTileClipped(){return!0}},symbol:bf,background:class extends cs{constructor(a){super(a,zI)}},raster:class extends cs{constructor(a){super(a,OI)}}};class NI{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Cx=63710088e-1;class Ln{constructor(r,c){if(isNaN(r)||isNaN(c))throw new Error(`Invalid LngLat object: (${r}, ${c})`);if(this.lng=+r,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ln(X(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const c=Math.PI/180,d=this.lat*c,g=r.lat*c,y=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((r.lng-this.lng)*c);return Cx*Math.acos(Math.min(y,1))}toBounds(r=0){const c=360*r/40075017,d=c/Math.cos(Math.PI/180*this.lat);return new fl(new Ln(this.lng-d,this.lat-c),new Ln(this.lng+d,this.lat+c))}static convert(r){if(r instanceof Ln)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ln(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ln(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class fl{constructor(r,c){r&&(c?this.setSouthWest(r).setNorthEast(c):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof Ln?new Ln(r.lng,r.lat):Ln.convert(r),this}setSouthWest(r){return this._sw=r instanceof Ln?new Ln(r.lng,r.lat):Ln.convert(r),this}extend(r){const c=this._sw,d=this._ne;let g,y;if(r instanceof Ln)g=r,y=r;else{if(!(r instanceof fl))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(fl.convert(r)):this.extend(Ln.convert(r)):this;if(g=r._sw,y=r._ne,!g||!y)return this}return c||d?(c.lng=Math.min(g.lng,c.lng),c.lat=Math.min(g.lat,c.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new Ln(g.lng,g.lat),this._ne=new Ln(y.lng,y.lat)),this}getCenter(){return new Ln((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ln(this.getWest(),this.getNorth())}getSouthEast(){return new Ln(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:c,lat:d}=Ln.convert(r);let g=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g}static convert(r){return r instanceof fl?r:r&&new fl(r)}}const Mx=2*Math.PI*Cx;function kx(a){return Mx*Math.cos(a*Math.PI/180)}function Lx(a){return(180+a)/360}function Rx(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Dx(a,r){return a/kx(r)}function Mg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class wf{constructor(r,c,d=0){this.x=+r,this.y=+c,this.z=+d}static fromLngLat(r,c=0){const d=Ln.convert(r);return new wf(Lx(d.lng),Rx(d.lat),Dx(c,d.lat))}toLngLat(){return new Ln(360*this.x-180,Mg(this.y))}toAltitude(){return this.z*kx(Mg(this.y))}meterInMercatorCoordinateUnits(){return 1/Mx*(r=Mg(this.y),1/Math.cos(r*Math.PI/180));var r}}function zx(a,r,c){var d=2*Math.PI*6378137/256/Math.pow(2,c);return[a*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}class kg{constructor(r,c,d){if(r<0||r>25||d<0||d>=Math.pow(2,r)||c<0||c>=Math.pow(2,r))throw new Error(`x=${c}, y=${d}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=c,this.y=d,this.key=eh(0,r,r,c,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,c,d){const g=(x=this.y,E=this.z,S=zx(256*(y=this.x),256*(x=Math.pow(2,E)-x-1),E),P=zx(256*(y+1),256*(x+1),E),S[0]+","+S[1]+","+P[0]+","+P[1]);var y,x,E,S,P;const D=function(O,N,G){let H,oe="";for(let se=O;se>0;se--)H=1<<se-1,oe+=(N&H?1:0)+(G&H?2:0);return oe}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const c=this.z-r.z;return c>0&&r.x===this.x>>c&&r.y===this.y>>c}getTilePoint(r){const c=Math.pow(2,this.z);return new vt((r.x*c-this.x)*Jn,(r.y*c-this.y)*Jn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ox{constructor(r,c){this.wrap=r,this.canonical=c,this.key=eh(r,c.z,c.z,c.x,c.y)}}class Vr{constructor(r,c,d,g,y){if(r<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${d}`);this.overscaledZ=r,this.wrap=c,this.canonical=new kg(d,+g,+y),this.key=eh(c,r,d,g,y)}clone(){return new Vr(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-r;return r>this.canonical.z?new Vr(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Vr(r,this.wrap,r,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(r,c){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-r;return r>this.canonical.z?eh(this.wrap*+c,r,this.canonical.z,this.canonical.x,this.canonical.y):eh(this.wrap*+c,r,r,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const c=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>c&&r.canonical.y===this.canonical.y>>c}children(r){if(this.overscaledZ>=r)return[new Vr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new Vr(c,this.wrap,c,d,g),new Vr(c,this.wrap,c,d+1,g),new Vr(c,this.wrap,c,d,g+1),new Vr(c,this.wrap,c,d+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Vr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Vr(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ox(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new wf(r.x-this.wrap,r.y))}}function eh(a,r,c,d,g){(a*=2)<0&&(a=-1*a-1);const y=1<<c;return(y*y*a+y*g+d).toString(36)+c.toString(36)+r.toString(36)}rt("CanonicalTileID",kg),rt("OverscaledTileID",Vr,{omit:["posMatrix"]});class Fx{constructor(r,c,d){if(this.uid=r,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void we(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const g=this.dim=c.height-2;this.data=new Uint32Array(c.data.buffer),this.encoding=d||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let x=0;x<g;x++){const E=this.get(y,x);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(r,c){const d=new Uint8Array(this.data.buffer),g=4*this._idx(r,c);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(d[g],d[g+1],d[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,c){if(r<-1||r>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(r+1)}_unpackMapbox(r,c,d){return(256*r*256+256*c+d)/10-1e4}_unpackTerrarium(r,c,d){return 256*r+c+d/256-32768}getPixels(){return new Ur({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,c,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,y=c*this.dim+this.dim,x=d*this.dim,E=d*this.dim+this.dim;switch(c){case-1:g=y-1;break;case 1:y=g+1}switch(d){case-1:x=E-1;break;case 1:E=x+1}const S=-c*this.dim,P=-d*this.dim;for(let D=x;D<E;D++)for(let O=g;O<y;O++)this.data[this._idx(O,D)]=r.data[this._idx(O+S,D+P)]}}rt("DEMData",Fx);class Bx{constructor(r){this._stringToNumber={},this._numberToString=[];for(let c=0;c<r.length;c++){const d=r[c];this._stringToNumber[d]=c,this._numberToString[c]=d}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Nx{constructor(r,c,d,g,y){this.type="Feature",this._vectorTileFeature=r,r._z=c,r._x=d,r._y=g,this.properties=r.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(r[c]=this[c]);return r}}class Ux{constructor(r,c){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new sl(Jn,16,0),this.grid3D=new sl(Jn,16,0),this.featureIndexArray=new Lt,this.promoteId=c}insert(r,c,d,g,y,x){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,y);const S=x?this.grid3D:this.grid;for(let P=0;P<c.length;P++){const D=c[P],O=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const G=D[N];O[0]=Math.min(O[0],G.x),O[1]=Math.min(O[1],G.y),O[2]=Math.max(O[2],G.x),O[3]=Math.max(O[3],G.y)}O[0]<Jn&&O[1]<Jn&&O[2]>=0&&O[3]>=0&&S.insert(E,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ca.VectorTile(new yg(this.rawTileData)).layers,this.sourceLayerCoder=new Bx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,c,d,g){this.loadVTLayers();const y=r.params||{},x=Jn/r.tileSize/r.scale,E=Jl(y.filter),S=r.queryGeometry,P=r.queryPadding*x,D=jx(S),O=this.grid.query(D.minX-P,D.minY-P,D.maxX+P,D.maxY+P),N=jx(r.cameraQueryGeometry),G=this.grid3D.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P,(se,ge,Te,me)=>function(be,De,Re,nt,lt){for(const We of be)if(De<=We.x&&Re<=We.y&&nt>=We.x&&lt>=We.y)return!0;const Ke=[new vt(De,Re),new vt(De,lt),new vt(nt,lt),new vt(nt,Re)];if(be.length>2){for(const We of Ke)if(oc(be,We))return!0}for(let We=0;We<be.length-1;We++)if(fA(be[We],be[We+1],Ke))return!0;return!1}(r.cameraQueryGeometry,se-P,ge-P,Te+P,me+P));for(const se of G)O.push(se);O.sort(UI);const H={};let oe;for(let se=0;se<O.length;se++){const ge=O[se];if(ge===oe)continue;oe=ge;const Te=this.featureIndexArray.get(ge);let me=null;this.loadMatchingFeature(H,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,E,y.layers,y.availableImages,c,d,g,(be,De,Re)=>(me||(me=ul(be)),De.queryIntersectsFeature(S,be,Re,me,this.z,r.transform,x,r.pixelPosMatrix)))}return H}loadMatchingFeature(r,c,d,g,y,x,E,S,P,D,O){const N=this.bucketLayerIDs[c];if(x&&!function(se,ge){for(let Te=0;Te<se.length;Te++)if(ge.indexOf(se[Te])>=0)return!0;return!1}(x,N))return;const G=this.sourceLayerCoder.decode(d),H=this.vtLayers[G].feature(g);if(y.needGeometry){const se=hl(H,!0);if(!y.filter(new vn(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!y.filter(new vn(this.tileID.overscaledZ),H))return;const oe=this.getId(H,G);for(let se=0;se<N.length;se++){const ge=N[se];if(x&&x.indexOf(ge)<0)continue;const Te=S[ge];if(!Te)continue;let me={};oe&&D&&(me=D.getState(Te.sourceLayer||"_geojsonTileLayer",oe));const be=te({},P[ge]);be.paint=Vx(be.paint,Te.paint,H,me,E),be.layout=Vx(be.layout,Te.layout,H,me,E);const De=!O||O(H,Te,me);if(!De)continue;const Re=new Nx(H,this.z,this.x,this.y,oe);Re.layer=be;let nt=r[ge];nt===void 0&&(nt=r[ge]=[]),nt.push({featureIndex:g,feature:Re,intersectionZ:De})}}lookupSymbolFeatures(r,c,d,g,y,x,E,S){const P={};this.loadVTLayers();const D=Jl(y);for(const O of r)this.loadMatchingFeature(P,d,g,O,D,x,E,S,c);return P}hasLayer(r){for(const c of this.bucketLayerIDs)for(const d of c)if(r===d)return!0;return!1}getId(r,c){let d=r.id;return this.promoteId&&(d=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof d=="boolean"&&(d=Number(d))),d}}function Vx(a,r,c,d,g){return J(a,(y,x)=>{const E=r instanceof ll?r.get(x):null;return E&&E.evaluate?E.evaluate(c,d,g):E})}function jx(a){let r=1/0,c=1/0,d=-1/0,g=-1/0;for(const y of a)r=Math.min(r,y.x),c=Math.min(c,y.y),d=Math.max(d,y.x),g=Math.max(g,y.y);return{minX:r,minY:c,maxX:d,maxY:g}}function UI(a,r){return r-a}var Lg;rt("FeatureIndex",Ux,{omit:["rawTileData","sourceLayerCoder"]}),l.PerformanceMarkers=void 0,(Lg=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Lg.load="load",Lg.fullLoad="fullLoad";let Ef=null,th=[];const Rg=1e3/30,VI={mark(a){performance.mark(a)},frame(a){const r=a;Ef!=null&&th.push(r-Ef),Ef=r},clearMetrics(){Ef=null,th=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const a in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[a])},getPerformanceMetrics(){performance.measure("loadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure("fullLoadTime",l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const a=performance.getEntriesByName("loadTime")[0].duration,r=performance.getEntriesByName("fullLoadTime")[0].duration,c=th.length,d=1/(th.reduce((y,x)=>y+x,0)/c/1e3),g=th.filter(y=>y>Rg).reduce((y,x)=>y+(x-Rg)/Rg,0);return{loadTime:a,fullLoadTime:r,fps:d,percentDroppedFrames:g/(c+g)*100}}};l.AJAXError=Xn,l.ARRAY_TYPE=Xi,l.Actor=class{constructor(a,r,c){this.target=a,this.parent=r,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},ye(["receive","process"],this),this.invoker=new NI(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ue()?a:window}send(a,r,c,d,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[y]=c);const x=en(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:a,hasCallback:!!c,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:vo(r,x)},x),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(a){const r=a.data,c=r.id;if(c&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[c];const d=this.cancelCallbacks[c];delete this.cancelCallbacks[c],d&&d()}else Ue()||r.mustQueue?(this.tasks[c]=r,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,r)}process(){if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){if(r.type==="<response>"){const c=this.callbacks[a];delete this.callbacks[a],c&&(r.error?c(Xs(r.error)):c(null,Xs(r.data)))}else{let c=!1;const d=en(this.globalScope)?void 0:[],g=r.hasCallback?(E,S)=>{c=!0,delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:E?vo(E):null,data:vo(S,d)},d)}:E=>{c=!0};let y=null;const x=Xs(r.data);if(this.parent[r.type])y=this.parent[r.type](r.sourceMapId,x,g);else if(this.parent.getWorkerSource){const E=r.type.split(".");y=this.parent.getWorkerSource(r.sourceMapId,E[0],x.source)[E[1]](x,g)}else g(new Error(`Could not find function ${r.type}`));!c&&y&&y.cancel&&(this.cancelCallbacks[a]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=$u,l.CanonicalTileID=kg,l.CollisionBoxArray=ke,l.CollisionCircleLayoutArray=class extends z{},l.Color=q,l.DEMData=Fx,l.DataConstantProperty=ut,l.DictionaryCoder=Bx,l.EXTENT=Jn,l.ErrorEvent=js,l.EvaluationParameters=vn,l.Event=Dr,l.Evented=xr,l.FeatureIndex=Ux,l.FillBucket=pg,l.FillExtrusionBucket=gg,l.GeoJSONFeature=Nx,l.ImageAtlas=ux,l.ImagePosition=xg,l.LineBucket=_g,l.LineStripIndexArray=class extends re{},l.LngLat=Ln,l.LngLatBounds=fl,l.MercatorCoordinate=wf,l.ONE_EM=mi,l.OverscaledTileID=Vr,l.PerformanceUtils=VI,l.PosArray=gt,l.Properties=pi,l.QuadTriangleArray=class extends V{},l.RGBAImage=Ur,l.RasterBoundsArray=class extends m{},l.RequestPerformance=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},l.ResourceType=Ci,l.SegmentVector=Ft,l.SymbolBucket=fc,l.Transitionable=Kd,l.TriangleIndexArray=Wi,l.Uniform1f=Eo,l.Uniform1i=class extends wo{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},l.Uniform2f=class extends wo{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},l.Uniform3f=class extends wo{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},l.Uniform4f=rc,l.UniformColor=Av,l.UniformMatrix4f=class extends wo{constructor(a,r){super(a,r),this.current=lA}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},l.UnwrappedTileID=Ox,l.ValidationError=He,l.ZoomHistory=Mu,l.add=function(a,r,c){return a[0]=r[0]+c[0],a[1]=r[1]+c[1],a[2]=r[2]+c[2],a},l.addDynamicAttributes=Sg,l.asyncAll=function(a,r,c){if(!a.length)return c(null,[]);let d=a.length;const g=new Array(a.length);let y=null;a.forEach((x,E)=>{r(x,(S,P)=>{S&&(y=S),g[E]=P,--d==0&&c(y,g)})})},l.bezier=C,l.bindAll=ye,l.cacheEntryPossiblyAdded=function(a){xi++,xi>nr&&(a.getActor().send("enforceCacheSizeLimit",nn),xi=0)},l.clamp=k,l.clearTileCache=function(a){const r=caches.delete(wt);a&&r.catch(a).then(()=>a())},l.clipLine=wx,l.clone=function(a){var r=new Xi(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},l.clone$1=Q,l.clone$2=function(a){var r=new Xi(3);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r},l.collisionCircleLayout=sI,l.config=et,l.copy=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.create=function(){var a=new Xi(16);return Xi!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},l.create$1=Dv,l.createExpression=Xa,l.createFilter=Jl,l.createLayout=Gn,l.createStyleLayer=function(a){return a.type==="custom"?new FI(a):new BI[a.type](a)},l.cross=function(a,r,c){var d=r[0],g=r[1],y=r[2],x=c[0],E=c[1],S=c[2];return a[0]=g*S-y*E,a[1]=y*x-d*S,a[2]=d*E-g*x,a},l.dot=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]},l.dot$1=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},l.ease=L,l.emitValidationErrors=ec,l.enforceCacheSizeLimit=function(a){ni(),St&&St.then(r=>{r.keys().then(c=>{for(let d=0;d<c.length-a;d++)r.delete(c[d])})})},l.equals=function(a,r){var c=a[0],d=a[1],g=a[2],y=a[3],x=a[4],E=a[5],S=a[6],P=a[7],D=a[8],O=a[9],N=a[10],G=a[11],H=a[12],oe=a[13],se=a[14],ge=a[15],Te=r[0],me=r[1],be=r[2],De=r[3],Re=r[4],nt=r[5],lt=r[6],Ke=r[7],We=r[8],je=r[9],Je=r[10],qe=r[11],Ne=r[12],_t=r[13],dt=r[14],Rt=r[15];return Math.abs(c-Te)<=qi*Math.max(1,Math.abs(c),Math.abs(Te))&&Math.abs(d-me)<=qi*Math.max(1,Math.abs(d),Math.abs(me))&&Math.abs(g-be)<=qi*Math.max(1,Math.abs(g),Math.abs(be))&&Math.abs(y-De)<=qi*Math.max(1,Math.abs(y),Math.abs(De))&&Math.abs(x-Re)<=qi*Math.max(1,Math.abs(x),Math.abs(Re))&&Math.abs(E-nt)<=qi*Math.max(1,Math.abs(E),Math.abs(nt))&&Math.abs(S-lt)<=qi*Math.max(1,Math.abs(S),Math.abs(lt))&&Math.abs(P-Ke)<=qi*Math.max(1,Math.abs(P),Math.abs(Ke))&&Math.abs(D-We)<=qi*Math.max(1,Math.abs(D),Math.abs(We))&&Math.abs(O-je)<=qi*Math.max(1,Math.abs(O),Math.abs(je))&&Math.abs(N-Je)<=qi*Math.max(1,Math.abs(N),Math.abs(Je))&&Math.abs(G-qe)<=qi*Math.max(1,Math.abs(G),Math.abs(qe))&&Math.abs(H-Ne)<=qi*Math.max(1,Math.abs(H),Math.abs(Ne))&&Math.abs(oe-_t)<=qi*Math.max(1,Math.abs(oe),Math.abs(_t))&&Math.abs(se-dt)<=qi*Math.max(1,Math.abs(se),Math.abs(dt))&&Math.abs(ge-Rt)<=qi*Math.max(1,Math.abs(ge),Math.abs(Rt))},l.evaluateSizeForFeature=function(a,{uSize:r,uSizeT:c},{lowerSize:d,upperSize:g}){return a.kind==="source"?d/Ao:a.kind==="composite"?kt(d/Ao,g/Ao,c):r},l.evaluateSizeForZoom=function(a,r){let c=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:x}=a,E=g?k(sr.interpolationFactor(g,r,y,x),0,1):0;a.kind==="camera"?d=kt(a.minSize,a.maxSize,E):c=E}return{uSizeT:c,uSize:d}},l.evaluateVariableOffset=Sx,l.evented=Fu,l.exported=ti,l.exported$1=ii,l.extend=te,l.filterObject=W,l.fromRotation=function(a,r){var c=Math.sin(r),d=Math.cos(r);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},l.fromScaling=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},l.getAnchorAlignment=wg,l.getAnchorJustification=Tg,l.getArrayBuffer=Gi,l.getImage=rs,l.getJSON=function(a,r){return di(te(a,{type:"json"}),r)},l.getOverlapMode=Cg,l.getRTLTextPluginStatus=ol,l.getReferrer=Lr,l.getVideo=function(a,r){const c=window.document.createElement("video");c.muted=!0,c.onloadstart=function(){r(null,c)};for(let d=0;d<a.length;d++){const g=window.document.createElement("source");Vs(a[d])||(c.crossOrigin="Anonymous"),g.src=a[d],c.appendChild(g)}return{cancel:()=>{}}},l.identity=sg,l.invert=function(a,r){var c=r[0],d=r[1],g=r[2],y=r[3],x=r[4],E=r[5],S=r[6],P=r[7],D=r[8],O=r[9],N=r[10],G=r[11],H=r[12],oe=r[13],se=r[14],ge=r[15],Te=c*E-d*x,me=c*S-g*x,be=c*P-y*x,De=d*S-g*E,Re=d*P-y*E,nt=g*P-y*S,lt=D*oe-O*H,Ke=D*se-N*H,We=D*ge-G*H,je=O*se-N*oe,Je=O*ge-G*oe,qe=N*ge-G*se,Ne=Te*qe-me*Je+be*je+De*We-Re*Ke+nt*lt;return Ne?(a[0]=(E*qe-S*Je+P*je)*(Ne=1/Ne),a[1]=(g*Je-d*qe-y*je)*Ne,a[2]=(oe*nt-se*Re+ge*De)*Ne,a[3]=(N*Re-O*nt-G*De)*Ne,a[4]=(S*We-x*qe-P*Ke)*Ne,a[5]=(c*qe-g*We+y*Ke)*Ne,a[6]=(se*be-H*nt-ge*me)*Ne,a[7]=(D*nt-N*be+G*me)*Ne,a[8]=(x*Je-E*We+P*lt)*Ne,a[9]=(d*We-c*Je-y*lt)*Ne,a[10]=(H*Re-oe*be+ge*Te)*Ne,a[11]=(O*be-D*Re-G*Te)*Ne,a[12]=(E*Ke-x*je-S*lt)*Ne,a[13]=(c*je-d*Ke+g*lt)*Ne,a[14]=(oe*me-H*De-se*Te)*Ne,a[15]=(D*De-O*me+N*Te)*Ne,a):null},l.isImageBitmap=Dt,l.isSafari=en,l.isWorker=Ue,l.keysDifference=function(a,r){const c=[];for(const d in a)d in r||c.push(d);return c},l.lazyLoadRTLTextPlugin=function(){Er.isLoading()||Er.isLoaded()||ol()!=="deferred"||Yd()},l.makeRequest=di,l.mapObject=J,l.mercatorXfromLng=Lx,l.mercatorYfromLat=Rx,l.mercatorZfromAltitude=Dx,l.mul=gA,l.mul$1=function(a,r,c){return a[0]=r[0]*c[0],a[1]=r[1]*c[1],a[2]=r[2]*c[2],a[3]=r[3]*c[3],a},l.multiply=zv,l.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},l.normalize=function(a,r){var c=r[0],d=r[1],g=r[2],y=c*c+d*d+g*g;return y>0&&(y=1/Math.sqrt(y)),a[0]=r[0]*y,a[1]=r[1]*y,a[2]=r[2]*y,a},l.number=kt,l.ortho=function(a,r,c,d,g,y,x){var E=1/(r-c),S=1/(d-g),P=1/(y-x);return a[0]=-2*E,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(r+c)*E,a[13]=(g+d)*S,a[14]=(x+y)*P,a[15]=1,a},l.parseCacheControl=st,l.parseGlyphPbf=function(a){return new yg(a).readFields(gI,[])},l.pbf=yg,l.performSymbolLayout=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Jn/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0].layout,c=a.bucket.layers[0]._unevaluatedLayout._values,d={layoutIconSize:c["icon-size"].possiblyEvaluate(new vn(a.bucket.zoom+1),a.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new vn(a.bucket.zoom+1),a.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new vn(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=a.bucket.textSizeData;d.compositeTextSizes=[c["text-size"].possiblyEvaluate(new vn(S),a.canonical),c["text-size"].possiblyEvaluate(new vn(P),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:P}=a.bucket.iconSizeData;d.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new vn(S),a.canonical),c["icon-size"].possiblyEvaluate(new vn(P),a.canonical)]}const g=r.get("text-line-height")*mi,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",x=r.get("text-keep-upright"),E=r.get("text-size");for(const S of a.bucket.features){const P=r.get("text-font").evaluate(S,{},a.canonical).join(","),D=E.evaluate(S,{},a.canonical),O=d.layoutTextSize.evaluate(S,{},a.canonical),N=d.layoutIconSize.evaluate(S,{},a.canonical),G={horizontal:{},vertical:void 0},H=S.text;let oe,se=[0,0];if(H){const me=H.toString(),be=r.get("text-letter-spacing").evaluate(S,{},a.canonical)*mi,De=Km(me)?be:0,Re=r.get("text-anchor").evaluate(S,{},a.canonical),nt=r.get("text-variable-anchor");if(!nt){const Je=r.get("text-radial-offset").evaluate(S,{},a.canonical);se=Je?Sx(Re,[Je*mi,Eg]):r.get("text-offset").evaluate(S,{},a.canonical).map(qe=>qe*mi)}let lt=y?"center":r.get("text-justify").evaluate(S,{},a.canonical);const Ke=r.get("symbol-placement"),We=Ke==="point"?r.get("text-max-width").evaluate(S,{},a.canonical)*mi:0,je=()=>{a.bucket.allowVerticalPlacement&&tc(me)&&(G.vertical=pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,We,g,Re,"left",De,se,l.WritingMode.vertical,!0,Ke,O,D))};if(!y&&nt){const Je=lt==="auto"?nt.map(Ne=>Tg(Ne)):[lt];let qe=!1;for(let Ne=0;Ne<Je.length;Ne++){const _t=Je[Ne];if(!G.horizontal[_t])if(qe)G.horizontal[_t]=G.horizontal[0];else{const dt=pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,We,g,"center",_t,De,se,l.WritingMode.horizontal,!1,Ke,O,D);dt&&(G.horizontal[_t]=dt,qe=dt.positionedLines.length===1)}}je()}else{lt==="auto"&&(lt=Tg(Re));const Je=pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,We,g,Re,lt,De,se,l.WritingMode.horizontal,!1,Ke,O,D);Je&&(G.horizontal[lt]=Je),je(),tc(me)&&y&&x&&(G.vertical=pf(H,a.glyphMap,a.glyphPositions,a.imagePositions,P,We,g,Re,lt,De,se,l.WritingMode.vertical,!1,Ke,O,D))}}let ge=!1;if(S.icon&&S.icon.name){const me=a.imageMap[S.icon.name];me&&(oe=wI(a.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},a.canonical),r.get("icon-anchor").evaluate(S,{},a.canonical)),ge=!!me.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ge:a.bucket.sdfIcons!==ge&&we("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(me.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Te=Ix(G.horizontal)||G.vertical;a.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||oe)&&CI(a.bucket,S,G,oe,a.imageMap,d,O,N,se,ge,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},l.perspective=function(a,r,c,d,g){var y,x=1/Math.tan(r/2);return a[0]=x/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+d)*(y=1/(d-g)),a[14]=2*g*d*y):(a[10]=-1,a[14]=-2*d),a},l.pick=function(a,r){const c={};for(let d=0;d<r.length;d++){const g=r[d];g in a&&(c[g]=a[g])}return c},l.plugin=Er,l.pointGeometry=vt,l.polygonIntersectsPolygon=Mv,l.potpack=cx,l.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],l.register=rt,l.registerForPluginStateChange=function(a){return a({pluginStatus:$i,pluginURL:Zs}),Fu.on("pluginStateChange",a),a},l.renderColorRamp=jv,l.rotateX=function(a,r,c){var d=Math.sin(c),g=Math.cos(c),y=r[4],x=r[5],E=r[6],S=r[7],P=r[8],D=r[9],O=r[10],N=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=y*g+P*d,a[5]=x*g+D*d,a[6]=E*g+O*d,a[7]=S*g+N*d,a[8]=P*g-y*d,a[9]=D*g-x*d,a[10]=O*g-E*d,a[11]=N*g-S*d,a},l.rotateZ=function(a,r,c){var d=Math.sin(c),g=Math.cos(c),y=r[0],x=r[1],E=r[2],S=r[3],P=r[4],D=r[5],O=r[6],N=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=y*g+P*d,a[1]=x*g+D*d,a[2]=E*g+O*d,a[3]=S*g+N*d,a[4]=P*g-y*d,a[5]=D*g-x*d,a[6]=O*g-E*d,a[7]=N*g-S*d,a},l.scale=function(a,r,c){var d=c[0],g=c[1],y=c[2];return a[0]=r[0]*d,a[1]=r[1]*d,a[2]=r[2]*d,a[3]=r[3]*d,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*y,a[9]=r[9]*y,a[10]=r[10]*y,a[11]=r[11]*y,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},l.scale$1=function(a,r,c){return a[0]=r[0]*c,a[1]=r[1]*c,a[2]=r[2]*c,a},l.setCacheLimits=function(a,r){nn=a,nr=r},l.setRTLTextPlugin=function(a,r,c=!1){if($i===Ru||$i===Du||$i===zu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Zs=ti.resolveURL(a),$i=Ru,Ou=r,sa(),c||Yd()},l.spec=Me,l.sphericalToCartesian=function([a,r,c]){return r+=90,r*=Math.PI/180,c*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(c),y:a*Math.sin(r)*Math.sin(c),z:a*Math.cos(c)}},l.sqrLen=function(a){var r=a[0],c=a[1];return r*r+c*c},l.sub=function(a,r,c){return a[0]=r[0]-c[0],a[1]=r[1]-c[1],a[2]=r[2]-c[2],a},l.toEvaluationFeature=hl,l.transformMat3=function(a,r,c){var d=r[0],g=r[1],y=r[2];return a[0]=d*c[0]+g*c[3]+y*c[6],a[1]=d*c[1]+g*c[4]+y*c[7],a[2]=d*c[2]+g*c[5]+y*c[8],a},l.transformMat4=of,l.transformMat4$1=function(a,r,c){var d=r[0],g=r[1];return a[0]=c[0]*d+c[4]*g+c[12],a[1]=c[1]*d+c[5]*g+c[13],a},l.translate=function(a,r,c){var d,g,y,x,E,S,P,D,O,N,G,H,oe=c[0],se=c[1],ge=c[2];return r===a?(a[12]=r[0]*oe+r[4]*se+r[8]*ge+r[12],a[13]=r[1]*oe+r[5]*se+r[9]*ge+r[13],a[14]=r[2]*oe+r[6]*se+r[10]*ge+r[14],a[15]=r[3]*oe+r[7]*se+r[11]*ge+r[15]):(g=r[1],y=r[2],x=r[3],E=r[4],S=r[5],P=r[6],D=r[7],O=r[8],N=r[9],G=r[10],H=r[11],a[0]=d=r[0],a[1]=g,a[2]=y,a[3]=x,a[4]=E,a[5]=S,a[6]=P,a[7]=D,a[8]=O,a[9]=N,a[10]=G,a[11]=H,a[12]=d*oe+E*se+O*ge+r[12],a[13]=g*oe+S*se+N*ge+r[13],a[14]=y*oe+P*se+G*ge+r[14],a[15]=x*oe+D*se+H*ge+r[15]),a},l.triggerPluginCompletionEvent=Zd,l.unicodeBlockLookup=Ye,l.uniqueId=function(){return ie++},l.validateCustomStyleLayer=function(a){const r=[],c=a.id;return c===void 0&&r.push({message:`layers.${c}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${c}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),r},l.validateLight=Cu,l.validateStyle=rl,l.vectorTile=ca,l.warnOnce=we,l.wrap=X}),u(["./shared"],function(l){function b(Y){const R=typeof Y;if(R==="number"||R==="boolean"||R==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){let q="[";for(const le of Y)q+=`${b(le)},`;return`${q}]`}const F=Object.keys(Y).sort();let $="{";for(let q=0;q<F.length;q++)$+=`${JSON.stringify(F[q])}:${b(Y[F[q]])},`;return`${$}}`}function T(Y){let R="";for(const F of l.refProperties)R+=`/${b(Y[F])}`;return R}class C{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,F){for(const q of R){this._layerConfigs[q.id]=q;const le=this._layers[q.id]=l.createStyleLayer(q);le._featureFilter=l.createFilter(le.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of F)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const $=function(q,le){const de={};for(let ae=0;ae<q.length;ae++){const fe=le&&le[q[ae].id]||T(q[ae]);le&&(le[q[ae].id]=fe);let Ie=de[fe];Ie||(Ie=de[fe]=[]),Ie.push(q[ae])}const ue=[];for(const ae in de)ue.push(de[ae]);return ue}(Object.values(this._layerConfigs),this.keyCache);for(const q of $){const le=q.map(ze=>this._layers[ze.id]),de=le[0];if(de.visibility==="none")continue;const ue=de.source||"";let ae=this.familiesBySource[ue];ae||(ae=this.familiesBySource[ue]={});const fe=de.sourceLayer||"_geojsonTileLayer";let Ie=ae[fe];Ie||(Ie=ae[fe]=[]),Ie.push(le)}}}class L{constructor(R){const F={},$=[];for(const ue in R){const ae=R[ue],fe=F[ue]={};for(const Ie in ae){const ze=ae[+Ie];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ae={x:0,y:0,w:ze.bitmap.width+2,h:ze.bitmap.height+2};$.push(Ae),fe[Ie]={rect:Ae,metrics:ze.metrics}}}const{w:q,h:le}=l.potpack($),de=new l.AlphaImage({width:q||1,height:le||1});for(const ue in R){const ae=R[ue];for(const fe in ae){const Ie=ae[+fe];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const ze=F[ue][fe].rect;l.AlphaImage.copy(Ie.bitmap,de,{x:0,y:0},{x:ze.x+1,y:ze.y+1},Ie.bitmap)}}this.image=de,this.positions=F}}l.register("GlyphAtlas",L);class k{constructor(R){this.tileID=new l.OverscaledTileID(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId}parse(R,F,$,q,le){this.status="parsing",this.data=R,this.collisionBoxArray=new l.CollisionBoxArray;const de=new l.DictionaryCoder(Object.keys(R.layers).sort()),ue=new l.FeatureIndex(this.tileID,this.promoteId);ue.bucketLayerIDs=[];const ae={},fe={featureIndex:ue,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},Ie=F.familiesBySource[this.source];for(const yt in Ie){const Tt=R.layers[yt];if(!Tt)continue;Tt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const zt=de.encode(yt),Nt=[];for(let un=0;un<Tt.length;un++){const hn=Tt.feature(un),Yn=ue.getId(hn,yt);Nt.push({feature:hn,id:Yn,index:un,sourceLayerIndex:zt})}for(const un of Ie[yt]){const hn=un[0];hn.source!==this.source&&l.warnOnce(`layer.source = ${hn.source} does not equal this.source = ${this.source}`),hn.minzoom&&this.zoom<Math.floor(hn.minzoom)||hn.maxzoom&&this.zoom>=hn.maxzoom||hn.visibility!=="none"&&(X(un,this.zoom,$),(ae[hn.id]=hn.createBucket({index:ue.bucketLayerIDs.length,layers:un,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:zt,sourceID:this.source})).populate(Nt,fe,this.tileID.canonical),ue.bucketLayerIDs.push(un.map(Yn=>Yn.id)))}}let ze,Ae,it,at;const Ze=l.mapObject(fe.glyphDependencies,yt=>Object.keys(yt).map(Number));Object.keys(Ze).length?q.send("getGlyphs",{uid:this.uid,stacks:Ze},(yt,Tt)=>{ze||(ze=yt,Ae=Tt,Mt.call(this))}):Ae={};const mt=Object.keys(fe.iconDependencies);mt.length?q.send("getImages",{icons:mt,source:this.source,tileID:this.tileID,type:"icons"},(yt,Tt)=>{ze||(ze=yt,it=Tt,Mt.call(this))}):it={};const ht=Object.keys(fe.patternDependencies);function Mt(){if(ze)return le(ze);if(Ae&&it&&at){const yt=new L(Ae),Tt=new l.ImageAtlas(it,at);for(const zt in ae){const Nt=ae[zt];Nt instanceof l.SymbolBucket?(X(Nt.layers,this.zoom,$),l.performSymbolLayout({bucket:Nt,glyphMap:Ae,glyphPositions:yt.positions,imageMap:it,imagePositions:Tt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Nt.hasPattern&&(Nt instanceof l.LineBucket||Nt instanceof l.FillBucket||Nt instanceof l.FillExtrusionBucket)&&(X(Nt.layers,this.zoom,$),Nt.addFeatures(fe,this.tileID.canonical,Tt.patternPositions))}this.status="done",le(null,{buckets:Object.values(ae).filter(zt=>!zt.isEmpty()),featureIndex:ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yt.image,imageAtlas:Tt,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?it:null,glyphPositions:this.returnDependencies?yt.positions:null})}}ht.length?q.send("getImages",{icons:ht,source:this.source,tileID:this.tileID,type:"patterns"},(yt,Tt)=>{ze||(ze=yt,at=Tt,Mt.call(this))}):at={},Mt.call(this)}}function X(Y,R,F){const $=new l.EvaluationParameters(R);for(const q of Y)q.recalculate($,F)}function te(Y,R){const F=l.getArrayBuffer(Y.request,($,q,le,de)=>{$?R($):q&&R(null,{vectorTile:new l.vectorTile.VectorTile(new l.pbf(q)),rawData:q,cacheControl:le,expires:de})});return()=>{F.cancel(),R()}}class ie{constructor(R,F,$,q){this.actor=R,this.layerIndex=F,this.availableImages=$,this.loadVectorData=q||te,this.loading={},this.loaded={}}loadTile(R,F){const $=R.uid;this.loading||(this.loading={});const q=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request),le=this.loading[$]=new k(R);le.abort=this.loadVectorData(R,(de,ue)=>{if(delete this.loading[$],de||!ue)return le.status="done",this.loaded[$]=le,F(de);const ae=ue.rawData,fe={};ue.expires&&(fe.expires=ue.expires),ue.cacheControl&&(fe.cacheControl=ue.cacheControl);const Ie={};if(q){const ze=q.finish();ze&&(Ie.resourceTiming=JSON.parse(JSON.stringify(ze)))}le.vectorTile=ue.vectorTile,le.parse(ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(ze,Ae)=>{if(ze||!Ae)return F(ze);F(null,l.extend({rawTileData:ae.slice(0)},Ae,fe,Ie))}),this.loaded=this.loaded||{},this.loaded[$]=le})}reloadTile(R,F){const $=this.loaded,q=R.uid,le=this;if($&&$[q]){const de=$[q];de.showCollisionBoxes=R.showCollisionBoxes;const ue=(ae,fe)=>{const Ie=de.reloadCallback;Ie&&(delete de.reloadCallback,de.parse(de.vectorTile,le.layerIndex,this.availableImages,le.actor,Ie)),F(ae,fe)};de.status==="parsing"?de.reloadCallback=ue:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.actor,ue):ue())}}abortTile(R,F){const $=this.loading,q=R.uid;$&&$[q]&&$[q].abort&&($[q].abort(),delete $[q]),F()}removeTile(R,F){const $=this.loaded,q=R.uid;$&&$[q]&&delete $[q],F()}}class ye{constructor(){this.loaded={}}loadTile(R,F){const{uid:$,encoding:q,rawImageData:le}=R,de=l.isImageBitmap(le)?this.getImageData(le):le,ue=new l.DEMData($,de,q);this.loaded=this.loaded||{},this.loaded[$]=ue,F(null,ue)}getImageData(R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(R.width,R.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=R.width,this.offscreenCanvas.height=R.height,this.offscreenCanvasContext.drawImage(R,0,0,R.width,R.height);const F=this.offscreenCanvasContext.getImageData(-1,-1,R.width+2,R.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:F.width,height:F.height},F.data)}removeTile(R){const F=this.loaded,$=R.uid;F&&F[$]&&delete F[$]}}var J=function Y(R,F){var $,q=R&&R.type;if(q==="FeatureCollection")for($=0;$<R.features.length;$++)Y(R.features[$],F);else if(q==="GeometryCollection")for($=0;$<R.geometries.length;$++)Y(R.geometries[$],F);else if(q==="Feature")Y(R.geometry,F);else if(q==="Polygon")W(R.coordinates,F);else if(q==="MultiPolygon")for($=0;$<R.coordinates.length;$++)W(R.coordinates[$],F);return R};function W(Y,R){if(Y.length!==0){Q(Y[0],R);for(var F=1;F<Y.length;F++)Q(Y[F],!R)}}function Q(Y,R){for(var F=0,$=0,q=0,le=Y.length,de=le-1;q<le;de=q++){var ue=(Y[q][0]-Y[de][0])*(Y[de][1]+Y[q][1]),ae=F+ue;$+=Math.abs(F)>=Math.abs(ue)?F-ae+ue:ue-ae+F,F=ae}F+$>=0!=!!R&&Y.reverse()}const _e=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;class we{constructor(R){this._feature=R,this.extent=l.EXTENT,this.type=R.type,this.properties=R.tags,"id"in R&&!isNaN(R.id)&&(this.id=parseInt(R.id,10))}loadGeometry(){if(this._feature.type===1){const R=[];for(const F of this._feature.geometry)R.push([new l.pointGeometry(F[0],F[1])]);return R}{const R=[];for(const F of this._feature.geometry){const $=[];for(const q of F)$.push(new l.pointGeometry(q[0],q[1]));R.push($)}return R}}toGeoJSON(R,F,$){return _e.call(this,R,F,$)}}class Ce{constructor(R){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=R.length,this._features=R}feature(R){return new we(this._features[R])}}var Oe={exports:{}},Ue=l.pointGeometry,st=l.vectorTile.VectorTileFeature,Xe=xt;function xt(Y,R){this.options=R||{},this.features=Y,this.length=Y.length}function $t(Y,R){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=R||4096}xt.prototype.feature=function(Y){return new $t(this.features[Y],this.options.extent)},$t.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var R=0;R<Y.length;R++){for(var F=Y[R],$=[],q=0;q<F.length;q++)$.push(new Ue(F[q][0],F[q][1]));this.geometry.push($)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,R=1/0,F=-1/0,$=1/0,q=-1/0,le=0;le<Y.length;le++)for(var de=Y[le],ue=0;ue<de.length;ue++){var ae=de[ue];R=Math.min(R,ae.x),F=Math.max(F,ae.x),$=Math.min($,ae.y),q=Math.max(q,ae.y)}return[R,$,F,q]},$t.prototype.toGeoJSON=st.prototype.toGeoJSON;var en=l.pbf,Dt=Xe;function ti(Y){var R=new en;return function(F,$){for(var q in F.layers)$.writeMessage(3,vt,F.layers[q])}(Y,R),R.finish()}function vt(Y,R){var F;R.writeVarintField(15,Y.version||1),R.writeStringField(1,Y.name||""),R.writeVarintField(5,Y.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<Y.length;F++)$.feature=Y.feature(F),R.writeMessage(2,vi,$);var q=$.keys;for(F=0;F<q.length;F++)R.writeStringField(3,q[F]);var le=$.values;for(F=0;F<le.length;F++)R.writeMessage(4,nn,le[F])}function vi(Y,R){var F=Y.feature;F.id!==void 0&&R.writeVarintField(1,F.id),R.writeMessage(2,et,Y),R.writeVarintField(3,F.type),R.writeMessage(4,tn,F)}function et(Y,R){var F=Y.feature,$=Y.keys,q=Y.values,le=Y.keycache,de=Y.valuecache;for(var ue in F.properties){var ae=F.properties[ue],fe=le[ue];if(ae!==null){fe===void 0&&($.push(ue),le[ue]=fe=$.length-1),R.writeVarint(fe);var Ie=typeof ae;Ie!=="string"&&Ie!=="boolean"&&Ie!=="number"&&(ae=JSON.stringify(ae));var ze=Ie+":"+ae,Ae=de[ze];Ae===void 0&&(q.push(ae),de[ze]=Ae=q.length-1),R.writeVarint(Ae)}}}function wt(Y,R){return(R<<3)+(7&Y)}function St(Y){return Y<<1^Y>>31}function tn(Y,R){for(var F=Y.loadGeometry(),$=Y.type,q=0,le=0,de=F.length,ue=0;ue<de;ue++){var ae=F[ue],fe=1;$===1&&(fe=ae.length),R.writeVarint(wt(1,fe));for(var Ie=$===3?ae.length-1:ae.length,ze=0;ze<Ie;ze++){ze===1&&$!==1&&R.writeVarint(wt(2,Ie-1));var Ae=ae[ze].x-q,it=ae[ze].y-le;R.writeVarint(St(Ae)),R.writeVarint(St(it)),q+=Ae,le+=it}$===3&&R.writeVarint(wt(7,1))}}function nn(Y,R){var F=typeof Y;F==="string"?R.writeStringField(1,Y):F==="boolean"?R.writeBooleanField(7,Y):F==="number"&&(Y%1!=0?R.writeDoubleField(3,Y):Y<0?R.writeSVarintField(6,Y):R.writeVarintField(5,Y))}function nr(Y,R,F,$,q,le){if(q-$<=F)return;const de=$+q>>1;ni(Y,R,de,$,q,le%2),nr(Y,R,F,$,de-1,le+1),nr(Y,R,F,de+1,q,le+1)}function ni(Y,R,F,$,q,le){for(;q>$;){if(q-$>600){const fe=q-$+1,Ie=F-$+1,ze=Math.log(fe),Ae=.5*Math.exp(2*ze/3),it=.5*Math.sqrt(ze*Ae*(fe-Ae)/fe)*(Ie-fe/2<0?-1:1);ni(Y,R,F,Math.max($,Math.floor(F-Ie*Ae/fe+it)),Math.min(q,Math.floor(F+(fe-Ie)*Ae/fe+it)),le)}const de=R[2*F+le];let ue=$,ae=q;for(xi(Y,R,$,F),R[2*q+le]>de&&xi(Y,R,$,q);ue<ae;){for(xi(Y,R,ue,ae),ue++,ae--;R[2*ue+le]<de;)ue++;for(;R[2*ae+le]>de;)ae--}R[2*$+le]===de?xi(Y,R,$,ae):(ae++,xi(Y,R,ae,q)),ae<=F&&($=ae+1),F<=ae&&(q=ae-1)}}function xi(Y,R,F,$){ii(Y,F,$),ii(R,2*F,2*$),ii(R,2*F+1,2*$+1)}function ii(Y,R,F){const $=Y[R];Y[R]=Y[F],Y[F]=$}function ln(Y,R,F,$){const q=Y-F,le=R-$;return q*q+le*le}Oe.exports=ti,Oe.exports.fromVectorTileJs=ti,Oe.exports.fromGeojsonVt=function(Y,R){R=R||{};var F={};for(var $ in Y)F[$]=new Dt(Y[$].features,R),F[$].name=$,F[$].version=R.version,F[$].extent=R.extent;return ti({layers:F})},Oe.exports.GeoJSONWrapper=Dt;const bi=Y=>Y[0],Wt=Y=>Y[1];class zn{constructor(R,F=bi,$=Wt,q=64,le=Float64Array){this.nodeSize=q,this.points=R;const de=R.length<65536?Uint16Array:Uint32Array,ue=this.ids=new de(R.length),ae=this.coords=new le(2*R.length);for(let fe=0;fe<R.length;fe++)ue[fe]=fe,ae[2*fe]=F(R[fe]),ae[2*fe+1]=$(R[fe]);nr(ue,ae,q,0,ue.length-1,0)}range(R,F,$,q){return function(le,de,ue,ae,fe,Ie,ze){const Ae=[0,le.length-1,0],it=[];let at,Ze;for(;Ae.length;){const mt=Ae.pop(),ht=Ae.pop(),Mt=Ae.pop();if(ht-Mt<=ze){for(let zt=Mt;zt<=ht;zt++)at=de[2*zt],Ze=de[2*zt+1],at>=ue&&at<=fe&&Ze>=ae&&Ze<=Ie&&it.push(le[zt]);continue}const yt=Math.floor((Mt+ht)/2);at=de[2*yt],Ze=de[2*yt+1],at>=ue&&at<=fe&&Ze>=ae&&Ze<=Ie&&it.push(le[yt]);const Tt=(mt+1)%2;(mt===0?ue<=at:ae<=Ze)&&(Ae.push(Mt),Ae.push(yt-1),Ae.push(Tt)),(mt===0?fe>=at:Ie>=Ze)&&(Ae.push(yt+1),Ae.push(ht),Ae.push(Tt))}return it}(this.ids,this.coords,R,F,$,q,this.nodeSize)}within(R,F,$){return function(q,le,de,ue,ae,fe){const Ie=[0,q.length-1,0],ze=[],Ae=ae*ae;for(;Ie.length;){const it=Ie.pop(),at=Ie.pop(),Ze=Ie.pop();if(at-Ze<=fe){for(let Tt=Ze;Tt<=at;Tt++)ln(le[2*Tt],le[2*Tt+1],de,ue)<=Ae&&ze.push(q[Tt]);continue}const mt=Math.floor((Ze+at)/2),ht=le[2*mt],Mt=le[2*mt+1];ln(ht,Mt,de,ue)<=Ae&&ze.push(q[mt]);const yt=(it+1)%2;(it===0?de-ae<=ht:ue-ae<=Mt)&&(Ie.push(Ze),Ie.push(mt-1),Ie.push(yt)),(it===0?de+ae>=ht:ue+ae>=Mt)&&(Ie.push(mt+1),Ie.push(at),Ie.push(yt))}return ze}(this.ids,this.coords,R,F,$,this.nodeSize)}}const is={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Ci=Math.fround||(Xn=new Float32Array(1),Y=>(Xn[0]=+Y,Xn[0]));var Xn;class Lr{constructor(R){this.options=rs(Object.create(is),R),this.trees=new Array(this.options.maxZoom+1)}load(R){const{log:F,minZoom:$,maxZoom:q,nodeSize:le}=this.options;F&&console.time("total time");const de=`prepare ${R.length} points`;F&&console.time(de),this.points=R;let ue=[];for(let ae=0;ae<R.length;ae++)R[ae].geometry&&ue.push(di(R[ae],ae));this.trees[q+1]=new zn(ue,po,Rr,le,Float32Array),F&&console.timeEnd(de);for(let ae=q;ae>=$;ae--){const fe=+Date.now();ue=this._cluster(ue,ae),this.trees[ae]=new zn(ue,po,Rr,le,Float32Array),F&&console.log("z%d: %d clusters in %dms",ae,ue.length,+Date.now()-fe)}return F&&console.timeEnd("total time"),this}getClusters(R,F){let $=((R[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,R[1]));let le=R[2]===180?180:((R[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)$=-180,le=180;else if($>le){const Ie=this.getClusters([$,q,180,de],F),ze=this.getClusters([-180,q,le,de],F);return Ie.concat(ze)}const ue=this.trees[this._limitZoom(F)],ae=ue.range(Vt($),Mi(de),Vt(le),Mi(q)),fe=[];for(const Ie of ae){const ze=ue.points[Ie];fe.push(ze.numPoints?Gi(ze):this.points[ze.index])}return fe}getChildren(R){const F=this._getOriginId(R),$=this._getOriginZoom(R),q="No cluster with the specified id.",le=this.trees[$];if(!le)throw new Error(q);const de=le.points[F];if(!de)throw new Error(q);const ue=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ae=le.within(de.x,de.y,ue),fe=[];for(const Ie of ae){const ze=le.points[Ie];ze.parentId===R&&fe.push(ze.numPoints?Gi(ze):this.points[ze.index])}if(fe.length===0)throw new Error(q);return fe}getLeaves(R,F,$){const q=[];return this._appendLeaves(q,R,F=F||10,$=$||0,0),q}getTile(R,F,$){const q=this.trees[this._limitZoom(R)],le=Math.pow(2,R),{extent:de,radius:ue}=this.options,ae=ue/de,fe=($-ae)/le,Ie=($+1+ae)/le,ze={features:[]};return this._addTileFeatures(q.range((F-ae)/le,fe,(F+1+ae)/le,Ie),q.points,F,$,le,ze),F===0&&this._addTileFeatures(q.range(1-ae/le,fe,1,Ie),q.points,le,$,le,ze),F===le-1&&this._addTileFeatures(q.range(0,fe,ae/le,Ie),q.points,-1,$,le,ze),ze.features.length?ze:null}getClusterExpansionZoom(R){let F=this._getOriginZoom(R)-1;for(;F<=this.options.maxZoom;){const $=this.getChildren(R);if(F++,$.length!==1)break;R=$[0].properties.cluster_id}return F}_appendLeaves(R,F,$,q,le){const de=this.getChildren(F);for(const ue of de){const ae=ue.properties;if(ae&&ae.cluster?le+ae.point_count<=q?le+=ae.point_count:le=this._appendLeaves(R,ae.cluster_id,$,q,le):le<q?le++:R.push(ue),R.length===$)break}return le}_addTileFeatures(R,F,$,q,le,de){for(const ue of R){const ae=F[ue],fe=ae.numPoints;let Ie,ze,Ae;if(fe)Ie=Vs(ae),ze=ae.x,Ae=ae.y;else{const Ze=this.points[ae.index];Ie=Ze.properties,ze=Vt(Ze.geometry.coordinates[0]),Ae=Mi(Ze.geometry.coordinates[1])}const it={type:1,geometry:[[Math.round(this.options.extent*(ze*le-$)),Math.round(this.options.extent*(Ae*le-q))]],tags:Ie};let at;fe?at=ae.id:this.options.generateId?at=ae.index:this.points[ae.index].id&&(at=this.points[ae.index].id),at!==void 0&&(it.id=at),de.features.push(it)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,F){const $=[],{radius:q,extent:le,reduce:de,minPoints:ue}=this.options,ae=q/(le*Math.pow(2,F));for(let fe=0;fe<R.length;fe++){const Ie=R[fe];if(Ie.zoom<=F)continue;Ie.zoom=F;const ze=this.trees[F+1],Ae=ze.within(Ie.x,Ie.y,ae),it=Ie.numPoints||1;let at=it;for(const Ze of Ae){const mt=ze.points[Ze];mt.zoom>F&&(at+=mt.numPoints||1)}if(at>it&&at>=ue){let Ze=Ie.x*it,mt=Ie.y*it,ht=de&&it>1?this._map(Ie,!0):null;const Mt=(fe<<5)+(F+1)+this.points.length;for(const yt of Ae){const Tt=ze.points[yt];if(Tt.zoom<=F)continue;Tt.zoom=F;const zt=Tt.numPoints||1;Ze+=Tt.x*zt,mt+=Tt.y*zt,Tt.parentId=Mt,de&&(ht||(ht=this._map(Ie,!0)),de(ht,this._map(Tt)))}Ie.parentId=Mt,$.push(ji(Ze/at,mt/at,Mt,at,ht))}else if($.push(Ie),at>1)for(const Ze of Ae){const mt=ze.points[Ze];mt.zoom<=F||(mt.zoom=F,$.push(mt))}}return $}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,F){if(R.numPoints)return F?rs({},R.properties):R.properties;const $=this.points[R.index].properties,q=this.options.map($);return F&&q===$?rs({},q):q}}function ji(Y,R,F,$,q){return{x:Ci(Y),y:Ci(R),zoom:1/0,id:F,parentId:-1,numPoints:$,properties:q}}function di(Y,R){const[F,$]=Y.geometry.coordinates;return{x:Ci(Vt(F)),y:Ci(Mi($)),zoom:1/0,index:R,parentId:-1}}function Gi(Y){return{type:"Feature",id:Y.id,properties:Vs(Y),geometry:{type:"Point",coordinates:[(R=Y.x,360*(R-.5)),On(Y.y)]}};var R}function Vs(Y){const R=Y.numPoints,F=R>=1e4?`${Math.round(R/1e3)}k`:R>=1e3?Math.round(R/100)/10+"k":R;return rs(rs({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:R,point_count_abbreviated:F})}function Vt(Y){return Y/360+.5}function Mi(Y){const R=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function On(Y){const R=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function rs(Y,R){for(const F in R)Y[F]=R[F];return Y}function po(Y){return Y.x}function Rr(Y){return Y.y}function Dr(Y,R,F,$){for(var q,le=$,de=F-R>>1,ue=F-R,ae=Y[R],fe=Y[R+1],Ie=Y[F],ze=Y[F+1],Ae=R+3;Ae<F;Ae+=3){var it=js(Y[Ae],Y[Ae+1],ae,fe,Ie,ze);if(it>le)q=Ae,le=it;else if(it===le){var at=Math.abs(Ae-de);at<ue&&(q=Ae,ue=at)}}le>$&&(q-R>3&&Dr(Y,R,q,$),Y[q+2]=le,F-q>3&&Dr(Y,q,F,$))}function js(Y,R,F,$,q,le){var de=q-F,ue=le-$;if(de!==0||ue!==0){var ae=((Y-F)*de+(R-$)*ue)/(de*de+ue*ue);ae>1?(F=q,$=le):ae>0&&(F+=de*ae,$+=ue*ae)}return(de=Y-F)*de+(ue=R-$)*ue}function xr(Y,R,F,$){var q={id:Y===void 0?null:Y,type:R,geometry:F,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var de=le.geometry,ue=le.type;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Me(le,de);else if(ue==="Polygon"||ue==="MultiLineString")for(var ae=0;ae<de.length;ae++)Me(le,de[ae]);else if(ue==="MultiPolygon")for(ae=0;ae<de.length;ae++)for(var fe=0;fe<de[ae].length;fe++)Me(le,de[ae][fe])}(q),q}function Me(Y,R){for(var F=0;F<R.length;F+=3)Y.minX=Math.min(Y.minX,R[F]),Y.minY=Math.min(Y.minY,R[F+1]),Y.maxX=Math.max(Y.maxX,R[F]),Y.maxY=Math.max(Y.maxY,R[F+1])}function He(Y,R,F,$){if(R.geometry){var q=R.geometry.coordinates,le=R.geometry.type,de=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),ue=[],ae=R.id;if(F.promoteId?ae=R.properties[F.promoteId]:F.generateId&&(ae=$||0),le==="Point")ss(q,ue);else if(le==="MultiPoint")for(var fe=0;fe<q.length;fe++)ss(q[fe],ue);else if(le==="LineString")wi(q,ue,de,!1);else if(le==="MultiLineString"){if(F.lineMetrics){for(fe=0;fe<q.length;fe++)wi(q[fe],ue=[],de,!1),Y.push(xr(ae,"LineString",ue,R.properties));return}Bt(q,ue,de,!1)}else if(le==="Polygon")Bt(q,ue,de,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(fe=0;fe<R.geometry.geometries.length;fe++)He(Y,{id:ae,geometry:R.geometry.geometries[fe],properties:R.properties},F,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<q.length;fe++){var Ie=[];Bt(q[fe],Ie,de,!0),ue.push(Ie)}}Y.push(xr(ae,le,ue,R.properties))}}function ss(Y,R){R.push(Hi(Y[0])),R.push(ki(Y[1])),R.push(0)}function wi(Y,R,F,$){for(var q,le,de=0,ue=0;ue<Y.length;ue++){var ae=Hi(Y[ue][0]),fe=ki(Y[ue][1]);R.push(ae),R.push(fe),R.push(0),ue>0&&(de+=$?(q*fe-ae*le)/2:Math.sqrt(Math.pow(ae-q,2)+Math.pow(fe-le,2))),q=ae,le=fe}var Ie=R.length-3;R[2]=1,Dr(R,0,Ie,F),R[Ie+2]=1,R.size=Math.abs(de),R.start=0,R.end=R.size}function Bt(Y,R,F,$){for(var q=0;q<Y.length;q++){var le=[];wi(Y[q],le,F,$),R.push(le)}}function Hi(Y){return Y/360+.5}function ki(Y){var R=Math.sin(Y*Math.PI/180),F=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return F<0?0:F>1?1:F}function Li(Y,R,F,$,q,le,de,ue){if($/=R,le>=(F/=R)&&de<$)return Y;if(de<F||le>=$)return null;for(var ae=[],fe=0;fe<Y.length;fe++){var Ie=Y[fe],ze=Ie.geometry,Ae=Ie.type,it=q===0?Ie.minX:Ie.minY,at=q===0?Ie.maxX:Ie.maxY;if(it>=F&&at<$)ae.push(Ie);else if(!(at<F||it>=$)){var Ze=[];if(Ae==="Point"||Ae==="MultiPoint")os(ze,Ze,F,$,q);else if(Ae==="LineString")Ge(ze,Ze,F,$,q,!1,ue.lineMetrics);else if(Ae==="MultiLineString")It(ze,Ze,F,$,q,!1);else if(Ae==="Polygon")It(ze,Ze,F,$,q,!0);else if(Ae==="MultiPolygon")for(var mt=0;mt<ze.length;mt++){var ht=[];It(ze[mt],ht,F,$,q,!0),ht.length&&Ze.push(ht)}if(Ze.length){if(ue.lineMetrics&&Ae==="LineString"){for(mt=0;mt<Ze.length;mt++)ae.push(xr(Ie.id,Ae,Ze[mt],Ie.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(Ze.length===1?(Ae="LineString",Ze=Ze[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=Ze.length===3?"Point":"MultiPoint"),ae.push(xr(Ie.id,Ae,Ze,Ie.tags))}}}return ae.length?ae:null}function os(Y,R,F,$,q){for(var le=0;le<Y.length;le+=3){var de=Y[le+q];de>=F&&de<=$&&(R.push(Y[le]),R.push(Y[le+1]),R.push(Y[le+2]))}}function Ge(Y,R,F,$,q,le,de){for(var ue,ae,fe=Pt(Y),Ie=q===0?zr:At,ze=Y.start,Ae=0;Ae<Y.length-3;Ae+=3){var it=Y[Ae],at=Y[Ae+1],Ze=Y[Ae+2],mt=Y[Ae+3],ht=Y[Ae+4],Mt=q===0?it:at,yt=q===0?mt:ht,Tt=!1;de&&(ue=Math.sqrt(Math.pow(it-mt,2)+Math.pow(at-ht,2))),Mt<F?yt>F&&(ae=Ie(fe,it,at,mt,ht,F),de&&(fe.start=ze+ue*ae)):Mt>$?yt<$&&(ae=Ie(fe,it,at,mt,ht,$),de&&(fe.start=ze+ue*ae)):Zn(fe,it,at,Ze),yt<F&&Mt>=F&&(ae=Ie(fe,it,at,mt,ht,F),Tt=!0),yt>$&&Mt<=$&&(ae=Ie(fe,it,at,mt,ht,$),Tt=!0),!le&&Tt&&(de&&(fe.end=ze+ue*ae),R.push(fe),fe=Pt(Y)),de&&(ze+=ue)}var zt=Y.length-3;it=Y[zt],at=Y[zt+1],Ze=Y[zt+2],(Mt=q===0?it:at)>=F&&Mt<=$&&Zn(fe,it,at,Ze),zt=fe.length-3,le&&zt>=3&&(fe[zt]!==fe[0]||fe[zt+1]!==fe[1])&&Zn(fe,fe[0],fe[1],fe[2]),fe.length&&R.push(fe)}function Pt(Y){var R=[];return R.size=Y.size,R.start=Y.start,R.end=Y.end,R}function It(Y,R,F,$,q,le){for(var de=0;de<Y.length;de++)Ge(Y[de],R,F,$,q,le,!1)}function Zn(Y,R,F,$){Y.push(R),Y.push(F),Y.push($)}function zr(Y,R,F,$,q,le){var de=(le-R)/($-R);return Y.push(le),Y.push(F+(q-F)*de),Y.push(1),de}function At(Y,R,F,$,q,le){var de=(le-F)/(q-F);return Y.push(R+($-R)*de),Y.push(le),Y.push(1),de}function ir(Y,R){for(var F=[],$=0;$<Y.length;$++){var q,le=Y[$],de=le.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")q=jn(le.geometry,R);else if(de==="MultiLineString"||de==="Polygon"){q=[];for(var ue=0;ue<le.geometry.length;ue++)q.push(jn(le.geometry[ue],R))}else if(de==="MultiPolygon")for(q=[],ue=0;ue<le.geometry.length;ue++){for(var ae=[],fe=0;fe<le.geometry[ue].length;fe++)ae.push(jn(le.geometry[ue][fe],R));q.push(ae)}F.push(xr(le.id,de,q,le.tags))}return F}function jn(Y,R){var F=[];F.size=Y.size,Y.start!==void 0&&(F.start=Y.start,F.end=Y.end);for(var $=0;$<Y.length;$+=3)F.push(Y[$]+R,Y[$+1],Y[$+2]);return F}function Gs(Y,R){if(Y.transformed)return Y;var F,$,q,le=1<<Y.z,de=Y.x,ue=Y.y;for(F=0;F<Y.features.length;F++){var ae=Y.features[F],fe=ae.geometry,Ie=ae.type;if(ae.geometry=[],Ie===1)for($=0;$<fe.length;$+=2)ae.geometry.push(Mn(fe[$],fe[$+1],R,le,de,ue));else for($=0;$<fe.length;$++){var ze=[];for(q=0;q<fe[$].length;q+=2)ze.push(Mn(fe[$][q],fe[$][q+1],R,le,de,ue));ae.geometry.push(ze)}}return Y.transformed=!0,Y}function Mn(Y,R,F,$,q,le){return[Math.round(F*(Y*$-q)),Math.round(F*(R*$-le))]}function ri(Y,R,F,$,q){for(var le=R===q.maxZoom?0:q.tolerance/((1<<R)*q.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:$,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ue=0;ue<Y.length;ue++){de.numFeatures++,Jt(de,Y[ue],le,q);var ae=Y[ue].minX,fe=Y[ue].minY,Ie=Y[ue].maxX,ze=Y[ue].maxY;ae<de.minX&&(de.minX=ae),fe<de.minY&&(de.minY=fe),Ie>de.maxX&&(de.maxX=Ie),ze>de.maxY&&(de.maxY=ze)}return de}function Jt(Y,R,F,$){var q=R.geometry,le=R.type,de=[];if(le==="Point"||le==="MultiPoint")for(var ue=0;ue<q.length;ue+=3)de.push(q[ue]),de.push(q[ue+1]),Y.numPoints++,Y.numSimplified++;else if(le==="LineString")Hs(de,q,Y,F,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(ue=0;ue<q.length;ue++)Hs(de,q[ue],Y,F,le==="Polygon",ue===0);else if(le==="MultiPolygon")for(var ae=0;ae<q.length;ae++){var fe=q[ae];for(ue=0;ue<fe.length;ue++)Hs(de,fe[ue],Y,F,!0,ue===0)}if(de.length){var Ie=R.tags||null;if(le==="LineString"&&$.lineMetrics){for(var ze in Ie={},R.tags)Ie[ze]=R.tags[ze];Ie.mapbox_clip_start=q.start/q.size,Ie.mapbox_clip_end=q.end/q.size}var Ae={geometry:de,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:Ie};R.id!==null&&(Ae.id=R.id),Y.features.push(Ae)}}function Hs(Y,R,F,$,q,le){var de=$*$;if($>0&&R.size<(q?de:$))F.numPoints+=R.length/3;else{for(var ue=[],ae=0;ae<R.length;ae+=3)($===0||R[ae+2]>de)&&(F.numSimplified++,ue.push(R[ae]),ue.push(R[ae+1])),F.numPoints++;q&&function(fe,Ie){for(var ze=0,Ae=0,it=fe.length,at=it-2;Ae<it;at=Ae,Ae+=2)ze+=(fe[Ae]-fe[at])*(fe[Ae+1]+fe[at+1]);if(ze>0===Ie)for(Ae=0,it=fe.length;Ae<it/2;Ae+=2){var Ze=fe[Ae],mt=fe[Ae+1];fe[Ae]=fe[it-2-Ae],fe[Ae+1]=fe[it-1-Ae],fe[it-2-Ae]=Ze,fe[it-1-Ae]=mt}}(ue,le),Y.push(ue)}}function br(Y,R){var F=(R=this.options=function(q,le){for(var de in le)q[de]=le[de];return q}(Object.create(this.options),R)).debug;if(F&&console.time("preprocess data"),R.maxZoom<0||R.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(R.promoteId&&R.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(q,le){var de=[];if(q.type==="FeatureCollection")for(var ue=0;ue<q.features.length;ue++)He(de,q.features[ue],le,ue);else He(de,q.type==="Feature"?q:{geometry:q},le);return de}(Y,R);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",R.indexMaxZoom,R.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(q,le){var de=le.buffer/le.extent,ue=q,ae=Li(q,1,-1-de,de,0,-1,2,le),fe=Li(q,1,1-de,2+de,0,-1,2,le);return(ae||fe)&&(ue=Li(q,1,-de,1+de,0,-1,2,le)||[],ae&&(ue=ir(ae,1).concat(ue)),fe&&(ue=ue.concat(ir(fe,-1)))),ue}($,R),$.length&&this.splitTile($,0,0,0),F&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function wr(Y,R,F){return 32*((1<<Y)*F+R)+Y}function Es(Y,R){const F=Y.tileID.canonical;if(!this._geoJSONIndex)return R(null,null);const $=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!$)return R(null,null);const q=new Ce($.features);let le=Oe.exports(q);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),R(null,{vectorTile:q,rawData:le.buffer})}br.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},br.prototype.splitTile=function(Y,R,F,$,q,le,de){for(var ue=[Y,R,F,$],ae=this.options,fe=ae.debug;ue.length;){$=ue.pop(),F=ue.pop(),R=ue.pop(),Y=ue.pop();var Ie=1<<R,ze=wr(R,F,$),Ae=this.tiles[ze];if(!Ae&&(fe>1&&console.time("creation"),Ae=this.tiles[ze]=ri(Y,R,F,$,ae),this.tileCoords.push({z:R,x:F,y:$}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",R,F,$,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var it="z"+R;this.stats[it]=(this.stats[it]||0)+1,this.total++}if(Ae.source=Y,q){if(R===ae.maxZoom||R===q)continue;var at=1<<q-R;if(F!==Math.floor(le/at)||$!==Math.floor(de/at))continue}else if(R===ae.indexMaxZoom||Ae.numPoints<=ae.indexMaxPoints)continue;if(Ae.source=null,Y.length!==0){fe>1&&console.time("clipping");var Ze,mt,ht,Mt,yt,Tt,zt=.5*ae.buffer/ae.extent,Nt=.5-zt,un=.5+zt,hn=1+zt;Ze=mt=ht=Mt=null,yt=Li(Y,Ie,F-zt,F+un,0,Ae.minX,Ae.maxX,ae),Tt=Li(Y,Ie,F+Nt,F+hn,0,Ae.minX,Ae.maxX,ae),Y=null,yt&&(Ze=Li(yt,Ie,$-zt,$+un,1,Ae.minY,Ae.maxY,ae),mt=Li(yt,Ie,$+Nt,$+hn,1,Ae.minY,Ae.maxY,ae),yt=null),Tt&&(ht=Li(Tt,Ie,$-zt,$+un,1,Ae.minY,Ae.maxY,ae),Mt=Li(Tt,Ie,$+Nt,$+hn,1,Ae.minY,Ae.maxY,ae),Tt=null),fe>1&&console.timeEnd("clipping"),ue.push(Ze||[],R+1,2*F,2*$),ue.push(mt||[],R+1,2*F,2*$+1),ue.push(ht||[],R+1,2*F+1,2*$),ue.push(Mt||[],R+1,2*F+1,2*$+1)}}},br.prototype.getTile=function(Y,R,F){var $=this.options,q=$.extent,le=$.debug;if(Y<0||Y>24)return null;var de=1<<Y,ue=wr(Y,R=(R%de+de)%de,F);if(this.tiles[ue])return Gs(this.tiles[ue],q);le>1&&console.log("drilling down to z%d-%d-%d",Y,R,F);for(var ae,fe=Y,Ie=R,ze=F;!ae&&fe>0;)fe--,Ie=Math.floor(Ie/2),ze=Math.floor(ze/2),ae=this.tiles[wr(fe,Ie,ze)];return ae&&ae.source?(le>1&&console.log("found parent tile z%d-%d-%d",fe,Ie,ze),le>1&&console.time("drilling down"),this.splitTile(ae.source,fe,Ie,ze,Y,R,F),le>1&&console.timeEnd("drilling down"),this.tiles[ue]?Gs(this.tiles[ue],q):null):null};class $s extends ie{constructor(R,F,$,q){super(R,F,$,Es),q&&(this.loadGeoJSON=q)}loadData(R,F){var $;($=this._pendingRequest)===null||$===void 0||$.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const q=!!(R&&R.request&&R.request.collectResourceTiming)&&new l.RequestPerformance(R.request);this._pendingCallback=F,this._pendingRequest=this.loadGeoJSON(R,(le,de)=>{if(delete this._pendingCallback,delete this._pendingRequest,le||!de)return F(le);if(typeof de!="object")return F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));{J(de,!0);try{if(R.filter){const ae=l.createExpression(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ae.result==="error")throw new Error(ae.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Ie=>ae.value.evaluate({zoom:0},Ie))}}this._geoJSONIndex=R.cluster?new Lr(function({superclusterOptions:ae,clusterProperties:fe}){if(!fe||!ae)return ae;const Ie={},ze={},Ae={accumulated:null,zoom:0},it={properties:null},at=Object.keys(fe);for(const Ze of at){const[mt,ht]=fe[Ze],Mt=l.createExpression(ht),yt=l.createExpression(typeof mt=="string"?[mt,["accumulated"],["get",Ze]]:mt);Ie[Ze]=Mt.value,ze[Ze]=yt.value}return ae.map=Ze=>{it.properties=Ze;const mt={};for(const ht of at)mt[ht]=Ie[ht].evaluate(Ae,it);return mt},ae.reduce=(Ze,mt)=>{it.properties=mt;for(const ht of at)Ae.accumulated=Ze[ht],Ze[ht]=ze[ht].evaluate(Ae,it)},ae}(R)).load(de.features):function(ae,fe){return new br(ae,fe)}(de,R.geojsonVtOptions)}catch(ae){return F(ae)}this.loaded={};const ue={};if(q){const ae=q.finish();ae&&(ue.resourceTiming={},ue.resourceTiming[R.source]=JSON.parse(JSON.stringify(ae)))}F(null,ue)}})}reloadTile(R,F){const $=this.loaded;return $&&$[R.uid]?super.reloadTile(R,F):this.loadTile(R,F)}loadGeoJSON(R,F){if(R.request)return l.getJSON(R.request,F);if(typeof R.data=="string")try{F(null,JSON.parse(R.data))}catch{F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`))}else F(new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(R,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()}getClusterExpansionZoom(R,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(R.clusterId))}catch($){F($)}}getClusterChildren(R,F){try{F(null,this._geoJSONIndex.getChildren(R.clusterId))}catch($){F($)}}getClusterLeaves(R,F){try{F(null,this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset))}catch($){F($)}}}class as{constructor(R){this.self=R,this.actor=new l.Actor(R,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ie,geojson:$s},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(F,$)=>{if(this.workerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.workerSourceTypes[F]=$},this.self.registerRTLTextPlugin=F=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=F.applyArabicShaping,l.plugin.processBidirectionalText=F.processBidirectionalText,l.plugin.processStyledBidirectionalText=F.processStyledBidirectionalText}}setReferrer(R,F){this.referrer=F}setImages(R,F,$){this.availableImages[R]=F;for(const q in this.workerSources[R]){const le=this.workerSources[R][q];for(const de in le)le[de].availableImages=F}$()}setLayers(R,F,$){this.getLayerIndex(R).replace(F),$()}updateLayers(R,F,$){this.getLayerIndex(R).update(F.layers,F.removedIds),$()}loadTile(R,F,$){this.getWorkerSource(R,F.type,F.source).loadTile(F,$)}loadDEMTile(R,F,$){this.getDEMWorkerSource(R,F.source).loadTile(F,$)}reloadTile(R,F,$){this.getWorkerSource(R,F.type,F.source).reloadTile(F,$)}abortTile(R,F,$){this.getWorkerSource(R,F.type,F.source).abortTile(F,$)}removeTile(R,F,$){this.getWorkerSource(R,F.type,F.source).removeTile(F,$)}removeDEMTile(R,F){this.getDEMWorkerSource(R,F.source).removeTile(F)}removeSource(R,F,$){if(!this.workerSources[R]||!this.workerSources[R][F.type]||!this.workerSources[R][F.type][F.source])return;const q=this.workerSources[R][F.type][F.source];delete this.workerSources[R][F.type][F.source],q.removeSource!==void 0?q.removeSource(F,$):$()}loadWorkerSource(R,F,$){try{this.self.importScripts(F.url),$()}catch(q){$(q.toString())}}syncRTLPluginState(R,F,$){try{l.plugin.setState(F);const q=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&q!=null){this.self.importScripts(q);const le=l.plugin.isParsed();$(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${q}`),le)}}catch(q){$(q.toString())}}getAvailableImages(R){let F=this.availableImages[R];return F||(F=[]),F}getLayerIndex(R){let F=this.layerIndexes[R];return F||(F=this.layerIndexes[R]=new C),F}getWorkerSource(R,F,$){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][F]||(this.workerSources[R][F]={}),!this.workerSources[R][F][$]){const q={send:(le,de,ue)=>{this.actor.send(le,de,ue,R)}};this.workerSources[R][F][$]=new this.workerSourceTypes[F](q,this.getLayerIndex(R),this.getAvailableImages(R))}return this.workerSources[R][F][$]}getDEMWorkerSource(R,F){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][F]||(this.demWorkerSources[R][F]=new ye),this.demWorkerSources[R][F]}enforceCacheSizeLimit(R,F){l.enforceCacheSizeLimit(F)}}return l.isWorker()&&(self.worker=new as(self)),as}),u(["./shared"],function(l){var b=T;function T(m){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(v);try{_=new Worker(w),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(w),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?(C[h=s&&s.failIfMajorPerformanceCaveat]===void 0&&(C[h]=function(p){var _,v=function(w){var A=document.createElement("canvas"),I=Object.create(T.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=w,A.getContext("webgl",I)||A.getContext("experimental-webgl",I)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(h)),C[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(m)}var C={};function L(m,s){if(Array.isArray(m)){if(!Array.isArray(s)||m.length!==s.length)return!1;for(let h=0;h<m.length;h++)if(!L(m[h],s[h]))return!1;return!0}if(typeof m=="object"&&m!==null&&s!==null){if(typeof s!="object"||Object.keys(m).length!==Object.keys(s).length)return!1;for(const h in m)if(!L(m[h],s[h]))return!1;return!0}return m===s}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class k{static testProp(s){if(!k.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in k.docStyle)return s[h];return s[0]}static create(s,h,p){const _=window.document.createElement(s);return h!==void 0&&(_.className=h),p&&p.appendChild(_),_}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(s,h){s.style[k.transformProp]=h}static addEventListener(s,h,p,_={}){s.addEventListener(h,p,"passive"in _?_:_.capture)}static removeEventListener(s,h,p,_={}){s.removeEventListener(h,p,"passive"in _?_:_.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static mousePos(s,h){const p=s.getBoundingClientRect();return new l.pointGeometry(h.clientX-p.left-s.clientLeft,h.clientY-p.top-s.clientTop)}static touchPos(s,h){const p=s.getBoundingClientRect(),_=[];for(let v=0;v<h.length;v++)_.push(new l.pointGeometry(h[v].clientX-p.left-s.clientLeft,h[v].clientY-p.top-s.clientTop));return _}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);class X{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeSpriteURL(s,h,p){const _=function(v){const w=v.match(te);if(!w)throw new Error(`Unable to parse URL "${v}"`);return{protocol:w[1],authority:w[2],path:w[3]||"/",params:w[4]?w[4].split("&"):[]}}(s);return _.path+=`${h}${p}`,function(v){const w=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${w}`}(_)}setTransformRequest(s){this._transformRequestFn=s}}const te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class ie{constructor(s,h,p,_){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(h,_)}update(s,h,p){const{width:_,height:v}=s,w=!(this.size&&this.size[0]===_&&this.size[1]===v||p),{context:A}=this,{gl:I}=A;if(this.useMipmap=Boolean(h&&h.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!h||h.premultiply!==!1)),w)this.size=[_,v],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,s):I.texImage2D(I.TEXTURE_2D,0,this.format,_,v,0,this.format,I.UNSIGNED_BYTE,s.data);else{const{x:M,y:z}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.isImageBitmap(s)?I.texSubImage2D(I.TEXTURE_2D,0,M,z,I.RGBA,I.UNSIGNED_BYTE,s):I.texSubImage2D(I.TEXTURE_2D,0,M,z,_,v,I.RGBA,I.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(s,h,p){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),s!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,s),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||s),this.filter=s),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function ye(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class J extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,p);this.requestors=[]}}getImage(s){return this.images[s]}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let p=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new l.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,h){if(!s)return!0;let p=0;for(const _ of s){if(_[0]<p||_[1]<_[0]||h<_[1])return!1;p=_[1]}return!0}_validateContent(s,h){return!(s&&(s.length!==4||s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,h){const p=this.images[s];if(p.data.width!==h.data.width||p.data.height!==h.data.height)throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=p.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,h){let p=!0;if(!this.isLoaded())for(const _ of s)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(s,h):this.requestors.push({ids:s,callback:h})}_notify(s,h){const p={};for(const _ of s){this.images[_]||this.fire(new l.Event("styleimagemissing",{id:_}));const v=this.images[_];v?p[_]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:l.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],p=this.getImage(s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new l.ImagePosition(_,p);this.patterns[s]={bin:_,position:v}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ie(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const v in this.patterns)s.push(this.patterns[v].bin);const{w:h,h:p}=l.potpack(s),_=this.atlasImage;_.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:w}=this.patterns[v],A=w.x+1,I=w.y+1,M=this.images[v].data,z=M.width,B=M.height;l.RGBAImage.copy(M,_,{x:0,y:0},{x:A,y:I},{width:z,height:B}),l.RGBAImage.copy(M,_,{x:0,y:B-1},{x:A,y:I-1},{width:z,height:1}),l.RGBAImage.copy(M,_,{x:0,y:0},{x:A,y:I+B},{width:z,height:1}),l.RGBAImage.copy(M,_,{x:z-1,y:0},{x:A-1,y:I},{width:1,height:B}),l.RGBAImage.copy(M,_,{x:0,y:0},{x:A+z,y:I},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.images[h];p||l.warnOnce(`Image with ID: "${h}" was not found`),ye(p)&&this.updateImage(h,p)}}}const W=1e20;function Q(m,s,h,p,_,v,w,A,I){for(let M=s;M<s+p;M++)_e(m,h*v+M,v,_,w,A,I);for(let M=h;M<h+_;M++)_e(m,M*v+s,1,p,w,A,I)}function _e(m,s,h,p,_,v,w){v[0]=0,w[0]=-W,w[1]=W,_[0]=m[s];for(let A=1,I=0,M=0;A<p;A++){_[A]=m[s+A*h];const z=A*A;do{const B=v[I];M=(_[A]-_[B]+z-B*B)/(A-B)/2}while(M<=w[I]&&--I>-1);I++,v[I]=A,w[I]=M,w[I+1]=W}for(let A=0,I=0;A<p;A++){for(;w[I+1]<A;)I++;const M=v[I],z=A-M;m[s+A*h]=_[M]+z*z}}class we{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s,h){const p=[];for(const _ in s)for(const v of s[_])p.push({stack:_,id:v});l.asyncAll(p,({stack:_,id:v},w)=>{let A=this.entries[_];A||(A=this.entries[_]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[v];if(I!==void 0)return void w(null,{stack:_,id:v,glyph:I});if(I=this._tinySDF(A,_,v),I)return A.glyphs[v]=I,void w(null,{stack:_,id:v,glyph:I});const M=Math.floor(v/256);if(256*M>65535)return void w(new Error("glyphs > 65535 not supported"));if(A.ranges[M])return void w(null,{stack:_,id:v,glyph:I});let z=A.requests[M];z||(z=A.requests[M]=[],we.loadGlyphRange(_,M,this.url,this.requestManager,(B,V)=>{if(V){for(const ne in V)this._doesCharSupportLocalGlyph(+ne)||(A.glyphs[+ne]=V[+ne]);A.ranges[M]=!0}for(const ne of z)ne(B,V);delete A.requests[M]})),z.push((B,V)=>{B?w(B):V&&w(null,{stack:_,id:v,glyph:V[v]||null})})},(_,v)=>{if(_)h(_);else if(v){const w={};for(const{stack:A,id:I,glyph:M}of v)(w[A]||(w[A]={}))[I]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};h(null,w)}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](s)||l.unicodeBlockLookup["Hangul Syllables"](s)||l.unicodeBlockLookup.Hiragana(s)||l.unicodeBlockLookup.Katakana(s))}_tinySDF(s,h,p){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(p))return;let v=s.tinySDF;if(!v){let A="400";/bold/i.test(h)?A="900":/medium/i.test(h)?A="500":/light/i.test(h)&&(A="200"),v=s.tinySDF=new we.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:A})}const w=v.draw(String.fromCharCode(p));return{id:p,bitmap:new l.AlphaImage({width:w.width||30,height:w.height||30},w.data),metrics:{width:w.glyphWidth||24,height:w.glyphHeight||24,left:w.glyphLeft||0,top:w.glyphTop-27||-8,advance:w.glyphAdvance||24}}}}we.loadGlyphRange=function(m,s,h,p,_){const v=256*s,w=v+255,A=p.transformRequest(h.replace("{fontstack}",m).replace("{range}",`${v}-${w}`),l.ResourceType.Glyphs);l.getArrayBuffer(A,(I,M)=>{if(I)_(I);else if(M){const z={};for(const B of l.parseGlyphPbf(M))z[B.id]=B;_(null,z)}})},we.TinySDF=class{constructor({fontSize:m=24,buffer:s=3,radius:h=8,cutoff:p=.25,fontFamily:_="sans-serif",fontWeight:v="normal",fontStyle:w="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=h;const A=this.size=m+4*s,I=this._createCanvas(A),M=this.ctx=I.getContext("2d",{willReadFrequently:!0});M.font=`${w} ${v} ${m}px ${_}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(m){const s=document.createElement("canvas");return s.width=s.height=m,s}draw(m){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:_,actualBoundingBoxRight:v}=this.ctx.measureText(m),w=Math.ceil(h),A=Math.min(this.size-this.buffer,Math.ceil(v-_)),I=Math.min(this.size-this.buffer,w+Math.ceil(p)),M=A+2*this.buffer,z=I+2*this.buffer,B=Math.max(M*z,0),V=new Uint8ClampedArray(B),ne={data:V,width:M,height:z,glyphWidth:A,glyphHeight:I,glyphTop:w,glyphLeft:0,glyphAdvance:s};if(A===0||I===0)return ne;const{ctx:K,buffer:ee,gridInner:he,gridOuter:pe}=this;K.clearRect(ee,ee,A,I),K.fillText(m,ee,ee+w);const ve=K.getImageData(ee,ee,A,I);pe.fill(W,0,B),he.fill(0,0,B);for(let re=0;re<I;re++)for(let Ee=0;Ee<A;Ee++){const xe=ve.data[4*(re*A+Ee)+3]/255;if(xe===0)continue;const ke=(re+ee)*M+Ee+ee;if(xe===1)pe[ke]=0,he[ke]=W;else{const Le=.5-xe;pe[ke]=Le>0?Le*Le:0,he[ke]=Le<0?Le*Le:0}}Q(pe,0,0,M,z,M,this.f,this.v,this.z),Q(he,ee,ee,A,I,M,this.f,this.v,this.z);for(let re=0;re<B;re++){const Ee=Math.sqrt(pe[re])-Math.sqrt(he[re]);V[re]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return ne}};const Ce=new l.Properties({anchor:new l.DataConstantProperty(l.spec.light.anchor),position:new class{constructor(){this.specification=l.spec.light.position}possiblyEvaluate(m,s){return l.sphericalToCartesian(m.expression.evaluate(s))}interpolate(m,s,h){return{x:l.number(m.x,s.x,h),y:l.number(m.y,s.y,h),z:l.number(m.z,s.z,h)}}},color:new l.DataConstantProperty(l.spec.light.color),intensity:new l.DataConstantProperty(l.spec.light.intensity)}),Oe="-transition";class Ue extends l.Evented{constructor(s){super(),this._transitionable=new l.Transitionable(Ce),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(l.validateLight,s,h))for(const p in s){const _=s[p];p.endsWith(Oe)?this._transitionable.setTransition(p.slice(0,-Oe.length),_):this._transitionable.setValue(p,_)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,p){return(!p||p.validate!==!1)&&l.emitValidationErrors(this,s.call(l.validateStyle,l.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:l.spec})))}}class st{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const p=s.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,h)),this.dashEntry[p]}getDashRanges(s,h,p){const _=[];let v=s.length%2==1?-s[s.length-1]*p:0,w=s[0]*p,A=!0;_.push({left:v,right:w,isDash:A,zeroLength:s[0]===0});let I=s[0];for(let M=1;M<s.length;M++){A=!A;const z=s[M];v=I*p,I+=z,w=I*p,_.push({left:v,right:w,isDash:A,zeroLength:z===0})}return _}addRoundDash(s,h,p){const _=h/2;for(let v=-p;v<=p;v++){const w=this.width*(this.nextRow+p+v);let A=0,I=s[A];for(let M=0;M<this.width;M++){M/I.right>1&&(I=s[++A]);const z=Math.abs(M-I.left),B=Math.abs(M-I.right),V=Math.min(z,B);let ne;const K=v/p*(_+1);if(I.isDash){const ee=_-Math.abs(K);ne=Math.sqrt(V*V+ee*ee)}else ne=_-Math.sqrt(V*V+K*K);this.data[w+M]=Math.max(0,Math.min(255,ne+128))}}}addRegularDash(s){for(let A=s.length-1;A>=0;--A){const I=s[A],M=s[A+1];I.zeroLength?s.splice(A,1):M&&M.isDash===I.isDash&&(M.left=I.left,s.splice(A,1))}const h=s[0],p=s[s.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const _=this.width*this.nextRow;let v=0,w=s[v];for(let A=0;A<this.width;A++){A/w.right>1&&(w=s[++v]);const I=Math.abs(A-w.left),M=Math.abs(A-w.right),z=Math.min(I,M);this.data[_+A]=Math.max(0,Math.min(255,(w.isDash?z:-z)+128))}}addDash(s,h){const p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return l.warnOnce("LineAtlas out of space"),null;let v=0;for(let A=0;A<s.length;A++)v+=s[A];if(v!==0){const A=this.width/v,I=this.getDashRanges(s,this.width,A);h?this.addRoundDash(I,A,p):this.addRegularDash(I)}const w={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=_,this.dirty=!0,w}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Xe{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=l.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const v=new Xe.Actor(p[_],h,this.id);v.name=`Worker ${_}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h,p){l.asyncAll(this.actors,(_,v)=>{_.send(s,h,v)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function xt(m,s,h){const p=function(_,v){if(_)return h(_);if(v){const w=l.pick(l.extend(v,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(w.vectorLayers=v.vector_layers,w.vectorLayerIds=w.vectorLayers.map(A=>A.id)),h(null,w)}};return m.url?l.getJSON(s.transformRequest(m.url,l.ResourceType.Source),p):l.exported.frame(()=>p(null,m))}Xe.Actor=l.Actor;class $t{constructor(s,h,p){this.bounds=l.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),p=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*h),_=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*h),v=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*h),w=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*h);return s.x>=p&&s.x<v&&s.y>=_&&s.y<w}}class en extends l.Evented{constructor(s,h,p,_){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(h,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new $t(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.cancel(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(p,l.ResourceType.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function v(w,A){return delete s.request,s.aborted?h(null):w&&w.status!==404?h(w):(A&&A.resourceTiming&&(s.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&s.setExpiryData(A),s.loadVectorData(A,this.map.painter),l.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired"?s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",_,v.bind(this)):(s.actor=this.dispatcher.getActor(),s.request=s.actor.send("loadTile",_,v.bind(this)))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id},void 0)}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Dt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},h),l.extend(this,l.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xt(this._options,this.map._requestManager,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new l.ErrorEvent(s)):h&&(l.extend(this,h),h.bounds&&(this.tileBounds=new $t(h.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),(_,v,w)=>{if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(_)s.state="errored",h(_);else if(v){this.map._refreshExpiredTiles&&s.setExpiryData(w);const A=this.map.painter.context,I=A.gl;s.texture=this.map.painter.getTileTexture(v.width),s.texture?s.texture.update(v,{useMipmap:!0}):(s.texture=new ie(A,v,I.RGBA,{useMipmap:!0}),s.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.extTextureFilterAnisotropic&&I.texParameterf(I.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax)),s.state="loaded",l.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h()}unloadTile(s,h){s.texture&&this.map.painter.saveTileTexture(s.texture),h()}hasTransition(){return!1}}let ti;class vt extends Dt{constructor(s,h,p,_){super(s,h,p,_),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(s,h){const p=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(v,w){v&&(s.state="errored",h(v)),w&&(s.dem=w,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded",h(null))}s.request=l.getImage(this.map._requestManager.transformRequest(p,l.ResourceType.Tile),function(v,w){if(delete s.request,s.aborted)s.state="unloaded",h(null);else if(v)s.state="errored",h(v);else if(w){this.map._refreshExpiredTiles&&s.setExpiryData(w),delete w.cacheControl,delete w.expires;const A=l.isImageBitmap(w)&&(ti==null&&(ti=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ti)?w:l.exported.getImageData(w,1),I={uid:s.uid,coord:s.tileID,source:this.id,rawImageData:A,encoding:this.encoding};s.actor&&s.state!=="expired"||(s.actor=this.dispatcher.getActor(),s.actor.send("loadDEMTile",I,_.bind(this)))}}.bind(this)),s.neighboringTiles=this._getNeighboringTiles(s.tileID)}_getNeighboringTiles(s){const h=s.canonical,p=Math.pow(2,h.z),_=(h.x-1+p)%p,v=h.x===0?s.wrap-1:s.wrap,w=(h.x+1+p)%p,A=h.x+1===p?s.wrap+1:s.wrap,I={};return I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,w,h.y).key]={backfilled:!1},h.y>0&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,w,h.y-1).key]={backfilled:!1}),h.y+1<p&&(I[new l.OverscaledTileID(s.overscaledZ,v,h.z,_,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},I[new l.OverscaledTileID(s.overscaledZ,A,h.z,w,h.y+1).key]={backfilled:!1}),I}unloadTile(s){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&s.actor.send("removeDEMTile",{uid:s.uid,source:this.id})}}class vi extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(_),this._data=h.data,this._options=l.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:l.EXTENT,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData("content"),this}getClusterExpansionZoom(s,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:s,source:this.id},h),this}getClusterChildren(s,h){return this.actor.send("geojson.getClusterChildren",{clusterId:s,source:this.id},h),this}getClusterLeaves(s,h,p,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:s,limit:h,offset:p},_),this}_updateWorkerData(s){const h=l.extend({},this.workerOptions),p=this._data;typeof p=="string"?(h.request=this.map._requestManager.transformRequest(l.exported.resolveURL(p),l.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(p),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(_,v)=>{if(this._pendingLoads--,this._removed||v&&v.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source",sourceDataType:s}));let w=null;if(v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w=v.resourceTiming[this.id].slice(0)),_)return void this.fire(new l.ErrorEvent(_));const A={dataType:"source",sourceDataType:s};this._collectResourceTiming&&w&&w.length>0&&l.extend(A,{resourceTiming:w}),this.fire(new l.Event("data",A))})}loaded(){return this._pendingLoads===0}loadTile(s,h){const p=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const _={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.request=this.actor.send(p,_,(v,w)=>(delete s.request,s.unloadVectorData(),s.aborted?h(null):v?h(v):(s.loadVectorData(w,this.map.painter,p==="reloadTile"),h(null))))}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.aborted=!0}unloadTile(s){s.unloadVectorData(),this.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return l.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var et=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wt extends l.Evented{constructor(s,h,p,_){super(),this.id=s,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=h}load(s,h){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,l.getImage(this.map._requestManager.transformRequest(this.url,l.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new l.ErrorEvent(p)):_&&(this.image=_,s&&(this.coordinates=s),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this.options.url=s.url,this.load(s.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}setCoordinates(s){this.coordinates=s;const h=s.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(_){let v=1/0,w=1/0,A=-1/0,I=-1/0;for(const V of _)v=Math.min(v,V.x),w=Math.min(w,V.y),A=Math.max(A,V.x),I=Math.max(I,V.y);const M=Math.max(A-v,I-w),z=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),B=Math.pow(2,z);return new l.CanonicalTileID(z,Math.floor((v+A)/2*B),Math.floor((w+I)/2*B))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ie(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(s,h){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},h(null)):(s.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class St extends wt{constructor(s,h,p,_){super(s,h,p,_),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,l.ResourceType.Source).url);l.getVideo(this.urls,(h,p)=>{this._loaded=!0,h?this.fire(new l.ErrorEvent(h)):p&&(this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ie(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class tn extends wt{constructor(s,h,p,_){super(s,h,p,_),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ie(h,this.canvas,p.RGBA,{premultiply:!0});for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const nn={vector:en,raster:Dt,"raster-dem":vt,geojson:vi,video:St,image:wt,canvas:tn};function nr(m,s){const h=l.create();return l.translate(h,h,[1,1,0]),l.scale(h,h,[.5*m.width,.5*m.height,1]),l.multiply(h,h,m.calculatePosMatrix(s.toUnwrapped()))}function ni(m,s,h,p,_,v){const w=function(B,V,ne){if(B)for(const K of B){const ee=V[K];if(ee&&ee.source===ne&&ee.type==="fill-extrusion")return!0}else for(const K in V){const ee=V[K];if(ee.source===ne&&ee.type==="fill-extrusion")return!0}return!1}(_&&_.layers,s,m.id),A=v.maxPitchScaleFactor(),I=m.tilesIn(p,A,w);I.sort(xi);const M=[];for(const B of I)M.push({wrappedTileID:B.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,h,m._state,B.queryGeometry,B.cameraQueryGeometry,B.scale,_,v,A,nr(m.transform,B.tileID))});const z=function(B){const V={},ne={};for(const K of B){const ee=K.queryResults,he=K.wrappedTileID,pe=ne[he]=ne[he]||{};for(const ve in ee){const re=ee[ve],Ee=pe[ve]=pe[ve]||{},xe=V[ve]=V[ve]||[];for(const ke of re)Ee[ke.featureIndex]||(Ee[ke.featureIndex]=!0,xe.push(ke))}}return V}(M);for(const B in z)z[B].forEach(V=>{const ne=V.feature,K=m.getFeatureState(ne.layer["source-layer"],ne.id);ne.source=ne.layer.source,ne.layer["source-layer"]&&(ne.sourceLayer=ne.layer["source-layer"]),ne.state=K});return z}function xi(m,s){const h=m.tileID,p=s.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}class ii{constructor(s,h){this.tileID=s,this.uid=l.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<l.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.textures.forEach(h=>s.saveTileTexture(h)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(s,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(_,v){const w={};if(!v)return w;for(const A of _){const I=A.layerIds.map(M=>v.getLayer(M)).filter(Boolean);if(I.length!==0){A.layers=I,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(M=>I.filter(z=>z.id===M)[0]));for(const M of I)w[M.id]=A}}return w}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof l.SymbolBucket&&v.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(_).queryRadius(v))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ie(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ie(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,p,_,v,w,A,I,M,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:v,scale:w,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:A,queryPadding:this.queryPadding*M},s,h,p):{}}querySourceFeatures(s,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const _=p.loadVTLayers(),v=h?h.sourceLayer:"",w=_._geojsonTileLayer||_[v];if(!w)return;const A=l.createFilter(h&&h.filter),{z:I,x:M,y:z}=this.tileID.canonical,B={z:I,x:M,y:z};for(let V=0;V<w.length;V++){const ne=w.feature(V);if(A.needGeometry){const he=l.toEvaluationFeature(ne,!0);if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!A.filter(new l.EvaluationParameters(this.tileID.overscaledZ),ne))continue;const K=p.getId(ne,v),ee=new l.GeoJSONFeature(ne,I,M,z,K);ee.tile=B,s.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const p=l.parseCacheControl(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let _=!1;if(this.expirationTime>p)_=!1;else if(h)if(this.expirationTime<h)_=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!h.style.hasLayer(_))continue;const v=this.buckets[_],w=v.layers[0].sourceLayer||"_geojsonTileLayer",A=p[w],I=s[w];if(!A||!I||Object.keys(I).length===0)continue;v.update(I,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=h&&h.style&&h.style.getLayer(_);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=l.exported.now()+s}setDependencies(s,h){const p={};for(const _ of h)p[_]=!0;this.dependencies[s]=p}hasDependency(s,h){for(const p of s){const _=this.dependencies[p];if(_){for(const v of h)if(_[v])return!0}}return!1}}class ln{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,p){const _=s.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},p)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const p=s.wrapped().key,_=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][_];return this.data[p].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const p in this.data)for(const _ of this.data[p])s(_.value)||h.push(_);for(const p of h)this.remove(p.value.tileID,p)}}class bi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,p){const _=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][_]=this.stateChanges[s][_]||{},l.extend(this.stateChanges[s][_],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==_&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][_]===null){this.deletedStates[s][_]={};for(const v in this.state[s][_])p[v]||(this.deletedStates[s][_][v]=null)}else for(const v in p)this.deletedStates[s]&&this.deletedStates[s][_]&&this.deletedStates[s][_][v]===null&&delete this.deletedStates[s][_][v]}removeFeatureState(s,h,p){if(this.deletedStates[s]===null)return;const _=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&h!==void 0)this.deletedStates[s][_]!==null&&(this.deletedStates[s][_]=this.deletedStates[s][_]||{},this.deletedStates[s][_][p]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][_])for(p in this.deletedStates[s][_]={},this.stateChanges[s][_])this.deletedStates[s][_][p]=null;else this.deletedStates[s][_]=null;else this.deletedStates[s]=null}getState(s,h){const p=String(h),_=l.extend({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][h];if(v===null)return{};for(const w in v)delete _[w]}return _}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const p={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),l.extend(this.state[_][w],this.stateChanges[_][w]),v[w]=this.state[_][w];p[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const w in this.state[_])v[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else for(const A of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][A];v[w]=this.state[_][w]}p[_]=p[_]||{},l.extend(p[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const _ in s)s[_].setFeatureState(p,h)}}class Wt extends l.Evented{constructor(s,h,p){super(),this.id=s,this.dispatcher=p,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(_,v,w,A){const I=new nn[v.type](_,v,w,A);if(I.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${I.id}`);return l.bindAll(["load","abort","unload","serialize","prepare"],I),I}(s,h,p,this),this._tiles={},this._cache=new ln(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new bi}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h){return this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){this._source.abortTile&&this._source.abortTile(s,()=>{}),this._source.fire(new l.Event("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(zn).map(s=>s.key)}getRenderableIds(s){const h=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&h.push(this._tiles[p]);return s?h.sort((p,_)=>{const v=p.tileID,w=_.tileID,A=new l.pointGeometry(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),I=new l.pointGeometry(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||I.y-A.y||I.x-A.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(zn).map(p=>p.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=h),this._loadTile(p,this._tileLoaded.bind(this,p,s,h)))}_tileLoaded(s,h,p,_){if(_)return s.state="errored",void(_.status!==404?this._source.fire(new l.ErrorEvent(_,{tile:s})):this.update(this.transform,this.terrain));s.timeAdded=l.exported.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let _=0;_<h.length;_++){const v=h[_];if(s.neighboringTiles&&s.neighboringTiles[v]){const w=this.getTileByID(v);p(s,w),p(w,s)}}function p(_,v){_.needsHillshadePrepare=!0,_.needsTerrainPrepare=!0;let w=v.tileID.canonical.x-_.tileID.canonical.x;const A=v.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),M=v.tileID.key;w===0&&A===0||Math.abs(A)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,w,A),_.neighboringTiles&&_.neighboringTiles[M]&&(_.neighboringTiles[M].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,p,_){for(const v in this._tiles){let w=this._tiles[v];if(_[v]||!w.hasData()||w.tileID.overscaledZ<=h||w.tileID.overscaledZ>p)continue;let A=w.tileID;for(;w&&w.tileID.overscaledZ>h+1;){const M=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[M.key],w&&w.hasData()&&(A=M)}let I=A;for(;I.overscaledZ>h;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){_[A.key]=A;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=s.overscaledZ-1;p>=h;p--){const _=s.scaledTo(p),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,_=Math.floor(h*p*5),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const p={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(s,h){if(this.transform=s,this.terrain=h,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new l.OverscaledTileID(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(M=>this._source.hasTile(M)))):p=[];const _=s.coveringZoomLevel(this._source),v=Math.max(_-Wt.maxOverzooming,this._source.minzoom),w=Math.max(_+Wt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const M={};for(const z of p)if(z.canonical.z>this._source.minzoom){const B=z.scaledTo(z.canonical.z-1);M[B.key]=B;const V=z.scaledTo(Math.max(this._source.minzoom,Math.min(z.canonical.z,5)));M[V.key]=V}p=p.concat(Object.values(M))}const A=this._updateRetainedTiles(p,_);if(is(this._source.type)){const M={},z={},B=Object.keys(A);for(const V of B){const ne=A[V],K=this._tiles[V];if(!K||K.fadeEndTime&&K.fadeEndTime<=l.exported.now())continue;const ee=this.findLoadedParent(ne,v);ee&&(this._addTile(ee.tileID),M[ee.tileID.key]=ee.tileID),z[V]=ne}this._retainLoadedChildren(z,_,w,A);for(const V in M)A[V]||(this._coveredTiles[V]=!0,A[V]=M[V]);if(h){const V={},ne={};for(const K of p)this._tiles[K.key].hasData()?V[K.key]=K:ne[K.key]=K;for(const K in ne){const ee=ne[K].children(this._source.maxzoom);this._tiles[ee[0].key]&&this._tiles[ee[1].key]&&this._tiles[ee[2].key]&&this._tiles[ee[3].key]&&(V[ee[0].key]=A[ee[0].key]=ee[0],V[ee[1].key]=A[ee[1].key]=ee[1],V[ee[2].key]=A[ee[2].key]=ee[2],V[ee[3].key]=A[ee[3].key]=ee[3],delete ne[K])}for(const K in ne){const ee=this.findLoadedParent(ne[K],this._source.minzoom);if(ee){V[ee.tileID.key]=A[ee.tileID.key]=ee.tileID;for(const he in V)V[he].isChildOf(ee.tileID)&&delete V[he]}}for(const K in this._tiles)V[K]||(this._coveredTiles[K]=!0)}}for(const M in A)this._tiles[M].clearFadeHold();const I=l.keysDifference(this._tiles,A);for(const M of I){const z=this._tiles[M];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(M)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){const p={},_={},v=Math.max(h-Wt.maxOverzooming,this._source.minzoom),w=Math.max(h+Wt.maxUnderzooming,this._source.minzoom),A={};for(const I of s){const M=this._addTile(I);p[I.key]=I,M.hasData()||h<this._source.maxzoom&&(A[I.key]=I)}this._retainLoadedChildren(A,h,w,p);for(const I of s){let M=this._tiles[I.key];if(M.hasData())continue;if(h+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){p[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(p[B[0].key]&&p[B[1].key]&&p[B[2].key]&&p[B[3].key])continue}let z=M.wasRequested();for(let B=I.overscaledZ-1;B>=v;--B){const V=I.scaledTo(B);if(_[V.key]||(_[V.key]=!0,M=this.getTile(V),!M&&z&&(M=this._addTile(V)),M&&(p[V.key]=V,z=M.wasRequested(),M.hasData())))break}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let p,_=this._tiles[s].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}h.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;_=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const p=h;return h||(h=new ii(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))),h.uses++,this._tiles[s.key]=h,p||this._source.fire(new l.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=h.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,p){const _=[],v=this.transform;if(!v)return _;const w=p?v.getCameraQueryGeometry(s):s,A=s.map(K=>v.pointCoordinate(K,this.terrain)),I=w.map(K=>v.pointCoordinate(K,this.terrain)),M=this.getIds();let z=1/0,B=1/0,V=-1/0,ne=-1/0;for(const K of I)z=Math.min(z,K.x),B=Math.min(B,K.y),V=Math.max(V,K.x),ne=Math.max(ne,K.y);for(let K=0;K<M.length;K++){const ee=this._tiles[M[K]];if(ee.holdingForFade())continue;const he=ee.tileID,pe=Math.pow(2,v.zoom-ee.tileID.overscaledZ),ve=h*ee.queryPadding*l.EXTENT/ee.tileSize/pe,re=[he.getTilePoint(new l.MercatorCoordinate(z,B)),he.getTilePoint(new l.MercatorCoordinate(V,ne))];if(re[0].x-ve<l.EXTENT&&re[0].y-ve<l.EXTENT&&re[1].x+ve>=0&&re[1].y+ve>=0){const Ee=A.map(ke=>he.getTilePoint(ke)),xe=I.map(ke=>he.getTilePoint(ke));_.push({tile:ee,tileID:he,queryGeometry:Ee,cameraQueryGeometry:xe,scale:pe})}}return _}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(is(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=l.exported.now())return!0}return!1}setFeatureState(s,h,p){this._state.updateState(s=s||"_geojsonTileLayer",h,p)}removeFeatureState(s,h,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,p)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,p){const _=this._tiles[s];_&&_.setDependencies(h,p)}reloadTilesForDependencies(s,h){for(const p in this._tiles)this._tiles[p].hasDependency(s,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,h))}}function zn(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||p-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function is(m){return m==="raster"||m==="image"||m==="video"}Wt.maxOverzooming=10,Wt.maxUnderzooming=3;const Ci="mapboxgl_preloaded_worker_pool";class Xn{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Xn.workerCount;)this.workers.push(new Worker(xo.workerUrl));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ci]}numActive(){return Object.keys(this.active).length}}const Lr=Math.floor(l.exported.hardwareConcurrency/2);let ji;function di(){return ji||(ji=new Xn),ji}function Gi(m,s){const h={};for(const p in m)p!=="ref"&&(h[p]=m[p]);return l.refProperties.forEach(p=>{p in s&&(h[p]=s[p])}),h}function Vs(m){m=m.slice();const s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=Gi(m[h],s[m[h].ref]));return m}Xn.workerCount=Math.max(Math.min(Lr,6),1);const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Mi(m,s,h){h.push({command:Vt.addSource,args:[m,s[m]]})}function On(m,s,h){s.push({command:Vt.removeSource,args:[m]}),h[m]=!0}function rs(m,s,h,p){On(m,h,p),Mi(m,s,h)}function po(m,s,h){let p;for(p in m[h])if(Object.prototype.hasOwnProperty.call(m[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;for(p in s[h])if(Object.prototype.hasOwnProperty.call(s[h],p)&&p!=="data"&&!L(m[h][p],s[h][p]))return!1;return!0}function Rr(m,s,h,p,_,v){let w;for(w in s=s||{},m=m||{})Object.prototype.hasOwnProperty.call(m,w)&&(L(m[w],s[w])||h.push({command:v,args:[p,w,s[w],_]}));for(w in s)Object.prototype.hasOwnProperty.call(s,w)&&!Object.prototype.hasOwnProperty.call(m,w)&&(L(m[w],s[w])||h.push({command:v,args:[p,w,s[w],_]}))}function Dr(m){return m.id}function js(m,s){return m[s.id]=s,m}class xr{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.clamp(s,0,1);let h=1,p=this._distances[h];const _=s*this.paddedLength+this.padding;for(;p<_&&h<this._distances.length;)p=this._distances[++h];const v=h-1,w=this._distances[v],A=p-w,I=A>0?(_-w)/A:0;return this.points[v].mult(1-I).add(this.points[h].mult(I))}}function Me(m,s){let h=!0;return m==="always"||m!=="never"&&s!=="never"||(h=!1),h}class He{constructor(s,h,p){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(h/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,p,_,v){this._forEachCell(h,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(s,h,p,_){this._forEachCell(h-_,p-_,h+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(p),this.circles.push(_)}_insertBoxCell(s,h,p,_,v,w){this.boxCells[v].push(w)}_insertCircleCell(s,h,p,_,v,w){this.circleCells[v].push(w)}_query(s,h,p,_,v,w,A){if(p<0||s>this.width||_<0||h>this.height)return[];const I=[];if(s<=0&&h<=0&&this.width<=p&&this.height<=_){if(v)return[{key:null,x1:s,y1:h,x2:p,y2:_}];for(let M=0;M<this.boxKeys.length;M++)I.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const z=this.circles[3*M],B=this.circles[3*M+1],V=this.circles[3*M+2];I.push({key:this.circleKeys[M],x1:z-V,y1:B-V,x2:z+V,y2:B+V})}}else this._forEachCell(s,h,p,_,this._queryCell,I,{hitTest:v,overlapMode:w,seenUids:{box:{},circle:{}}},A);return I}query(s,h,p,_){return this._query(s,h,p,_,!1,null)}hitTest(s,h,p,_,v,w){return this._query(s,h,p,_,!0,v,w).length>0}hitTestCircle(s,h,p,_,v){const w=s-p,A=s+p,I=h-p,M=h+p;if(A<0||w>this.width||M<0||I>this.height)return!1;const z=[];return this._forEachCell(w,I,A,M,this._queryCellCircle,z,{hitTest:!0,overlapMode:_,circle:{x:s,y:h,radius:p},seenUids:{box:{},circle:{}}},v),z.length>0}_queryCell(s,h,p,_,v,w,A,I){const{seenUids:M,hitTest:z,overlapMode:B}=A,V=this.boxCells[v];if(V!==null){const K=this.bboxes;for(const ee of V)if(!M.box[ee]){M.box[ee]=!0;const he=4*ee,pe=this.boxKeys[ee];if(s<=K[he+2]&&h<=K[he+3]&&p>=K[he+0]&&_>=K[he+1]&&(!I||I(pe))&&(!z||!Me(B,pe.overlapMode))&&(w.push({key:pe,x1:K[he],y1:K[he+1],x2:K[he+2],y2:K[he+3]}),z))return!0}}const ne=this.circleCells[v];if(ne!==null){const K=this.circles;for(const ee of ne)if(!M.circle[ee]){M.circle[ee]=!0;const he=3*ee,pe=this.circleKeys[ee];if(this._circleAndRectCollide(K[he],K[he+1],K[he+2],s,h,p,_)&&(!I||I(pe))&&(!z||!Me(B,pe.overlapMode))){const ve=K[he],re=K[he+1],Ee=K[he+2];if(w.push({key:pe,x1:ve-Ee,y1:re-Ee,x2:ve+Ee,y2:re+Ee}),z)return!0}}}return!1}_queryCellCircle(s,h,p,_,v,w,A,I){const{circle:M,seenUids:z,overlapMode:B}=A,V=this.boxCells[v];if(V!==null){const K=this.bboxes;for(const ee of V)if(!z.box[ee]){z.box[ee]=!0;const he=4*ee,pe=this.boxKeys[ee];if(this._circleAndRectCollide(M.x,M.y,M.radius,K[he+0],K[he+1],K[he+2],K[he+3])&&(!I||I(pe))&&!Me(B,pe.overlapMode))return w.push(!0),!0}}const ne=this.circleCells[v];if(ne!==null){const K=this.circles;for(const ee of ne)if(!z.circle[ee]){z.circle[ee]=!0;const he=3*ee,pe=this.circleKeys[ee];if(this._circlesCollide(K[he],K[he+1],K[he+2],M.x,M.y,M.radius)&&(!I||I(pe))&&!Me(B,pe.overlapMode))return w.push(!0),!0}}}_forEachCell(s,h,p,_,v,w,A,I){const M=this._convertToXCellCoord(s),z=this._convertToYCellCoord(h),B=this._convertToXCellCoord(p),V=this._convertToYCellCoord(_);for(let ne=M;ne<=B;ne++)for(let K=z;K<=V;K++)if(v.call(this,s,h,p,_,this.xCellCount*K+ne,w,A,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,p,_,v,w){const A=_-s,I=v-h,M=p+w;return M*M>A*A+I*I}_circleAndRectCollide(s,h,p,_,v,w,A){const I=(w-_)/2,M=Math.abs(s-(_+I));if(M>I+p)return!1;const z=(A-v)/2,B=Math.abs(h-(v+z));if(B>z+p)return!1;if(M<=I||B<=z)return!0;const V=M-I,ne=B-z;return V*V+ne*ne<=p*p}}function ss(m,s,h,p,_){const v=l.create();return s?(l.scale(v,v,[1/_,1/_,1]),h||l.rotateZ(v,v,p.angle)):l.multiply(v,p.labelPlaneMatrix,m),v}function wi(m,s,h,p,_){if(s){const v=l.clone(m);return l.scale(v,v,[_,_,1]),h||l.rotateZ(v,v,-p.angle),v}return p.glCoordMatrix}function Bt(m,s,h){let p;h?(p=[m.x,m.y,h(m.x,m.y),1],l.transformMat4(p,p,s)):(p=[m.x,m.y,0,1],ir(p,p,s));const _=p[3];return{point:new l.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Hi(m,s){return .5+m/s*.5}function ki(m,s){const h=m[0]/m[3],p=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&p>=-s[1]&&p<=s[1]}function Li(m,s,h,p,_,v,w,A,I,M){const z=p?m.textSizeData:m.iconSizeData,B=l.evaluateSizeForZoom(z,h.transform.zoom),V=[256/h.width*2+1,256/h.height*2+1],ne=p?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ne.clear();const K=m.lineVertexArray,ee=p?m.text.placedSymbolArray:m.icon.placedSymbolArray,he=h.transform.width/h.transform.height;let pe=!1;for(let ve=0;ve<ee.length;ve++){const re=ee.get(ve);if(re.hidden||re.writingMode===l.WritingMode.vertical&&!pe){At(re.numGlyphs,ne);continue}let Ee;if(pe=!1,M?(Ee=[re.anchorX,re.anchorY,M(re.anchorX,re.anchorY),1],l.transformMat4(Ee,Ee,s)):(Ee=[re.anchorX,re.anchorY,0,1],ir(Ee,Ee,s)),!ki(Ee,V)){At(re.numGlyphs,ne);continue}const xe=Hi(h.transform.cameraToCenterDistance,Ee[3]),ke=l.evaluateSizeForFeature(z,B,re),Le=w?ke/xe:ke*xe,Fe=new l.pointGeometry(re.anchorX,re.anchorY),Pe=Bt(Fe,_,M).point,Qe={},$e=Pt(re,Le,!1,A,s,_,v,m.glyphOffsetArray,K,ne,Pe,Fe,Qe,he,I,M);pe=$e.useVertical,($e.notEnoughRoom||pe||$e.needsFlipping&&Pt(re,Le,!0,A,s,_,v,m.glyphOffsetArray,K,ne,Pe,Fe,Qe,he,I,M).notEnoughRoom)&&At(re.numGlyphs,ne)}p?m.text.dynamicLayoutVertexBuffer.updateData(ne):m.icon.dynamicLayoutVertexBuffer.updateData(ne)}function os(m,s,h,p,_,v,w,A,I,M,z,B,V){const ne=A.glyphStartIndex+A.numGlyphs,K=A.lineStartIndex,ee=A.lineStartIndex+A.lineLength,he=s.getoffsetX(A.glyphStartIndex),pe=s.getoffsetX(ne-1),ve=Zn(m*he,h,p,_,v,w,A.segment,K,ee,I,M,z,B,V);if(!ve)return null;const re=Zn(m*pe,h,p,_,v,w,A.segment,K,ee,I,M,z,B,V);return re?{first:ve,last:re}:null}function Ge(m,s,h,p){return m===l.WritingMode.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*p?{useVertical:!0}:(m===l.WritingMode.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Pt(m,s,h,p,_,v,w,A,I,M,z,B,V,ne,K,ee){const he=s/24,pe=m.lineOffsetX*he,ve=m.lineOffsetY*he;let re;if(m.numGlyphs>1){const Ee=m.glyphStartIndex+m.numGlyphs,xe=m.lineStartIndex,ke=m.lineStartIndex+m.lineLength,Le=os(he,A,pe,ve,h,z,B,m,I,v,V,K,ee);if(!Le)return{notEnoughRoom:!0};const Fe=Bt(Le.first.point,w,ee).point,Pe=Bt(Le.last.point,w,ee).point;if(p&&!h){const Qe=Ge(m.writingMode,Fe,Pe,ne);if(Qe)return Qe}re=[Le.first];for(let Qe=m.glyphStartIndex+1;Qe<Ee-1;Qe++)re.push(Zn(he*A.getoffsetX(Qe),pe,ve,h,z,B,m.segment,xe,ke,I,v,V,K,ee));re.push(Le.last)}else{if(p&&!h){const xe=Bt(B,_,ee).point,ke=m.lineStartIndex+m.segment+1,Le=new l.pointGeometry(I.getx(ke),I.gety(ke)),Fe=Bt(Le,_,ee),Pe=Fe.signedDistanceFromCamera>0?Fe.point:It(B,Le,xe,1,_,ee),Qe=Ge(m.writingMode,xe,Pe,ne);if(Qe)return Qe}const Ee=Zn(he*A.getoffsetX(m.glyphStartIndex),pe,ve,h,z,B,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,I,v,V,K,ee);if(!Ee)return{notEnoughRoom:!0};re=[Ee]}for(const Ee of re)l.addDynamicAttributes(M,Ee.point,Ee.angle);return{}}function It(m,s,h,p,_,v){const w=Bt(m.add(m.sub(s)._unit()),_,v).point,A=h.sub(w);return h.add(A._mult(p/A.mag()))}function Zn(m,s,h,p,_,v,w,A,I,M,z,B,V,ne){const K=p?m-s:m+s;let ee=K>0?1:-1,he=0;p&&(ee*=-1,he=Math.PI),ee<0&&(he+=Math.PI);let pe=ee>0?A+w:A+w+1,ve=_,re=_,Ee=0,xe=0;const ke=Math.abs(K),Le=[];for(;Ee+xe<=ke;){if(pe+=ee,pe<A||pe>=I)return null;if(re=ve,Le.push(ve),ve=B[pe],ve===void 0){const tt=new l.pointGeometry(M.getx(pe),M.gety(pe)),Ct=Bt(tt,z,ne);if(Ct.signedDistanceFromCamera>0)ve=B[pe]=Ct.point;else{const Lt=pe-ee;ve=It(Ee===0?v:new l.pointGeometry(M.getx(Lt),M.gety(Lt)),tt,re,ke-Ee+1,z,ne)}}Ee+=xe,xe=re.dist(ve)}const Fe=(ke-Ee)/xe,Pe=ve.sub(re),Qe=Pe.mult(Fe)._add(re);Qe._add(Pe._unit()._perp()._mult(h*ee));const $e=he+Math.atan2(ve.y-re.y,ve.x-re.x);return Le.push(Qe),{point:Qe,angle:V?$e:0,path:Le}}const zr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function At(m,s){for(let h=0;h<m;h++){const p=s.length;s.resize(p+4),s.float32.set(zr,3*p)}}function ir(m,s,h){const p=s[0],_=s[1];return m[0]=h[0]*p+h[4]*_+h[12],m[1]=h[1]*p+h[5]*_+h[13],m[3]=h[3]*p+h[7]*_+h[15],m}const jn=100;class Gs{constructor(s,h=new He(s.width+200,s.height+200,25),p=new He(s.width+200,s.height+200,25)){this.transform=s,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+jn,this.screenBottomBoundary=s.height+jn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,p,_,v,w){const A=this.projectAndGetPerspectiveRatio(_,s.anchorPointX,s.anchorPointY,w),I=p*A.perspectiveRatio,M=s.x1*I+A.point.x,z=s.y1*I+A.point.y,B=s.x2*I+A.point.x,V=s.y2*I+A.point.y;return!this.isInsideGrid(M,z,B,V)||h!=="always"&&this.grid.hitTest(M,z,B,V,h,v)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,z,B,V],offscreen:this.isOffscreen(M,z,B,V)}}placeCollisionCircles(s,h,p,_,v,w,A,I,M,z,B,V,ne,K){const ee=[],he=new l.pointGeometry(h.anchorX,h.anchorY),pe=Bt(he,w,K),ve=Hi(this.transform.cameraToCenterDistance,pe.signedDistanceFromCamera),re=(z?v/ve:v*ve)/l.ONE_EM,Ee=Bt(he,A,K).point,xe=os(re,_,h.lineOffsetX*re,h.lineOffsetY*re,!1,Ee,he,h,p,A,{},!1,K);let ke=!1,Le=!1,Fe=!0;if(xe){const Pe=.5*V*ve+ne,Qe=new l.pointGeometry(-100,-100),$e=new l.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),tt=new xr,Ct=xe.first,Lt=xe.last;let gt=[];for(let Gt=Ct.path.length-1;Gt>=1;Gt--)gt.push(Ct.path[Gt]);for(let Gt=1;Gt<Lt.path.length;Gt++)gt.push(Lt.path[Gt]);const rn=2.5*Pe;if(I){const Gt=gt.map(Ht=>Bt(Ht,I,K));gt=Gt.some(Ht=>Ht.signedDistanceFromCamera<=0)?[]:Gt.map(Ht=>Ht.point)}let sn=[];if(gt.length>0){const Gt=gt[0].clone(),Ht=gt[0].clone();for(let an=1;an<gt.length;an++)Gt.x=Math.min(Gt.x,gt[an].x),Gt.y=Math.min(Gt.y,gt[an].y),Ht.x=Math.max(Ht.x,gt[an].x),Ht.y=Math.max(Ht.y,gt[an].y);sn=Gt.x>=Qe.x&&Ht.x<=$e.x&&Gt.y>=Qe.y&&Ht.y<=$e.y?[gt]:Ht.x<Qe.x||Gt.x>$e.x||Ht.y<Qe.y||Gt.y>$e.y?[]:l.clipLine([gt],Qe.x,Qe.y,$e.x,$e.y)}for(const Gt of sn){tt.reset(Gt,.25*Pe);let Ht=0;Ht=tt.length<=.5*Pe?1:Math.ceil(tt.paddedLength/rn)+1;for(let an=0;an<Ht;an++){const si=an/Math.max(Ht-1,1),us=tt.lerp(si),Nr=us.x+jn,hs=us.y+jn;ee.push(Nr,hs,Pe,0);const Qs=Nr-Pe,Tr=hs-Pe,Wi=Nr+Pe,Is=hs+Pe;if(Fe=Fe&&this.isOffscreen(Qs,Tr,Wi,Is),Le=Le||this.isInsideGrid(Qs,Tr,Wi,Is),s!=="always"&&this.grid.hitTestCircle(Nr,hs,Pe,s,B)&&(ke=!0,!M))return{circles:[],offscreen:!1,collisionDetected:ke}}}}return{circles:!M&&ke||!Le||ve<this.perspectiveRatioCutoff?[]:ee,offscreen:Fe,collisionDetected:ke}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,_=1/0,v=-1/0,w=-1/0;for(const z of s){const B=new l.pointGeometry(z.x+jn,z.y+jn);p=Math.min(p,B.x),_=Math.min(_,B.y),v=Math.max(v,B.x),w=Math.max(w,B.y),h.push(B)}const A=this.grid.query(p,_,v,w).concat(this.ignoredGrid.query(p,_,v,w)),I={},M={};for(const z of A){const B=z.key;if(I[B.bucketInstanceId]===void 0&&(I[B.bucketInstanceId]={}),I[B.bucketInstanceId][B.featureIndex])continue;const V=[new l.pointGeometry(z.x1,z.y1),new l.pointGeometry(z.x2,z.y1),new l.pointGeometry(z.x2,z.y2),new l.pointGeometry(z.x1,z.y2)];l.polygonIntersectsPolygon(h,V)&&(I[B.bucketInstanceId][B.featureIndex]=!0,M[B.bucketInstanceId]===void 0&&(M[B.bucketInstanceId]=[]),M[B.bucketInstanceId].push(B.featureIndex))}return M}insertCollisionBox(s,h,p,_,v,w){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:v,collisionGroupID:w,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,p,_,v,w){const A=p?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:v,collisionGroupID:w,overlapMode:h};for(let M=0;M<s.length;M+=4)A.insertCircle(I,s[M],s[M+1],s[M+2])}projectAndGetPerspectiveRatio(s,h,p,_){let v;return _?(v=[h,p,_(h,p),1],l.transformMat4(v,v,s)):(v=[h,p,0,1],ir(v,v,s)),{point:new l.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+jn,(-v[1]/v[3]+1)/2*this.transform.height+jn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(s,h,p,_){return p<jn||s>=this.screenRightBoundary||_<jn||h>this.screenBottomBoundary}isInsideGrid(s,h,p,_){return p>=0&&s<this.gridRightBoundary&&_>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=l.identity([]);return l.translate(s,s,[-100,-100,0]),s}}function Mn(m,s,h){return s*(l.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}class ri{constructor(s,h,p,_){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Jt{constructor(s,h,p,_,v){this.text=new ri(s?s.text:null,h,p,v),this.icon=new ri(s?s.icon:null,h,_,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Hs{constructor(s,h,p){this.text=s,this.icon=h,this.skipFade=p}}class br{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class wr{constructor(s,h,p,_,v){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class Es{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[s]}}function $s(m,s,h,p,_){const{horizontalAlign:v,verticalAlign:w}=l.getAnchorAlignment(m),A=-(v-.5)*s,I=-(w-.5)*h,M=l.evaluateVariableOffset(m,p);return new l.pointGeometry(A+M[0]*_,I+M[1]*_)}function as(m,s,h,p,_,v){const{x1:w,x2:A,y1:I,y2:M,anchorPointX:z,anchorPointY:B}=m,V=new l.pointGeometry(s,h);return p&&V._rotate(_?v:-v),{x1:w+V.x,y1:I+V.y,x2:A+V.x,y2:M+V.y,anchorPointX:z,anchorPointY:B}}class Y{constructor(s,h,p,_,v){this.transform=s.clone(),this.terrain=h,this.collisionIndex=new Gs(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Es(_),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,p,_){const v=p.getBucket(h),w=p.latestFeatureIndex;if(!v||!w||h.id!==v.layerIds[0])return;const A=p.collisionBoxArray,I=v.layers[0].layout,M=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),z=p.tileSize/l.EXTENT,B=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),V=I.get("text-pitch-alignment")==="map",ne=I.get("text-rotation-alignment")==="map",K=Mn(p,1,this.transform.zoom),ee=ss(B,V,ne,this.transform,K);let he=null;if(V){const ve=wi(B,V,ne,this.transform,K);he=l.multiply([],this.transform.labelPlaneMatrix,ve)}this.retainedQueryData[v.bucketInstanceId]=new wr(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,p.tileID);const pe={bucket:v,layout:I,posMatrix:B,textLabelPlaneMatrix:ee,labelToScreenMatrix:he,scale:M,textPixelRatio:z,holdingForFade:p.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(const ve of v.sortKeyRanges){const{sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:xe}=ve;s.push({sortKey:re,symbolInstanceStart:Ee,symbolInstanceEnd:xe,parameters:pe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(s,h,p,_,v,w,A,I,M,z,B,V,ne,K,ee,he){const pe=[V.textOffset0,V.textOffset1],ve=$s(s,p,_,pe,v),re=this.collisionIndex.placeCollisionBox(as(h,ve.x,ve.y,w,A,this.transform.angle),B,I,M,z.predicate,he);if((!ee||this.collisionIndex.placeCollisionBox(as(ee,ve.x,ve.y,w,A,this.transform.angle),B,I,M,z.predicate,he).box.length!==0)&&re.box.length>0){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID]&&this.prevPlacement.placements[V.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[V.crossTileID].anchor),V.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[V.crossTileID]={textOffset:pe,width:p,height:_,anchor:s,textBoxScale:v,prevAnchor:Ee},this.markUsedJustification(ne,s,V,K),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,K,V),this.placedOrientations[V.crossTileID]=K),{shift:ve,placedGlyphBoxes:re}}}placeLayerBucketPart(s,h,p){const{bucket:_,layout:v,posMatrix:w,textLabelPlaneMatrix:A,labelToScreenMatrix:I,textPixelRatio:M,holdingForFade:z,collisionBoxArray:B,partiallyEvaluatedTextSize:V,collisionGroup:ne}=s.parameters,K=v.get("text-optional"),ee=v.get("icon-optional"),he=l.getOverlapMode(v,"text-overlap","text-allow-overlap"),pe=he==="always",ve=l.getOverlapMode(v,"icon-overlap","icon-allow-overlap"),re=ve==="always",Ee=v.get("text-rotation-alignment")==="map",xe=v.get("text-pitch-alignment")==="map",ke=v.get("icon-text-fit")!=="none",Le=v.get("symbol-z-order")==="viewport-y",Fe=pe&&(re||!_.hasIconData()||ee),Pe=re&&(pe||!_.hasTextData()||K);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B);const Qe=($e,tt)=>{if(h[$e.crossTileID])return;if(z)return void(this.placements[$e.crossTileID]=new Hs(!1,!1,!1));let Ct=!1,Lt=!1,gt=!0,rn=null,sn={box:null,offscreen:null},Gt={box:null,offscreen:null},Ht=null,an=null,si=null,us=0,Nr=0,hs=0;tt.textFeatureIndex?us=tt.textFeatureIndex:$e.useRuntimeCollisionCircles&&(us=$e.featureIndex),tt.verticalTextFeatureIndex&&(Nr=tt.verticalTextFeatureIndex);const Qs=this.retainedQueryData[_.bucketInstanceId].tileID,Tr=this.terrain?(Kn,Ft)=>this.terrain.getElevation(Qs,Kn,Ft):null;for(const Kn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const Ft=tt[Kn];Ft&&(Ft.elevation=Tr?Tr(Ft.anchorPointX,Ft.anchorPointY):0)}const Wi=tt.textBox;if(Wi){const Kn=Qt=>{let oi=l.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Qt&&this.prevPlacement){const ai=this.prevPlacement.placedOrientations[$e.crossTileID];ai&&(this.placedOrientations[$e.crossTileID]=ai,oi=ai,this.markUsedOrientation(_,oi,$e))}return oi},Ft=(Qt,oi)=>{if(_.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&tt.verticalTextBox){for(const ai of _.writingModes)if(ai===l.WritingMode.vertical?(sn=oi(),Gt=sn):sn=Qt(),sn&&sn.box&&sn.box.length)break}else sn=Qt()};if(v.get("text-variable-anchor")){let Qt=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e.crossTileID]){const xn=this.prevPlacement.variableOffsets[$e.crossTileID];Qt.indexOf(xn.anchor)>0&&(Qt=Qt.filter(Sr=>Sr!==xn.anchor),Qt.unshift(xn.anchor))}const oi=(xn,Sr,bo)=>{const Uu=xn.x2-xn.x1,aa=xn.y2-xn.y1,tf=$e.textBoxScale,Vu=ke&&ve==="never"?Sr:null;let eo={box:[],offscreen:!1};const wo=he!=="never"?2*Qt.length:Qt.length;for(let Eo=0;Eo<wo;++Eo){const rc=this.attemptAnchorPlacement(Qt[Eo%Qt.length],xn,Uu,aa,tf,Ee,xe,M,w,ne,Eo>=Qt.length?he:"never",$e,_,bo,Vu,Tr);if(rc&&(eo=rc.placedGlyphBoxes,eo&&eo.box&&eo.box.length)){Ct=!0,rn=rc.shift;break}}return eo};Ft(()=>oi(Wi,tt.iconBox,l.WritingMode.horizontal),()=>{const xn=tt.verticalTextBox;return _.allowVerticalPlacement&&!(sn&&sn.box&&sn.box.length)&&$e.numVerticalGlyphVertices>0&&xn?oi(xn,tt.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),sn&&(Ct=sn.box,gt=sn.offscreen);const ai=Kn(sn&&sn.box);if(!Ct&&this.prevPlacement){const xn=this.prevPlacement.variableOffsets[$e.crossTileID];xn&&(this.variableOffsets[$e.crossTileID]=xn,this.markUsedJustification(_,xn.anchor,$e,ai))}}else{const Qt=(oi,ai)=>{const xn=this.collisionIndex.placeCollisionBox(oi,he,M,w,ne.predicate,Tr);return xn&&xn.box&&xn.box.length&&(this.markUsedOrientation(_,ai,$e),this.placedOrientations[$e.crossTileID]=ai),xn};Ft(()=>Qt(Wi,l.WritingMode.horizontal),()=>{const oi=tt.verticalTextBox;return _.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&oi?Qt(oi,l.WritingMode.vertical):{box:null,offscreen:null}}),Kn(sn&&sn.box&&sn.box.length)}}if(Ht=sn,Ct=Ht&&Ht.box&&Ht.box.length>0,gt=Ht&&Ht.offscreen,$e.useRuntimeCollisionCircles){const Kn=_.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex),Ft=l.evaluateSizeForFeature(_.textSizeData,V,Kn),Qt=v.get("text-padding");an=this.collisionIndex.placeCollisionCircles(he,Kn,_.lineVertexArray,_.glyphOffsetArray,Ft,w,A,I,p,xe,ne.predicate,$e.collisionCircleDiameter,Qt,Tr),an.circles.length&&an.collisionDetected&&!p&&l.warnOnce("Collisions detected, but collision boxes are not shown"),Ct=pe||an.circles.length>0&&!an.collisionDetected,gt=gt&&an.offscreen}if(tt.iconFeatureIndex&&(hs=tt.iconFeatureIndex),tt.iconBox){const Kn=Ft=>{const Qt=ke&&rn?as(Ft,rn.x,rn.y,Ee,xe,this.transform.angle):Ft;return this.collisionIndex.placeCollisionBox(Qt,ve,M,w,ne.predicate,Tr)};Gt&&Gt.box&&Gt.box.length&&tt.verticalIconBox?(si=Kn(tt.verticalIconBox),Lt=si.box.length>0):(si=Kn(tt.iconBox),Lt=si.box.length>0),gt=gt&&si.offscreen}const Is=K||$e.numHorizontalGlyphVertices===0&&$e.numVerticalGlyphVertices===0,ic=ee||$e.numIconVertices===0;if(Is||ic?ic?Is||(Lt=Lt&&Ct):Ct=Lt&&Ct:Lt=Ct=Lt&&Ct,Ct&&Ht&&Ht.box&&this.collisionIndex.insertCollisionBox(Ht.box,he,v.get("text-ignore-placement"),_.bucketInstanceId,Gt&&Gt.box&&Nr?Nr:us,ne.ID),Lt&&si&&this.collisionIndex.insertCollisionBox(si.box,ve,v.get("icon-ignore-placement"),_.bucketInstanceId,hs,ne.ID),an&&(Ct&&this.collisionIndex.insertCollisionCircles(an.circles,he,v.get("text-ignore-placement"),_.bucketInstanceId,us,ne.ID),p)){const Kn=_.bucketInstanceId;let Ft=this.collisionCircleArrays[Kn];Ft===void 0&&(Ft=this.collisionCircleArrays[Kn]=new br);for(let Qt=0;Qt<an.circles.length;Qt+=4)Ft.circles.push(an.circles[Qt+0]),Ft.circles.push(an.circles[Qt+1]),Ft.circles.push(an.circles[Qt+2]),Ft.circles.push(an.collisionDetected?1:0)}if($e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(_.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$e.crossTileID]=new Hs(Ct||Fe,Lt||Pe,gt||_.justReloaded),h[$e.crossTileID]=!0};if(Le){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $e=_.getSortedSymbolIndexes(this.transform.angle);for(let tt=$e.length-1;tt>=0;--tt){const Ct=$e[tt];Qe(_.symbolInstances.get(Ct),_.collisionArrays[Ct])}}else for(let $e=s.symbolInstanceStart;$e<s.symbolInstanceEnd;$e++)Qe(_.symbolInstances.get($e),_.collisionArrays[$e]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[_.bucketInstanceId];l.invert($e.invProjMatrix,w),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(s,h,p,_){let v;v=_===l.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(h)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const A of w)A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=v>=0&&A!==v?0:p.crossTileID)}markUsedOrientation(s,h,p){const _=h===l.WritingMode.horizontal||h===l.WritingMode.horizontalOnly?h:0,v=h===l.WritingMode.vertical?h:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const A of w)s.text.placedSymbolArray.get(A).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const _=h?h.symbolFadeChange(s):1,v=h?h.opacities:{},w=h?h.variableOffsets:{},A=h?h.placedOrientations:{};for(const I in this.placements){const M=this.placements[I],z=v[I];z?(this.opacities[I]=new Jt(z,_,M.text,M.icon),p=p||M.text!==z.text.placed||M.icon!==z.icon.placed):(this.opacities[I]=new Jt(null,_,M.text,M.icon,M.skipFade),p=p||M.text||M.icon)}for(const I in v){const M=v[I];if(!this.opacities[I]){const z=new Jt(M,_,!1,!1);z.isHidden()||(this.opacities[I]=z,p=p||M.text.placed||M.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in A)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=A[I]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const p={};for(const _ of h){const v=_.getBucket(s);v&&_.latestFeatureIndex&&s.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,_.collisionBoxArray)}}updateBucketOpacities(s,h,p){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const _=s.layers[0].layout,v=new Jt(null,0,!1,!1,!0),w=_.get("text-allow-overlap"),A=_.get("icon-allow-overlap"),I=_.get("text-variable-anchor"),M=_.get("text-rotation-alignment")==="map",z=_.get("text-pitch-alignment")==="map",B=_.get("icon-text-fit")!=="none",V=new Jt(null,0,w&&(A||!s.hasIconData()||_.get("icon-optional")),A&&(w||!s.hasTextData()||_.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const ne=(K,ee,he)=>{for(let pe=0;pe<ee/4;pe++)K.opacityVertexArray.emplaceBack(he)};for(let K=0;K<s.symbolInstances.length;K++){const ee=s.symbolInstances.get(K),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:pe,crossTileID:ve}=ee;let re=this.opacities[ve];h[ve]?re=v:re||(re=V,this.opacities[ve]=re),h[ve]=!0;const Ee=ee.numIconVertices>0,xe=this.placedOrientations[ee.crossTileID],ke=xe===l.WritingMode.vertical,Le=xe===l.WritingMode.horizontal||xe===l.WritingMode.horizontalOnly;if(he>0||pe>0){const Fe=fe(re.text);ne(s.text,he,ke?Ie:Fe),ne(s.text,pe,Le?Ie:Fe);const Pe=re.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(tt=>{tt>=0&&(s.text.placedSymbolArray.get(tt).hidden=Pe||ke?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Pe||Le?1:0);const Qe=this.variableOffsets[ee.crossTileID];Qe&&this.markUsedJustification(s,Qe.anchor,ee,xe);const $e=this.placedOrientations[ee.crossTileID];$e&&(this.markUsedJustification(s,"left",ee,$e),this.markUsedOrientation(s,$e,ee))}if(Ee){const Fe=fe(re.icon),Pe=!(B&&ee.verticalPlacedIconSymbolIndex&&ke);ee.placedIconSymbolIndex>=0&&(ne(s.icon,ee.numIconVertices,Pe?Fe:Ie),s.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=re.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(ne(s.icon,ee.numVerticalIconVertices,Pe?Ie:Fe),s.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=re.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Fe=s.collisionArrays[K];if(Fe){let Pe=new l.pointGeometry(0,0);if(Fe.textBox||Fe.verticalTextBox){let $e=!0;if(I){const tt=this.variableOffsets[ve];tt?(Pe=$s(tt.anchor,tt.width,tt.height,tt.textOffset,tt.textBoxScale),M&&Pe._rotate(z?this.transform.angle:-this.transform.angle)):$e=!1}Fe.textBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!$e||ke,Pe.x,Pe.y),Fe.verticalTextBox&&R(s.textCollisionBox.collisionVertexArray,re.text.placed,!$e||Le,Pe.x,Pe.y)}const Qe=Boolean(!Le&&Fe.verticalIconBox);Fe.iconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,Qe,B?Pe.x:0,B?Pe.y:0),Fe.verticalIconBox&&R(s.iconCollisionBox.collisionVertexArray,re.icon.placed,!Qe,B?Pe.x:0,B?Pe.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const K=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=K.invProjMatrix,s.placementViewportMatrix=K.viewportMatrix,s.collisionCircleArray=K.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function R(m,s,h,p,_){m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0),m.emplaceBack(s?1:0,h?1:0,p||0,_||0)}const F=Math.pow(2,25),$=Math.pow(2,24),q=Math.pow(2,17),le=Math.pow(2,16),de=Math.pow(2,9),ue=Math.pow(2,8),ae=Math.pow(2,1);function fe(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*F+s*$+h*q+s*le+h*de+s*ue+h*ae+s}const Ie=0;class ze{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,p,_,v){const w=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(w,_,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,I)=>A.sortKey-I.sortKey));this._currentPartIndex<w.length;)if(h.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Ae{constructor(s,h,p,_,v,w,A,I){this.placement=new Y(s,h,w,A,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,h,p){const _=l.exported.now(),v=()=>{const w=l.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=h[s[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(w.type==="symbol"&&(!w.minzoom||w.minzoom<=A)&&(!w.maxzoom||w.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ze(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const it=512/l.EXTENT/2;class at{constructor(s,h,p){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<h.length;_++){const v=h.get(_),w=v.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,s)})}}getScaledCoordinates(s,h){const p=it/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*l.EXTENT+s.anchorX)*p),y:Math.floor((h.canonical.y*l.EXTENT+s.anchorY)*p)}}findMatches(s,h,p){const _=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<s.length;v++){const w=s.get(v);if(w.crossTileID)continue;const A=this.indexedSymbolInstances[w.key];if(!A)continue;const I=this.getScaledCoordinates(w,h);for(const M of A)if(Math.abs(M.coord.x-I.x)<=_&&Math.abs(M.coord.y-I.y)<=_&&!p[M.crossTileID]){p[M.crossTileID]=!0,w.crossTileID=M.crossTileID;break}}}}class Ze{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const p in this.indexes){const _=this.indexes[p],v={};for(const w in _){const A=_[w];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),v[A.tileID.key]=A}this.indexes[p]=v}this.lng=s}addBucket(s,h,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const _=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const w=this.indexes[v];if(Number(v)>s.overscaledZ)for(const A in w){const I=w[A];I.tileID.isChildOf(s)&&I.findMatches(h.symbolInstances,s,_)}else{const A=w[s.scaledTo(Number(v)).key];A&&A.findMatches(h.symbolInstances,s,_)}}for(let v=0;v<h.symbolInstances.length;v++){const w=h.symbolInstances.get(v);w.crossTileID||(w.crossTileID=p.generate(),_[w.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new at(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const p in h.indexedSymbolInstances)for(const _ of h.indexedSymbolInstances[p])delete this.usedCrossTileIDs[s][_.crossTileID]}removeStaleBuckets(s){let h=!1;for(const p in this.indexes){const _=this.indexes[p];for(const v in _)s[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],h=!0)}return h}}class ht{constructor(){this.layerIndexes={},this.crossTileIDs=new Ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,p){let _=this.layerIndexes[s.id];_===void 0&&(_=this.layerIndexes[s.id]=new mt);let v=!1;const w={};_.handleWrapJump(p);for(const A of h){const I=A.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,I,this.crossTileIDs)&&(v=!0),w[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(s){const h={};s.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}var Mt=l.createLayout([{name:"a_pos",type:"Int16",components:2}]);class yt extends l.Evented{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=s._cache.max,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const s in this._tiles){const h=this._tiles[s];h.textures.forEach(p=>p.destroy()),h.textures=[]}}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];for(const p of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.posMatrix=new Float64Array(16),l.ortho(p.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[p.key]=new ii(p,this.tileSize))}removeOutdated(s){const h={};this.renderHistory=this.renderHistory.filter((p,_)=>this.renderHistory.indexOf(p)===_).slice(0,this.renderHistorySize);for(const p of this._renderableTilesKeys)h[p]=!0;for(const p of this.renderHistory)h[p]=!0;for(const p in this._tiles)h[p]||(this._tiles[p].clearTextures(s),delete this._tiles[p])}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const p of this._renderableTilesKeys){const _=this._tiles[p].tileID;if(_.canonical.equals(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16),l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),h[p]=v}else if(_.canonical.isChildOf(s.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const w=_.canonical.z-s.canonical.z,A=_.canonical.x-(_.canonical.x>>w<<w),I=_.canonical.y-(_.canonical.y>>w<<w),M=l.EXTENT>>w;l.ortho(v.posMatrix,0,M,0,M,0,1),l.translate(v.posMatrix,v.posMatrix,[-A*M,-I*M,0]),h[p]=v}else if(s.canonical.isChildOf(_.canonical)){const v=s.clone();v.posMatrix=new Float64Array(16);const w=s.canonical.z-_.canonical.z,A=s.canonical.x-(s.canonical.x>>w<<w),I=s.canonical.y-(s.canonical.y>>w<<w),M=l.EXTENT>>w;l.ortho(v.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(v.posMatrix,v.posMatrix,[A*M,I*M,0]),l.scale(v.posMatrix,v.posMatrix,[1/2**w,1/2**w,0]),h[p]=v}}return h}getSourceTile(s,h){const p=this.sourceCache._source;let _=s.overscaledZ-this.deltaZoom;if(_>p.maxzoom&&(_=p.maxzoom),_<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(_).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!v||!v.dem)&&h)for(;_>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(s.scaledTo(_--).key);return v}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeLoaded>=s)}}class Tt{constructor(s,h,p){this.style=s,this.sourceCache=new yt(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.elevationOffset=typeof p.elevationOffset=="number"?p.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(s,h,p,_=l.EXTENT){if(!(h>=0&&h<_&&p>=0&&p<_))return this.elevationOffset;let v=0;const w=this.getTerrainData(s);if(w.tile&&w.tile.dem){const A=l.transformMat4$1([],[h/_*l.EXTENT,p/_*l.EXTENT],w.u_terrain_matrix),I=[A[0]*w.tile.dem.dim,A[1]*w.tile.dem.dim],M=[Math.floor(I[0]),Math.floor(I[1])],z=w.tile.dem.get(M[0],M[1]),B=w.tile.dem.get(M[0],M[1]+1),V=w.tile.dem.get(M[0]+1,M[1]),ne=w.tile.dem.get(M[0]+1,M[1]+1);v=l.number(l.number(z,B,I[0]-M[0]),l.number(V,ne,I[0]-M[0]),I[1]-M[1])}return v}rememberForRerender(s,h){for(const p in this.sourceCache._tiles){const _=this.sourceCache._tiles[p];(_.tileID.equals(h)||_.tileID.isChildOf(h))&&(s===this.sourceCache.sourceCache.id&&(_.timeLoaded=Date.now()),this._rerender[s]=this._rerender[s]||{},this._rerender[s][_.tileID.key]=!0)}}needsRerender(s,h){return this._rerender[s]&&this._rerender[s][h.key]}clearRerenderCache(){this._rerender={}}getElevation(s,h,p,_=l.EXTENT){return(this.getDEMElevation(s,h,p,_)+this.elevationOffset)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const _=this.style.map.painter.context,v=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ie(_,v,_.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ie(_,new l.RGBAImage({width:1,height:1}),_.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const _=this.style.map.painter.context;h.demTexture=this.style.map.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ie(_,h.dem.getPixels(),_.gl.RGBA,{premultiply:!1}),h.demTexture.bind(_.gl.NEAREST,_.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const _=this.sourceCache.sourceCache._source.maxzoom;let v=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=_?v=s.canonical.z-_:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const w=s.canonical.x-(s.canonical.x>>v<<v),A=s.canonical.y-(s.canonical.y>>v<<v),I=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<v),1/(l.EXTENT<<v),0]);l.translate(I,I,[w*l.EXTENT,A*l.EXTENT,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getRTTFramebuffer(){const s=this.style.map.painter;if(!this._rttFramebuffer){const h=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=s.context.createFramebuffer(h,h,!0),this._rttFramebuffer.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,h,h))}return this._rttFramebuffer}getFramebuffer(s){const h=this.style.map.painter,p=h.width/devicePixelRatio,_=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===_||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ie(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ie(h.context,{width:p,height:_,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,_,!0),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,_))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,w=0;v<this._coordsTextureSize;v++)for(let A=0;A<this._coordsTextureSize;A++,w+=4)h[w+0]=255&A,h[w+1]=255&v,h[w+2]=A>>8<<4|v>>8,h[w+3]=0;const p=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),_=new ie(s,p,s.gl.RGBA,{premultiply:!1});return _.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=_,_}pointCoordinate(s){const h=new Uint8Array(4),p=this.style.map.painter,_=p.context,v=_.gl;_.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(s.x,p.height/devicePixelRatio-s.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),_.bindFramebuffer.set(null);const w=h[0]+(h[2]>>4<<8),A=h[1]+((15&h[2])<<8),I=this.coordsIndex[255-h[3]],M=I&&this.sourceCache.getTileByID(I);if(!M)return null;const z=this._coordsTextureSize,B=(1<<M.tileID.canonical.z)*z;return new l.MercatorCoordinate((M.tileID.canonical.x*z+w)/B,(M.tileID.canonical.y*z+A)/B,this.getElevation(M.tileID,w,A,z))}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.style.map.painter.context,h=new l.PosArray,p=new l.TriangleIndexArray,_=this.meshSize,v=l.EXTENT/_,w=_*_;for(let A=0;A<=_;A++)for(let I=0;I<=_;I++)h.emplaceBack(I*v,A*v);for(let A=0;A<w;A+=_+1)for(let I=0;I<_;I++)p.emplaceBack(I+A,_+I+A+1,_+I+A+2),p.emplaceBack(I+A,_+I+A+2,I+A+1);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(h,Mt.members),segments:l.SegmentVector.simpleSegment(0,0,h.length,p.length)},this._mesh}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=(h.dem.min+this.elevationOffset)*this.exaggeration,p.maxElevation=(h.dem.max+this.elevationOffset)*this.exaggeration),p}}const zt=(m,s)=>l.emitValidationErrors(m,s&&s.filter(h=>h.identifier!=="source.canvas")),Nt=l.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),un=l.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),hn=function(){const m={},s=l.spec.$version;for(const h in l.spec.$root){const p=l.spec.$root[h];if(p.required){let _=null;_=h==="version"?s:p.type==="array"?[]:{},_!=null&&(m[h]=_)}}return m}();class Yn extends l.Evented{constructor(s,h={}){super(),this.map=s,this.dispatcher=new Xe(di(),this),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new we(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new st(256,512),this.crossTileSymbolIndex=new ht,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const p=this;this._rtlTextPluginCallback=Yn.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,w)=>{if(l.triggerPluginCompletionEvent(v),w&&w.every(A=>A))for(const A in p.sourceCaches)p.sourceCaches[A].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.sourceCaches[_.sourceId];if(!v)return;const w=v.getSource();if(w&&w.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===w.id&&this._validateLayer(I)}})}loadURL(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"}));const p=typeof h.validate!="boolean"||h.validate,_=this.map._requestManager.transformRequest(s,l.ResourceType.Style);this._request=l.getJSON(_,(v,w)=>{this._request=null,v?this.fire(new l.ErrorEvent(v)):w&&this._load(w,p)})}loadJSON(s,h={}){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.exported.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(hn,!1)}_load(s,h){if(h&&zt(this,l.validateStyle(s)))return;this._loaded=!0,this.stylesheet=s;for(const _ in s.sources)this.addSource(_,s.sources[_],{validate:!1});s.sprite?this._loadSprite(s.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(s.glyphs);const p=Vs(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=l.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ue(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}_loadSprite(s){this._spriteRequest=function(h,p,_,v){let w,A,I;const M=_>1?"@2x":"";let z=l.getJSON(p.transformRequest(p.normalizeSpriteURL(h,M,".json"),l.ResourceType.SpriteJSON),(ne,K)=>{z=null,I||(I=ne,w=K,V())}),B=l.getImage(p.transformRequest(p.normalizeSpriteURL(h,M,".png"),l.ResourceType.SpriteImage),(ne,K)=>{B=null,I||(I=ne,A=K,V())});function V(){if(I)v(I);else if(w&&A){const ne=l.exported.getImageData(A),K={};for(const ee in w){const{width:he,height:pe,x:ve,y:re,sdf:Ee,pixelRatio:xe,stretchX:ke,stretchY:Le,content:Fe}=w[ee],Pe=new l.RGBAImage({width:he,height:pe});l.RGBAImage.copy(ne,Pe,{x:ve,y:re},{x:0,y:0},{width:he,height:pe}),K[ee]={data:Pe,pixelRatio:xe,sdf:Ee,stretchX:ke,stretchY:Le,content:Fe}}v(null,K)}}return{cancel(){z&&(z.cancel(),z=null),B&&(B.cancel(),B=null)}}}(s,this.map._requestManager,this.map.getPixelRatio(),(h,p)=>{if(this._spriteRequest=null,h)this.fire(new l.ErrorEvent(h));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))})}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const p=s.sourceLayer;if(!p)return;const _=h.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${_.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const h=[];for(const p of s){const _=this._layers[p];_.type!=="custom"&&h.push(_.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(_.length||v.length)&&this._updateWorkerLayers(_,v);for(const w in this._updatedSources){const A=this._updatedSources[w];if(A==="reload")this._reloadSource(w);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(w)}}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const _ in this.sourceCaches){const v=this.sourceCaches[_];p[_]=v.used,v.used=!1}for(const _ of this._order){const v=this._layers[_];v.recalculate(s,this._availableImages),!v.isHidden(s.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const _ in p){const v=this.sourceCaches[_];p[_]!==v.used&&v.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(s),this.z=s.zoom,h&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(s){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),s){const h=this.sourceCaches[s.source];if(!h)throw new Error(`cannot load terrain, because there exists no source with ID: ${s.source}`);this.terrain=new Tt(this,h,s),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=p=>{p.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=p=>{p.tile&&(p.sourceId===s.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(p.sourceId,p.tile.tileID)):p.source.type==="geojson"&&this.terrain.rememberForRerender(p.sourceId,p.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new l.Event("terrain",{terrain:s}))}setState(s){if(this._checkLoaded(),zt(this,l.validateStyle(s)))return!1;(s=l.clone$1(s)).layers=Vs(s.layers);const h=function(_,v){if(!_)return[{command:Vt.setStyle,args:[v]}];let w=[];try{if(!L(_.version,v.version))return[{command:Vt.setStyle,args:[v]}];L(_.center,v.center)||w.push({command:Vt.setCenter,args:[v.center]}),L(_.zoom,v.zoom)||w.push({command:Vt.setZoom,args:[v.zoom]}),L(_.bearing,v.bearing)||w.push({command:Vt.setBearing,args:[v.bearing]}),L(_.pitch,v.pitch)||w.push({command:Vt.setPitch,args:[v.pitch]}),L(_.sprite,v.sprite)||w.push({command:Vt.setSprite,args:[v.sprite]}),L(_.glyphs,v.glyphs)||w.push({command:Vt.setGlyphs,args:[v.glyphs]}),L(_.transition,v.transition)||w.push({command:Vt.setTransition,args:[v.transition]}),L(_.light,v.light)||w.push({command:Vt.setLight,args:[v.light]});const A={},I=[];(function(z,B,V,ne){let K;for(K in B=B||{},z=z||{})Object.prototype.hasOwnProperty.call(z,K)&&(Object.prototype.hasOwnProperty.call(B,K)||On(K,V,ne));for(K in B)Object.prototype.hasOwnProperty.call(B,K)&&(Object.prototype.hasOwnProperty.call(z,K)?L(z[K],B[K])||(z[K].type==="geojson"&&B[K].type==="geojson"&&po(z,B,K)?V.push({command:Vt.setGeoJSONSourceData,args:[K,B[K].data]}):rs(K,B,V,ne)):Mi(K,B,V))})(_.sources,v.sources,I,A);const M=[];_.layers&&_.layers.forEach(z=>{A[z.source]?w.push({command:Vt.removeLayer,args:[z.id]}):M.push(z)}),w=w.concat(I),function(z,B,V){B=B||[];const ne=(z=z||[]).map(Dr),K=B.map(Dr),ee=z.reduce(js,{}),he=B.reduce(js,{}),pe=ne.slice(),ve=Object.create(null);let re,Ee,xe,ke,Le,Fe,Pe;for(re=0,Ee=0;re<ne.length;re++)xe=ne[re],Object.prototype.hasOwnProperty.call(he,xe)?Ee++:(V.push({command:Vt.removeLayer,args:[xe]}),pe.splice(pe.indexOf(xe,Ee),1));for(re=0,Ee=0;re<K.length;re++)xe=K[K.length-1-re],pe[pe.length-1-re]!==xe&&(Object.prototype.hasOwnProperty.call(ee,xe)?(V.push({command:Vt.removeLayer,args:[xe]}),pe.splice(pe.lastIndexOf(xe,pe.length-Ee),1)):Ee++,Fe=pe[pe.length-re],V.push({command:Vt.addLayer,args:[he[xe],Fe]}),pe.splice(pe.length-re,0,xe),ve[xe]=!0);for(re=0;re<K.length;re++)if(xe=K[re],ke=ee[xe],Le=he[xe],!ve[xe]&&!L(ke,Le))if(L(ke.source,Le.source)&&L(ke["source-layer"],Le["source-layer"])&&L(ke.type,Le.type)){for(Pe in Rr(ke.layout,Le.layout,V,xe,null,Vt.setLayoutProperty),Rr(ke.paint,Le.paint,V,xe,null,Vt.setPaintProperty),L(ke.filter,Le.filter)||V.push({command:Vt.setFilter,args:[xe,Le.filter]}),L(ke.minzoom,Le.minzoom)&&L(ke.maxzoom,Le.maxzoom)||V.push({command:Vt.setLayerZoomRange,args:[xe,Le.minzoom,Le.maxzoom]}),ke)Object.prototype.hasOwnProperty.call(ke,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Rr(ke[Pe],Le[Pe],V,xe,Pe.slice(6),Vt.setPaintProperty):L(ke[Pe],Le[Pe])||V.push({command:Vt.setLayerProperty,args:[xe,Pe,Le[Pe]]}));for(Pe in Le)Object.prototype.hasOwnProperty.call(Le,Pe)&&!Object.prototype.hasOwnProperty.call(ke,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?Rr(ke[Pe],Le[Pe],V,xe,Pe.slice(6),Vt.setPaintProperty):L(ke[Pe],Le[Pe])||V.push({command:Vt.setLayerProperty,args:[xe,Pe,Le[Pe]]}))}else V.push({command:Vt.removeLayer,args:[xe]}),Fe=pe[pe.lastIndexOf(xe)+1],V.push({command:Vt.addLayer,args:[Le,Fe]})}(M,v.layers,w)}catch(A){console.warn("Unable to compute style diff:",A),w=[{command:Vt.setStyle,args:[v]}]}return w}(this.serialize(),s).filter(_=>!(_.command in un));if(h.length===0)return!1;const p=h.filter(_=>!(_.command in Nt));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return h.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=s,!0}addImage(s,h){if(this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.ErrorEvent(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(l.validateStyle.source,`sources.${s}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const _=this.sourceCaches[s]=new Wt(s,h,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:s})),_.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new l.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,p={}){this._checkLoaded();const _=s.id;if(this.getLayer(_))return void this.fire(new l.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let v;if(s.type==="custom"){if(zt(this,l.validateCustomStyleLayer(s)))return;v=l.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(_,s.source),s=l.clone$1(s),s=l.extend(s,{source:_})),this._validate(l.validateStyle.layer,`layers.${_}`,s,{arrayIndex:-1},p))return;v=l.createStyleLayer(s),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}const w=h?this._order.indexOf(h):this._order.length;if(h&&w===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${h}".`)));else{if(this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=v,this._removedLayers[_]&&v.source&&v.type!=="custom"){const A=this._removedLayers[_];delete this._removedLayers[_],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const p=this._order.indexOf(s);this._order.splice(p,1);const _=h?this._order.indexOf(h):this._order.length;h&&_===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(_,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,p){this._checkLoaded();const _=this.getLayer(s);_?_.minzoom===h&&_.maxzoom===p||(h!=null&&(_.minzoom=h),p!=null&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,p={}){this._checkLoaded();const _=this.getLayer(s);if(_){if(!L(_.filter,h))return h==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(l.validateStyle.filter,`layers.${_.id}.filter`,h,null,p)||(_.filter=l.clone$1(h),this._updateLayer(_)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.clone$1(this.getLayer(s).filter)}setLayoutProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?L(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,_),this._updateLayer(v)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const p=this.getLayer(s);if(p)return p.getLayoutProperty(h);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,p,_={}){this._checkLoaded();const v=this.getLayer(s);v?L(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,_)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const p=s.source,_=s.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=v.getSource().type;w==="geojson"&&_?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):w!=="vector"||_?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),v.setFeatureState(_,s.id,h)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const p=s.source,_=this.sourceCaches[p];if(_===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const v=_.getSource().type,w=v==="vector"?s.sourceLayer:void 0;v!=="vector"||w?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(w,s.id,h):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,p=s.sourceLayer,_=this.sourceCaches[h];if(_!==void 0)return _.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(p,s.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return l.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:l.mapObject(this.sourceCaches,s=>s.serialize()),layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=w=>this._layers[w].type==="fill-extrusion",p={},_=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(h(A)){p[A]=w;for(const I of s){const M=I[A];if(M)for(const z of M)_.push(z)}}}_.sort((w,A)=>A.intersectionZ-w.intersectionZ);const v=[];for(let w=this._order.length-1;w>=0;w--){const A=this._order[w];if(h(A))for(let I=_.length-1;I>=0;I--){const M=_[I].feature;if(p[M.layer.id]<w)break;v.push(M),_.pop()}else for(const I of s){const M=I[A];if(M)for(const z of M)v.push(z.feature)}}return v}queryRenderedFeatures(s,h,p){h&&h.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const _={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of h.layers){const A=this._layers[w];if(!A)return this.fire(new l.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];_[A.source]=!0}}const v=[];h.availableImages=this._availableImages;for(const w in this.sourceCaches)h.layers&&!_[w]||v.push(ni(this.sourceCaches[w],this._layers,this._serializedLayers,s,h,p));return this.placement&&v.push(function(w,A,I,M,z,B,V){const ne={},K=B.queryRenderedSymbols(M),ee=[];for(const he of Object.keys(K).map(Number))ee.push(V[he]);ee.sort(xi);for(const he of ee){const pe=he.featureIndex.lookupSymbolFeatures(K[he.bucketInstanceId],A,he.bucketIndex,he.sourceLayerIndex,z.filter,z.layers,z.availableImages,w);for(const ve in pe){const re=ne[ve]=ne[ve]||[],Ee=pe[ve];Ee.sort((xe,ke)=>{const Le=he.featureSortOrder;if(Le){const Fe=Le.indexOf(xe.featureIndex);return Le.indexOf(ke.featureIndex)-Fe}return ke.featureIndex-xe.featureIndex});for(const xe of Ee)re.push(xe)}}for(const he in ne)ne[he].forEach(pe=>{const ve=pe.feature,re=I[w[he].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=re});return ne}(this._layers,this._serializedLayers,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,h){h&&h.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[s];return p?function(_,v){const w=_.getRenderableIds().map(M=>_.getTileByID(M)),A=[],I={};for(let M=0;M<w.length;M++){const z=w[M],B=z.tileID.canonical.key;I[B]||(I[B]=!0,z.querySourceFeatures(A,v))}return A}(p,h):[]}addSourceType(s,h,p){return Yn.getSourceType(s)?p(new Error(`A source type called "${s}" already exists.`)):(Yn.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const w in s)if(!L(s[w],p[w])){_=!0;break}if(!_)return;const v={now:l.exported.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(v)}_validate(s,h,p,_,v={}){return(!v||v.validate!==!1)&&zt(this,s.call(l.validateStyle,l.extend({key:h,style:this.serialize(),value:p,styleSpec:l.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const h=this.sourceCaches[s];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,p,_,v=!1){let w=!1,A=!1;const I={};for(const M of this._order){const z=this._layers[M];if(z.type!=="symbol")continue;if(!I[z.source]){const V=this.sourceCaches[z.source];I[z.source]=V.getRenderableIds(!0).map(ne=>V.getTileByID(ne)).sort((ne,K)=>K.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(K.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(z,I[z.source],s.center.lng);w=w||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.exported.now(),s.zoom))&&(this.pauseablePlacement=new Ae(s,this.terrain,this._order,v,h,p,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.exported.now()),A=!0),w&&this.pauseablePlacement.placement.setStale()),A||w)for(const M of this._order){const z=this._layers[M];z.type==="symbol"&&this.placement.updateLayerOpacities(z,I[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.exported.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h,p){this.imageManager.getImages(h.icons,p),this._updateTilesForChangedImages();const _=this.sourceCaches[h.source];_&&_.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(s,h,p){this.glyphManager.getGlyphs(h.stacks,p)}getResource(s,h,p){return l.makeRequest(h,p)}}Yn.getSourceType=function(m){return nn[m]},Yn.setSourceType=function(m,s){nn[m]=s},Yn.registerForPluginStateChange=l.registerForPluginStateChange;var Or="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const fi={prelude:qt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:qt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:qt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:qt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:qt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:qt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:qt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:qt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:qt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:qt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:qt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:qt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:qt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:qt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:qt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:qt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:qt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:qt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:qt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:qt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:qt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:qt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Or),terrainDepth:qt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Or),terrainCoords:qt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Or)};function qt(m,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v?v.concat(_):_,A={};return{fragmentSource:m=m.replace(h,(I,M,z,B,V)=>(A[V]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
varying ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:`
#ifdef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = u_${V};
#endif
`)),vertexSource:s=s.replace(h,(I,M,z,B,V)=>{const ne=B==="float"?"vec2":"vec4",K=V.match(/color/)?"color":ne;return A[V]?M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${ne} a_${V};
varying ${z} ${B} ${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${K}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
attribute ${z} ${ne} a_${V};
#else
uniform ${z} ${B} u_${V};
#endif
`:K==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = a_${V};
#else
    ${z} ${B} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${z} ${B} ${V} = unpack_mix_${K}(a_${V}, u_${V}_t);
#else
    ${z} ${B} ${V} = u_${V};
#endif
`}),staticAttributes:p,staticUniforms:w}}class mo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,p,_,v,w,A,I,M){this.context=s;let z=this.boundPaintVertexBuffers.length!==_.length;for(let B=0;!z&&B<_.length;B++)this.boundPaintVertexBuffers[B]!==_[B]&&(z=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===p&&!z&&this.boundIndexBuffer===v&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===I&&this.boundDynamicVertexBuffer3===M?(s.bindVertexArrayOES.set(this.vao),A&&A.bind(),v&&v.dynamicDraw&&v.bind(),I&&I.bind(),M&&M.bind()):this.freshBind(h,p,_,v,w,A,I,M)}freshBind(s,h,p,_,v,w,A,I){let M;const z=s.numAttributes,B=this.context,V=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=I;else{M=B.currentNumAttributes||0;for(let ne=z;ne<M;ne++)V.disableVertexAttribArray(ne)}h.enableAttributes(V,s);for(const ne of p)ne.enableAttributes(V,s);w&&w.enableAttributes(V,s),A&&A.enableAttributes(V,s),I&&I.enableAttributes(V,s),h.bind(),h.setVertexAttribPointers(V,s,v);for(const ne of p)ne.bind(),ne.setVertexAttribPointers(V,s,v);w&&(w.bind(),w.setVertexAttribPointers(V,s,v)),_&&_.bind(),A&&(A.bind(),A.setVertexAttribPointers(V,s,v)),I&&(I.bind(),I.setVertexAttribPointers(V,s,v)),B.currentNumAttributes=z}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function go(m){const s=[];for(let h=0;h<m.length;h++){if(m[h]===null)continue;const p=m[h].split(" ");s.push(p.pop())}return s}class qo{constructor(s,h,p,_,v,w,A){const I=s.gl;this.program=I.createProgram();const M=go(p.staticAttributes),z=_?_.getBinderAttributes():[],B=M.concat(z),V=fi.prelude.staticUniforms?go(fi.prelude.staticUniforms):[],ne=p.staticUniforms?go(p.staticUniforms):[],K=_?_.getBinderUniforms():[],ee=V.concat(ne).concat(K),he=[];for(const Le of ee)he.indexOf(Le)<0&&he.push(Le);const pe=_?_.defines():[];w&&pe.push("#define OVERDRAW_INSPECTOR;"),A&&pe.push("#define TERRAIN3D;");const ve=pe.concat(fi.prelude.fragmentSource,p.fragmentSource).join(`
`),re=pe.concat(fi.prelude.vertexSource,p.vertexSource).join(`
`),Ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Ee,ve),I.compileShader(Ee),I.attachShader(this.program,Ee);const xe=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(xe,re),I.compileShader(xe),I.attachShader(this.program,xe),this.attributes={};const ke={};this.numAttributes=B.length;for(let Le=0;Le<this.numAttributes;Le++)B[Le]&&(I.bindAttribLocation(this.program,Le,B[Le]),this.attributes[B[Le]]=Le);I.linkProgram(this.program),I.deleteShader(xe),I.deleteShader(Ee);for(let Le=0;Le<he.length;Le++){const Fe=he[Le];if(Fe&&!ke[Fe]){const Pe=I.getUniformLocation(this.program,Fe);Pe&&(ke[Fe]=Pe)}}this.fixedUniforms=v(s,ke),this.terrainUniforms=((Le,Fe)=>({u_depth:new l.Uniform1i(Le,Fe.u_depth),u_terrain:new l.Uniform1i(Le,Fe.u_terrain),u_terrain_dim:new l.Uniform1f(Le,Fe.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(Le,Fe.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(Le,Fe.u_terrain_unpack),u_terrain_offset:new l.Uniform1f(Le,Fe.u_terrain_offset),u_terrain_exaggeration:new l.Uniform1f(Le,Fe.u_terrain_exaggeration)}))(s,ke),this.binderUniforms=_?_.getUniforms(s,ke):[]}draw(s,h,p,_,v,w,A,I,M,z,B,V,ne,K,ee,he,pe,ve){const re=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(_),s.setColorMode(v),s.setCullFace(w),I){s.activeTexture.set(re.TEXTURE2),re.bindTexture(re.TEXTURE_2D,I.depthTexture),s.activeTexture.set(re.TEXTURE3),re.bindTexture(re.TEXTURE_2D,I.texture);for(const xe in this.terrainUniforms)this.terrainUniforms[xe].set(I[xe])}for(const xe in this.fixedUniforms)this.fixedUniforms[xe].set(A[xe]);ee&&ee.setUniforms(s,this.binderUniforms,ne,{zoom:K});let Ee=0;switch(h){case re.LINES:Ee=2;break;case re.TRIANGLES:Ee=3;break;case re.LINE_STRIP:Ee=1}for(const xe of V.get()){const ke=xe.vaos||(xe.vaos={});(ke[M]||(ke[M]=new mo)).bind(s,this,z,ee?ee.getPaintVertexBuffers():[],B,xe.vertexOffset,he,pe,ve),re.drawElements(h,xe.primitiveLength*Ee,re.UNSIGNED_SHORT,xe.primitiveOffset*Ee*2)}}}function Xo(m,s,h){const p=1/Mn(h,1,s.transform.tileZoom),_=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,s.transform.tileZoom)/_,w=v*(h.tileID.canonical.x+h.tileID.wrap*_),A=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A]}}const Ws=(m,s,h,p)=>{const _=s.style.light,v=_.properties.get("position"),w=[v.x,v.y,v.z],A=l.create$1();_.properties.get("anchor")==="viewport"&&l.fromRotation(A,-s.transform.angle),l.transformMat3(w,w,A);const I=_.properties.get("color");return{u_matrix:m,u_lightpos:w,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+h,u_opacity:p}},Fr=(m,s,h,p,_,v,w)=>l.extend(Ws(m,s,h,p),Xo(v,s,w),{u_height_factor:-Math.pow(2,_.overscaledZ)/w.tileSize/8}),Zo=m=>({u_matrix:m}),Yo=(m,s,h,p)=>l.extend(Zo(m),Xo(h,s,p)),Ko=(m,s)=>({u_matrix:m,u_world:s}),Ga=(m,s,h,p,_)=>l.extend(Yo(m,s,h,p),{u_world:_}),Vl=(m,s,h,p)=>{const _=m.transform;let v,w;if(p.paint.get("circle-pitch-alignment")==="map"){const A=Mn(h,1,_.zoom);v=!0,w=[A,A]}else v=!1,w=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(s.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w}},Ts=(m,s,h)=>{const p=Mn(h,1,s.zoom),_=Math.pow(2,s.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*_),s.pixelsToGLUnits[1]/(p*_)],u_overscale_factor:v}},j=(m,s,h=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:h}),Z=m=>({u_matrix:m}),ce=(m,s,h,p)=>({u_matrix:m,u_extrude_scale:Mn(s,1,h),u_intensity:p});function Se(m,s){const h=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new l.MercatorCoordinate(0,p/h).toLngLat().lat,new l.MercatorCoordinate(0,(p+1)/h).toLngLat().lat]}const Be=(m,s,h,p)=>{const _=m.transform;return{u_matrix:Fn(m,s,h,p),u_ratio:1/Mn(s,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},ot=(m,s,h,p,_)=>l.extend(Be(m,s,h,_),{u_image:0,u_image_height:p}),Ot=(m,s,h,p,_)=>{const v=m.transform,w=kt(s,v);return{u_matrix:Fn(m,s,h,_),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Mn(s,1,v.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},En=(m,s,h,p,_,v)=>{const w=m.lineAtlas,A=kt(s,m.transform),I=h.layout.get("line-cap")==="round",M=w.getDash(p.from,I),z=w.getDash(p.to,I),B=M.width*_.fromScale,V=z.width*_.toScale;return l.extend(Be(m,s,h,v),{u_patternscale_a:[A/B,-M.height/2],u_patternscale_b:[A/V,-z.height/2],u_sdfgamma:w.width/(256*Math.min(B,V)*m.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:z.y,u_mix:_.t})};function kt(m,s){return 1/Mn(m,1,s.tileZoom)}function Fn(m,s,h,p){return m.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const rr=(m,s,h,p,_)=>{return{u_matrix:m,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(w=_.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(v=_.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ed(_.paint.get("raster-hue-rotate"))};var v,w};function Ed(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const fu=(m,s,h,p,_,v,w,A,I,M)=>{const z=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:z.width/z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:w,u_coord_matrix:A,u_is_text:+I,u_pitch_with_map:+p,u_texsize:M,u_texture:0}},jl=(m,s,h,p,_,v,w,A,I,M,z)=>{const B=_.transform;return l.extend(fu(m,s,h,p,_,v,w,A,I,M),{u_gamma_scale:p?Math.cos(B._pitch)*B.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+z})},Td=(m,s,h,p,_,v,w,A,I,M)=>l.extend(jl(m,s,h,p,_,v,w,A,!0,I,!0),{u_texsize_icon:M,u_texture_icon:1}),zm=(m,s,h)=>({u_matrix:m,u_opacity:s,u_color:h}),Om=(m,s,h,p,_,v)=>l.extend(function(w,A,I,M){const z=I.imageManager.getPattern(w.from.toString()),B=I.imageManager.getPattern(w.to.toString()),{width:V,height:ne}=I.imageManager.getPixelSize(),K=Math.pow(2,M.tileID.overscaledZ),ee=M.tileSize*Math.pow(2,I.transform.tileZoom)/K,he=ee*(M.tileID.canonical.x+M.tileID.wrap*K),pe=ee*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[V,ne],u_mix:A.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/Mn(M,1,I.transform.tileZoom),u_pixel_coord_upper:[he>>16,pe>>16],u_pixel_coord_lower:[65535&he,65535&pe]}}(p,v,h,_),{u_matrix:m,u_opacity:s}),pu={fillExtrusion:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fillExtrusionPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_lightpos:new l.Uniform3f(m,s.u_lightpos),u_lightintensity:new l.Uniform1f(m,s.u_lightintensity),u_lightcolor:new l.Uniform3f(m,s.u_lightcolor),u_vertical_gradient:new l.Uniform1f(m,s.u_vertical_gradient),u_height_factor:new l.Uniform1f(m,s.u_height_factor),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade),u_opacity:new l.Uniform1f(m,s.u_opacity)}),fill:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),fillPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),fillOutline:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world)}),fillOutlinePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_texsize:new l.Uniform2f(m,s.u_texsize),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),circle:(m,s)=>({u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(m,s.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),collisionBox:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(m,s.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(m,s.u_extrude_scale),u_overscale_factor:new l.Uniform1f(m,s.u_overscale_factor)}),collisionCircle:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_inv_matrix:new l.UniformMatrix4f(m,s.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(m,s.u_viewport_size)}),debug:(m,s)=>({u_color:new l.UniformColor(m,s.u_color),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_overlay:new l.Uniform1i(m,s.u_overlay),u_overlay_scale:new l.Uniform1f(m,s.u_overlay_scale)}),clippingMask:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmap:(m,s)=>({u_extrude_scale:new l.Uniform1f(m,s.u_extrude_scale),u_intensity:new l.Uniform1f(m,s.u_intensity),u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),heatmapTexture:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_world:new l.Uniform2f(m,s.u_world),u_image:new l.Uniform1i(m,s.u_image),u_color_ramp:new l.Uniform1i(m,s.u_color_ramp),u_opacity:new l.Uniform1f(m,s.u_opacity)}),hillshade:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_latrange:new l.Uniform2f(m,s.u_latrange),u_light:new l.Uniform2f(m,s.u_light),u_shadow:new l.UniformColor(m,s.u_shadow),u_highlight:new l.UniformColor(m,s.u_highlight),u_accent:new l.UniformColor(m,s.u_accent)}),hillshadePrepare:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_image:new l.Uniform1i(m,s.u_image),u_dimension:new l.Uniform2f(m,s.u_dimension),u_zoom:new l.Uniform1f(m,s.u_zoom),u_unpack:new l.Uniform4f(m,s.u_unpack)}),line:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels)}),lineGradient:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_image:new l.Uniform1i(m,s.u_image),u_image_height:new l.Uniform1f(m,s.u_image_height)}),linePattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texsize:new l.Uniform2f(m,s.u_texsize),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_image:new l.Uniform1i(m,s.u_image),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_scale:new l.Uniform3f(m,s.u_scale),u_fade:new l.Uniform1f(m,s.u_fade)}),lineSDF:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_ratio:new l.Uniform1f(m,s.u_ratio),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(m,s.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(m,s.u_patternscale_a),u_patternscale_b:new l.Uniform2f(m,s.u_patternscale_b),u_sdfgamma:new l.Uniform1f(m,s.u_sdfgamma),u_image:new l.Uniform1i(m,s.u_image),u_tex_y_a:new l.Uniform1f(m,s.u_tex_y_a),u_tex_y_b:new l.Uniform1f(m,s.u_tex_y_b),u_mix:new l.Uniform1f(m,s.u_mix)}),raster:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_tl_parent:new l.Uniform2f(m,s.u_tl_parent),u_scale_parent:new l.Uniform1f(m,s.u_scale_parent),u_buffer_scale:new l.Uniform1f(m,s.u_buffer_scale),u_fade_t:new l.Uniform1f(m,s.u_fade_t),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image0:new l.Uniform1i(m,s.u_image0),u_image1:new l.Uniform1i(m,s.u_image1),u_brightness_low:new l.Uniform1f(m,s.u_brightness_low),u_brightness_high:new l.Uniform1f(m,s.u_brightness_high),u_saturation_factor:new l.Uniform1f(m,s.u_saturation_factor),u_contrast_factor:new l.Uniform1f(m,s.u_contrast_factor),u_spin_weights:new l.Uniform3f(m,s.u_spin_weights)}),symbolIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture)}),symbolSDF:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texture:new l.Uniform1i(m,s.u_texture),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),symbolTextAndIcon:(m,s)=>({u_is_size_zoom_constant:new l.Uniform1i(m,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(m,s.u_is_size_feature_constant),u_size_t:new l.Uniform1f(m,s.u_size_t),u_size:new l.Uniform1f(m,s.u_size),u_camera_to_center_distance:new l.Uniform1f(m,s.u_camera_to_center_distance),u_pitch:new l.Uniform1f(m,s.u_pitch),u_rotate_symbol:new l.Uniform1i(m,s.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(m,s.u_aspect_ratio),u_fade_change:new l.Uniform1f(m,s.u_fade_change),u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(m,s.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(m,s.u_coord_matrix),u_is_text:new l.Uniform1i(m,s.u_is_text),u_pitch_with_map:new l.Uniform1i(m,s.u_pitch_with_map),u_texsize:new l.Uniform2f(m,s.u_texsize),u_texsize_icon:new l.Uniform2f(m,s.u_texsize_icon),u_texture:new l.Uniform1i(m,s.u_texture),u_texture_icon:new l.Uniform1i(m,s.u_texture_icon),u_gamma_scale:new l.Uniform1f(m,s.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(m,s.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(m,s.u_is_halo)}),background:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_color:new l.UniformColor(m,s.u_color)}),backgroundPattern:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_opacity:new l.Uniform1f(m,s.u_opacity),u_image:new l.Uniform1i(m,s.u_image),u_pattern_tl_a:new l.Uniform2f(m,s.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(m,s.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(m,s.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(m,s.u_pattern_br_b),u_texsize:new l.Uniform2f(m,s.u_texsize),u_mix:new l.Uniform1f(m,s.u_mix),u_pattern_size_a:new l.Uniform2f(m,s.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(m,s.u_pattern_size_b),u_scale_a:new l.Uniform1f(m,s.u_scale_a),u_scale_b:new l.Uniform1f(m,s.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(m,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(m,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(m,s.u_tile_units_to_pixels)}),terrain:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture)}),terrainDepth:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix)}),terrainCoords:(m,s)=>({u_matrix:new l.UniformMatrix4f(m,s.u_matrix),u_texture:new l.Uniform1i(m,s.u_texture),u_terrain_coords_id:new l.Uniform1f(m,s.u_terrain_coords_id)})};class mu{constructor(s,h,p){this.context=s;const _=s.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _u{constructor(s,h,p,_){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=_,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),s.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let p=0;p<this.attributes.length;p++){const _=h.attributes[this.attributes[p].name];_!==void 0&&s.enableVertexAttribArray(_)}}setVertexAttribPointers(s,h,p){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],w=h.attributes[v.name];w!==void 0&&s.vertexAttribPointer(w,v.components,s[gu[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Yt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Sd extends Yt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Fm extends Yt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Ha extends Yt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class $a extends Yt{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ad extends Yt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class sr extends Yt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class yu extends Yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Gl extends Yt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Hl extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class vu extends Yt{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class xu extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class $l extends Yt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class bu extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class wu extends Yt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Wl extends Yt{getDefault(){return l.Color.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Id extends Yt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Pd extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Jo extends Yt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Bm extends Yt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Nm extends Yt{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Um extends Yt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Vm extends Yt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class jm extends Yt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Gm extends Yt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Eu extends Yt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class ql extends Yt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Tu extends Yt{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Su extends Yt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class Qo extends Yt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Cd extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class Md extends Yt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Xl extends Yt{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class _o extends Xl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class kd extends Xl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ea{constructor(s,h,p,_){this.context=s,this.width=h,this.height=p;const v=s.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new _o(s,w),_&&(this.depthAttachment=new kd(s,w)),v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class gn{constructor(s,h,p){this.blendFunction=s,this.blendColor=h,this.mask=p}}gn.Replace=[1,0],gn.disabled=new gn(gn.Replace,l.Color.transparent,[!1,!1,!1,!1]),gn.unblended=new gn(gn.Replace,l.Color.transparent,[!0,!0,!0,!0]),gn.alphaBlended=new gn([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Ld{constructor(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Sd(this),this.clearDepth=new Fm(this),this.clearStencil=new Ha(this),this.colorMask=new $a(this),this.depthMask=new Ad(this),this.stencilMask=new sr(this),this.stencilFunc=new yu(this),this.stencilOp=new Gl(this),this.stencilTest=new Hl(this),this.depthRange=new vu(this),this.depthTest=new xu(this),this.depthFunc=new $l(this),this.blend=new bu(this),this.blendFunc=new wu(this),this.blendColor=new Wl(this),this.blendEquation=new Id(this),this.cullFace=new Pd(this),this.cullFaceSide=new Jo(this),this.frontFace=new Bm(this),this.program=new Nm(this),this.activeTexture=new Um(this),this.viewport=new Vm(this),this.bindFramebuffer=new jm(this),this.bindRenderbuffer=new Gm(this),this.bindTexture=new Eu(this),this.bindVertexBuffer=new ql(this),this.bindElementBuffer=new Tu(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Su(this),this.pixelStoreUnpack=new Qo(this),this.pixelStoreUnpackPremultiplyAlpha=new Cd(this),this.pixelStoreUnpackFlipY=new Md(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new mu(this,s,h)}createVertexBuffer(s,h,p){return new _u(this,s,h,p)}createRenderbuffer(s,h,p){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,s,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(s,h,p){return new ea(this,s,h,p)}clear({color:s,depth:h}){const p=this.gl;let _=0;s&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p.clear(_)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){L(s.blendFunction,gn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class jt{constructor(s,h,p){this.func=s,this.mask=h,this.range=p}}jt.ReadOnly=!1,jt.ReadWrite=!0,jt.disabled=new jt(519,jt.ReadOnly,[0,1]);const Kt=7680;class dn{constructor(s,h,p,_,v,w){this.test=s,this.ref=h,this.mask=p,this.fail=_,this.depthFail=v,this.pass=w}}dn.disabled=new dn({func:519,mask:0},0,0,Kt,Kt,Kt);class yn{constructor(s,h,p){this.enable=s,this.mode=h,this.frontFace=p}}let Wa;function ta(m,s,h,p,_,v,w){const A=m.context,I=A.gl,M=m.useProgram("collisionBox"),z=[];let B=0,V=0;for(let re=0;re<p.length;re++){const Ee=p[re],xe=s.getTile(Ee),ke=xe.getBucket(h);if(!ke)continue;let Le=Ee.posMatrix;_[0]===0&&_[1]===0||(Le=m.translatePosMatrix(Ee.posMatrix,xe,_,v));const Fe=w?ke.textCollisionBox:ke.iconCollisionBox,Pe=ke.collisionCircleArray;if(Pe.length>0){const Qe=l.create(),$e=Le;l.mul(Qe,ke.placementInvProjMatrix,m.transform.glCoordMatrix),l.mul(Qe,Qe,ke.placementViewportMatrix),z.push({circleArray:Pe,circleOffset:V,transform:$e,invTransform:Qe,coord:Ee}),B+=Pe.length/4,V=B}Fe&&M.draw(A,I.LINES,jt.disabled,dn.disabled,m.colorModeForRenderPass(),yn.disabled,Ts(Le,m.transform,xe),m.style.terrain&&m.style.terrain.getTerrainData(Ee),h.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,m.transform.zoom,null,null,Fe.collisionVertexBuffer)}if(!w||!z.length)return;const ne=m.useProgram("collisionCircle"),K=new l.CollisionCircleLayoutArray;K.resize(4*B),K._trim();let ee=0;for(const re of z)for(let Ee=0;Ee<re.circleArray.length/4;Ee++){const xe=4*Ee,ke=re.circleArray[xe+0],Le=re.circleArray[xe+1],Fe=re.circleArray[xe+2],Pe=re.circleArray[xe+3];K.emplace(ee++,ke,Le,Fe,Pe,0),K.emplace(ee++,ke,Le,Fe,Pe,1),K.emplace(ee++,ke,Le,Fe,Pe,2),K.emplace(ee++,ke,Le,Fe,Pe,3)}(!Wa||Wa.length<2*B)&&(Wa=function(re){const Ee=2*re,xe=new l.QuadTriangleArray;xe.resize(Ee),xe._trim();for(let ke=0;ke<Ee;ke++){const Le=6*ke;xe.uint16[Le+0]=4*ke+0,xe.uint16[Le+1]=4*ke+1,xe.uint16[Le+2]=4*ke+2,xe.uint16[Le+3]=4*ke+2,xe.uint16[Le+4]=4*ke+3,xe.uint16[Le+5]=4*ke+0}return xe}(B));const he=A.createIndexBuffer(Wa,!0),pe=A.createVertexBuffer(K,l.collisionCircleLayout.members,!0);for(const re of z){const Ee={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ve=m.transform).cameraToCenterDistance,u_viewport_size:[ve.width,ve.height]};ne.draw(A,I.TRIANGLES,jt.disabled,dn.disabled,m.colorModeForRenderPass(),yn.disabled,Ee,m.style.terrain&&m.style.terrain.getTerrainData(re.coord),h.id,pe,he,l.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ve;pe.destroy(),he.destroy()}yn.disabled=new yn(!1,1029,2305),yn.backCCW=new yn(!0,1029,2305);const Hm=l.identity(new Float32Array(16));function $m(m,s,h,p,_,v){const{horizontalAlign:w,verticalAlign:A}=l.getAnchorAlignment(m),I=-(w-.5)*s,M=-(A-.5)*h,z=l.evaluateVariableOffset(m,p);return new l.pointGeometry((I/_+z[0])*v,(M/_+z[1])*v)}function Rd(m,s,h,p,_,v,w,A,I,M,z){const B=m.text.placedSymbolArray,V=m.text.dynamicLayoutVertexArray,ne=m.icon.dynamicLayoutVertexArray,K={};V.clear();for(let ee=0;ee<B.length;ee++){const he=B.get(ee),pe=m.allowVerticalPlacement&&!he.placedOrientation,ve=he.hidden||!he.crossTileID||pe?null:p[he.crossTileID];if(ve){const re=new l.pointGeometry(he.anchorX,he.anchorY),Ee=Bt(re,h?w:v,z),xe=Hi(_.cameraToCenterDistance,Ee.signedDistanceFromCamera);let ke=l.evaluateSizeForFeature(m.textSizeData,I,he)*xe/l.ONE_EM;h&&(ke*=m.tilePixelRatio/A);const{width:Le,height:Fe,anchor:Pe,textOffset:Qe,textBoxScale:$e}=ve,tt=$m(Pe,Le,Fe,Qe,$e,ke),Ct=h?Bt(re.add(tt),v,z).point:Ee.point.add(s?tt.rotate(-_.angle):tt),Lt=m.allowVerticalPlacement&&he.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let gt=0;gt<he.numGlyphs;gt++)l.addDynamicAttributes(V,Ct,Lt);M&&he.associatedIconIndex>=0&&(K[he.associatedIconIndex]={shiftedAnchor:Ct,angle:Lt})}else At(he.numGlyphs,V)}if(M){ne.clear();const ee=m.icon.placedSymbolArray;for(let he=0;he<ee.length;he++){const pe=ee.get(he);if(pe.hidden)At(pe.numGlyphs,ne);else{const ve=K[he];if(ve)for(let re=0;re<pe.numGlyphs;re++)l.addDynamicAttributes(ne,ve.shiftedAnchor,ve.angle);else At(pe.numGlyphs,ne)}}m.icon.dynamicLayoutVertexBuffer.updateData(ne)}m.text.dynamicLayoutVertexBuffer.updateData(V)}function Wm(m,s,h){return h.iconsInText&&s?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Zl(m,s,h,p,_,v,w,A,I,M,z,B){const V=m.context,ne=V.gl,K=m.transform,ee=A==="map",he=I==="map",pe=A!=="viewport"&&h.layout.get("symbol-placement")!=="point",ve=ee&&!he&&!pe,re=!h.layout.get("symbol-sort-key").isConstant();let Ee=!1;const xe=m.depthModeForSublayer(0,jt.ReadOnly),ke=h.layout.get("text-variable-anchor"),Le=[];for(const Fe of p){const Pe=s.getTile(Fe),Qe=Pe.getBucket(h);if(!Qe)continue;const $e=_?Qe.text:Qe.icon;if(!$e||!$e.segments.get().length)continue;const tt=$e.programConfigurations.get(h.id),Ct=_||Qe.sdfIcons,Lt=_?Qe.textSizeData:Qe.iconSizeData,gt=he||K.pitch!==0,rn=m.useProgram(Wm(Ct,_,Qe),tt),sn=l.evaluateSizeForZoom(Lt,K.zoom),Gt=m.style.terrain&&m.style.terrain.getTerrainData(Fe);let Ht,an,si,us,Nr=[0,0],hs=null;if(_){if(an=Pe.glyphAtlasTexture,si=ne.LINEAR,Ht=Pe.glyphAtlasTexture.size,Qe.iconsInText){Nr=Pe.imageAtlasTexture.size,hs=Pe.imageAtlasTexture;const Sr=Lt.kind==="composite"||Lt.kind==="camera";us=gt||m.options.rotating||m.options.zooming||Sr?ne.LINEAR:ne.NEAREST}}else{const Sr=h.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;an=Pe.imageAtlasTexture,si=Ct||m.options.rotating||m.options.zooming||Sr||gt?ne.LINEAR:ne.NEAREST,Ht=Pe.imageAtlasTexture.size}const Qs=Mn(Pe,1,m.transform.zoom),Tr=ss(Fe.posMatrix,he,ee,m.transform,Qs),Wi=wi(Fe.posMatrix,he,ee,m.transform,Qs),Is=ke&&Qe.hasTextData(),ic=h.layout.get("icon-text-fit")!=="none"&&Is&&Qe.hasIconData();if(pe){const Sr=m.style.terrain?(Uu,aa)=>m.style.terrain.getElevation(Fe,Uu,aa):null,bo=h.layout.get("text-rotation-alignment")==="map";Li(Qe,Fe.posMatrix,m,_,Tr,Wi,he,M,bo,Sr)}const Kn=m.translatePosMatrix(Fe.posMatrix,Pe,v,w),Ft=pe||_&&ke||ic?Hm:Tr,Qt=m.translatePosMatrix(Wi,Pe,v,w,!0),oi=Ct&&h.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ai;ai=Ct?Qe.iconsInText?Td(Lt.kind,sn,ve,he,m,Kn,Ft,Qt,Ht,Nr):jl(Lt.kind,sn,ve,he,m,Kn,Ft,Qt,_,Ht,!0):fu(Lt.kind,sn,ve,he,m,Kn,Ft,Qt,_,Ht);const xn={program:rn,buffers:$e,uniformValues:ai,atlasTexture:an,atlasTextureIcon:hs,atlasInterpolation:si,atlasInterpolationIcon:us,isSDF:Ct,hasHalo:oi};if(re&&Qe.canOverlap){Ee=!0;const Sr=$e.segments.get();for(const bo of Sr)Le.push({segments:new l.SegmentVector([bo]),sortKey:bo.sortKey,state:xn,terrainData:Gt})}else Le.push({segments:$e.segments,sortKey:0,state:xn,terrainData:Gt})}Ee&&Le.sort((Fe,Pe)=>Fe.sortKey-Pe.sortKey);for(const Fe of Le){const Pe=Fe.state;if(V.activeTexture.set(ne.TEXTURE0),Pe.atlasTexture.bind(Pe.atlasInterpolation,ne.CLAMP_TO_EDGE),Pe.atlasTextureIcon&&(V.activeTexture.set(ne.TEXTURE1),Pe.atlasTextureIcon&&Pe.atlasTextureIcon.bind(Pe.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),Pe.isSDF){const Qe=Pe.uniformValues;Pe.hasHalo&&(Qe.u_is_halo=1,qa(Pe.buffers,Fe.segments,h,m,Pe.program,xe,z,B,Qe,Fe.terrainData)),Qe.u_is_halo=0}qa(Pe.buffers,Fe.segments,h,m,Pe.program,xe,z,B,Pe.uniformValues,Fe.terrainData)}}function qa(m,s,h,p,_,v,w,A,I,M){const z=p.context;_.draw(z,z.gl.TRIANGLES,v,w,A,yn.disabled,I,M,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,p.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Xa(m,s,h,p,_,v,w){const A=m.context.gl,I=h.paint.get("fill-pattern"),M=I&&I.constantOr(1),z=h.getCrossfadeParameters();let B,V,ne,K,ee;w?(V=M&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=A.LINES):(V=M?"fillPattern":"fill",B=A.TRIANGLES);for(const he of p){const pe=s.getTile(he);if(M&&!pe.patternsLoaded())continue;const ve=pe.getBucket(h);if(!ve)continue;const re=ve.programConfigurations.get(h.id),Ee=m.useProgram(V,re),xe=m.style.terrain&&m.style.terrain.getTerrainData(he);M&&(m.context.activeTexture.set(A.TEXTURE0),pe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),re.updatePaintBuffers(z));const ke=I.constantOr(null);if(ke&&pe.imageAtlas){const Pe=pe.imageAtlas,Qe=Pe.patternPositions[ke.to.toString()],$e=Pe.patternPositions[ke.from.toString()];Qe&&$e&&re.setConstantPatternPositions(Qe,$e)}const Le=xe?he:null,Fe=m.translatePosMatrix(Le?Le.posMatrix:he.posMatrix,pe,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(w){K=ve.indexBuffer2,ee=ve.segments2;const Pe=[A.drawingBufferWidth,A.drawingBufferHeight];ne=V==="fillOutlinePattern"&&M?Ga(Fe,m,z,pe,Pe):Ko(Fe,Pe)}else K=ve.indexBuffer,ee=ve.segments,ne=M?Yo(Fe,m,z,pe):Zo(Fe);Ee.draw(m.context,B,_,m.stencilModeForClipping(he),v,yn.disabled,ne,xe,h.id,ve.layoutVertexBuffer,K,ee,h.paint,m.transform.zoom,re)}}function Za(m,s,h,p,_,v,w){const A=m.context,I=A.gl,M=h.paint.get("fill-extrusion-pattern"),z=M.constantOr(1),B=h.getCrossfadeParameters(),V=h.paint.get("fill-extrusion-opacity");for(const ne of p){const K=s.getTile(ne),ee=K.getBucket(h);if(!ee)continue;const he=m.style.terrain&&m.style.terrain.getTerrainData(ne),pe=ee.programConfigurations.get(h.id),ve=m.useProgram(z?"fillExtrusionPattern":"fillExtrusion",pe);z&&(m.context.activeTexture.set(I.TEXTURE0),K.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),pe.updatePaintBuffers(B));const re=M.constantOr(null);if(re&&K.imageAtlas){const Le=K.imageAtlas,Fe=Le.patternPositions[re.to.toString()],Pe=Le.patternPositions[re.from.toString()];Fe&&Pe&&pe.setConstantPatternPositions(Fe,Pe)}const Ee=m.translatePosMatrix(ne.posMatrix,K,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),xe=h.paint.get("fill-extrusion-vertical-gradient"),ke=z?Fr(Ee,m,xe,V,ne,B,K):Ws(Ee,m,xe,V);ve.draw(A,A.gl.TRIANGLES,_,v,w,yn.backCCW,ke,he,h.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,h.paint,m.transform.zoom,pe,m.style.terrain&&ee.centroidVertexBuffer)}}function Au(m,s,h,p,_,v,w){const A=m.context,I=A.gl,M=h.fbo;if(!M)return;const z=m.useProgram("hillshade"),B=m.style.terrain&&m.style.terrain.getTerrainData(s);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,M.colorAttachment.get()),z.draw(A,I.TRIANGLES,_,v,w,yn.disabled,((V,ne,K,ee)=>{const he=K.paint.get("hillshade-shadow-color"),pe=K.paint.get("hillshade-highlight-color"),ve=K.paint.get("hillshade-accent-color");let re=K.paint.get("hillshade-illumination-direction")*(Math.PI/180);K.paint.get("hillshade-illumination-anchor")==="viewport"&&(re-=V.transform.angle);const Ee=!V.options.moving;return{u_matrix:ee?ee.posMatrix:V.transform.calculatePosMatrix(ne.tileID.toUnwrapped(),Ee),u_image:0,u_latrange:Se(0,ne.tileID),u_light:[K.paint.get("hillshade-exaggeration"),re],u_shadow:he,u_highlight:pe,u_accent:ve}})(m,h,p,B?s:null),B,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function Dd(m,s,h,p,_,v){const w=m.context,A=w.gl,I=s.dem;if(I&&I.data){const M=I.dim,z=I.stride,B=I.getPixels();if(w.activeTexture.set(A.TEXTURE1),w.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(z),s.demTexture){const ne=s.demTexture;ne.update(B,{premultiply:!1}),ne.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else s.demTexture=new ie(w,B,A.RGBA,{premultiply:!1}),s.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);w.activeTexture.set(A.TEXTURE0);let V=s.fbo;if(!V){const ne=new ie(w,{width:M,height:M,data:null},A.RGBA);ne.bind(A.LINEAR,A.CLAMP_TO_EDGE),V=s.fbo=w.createFramebuffer(M,M,!0),V.colorAttachment.set(ne.texture)}w.bindFramebuffer.set(V.framebuffer),w.viewport.set([0,0,M,M]),m.useProgram("hillshadePrepare").draw(w,A.TRIANGLES,p,_,v,yn.disabled,((ne,K)=>{const ee=K.stride,he=l.create();return l.ortho(he,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate(he,he,[0,-l.EXTENT,0]),{u_matrix:he,u_image:1,u_dimension:[ee,ee],u_zoom:ne.overscaledZ,u_unpack:K.getUnpackVector()}})(s.tileID,I),null,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Yl(m,s,h,p,_,v){const w=p.paint.get("raster-fade-duration");if(!v&&w>0){const A=l.exported.now(),I=(A-m.timeAdded)/w,M=s?(A-s.timeAdded)/w:-1,z=h.getSource(),B=_.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),V=!s||Math.abs(s.tileID.overscaledZ-B)>Math.abs(m.tileID.overscaledZ-B),ne=V&&m.refreshedUponExpiration?1:l.clamp(V?I:1-M,0,1);return m.refreshedUponExpiration&&I>=1&&(m.refreshedUponExpiration=!1),s?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}const Kl=new l.Color(1,0,0,1),Br=new l.Color(0,1,0,1),zd=new l.Color(0,0,1,1),Iu=new l.Color(1,0,1,1),Od=new l.Color(0,1,1,1);function yo(m,s,h,p){na(m,0,s+h/2,m.transform.width,h,p)}function Ya(m,s,h,p){na(m,s-h/2,0,h,m.transform.height,p)}function na(m,s,h,p,_,v){const w=m.context,A=w.gl;A.enable(A.SCISSOR_TEST),A.scissor(s*m.pixelRatio,h*m.pixelRatio,p*m.pixelRatio,_*m.pixelRatio),w.clear({color:v}),A.disable(A.SCISSOR_TEST)}function qm(m,s,h){const p=m.context,_=p.gl,v=h.posMatrix,w=m.useProgram("debug"),A=jt.disabled,I=dn.disabled,M=m.colorModeForRenderPass(),z="$debug",B=m.style.terrain&&m.style.terrain.getTerrainData(h);p.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE);const V=s.getTileByID(h.key).latestRawTileData,ne=Math.floor((V&&V.byteLength||0)/1024),K=s.getTile(h).tileSize,ee=512/Math.min(K,512)*(h.overscaledZ/m.transform.zoom)*.5;let he=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(he+=` => ${h.overscaledZ}`),function(pe,ve){pe.initDebugOverlayCanvas();const re=pe.debugOverlayCanvas,Ee=pe.context.gl,xe=pe.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,re.width,re.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(ve,5,5),xe.strokeText(ve,5,5),pe.debugOverlayTexture.update(re),pe.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(m,`${he} ${ne}kB`),w.draw(p,_.TRIANGLES,A,I,gn.alphaBlended,yn.disabled,j(v,l.Color.transparent,ee),null,z,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),w.draw(p,_.LINE_STRIP,A,I,M,yn.disabled,j(v,l.Color.red),B,z,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Jl(m,s,h){const p=m.context,_=p.gl,v=m.colorModeForRenderPass(),w=new jt(_.LEQUAL,jt.ReadWrite,m.depthRangeFor3D),A=m.useProgram("terrain"),I=s.getTerrainMesh(),M=s.getTerrainData(h.tileID);p.bindFramebuffer.set(null),p.viewport.set([0,0,m.width,m.height]),p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,s.getRTTFramebuffer().colorAttachment.get());const z=m.transform.calculatePosMatrix(h.tileID.toUnwrapped());A.draw(p,_.TRIANGLES,w,dn.disabled,v,yn.backCCW,{u_matrix:z,u_texture:0},M,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}function Fd(m,s,h,p){const _=m.context,v=h.tileSize*s.qualityFactor;h.textures[p]||(h.textures[p]=m.getTileTexture(v)||new ie(_,{width:v,height:v,data:null},_.gl.RGBA),h.textures[p].bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),p===0&&s.sourceCache.renderHistory.unshift(h.tileID.key));const w=s.getRTTFramebuffer();w.colorAttachment.set(h.textures[p].texture),_.bindFramebuffer.set(w.framebuffer),_.viewport.set([0,0,v,v])}class Bd{constructor(s){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=s,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=s.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const s=this.painter.style,h=s.terrain;for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const _=s.sourceCaches[p].getVisibleCoordinates();for(const v of _){const w=h.sourceCache.getTerrainCoords(v);for(const A in w)this._coordsDescendingInv[p][A]||(this._coordsDescendingInv[p][A]=[]),this._coordsDescendingInv[p][A].push(w[A])}}for(const p of s._order){const _=s._layers[p],v=_.source;if(this._renderToTexture[_.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const w in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][w]=this._coordsDescendingInv[v][w].map(A=>A.key).sort().join()}}return this._renderableTiles.forEach(p=>{for(const _ in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[_][p.tileID.key];v&&v!==p.textureCoords[_]&&p.clearTextures(this.painter),h.needsRerender(_,p.tileID)&&p.clearTextures(this.painter)}this._rerender[p.tileID.key]=!p.textures.length}),h.clearRerenderCache(),h.sourceCache.removeOutdated(this.painter),this}renderLayer(s){const h=s.type,p=this.painter,_=p.style._order,v=p.currentLayer,w=v+1===_.length;if(this._renderToTexture[h]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(_[v]),!w))return!0;if(this._renderToTexture[this._prevType]||h==="hillshade"||this._renderToTexture[h]&&w){this._prevType=h;const A=this._stacks.length-1,I=this._stacks[A]||[];for(const M of this._renderableTiles){if(Fd(p,p.style.terrain,M,A),this._rerender[M.tileID.key]){p.context.clear({color:l.Color.transparent});for(let z=0;z<I.length;z++){const B=p.style._layers[I[z]],V=B.source?this._coordsDescendingInv[B.source][M.tileID.key]:[M.tileID];p._renderTileClippingMasks(B,V),p.renderLayer(p,p.style.sourceCaches[B.source],B,V),B.source&&(M.textureCoords[B.source]=this._coordsDescendingInvStr[B.source][M.tileID.key])}}Jl(p,p.style.terrain,M)}if(h==="hillshade"){this._stacks.push([_[v]]);for(const M of this._renderableTiles){const z=this._coordsDescendingInv[s.source][M.tileID.key];Fd(p,p.style.terrain,M,this._stacks.length-1),p.context.clear({color:l.Color.transparent}),p._renderTileClippingMasks(s,z),p.renderLayer(p,p.style.sourceCaches[s.source],s,z),Jl(p,p.style.terrain,M)}return!0}return this._renderToTexture[h]}return!1}}const Ka={symbol:function(m,s,h,p,_){if(m.renderPass!=="translucent")return;const v=dn.disabled,w=m.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(A,I,M,z,B,V,ne){const K=I.transform,ee=B==="map",he=V==="map";for(const pe of A){const ve=z.getTile(pe),re=ve.getBucket(M);if(!re||!re.text||!re.text.segments.get().length)continue;const Ee=l.evaluateSizeForZoom(re.textSizeData,K.zoom),xe=Mn(ve,1,I.transform.zoom),ke=ss(pe.posMatrix,he,ee,I.transform,xe),Le=M.layout.get("icon-text-fit")!=="none"&&re.hasIconData();if(Ee){const Fe=Math.pow(2,K.zoom-ve.tileID.overscaledZ);Rd(re,ee,he,ne,K,ke,pe.posMatrix,Fe,Ee,Le,I.style.terrain?(Pe,Qe)=>I.style.terrain.getElevation(pe,Pe,Qe):null)}}}(p,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),_),h.paint.get("icon-opacity").constantOr(1)!==0&&Zl(m,s,h,p,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),v,w),h.paint.get("text-opacity").constantOr(1)!==0&&Zl(m,s,h,p,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),v,w),s.map.showCollisionBoxes&&(ta(m,s,h,p,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),ta(m,s,h,p,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("circle-opacity"),v=h.paint.get("circle-stroke-width"),w=h.paint.get("circle-stroke-opacity"),A=!h.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(v.constantOr(1)===0||w.constantOr(1)===0))return;const I=m.context,M=I.gl,z=m.depthModeForSublayer(0,jt.ReadOnly),B=dn.disabled,V=m.colorModeForRenderPass(),ne=[];for(let K=0;K<p.length;K++){const ee=p[K],he=s.getTile(ee),pe=he.getBucket(h);if(!pe)continue;const ve=pe.programConfigurations.get(h.id),re=m.useProgram("circle",ve),Ee=pe.layoutVertexBuffer,xe=pe.indexBuffer,ke=m.style.terrain&&m.style.terrain.getTerrainData(ee),Le={programConfiguration:ve,program:re,layoutVertexBuffer:Ee,indexBuffer:xe,uniformValues:Vl(m,ee,he,h),terrainData:ke};if(A){const Fe=pe.segments.get();for(const Pe of Fe)ne.push({segments:new l.SegmentVector([Pe]),sortKey:Pe.sortKey,state:Le})}else ne.push({segments:pe.segments,sortKey:0,state:Le})}A&&ne.sort((K,ee)=>K.sortKey-ee.sortKey);for(const K of ne){const{programConfiguration:ee,program:he,layoutVertexBuffer:pe,indexBuffer:ve,uniformValues:re,terrainData:Ee}=K.state;he.draw(I,M.TRIANGLES,z,B,V,yn.disabled,re,Ee,h.id,pe,ve,K.segments,h.paint,m.transform.zoom,ee)}},heatmap:function(m,s,h,p){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,v=_.gl,w=dn.disabled,A=new gn([v.ONE,v.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(I,M,z){const B=I.gl;I.activeTexture.set(B.TEXTURE1),I.viewport.set([0,0,M.width/4,M.height/4]);let V=z.heatmapFbo;if(V)B.bindTexture(B.TEXTURE_2D,V.colorAttachment.get()),I.bindFramebuffer.set(V.framebuffer);else{const ne=B.createTexture();B.bindTexture(B.TEXTURE_2D,ne),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_2D,B.TEXTURE_MAG_FILTER,B.LINEAR),V=z.heatmapFbo=I.createFramebuffer(M.width/4,M.height/4,!1),function(K,ee,he,pe){const ve=K.gl;ve.texImage2D(ve.TEXTURE_2D,0,ve.RGBA,ee.width/4,ee.height/4,0,ve.RGBA,K.extRenderToTextureHalfFloat?K.extTextureHalfFloat.HALF_FLOAT_OES:ve.UNSIGNED_BYTE,null),pe.colorAttachment.set(he)}(I,M,ne,V)}})(_,m,h),_.clear({color:l.Color.transparent});for(let I=0;I<p.length;I++){const M=p[I];if(s.hasRenderableParent(M))continue;const z=s.getTile(M),B=z.getBucket(h);if(!B)continue;const V=B.programConfigurations.get(h.id),ne=m.useProgram("heatmap",V),{zoom:K}=m.transform;ne.draw(_,v.TRIANGLES,jt.disabled,w,A,yn.disabled,ce(M.posMatrix,z,K,h.paint.get("heatmap-intensity")),null,h.id,B.layoutVertexBuffer,B.indexBuffer,B.segments,h.paint,m.transform.zoom,V)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,v){const w=_.context,A=w.gl,I=v.heatmapFbo;if(!I)return;w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,I.colorAttachment.get()),w.activeTexture.set(A.TEXTURE1);let M=v.colorRampTexture;M||(M=v.colorRampTexture=new ie(w,v.colorRamp,A.RGBA)),M.bind(A.LINEAR,A.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,A.TRIANGLES,jt.disabled,dn.disabled,_.colorModeForRenderPass(),yn.disabled,((z,B,V,ne)=>{const K=l.create();l.ortho(K,0,z.width,z.height,0,0,1);const ee=z.context.gl;return{u_matrix:K,u_world:[ee.drawingBufferWidth,ee.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}})(_,v),null,v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(m,h))},line:function(m,s,h,p){if(m.renderPass!=="translucent")return;const _=h.paint.get("line-opacity"),v=h.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const w=m.depthModeForSublayer(0,jt.ReadOnly),A=m.colorModeForRenderPass(),I=h.paint.get("line-dasharray"),M=h.paint.get("line-pattern"),z=M.constantOr(1),B=h.paint.get("line-gradient"),V=h.getCrossfadeParameters(),ne=z?"linePattern":I?"lineSDF":B?"lineGradient":"line",K=m.context,ee=K.gl;let he=!0;for(const pe of p){const ve=s.getTile(pe);if(z&&!ve.patternsLoaded())continue;const re=ve.getBucket(h);if(!re)continue;const Ee=re.programConfigurations.get(h.id),xe=m.context.program.get(),ke=m.useProgram(ne,Ee),Le=he||ke.program!==xe,Fe=m.style.terrain&&m.style.terrain.getTerrainData(pe),Pe=M.constantOr(null);if(Pe&&ve.imageAtlas){const tt=ve.imageAtlas,Ct=tt.patternPositions[Pe.to.toString()],Lt=tt.patternPositions[Pe.from.toString()];Ct&&Lt&&Ee.setConstantPatternPositions(Ct,Lt)}const Qe=Fe?pe:null,$e=z?Ot(m,ve,h,V,Qe):I?En(m,ve,h,I,V,Qe):B?ot(m,ve,h,re.lineClipsArray.length,Qe):Be(m,ve,h,Qe);if(z)K.activeTexture.set(ee.TEXTURE0),ve.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Ee.updatePaintBuffers(V);else if(I&&(Le||m.lineAtlas.dirty))K.activeTexture.set(ee.TEXTURE0),m.lineAtlas.bind(K);else if(B){const tt=re.gradients[h.id];let Ct=tt.texture;if(h.gradientVersion!==tt.version){let Lt=256;if(h.stepInterpolant){const gt=s.getSource().maxzoom,rn=pe.canonical.z===gt?Math.ceil(1<<m.transform.maxZoom-pe.canonical.z):1;Lt=l.clamp(l.nextPowerOfTwo(re.maxLineLength/l.EXTENT*1024*rn),256,K.maxTextureSize)}tt.gradient=l.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Lt,image:tt.gradient||void 0,clips:re.lineClipsArray}),tt.texture?tt.texture.update(tt.gradient):tt.texture=new ie(K,tt.gradient,ee.RGBA),tt.version=h.gradientVersion,Ct=tt.texture}K.activeTexture.set(ee.TEXTURE0),Ct.bind(h.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}ke.draw(K,ee.TRIANGLES,w,m.stencilModeForClipping(pe),A,yn.disabled,$e,Fe,h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,m.transform.zoom,Ee,re.layoutVertexBuffer2),he=!1}},fill:function(m,s,h,p){const _=h.paint.get("fill-color"),v=h.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const w=m.colorModeForRenderPass(),A=h.paint.get("fill-pattern"),I=m.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(l.Color.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===I){const M=m.depthModeForSublayer(1,m.renderPass==="opaque"?jt.ReadWrite:jt.ReadOnly);Xa(m,s,h,p,M,w,!1)}if(m.renderPass==="translucent"&&h.paint.get("fill-antialias")){const M=m.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,jt.ReadOnly);Xa(m,s,h,p,M,w,!0)}},"fill-extrusion":function(m,s,h,p){const _=h.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const v=new jt(m.context.gl.LEQUAL,jt.ReadWrite,m.depthRangeFor3D);if(_!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))Za(m,s,h,p,v,dn.disabled,gn.disabled),Za(m,s,h,p,v,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const w=m.colorModeForRenderPass();Za(m,s,h,p,v,dn.disabled,w)}}},hillshade:function(m,s,h,p){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,v=m.depthModeForSublayer(0,jt.ReadOnly),w=m.colorModeForRenderPass(),[A,I]=m.renderPass==="translucent"?m.stencilConfigForOverlap(p):[{},p];for(const M of I){const z=s.getTile(M);z.needsHillshadePrepare!==void 0&&z.needsHillshadePrepare&&m.renderPass==="offscreen"?Dd(m,z,h,v,dn.disabled,w):m.renderPass==="translucent"&&Au(m,M,z,h,v,A[M.overscaledZ],w)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,s,h,p){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!p.length)return;const _=m.context,v=_.gl,w=s.getSource(),A=m.useProgram("raster"),I=m.colorModeForRenderPass(),[M,z]=w instanceof wt?[{},p]:m.stencilConfigForOverlap(p),B=z[z.length-1].overscaledZ,V=!m.options.moving;for(const ne of z){const K=m.depthModeForSublayer(ne.overscaledZ-B,h.paint.get("raster-opacity")===1?jt.ReadWrite:jt.ReadOnly,v.LESS),ee=s.getTile(ne);ee.registerFadeDuration(h.paint.get("raster-fade-duration"));const he=s.findLoadedParent(ne,0),pe=Yl(ee,he,s,h,m.transform,m.style.terrain);let ve,re;const Ee=h.paint.get("raster-resampling")==="nearest"?v.NEAREST:v.LINEAR;_.activeTexture.set(v.TEXTURE0),ee.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(v.TEXTURE1),he?(he.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),ve=Math.pow(2,he.tileID.overscaledZ-ee.tileID.overscaledZ),re=[ee.tileID.canonical.x*ve%1,ee.tileID.canonical.y*ve%1]):ee.texture.bind(Ee,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST);const xe=m.style.terrain&&m.style.terrain.getTerrainData(ne),ke=xe?ne:null,Le=ke?ke.posMatrix:m.transform.calculatePosMatrix(ne.toUnwrapped(),V),Fe=rr(Le,re||[0,0],ve||1,pe,h);w instanceof wt?A.draw(_,v.TRIANGLES,K,dn.disabled,I,yn.disabled,Fe,xe,h.id,w.boundsBuffer,m.quadTriangleIndexBuffer,w.boundsSegments):A.draw(_,v.TRIANGLES,K,M[ne.overscaledZ],I,yn.disabled,Fe,xe,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,s,h,p){const _=h.paint.get("background-color"),v=h.paint.get("background-opacity");if(v===0)return;const w=m.context,A=w.gl,I=m.transform,M=I.tileSize,z=h.paint.get("background-pattern");if(m.isPatternMissing(z))return;const B=!z&&_.a===1&&v===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==B)return;const V=dn.disabled,ne=m.depthModeForSublayer(0,B==="opaque"?jt.ReadWrite:jt.ReadOnly),K=m.colorModeForRenderPass(),ee=m.useProgram(z?"backgroundPattern":"background"),he=p||I.coveringTiles({tileSize:M,terrain:m.style.terrain});z&&(w.activeTexture.set(A.TEXTURE0),m.imageManager.bind(m.context));const pe=h.getCrossfadeParameters();for(const ve of he){const re=p?ve.posMatrix:m.transform.calculatePosMatrix(ve.toUnwrapped()),Ee=z?Om(re,v,m,z,{tileID:ve,tileSize:M},pe):zm(re,v,_),xe=m.style.terrain&&m.style.terrain.getTerrainData(ve);ee.draw(w,A.TRIANGLES,ne,V,K,yn.disabled,Ee,xe,h.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,s,h){for(let p=0;p<h.length;p++)qm(m,s,h[p])},custom:function(m,s,h){const p=m.context,_=h.implementation;if(m.renderPass==="offscreen"){const v=_.prerender;v&&(m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),v.call(_,p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),p.setColorMode(m.colorModeForRenderPass()),p.setStencilMode(dn.disabled);const v=_.renderingMode==="3d"?new jt(m.context.gl.LEQUAL,jt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,jt.ReadOnly);p.setDepthMode(v),_.render(p.gl,m.transform.customLayerMatrix()),p.setDirty(),m.setBaseState(),p.bindFramebuffer.set(null)}}};class Pu{constructor(s,h){this.context=new Ld(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=Wt.maxUnderzooming+Wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ht,this.gpuTimers={}}resize(s,h,p){if(this.width=s*p,this.height=h*p,this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const s=this.context,h=new l.PosArray;h.emplaceBack(0,0),h.emplaceBack(l.EXTENT,0),h.emplaceBack(0,l.EXTENT),h.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(h,Mt.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const p=new l.PosArray;p.emplaceBack(0,0),p.emplaceBack(l.EXTENT,0),p.emplaceBack(0,l.EXTENT),p.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=s.createVertexBuffer(p,Mt.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const _=new l.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(l.EXTENT,0,l.EXTENT,0),_.emplaceBack(0,l.EXTENT,0,l.EXTENT),_.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(_,et.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const v=new l.PosArray;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,Mt.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const w=new l.LineStripIndexArray;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(w);const A=new l.TriangleIndexArray;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(A),this.emptyTexture=new ie(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);const I=this.context.gl;this.stencilClearMode=new dn({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.create();l.ortho(p,0,this.width,this.height,0,0,1),l.scale(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,jt.disabled,this.stencilClearMode,gn.disabled,yn.disabled,Z(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(gn.disabled),p.setDepthMode(jt.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of h){const A=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,I=this.style.terrain&&this.style.terrain.getTerrainData(w);v.draw(p,_.TRIANGLES,jt.disabled,new dn({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),gn.disabled,yn.disabled,Z(w.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new dn({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new dn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,p=s.sort((w,A)=>A.overscaledZ-w.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const w={};for(let A=0;A<v;A++)w[A+_]=new dn({func:h.GEQUAL,mask:255},A+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[w,p]}return[{[_]:dn.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new gn([s.CONSTANT_COLOR,s.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gn.unblended:gn.alphaBlended}depthModeForSublayer(s,h,p){if(!this.opaquePassEnabledForLayer())return jt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new jt(p||this.context.gl.LEQUAL,h,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(l.exported.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,v=this.style.terrain&&new Bd(this);for(const M in _){const z=_[M];z.used&&z.prepare(this.context)}const w={},A={},I={};for(const M in _){const z=_[M];w[M]=z.getVisibleCoordinates(),A[M]=w[M].slice().reverse(),I[M]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let M=0;M<p.length;M++)if(this.style._layers[p[M]].is3D()){this.opaquePassCutoff=M;break}if(v){this.opaquePassCutoff=0;const M=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||M.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(z,B){const V=z.context,ne=V.gl,K=gn.unblended,ee=new jt(ne.LEQUAL,jt.ReadWrite,[0,1]),he=B.getTerrainMesh(),pe=B.sourceCache.getRenderableTiles(),ve=z.useProgram("terrainDepth");V.bindFramebuffer.set(B.getFramebuffer("depth").framebuffer),V.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),V.clear({color:l.Color.transparent,depth:1});for(const re of pe){const Ee=B.getTerrainData(re.tileID),xe=z.transform.calculatePosMatrix(re.tileID.toUnwrapped());ve.draw(V,ne.TRIANGLES,ee,dn.disabled,K,yn.backCCW,{u_matrix:xe},Ee,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}V.bindFramebuffer.set(null),V.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain),function(z,B){const V=z.context,ne=V.gl,K=gn.unblended,ee=new jt(ne.LEQUAL,jt.ReadWrite,[0,1]),he=B.getTerrainMesh(),pe=B.getCoordsTexture(),ve=B.sourceCache.getRenderableTiles(),re=z.useProgram("terrainCoords");V.bindFramebuffer.set(B.getFramebuffer("coords").framebuffer),V.viewport.set([0,0,z.width/devicePixelRatio,z.height/devicePixelRatio]),V.clear({color:l.Color.transparent,depth:1}),B.coordsIndex=[];for(const Ee of ve){const xe=B.getTerrainData(Ee.tileID);V.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,pe.texture);const ke=z.transform.calculatePosMatrix(Ee.tileID.toUnwrapped());re.draw(V,ne.TRIANGLES,ee,dn.disabled,K,yn.backCCW,{u_matrix:ke,u_terrain_coords_id:(255-B.coordsIndex.length)/255,u_texture:0},xe,"terrain",he.vertexBuffer,he.indexBuffer,he.segments),B.coordsIndex.push(Ee.tileID.key)}V.bindFramebuffer.set(null),V.viewport.set([0,0,z.width,z.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const M of p){const z=this.style._layers[M];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;const B=A[z.source];(z.type==="custom"||B.length)&&this.renderLayer(this,_[z.source],z,B)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!v)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const M=this.style._layers[p[this.currentLayer]],z=_[M.source],B=w[M.source];this._renderTileClippingMasks(M,B),this.renderLayer(this,z,M,B)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const M=this.style._layers[p[this.currentLayer]],z=_[M.source];if(v&&v.renderLayer(M))continue;const B=(M.type==="symbol"?I:A)[M.source];this._renderTileClippingMasks(M,w[M.source]),this.renderLayer(this,z,M,B)}if(this.options.showTileBoundaries){let M,z;Object.values(this.style._layers).forEach(B=>{B.source&&!B.isHidden(this.transform.zoom)&&(B.source!==(z&&z.id)&&(z=this.style.sourceCaches[B.source]),(!M||M.getSource().maxzoom<z.getSource().maxzoom)&&(M=z))}),M&&Ka.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){const z=M.transform.padding;yo(M,M.transform.height-(z.top||0),3,Kl),yo(M,z.bottom||0,3,Br),Ya(M,z.left||0,3,zd),Ya(M,M.transform.width-(z.right||0),3,Iu);const B=M.transform.centerPoint;(function(V,ne,K,ee){na(V,ne-1,K-10,2,20,ee),na(V,ne-10,K-1,20,2,ee)})(M,B.x,M.transform.height-B.y,Od)}(this),this.context.setDefault()}renderLayer(s,h,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||(_||[]).length)&&(this.id=p.id,this.gpuTimingStart(p),Ka[p.type](s,h,p,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let p=this.gpuTimers[s.id];p||(p=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),p.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}queryGpuTimers(s){const h={};for(const p in s){const _=s[p],v=this.context.extTimerQuery,w=v.getQueryObjectEXT(_.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(_.query),h[p]=w}return h}translatePosMatrix(s,h,p,_,v){if(!p[0]&&!p[1])return s;const w=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const M=Math.sin(w),z=Math.cos(w);p=[p[0]*z-p[1]*M,p[0]*M+p[1]*z]}const A=[v?p[0]:Mn(h,p[0],this.transform.zoom),v?p[1]:Mn(h,p[1],this.transform.zoom),0],I=new Float32Array(16);return l.translate(I,s,A),I}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!h||!p}useProgram(s,h){this.cache=this.cache||{};const p=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new qo(this.context,s,fi[s],h,pu[s],this._showOverdrawInspector,this.style.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ie(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ql{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,p){const _=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const I=1/(A=l.transformMat4([],A,s))[3]/h*_;return l.mul$1(A,A,[I,I,1/A[3],I])}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const I=l.sub([],v[A[0]],v[A[1]]),M=l.sub([],v[A[2]],v[A[1]]),z=l.normalize([],l.cross([],I,M)),B=-l.dot(z,v[A[1]]);return z.concat(B)});return new Ql(v,w)}}class Ja{constructor(s,h){this.min=s,this.max=h,this.center=l.scale$1([],l.add([],this.min,this.max),.5)}quadrant(s){const h=[s%2==0,s<2],p=l.clone$2(this.min),_=l.clone$2(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],_[v]=h[v]?this.center[v]:this.max[v];return _[2]=this.max[2],new Ja(p,_)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let _=0;_<s.planes.length;_++){const v=s.planes[_];let w=0;for(let A=0;A<h.length;A++)l.dot$1(v,h[A])>=0&&w++;if(w===0)return 0;w!==h.length&&(p=!1)}if(p)return 2;for(let _=0;_<3;_++){let v=Number.MAX_VALUE,w=-Number.MAX_VALUE;for(let A=0;A<s.points.length;A++){const I=s.points[A][_]-this.min[_];v=Math.min(v,I),w=Math.max(w,I)}if(w<0||v>this.max[_]-this.min[_])return 0}return 1}}class ia{constructor(s=0,h=0,p=0,_=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=p,this.right=_}interpolate(s,h,p){return h.top!=null&&s.top!=null&&(this.top=l.number(s.top,h.top,p)),h.bottom!=null&&s.bottom!=null&&(this.bottom=l.number(s.bottom,h.bottom,p)),h.left!=null&&s.left!=null&&(this.left=l.number(s.left,h.left,p)),h.right!=null&&s.right!=null&&(this.right=l.number(s.right,h.right,p)),this}getCenter(s,h){const p=l.clamp((this.left+s-this.right)/2,0,s),_=l.clamp((this.top+h-this.bottom)/2,0,h);return new l.pointGeometry(p,_)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ia(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Qa{constructor(s,h,p,_,v){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=v===void 0||!!v,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=p==null?0:p,this._maxPitch=_==null?60:_,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ia,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const s=new Qa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s._elevation=this._elevation,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-l.wrap(s,-180,180)*Math.PI/180;var p;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(p=new l.ARRAY_TYPE(4),l.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(_,v,w){var A=v[0],I=v[1],M=v[2],z=v[3],B=Math.sin(w),V=Math.cos(w);_[0]=A*V+M*B,_[1]=I*V+z*B,_[2]=A*-B+M*V,_[3]=I*-B+z*V}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=l.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,p){this._unmodified=!1,this._edgeInsets.interpolate(s,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new l.UnwrappedTileID(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.pointGeometry(0,0)),_=this.pointCoordinate(new l.pointGeometry(this.width,0)),v=this.pointCoordinate(new l.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new l.pointGeometry(0,this.height)),A=Math.floor(Math.min(p.x,_.x,v.x,w.x)),I=Math.floor(Math.max(p.x,_.x,v.x,w.x)),M=1;for(let z=A-M;z<=I+M;z++)z!==0&&h.push(new l.UnwrappedTileID(z,s))}return h}coveringTiles(s){var h,p;let _=this.coveringZoomLevel(s);const v=_;if(s.minzoom!==void 0&&_<s.minzoom)return[];s.maxzoom!==void 0&&_>s.maxzoom&&(_=s.maxzoom);const w=this.pointCoordinate(this.getCameraPoint()),A=l.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,_),M=[I*w.x,I*w.y,0],z=[I*A.x,I*A.y,0],B=Ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_);let V=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(V=_);const ne=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,K=re=>({aabb:new Ja([re*I,0,0],[(re+1)*I,I,0]),zoom:0,x:0,y:0,wrap:re,fullyVisible:!1}),ee=[],he=[],pe=_,ve=s.reparseOverscaled?v:_;if(this._renderWorldCopies)for(let re=1;re<=3;re++)ee.push(K(-re)),ee.push(K(re));for(ee.push(K(0));ee.length>0;){const re=ee.pop(),Ee=re.x,xe=re.y;let ke=re.fullyVisible;if(!ke){const tt=re.aabb.intersects(B);if(tt===0)continue;ke=tt===2}const Le=s.terrain?M:z,Fe=re.aabb.distanceX(Le),Pe=re.aabb.distanceY(Le),Qe=Math.max(Math.abs(Fe),Math.abs(Pe)),$e=ne+(1<<pe-re.zoom)-2;if(re.zoom===pe||Qe>$e&&re.zoom>=V){const tt=pe-re.zoom,Ct=M[0]-.5-(Ee<<tt),Lt=M[1]-.5-(xe<<tt);he.push({tileID:new l.OverscaledTileID(re.zoom===pe?ve:re.zoom,re.wrap,re.zoom,Ee,xe),distanceSq:l.sqrLen([z[0]-.5-Ee,z[1]-.5-xe]),tileDistanceToCamera:Math.sqrt(Ct*Ct+Lt*Lt)})}else for(let tt=0;tt<4;tt++){const Ct=(Ee<<1)+tt%2,Lt=(xe<<1)+(tt>>1),gt=re.zoom+1;let rn=re.aabb.quadrant(tt);if(s.terrain){const sn=new l.OverscaledTileID(gt,re.wrap,gt,Ct,Lt),Gt=s.terrain.getMinMaxElevation(sn),Ht=(h=Gt.minElevation)!==null&&h!==void 0?h:this.elevation,an=(p=Gt.maxElevation)!==null&&p!==void 0?p:this.elevation;rn=new Ja([rn.min[0],rn.min[1],Ht],[rn.max[0],rn.max[1],an])}ee.push({aabb:rn,zoom:gt,x:Ct,y:Lt,wrap:re.wrap,fullyVisible:ke})}}return he.sort((re,Ee)=>re.distanceSq-Ee.distanceSq).map(re=>re.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=l.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.pointGeometry(l.mercatorXfromLng(s.lng)*this.worldSize,l.mercatorYfromLat(h)*this.worldSize)}unproject(s){return new l.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(s){this.freezeElevation||(this.elevation=s?this.getElevation(this._center,s):0)}getElevation(s,h){const p=l.MercatorCoordinate.fromLngLat(s),_=(1<<this.tileZoom)*l.EXTENT,v=p.x*_,w=p.y*_,A=Math.floor(v/l.EXTENT),I=Math.floor(w/l.EXTENT),M=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,A,I);return h.getElevation(M,v%l.EXTENT,w%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.pointLocation(this.centerPoint,s),p=this.getElevation(h,s);if(!(this.elevation-p))return;const _=this.getCameraPosition(),v=l.MercatorCoordinate.fromLngLat(_.lngLat,_.altitude),w=l.MercatorCoordinate.fromLngLat(h,p),A=v.x-w.x,I=v.y-w.y,M=v.z-w.z,z=Math.sqrt(A*A+I*I+M*M),B=this.scaleZoom(this.cameraToCenterDistance/z/this.tileSize);this._elevation=p,this._center=h,this.zoom=B}setLocationAtPoint(s,h){const p=this.pointCoordinate(h),_=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(s),w=new l.MercatorCoordinate(v.x-(p.x-_.x),v.y-(p.y-_.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),this.getElevation(s,h),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return l.MercatorCoordinate.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const V=h.pointCoordinate(s);if(V!=null)return V}const p=[s.x,s.y,0,1],_=[s.x,s.y,1,1];l.transformMat4(p,p,this.pixelMatrixInverse),l.transformMat4(_,_,this.pixelMatrixInverse);const v=p[3],w=_[3],A=p[1]/v,I=_[1]/w,M=p[2]/v,z=_[2]/w,B=M===z?0:(0-M)/(z-M);return new l.MercatorCoordinate(l.number(p[0]/v,_[0]/w,B)/this.worldSize,l.number(A,I,B)/this.worldSize)}coordinatePoint(s,h=0,p=this.pixelMatrix){const _=[s.x*this.worldSize,s.y*this.worldSize,h,1];return l.transformMat4(_,_,p),new l.pointGeometry(_[0]/_[3],_[1]/_[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new l.LngLatBounds().extend(this.pointLocation(new l.pointGeometry(0,s))).extend(this.pointLocation(new l.pointGeometry(this.width,s))).extend(this.pointLocation(new l.pointGeometry(this.width,this.height))).extend(this.pointLocation(new l.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new l.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(s,h=!1){const p=s.key,_=h?this._alignedPosMatrixCache:this._posMatrixCache;if(_[p])return _[p];const v=s.canonical,w=this.worldSize/this.zoomScale(v.z),A=v.x+Math.pow(2,v.z)*s.wrap,I=l.identity(new Float64Array(16));return l.translate(I,I,[A*w,v.y*w,0]),l.scale(I,I,[w/l.EXTENT,w/l.EXTENT,1]),l.multiply(I,h?this.alignedProjMatrix:this.projMatrix,I),_[p]=new Float32Array(I),_[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let s,h,p,_,v=-90,w=90,A=-180,I=180;const M=this.size,z=this._unmodified;if(this.latRange){const ne=this.latRange;v=l.mercatorYfromLat(ne[1])*this.worldSize,w=l.mercatorYfromLat(ne[0])*this.worldSize,s=w-v<M.y?M.y/(w-v):0}if(this.lngRange){const ne=this.lngRange;A=l.wrap(l.mercatorXfromLng(ne[0])*this.worldSize,0,this.worldSize),I=l.wrap(l.mercatorXfromLng(ne[1])*this.worldSize,0,this.worldSize),I<A&&(I+=this.worldSize),h=I-A<M.x?M.x/(I-A):0}const B=this.point,V=Math.max(h||0,s||0);if(V)return this.center=this.unproject(new l.pointGeometry(h?(I+A)/2:B.x,s?(w+v)/2:B.y)),this.zoom+=this.scaleZoom(V),this._unmodified=z,void(this._constraining=!1);if(this.latRange){const ne=B.y,K=M.y/2;ne-K<v&&(_=v+K),ne+K>w&&(_=w-K)}if(this.lngRange){const ne=(A+I)/2,K=l.wrap(B.x,ne-this.worldSize/2,ne+this.worldSize/2),ee=M.x/2;K-ee<A&&(p=A+ee),K+ee>I&&(p=I-ee)}p===void 0&&_===void 0||(this.center=this.unproject(new l.pointGeometry(p!==void 0?p:B.x,_!==void 0?_:B.y)).wrap()),this._unmodified=z,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let _=l.identity(new Float64Array(16));l.scale(_,_,[this.width/2,-this.height/2,1]),l.translate(_,_,[1,-1,0]),this.labelPlaneMatrix=_,_=l.identity(new Float64Array(16)),l.scale(_,_,[1,-1,1]),l.translate(_,_,[-1,-1,0]),l.scale(_,_,[2/this.width,2/this.height,1]),this.glCoordMatrix=_,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const v=Math.PI/2+this._pitch,w=this._fov*(.5+s.y/this.height),A=Math.sin(w)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-w,.01,Math.PI-.01)),I=this.getHorizon(),M=2*Math.atan(I/this.cameraToCenterDistance)*(.5+s.y/(2*I)),z=Math.sin(M)*this.cameraToSeaLevelDistance/Math.sin(l.clamp(Math.PI-v-M,.01,Math.PI-.01)),B=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,V=Math.cos(Math.PI/2-this._pitch)*z+this.cameraToSeaLevelDistance,ne=1.01*Math.min(B,V),K=this.height/50;_=new Float64Array(16),l.perspective(_,this._fov,this.width/this.height,K,ne),_[8]=2*-s.x/this.width,_[9]=2*s.y/this.height,l.scale(_,_,[1,-1,1]),l.translate(_,_,[0,0,-this.cameraToCenterDistance]),l.rotateX(_,_,this._pitch),l.rotateZ(_,_,this.angle),l.translate(_,_,[-h,-p,0]),this.mercatorMatrix=l.scale([],_,[this.worldSize,this.worldSize,this.worldSize]),l.scale(_,_,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_),l.translate(_,_,[0,0,-this.elevation]),this.projMatrix=_,this.invProjMatrix=l.invert([],_),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,_);const ee=this.width%2/2,he=this.height%2/2,pe=Math.cos(this.angle),ve=Math.sin(this.angle),re=h-Math.round(h)+pe*ee+ve*he,Ee=p-Math.round(p)+pe*he+ve*ee,xe=new Float64Array(_);if(l.translate(xe,xe,[re>.5?re-1:re,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=xe,_=l.invert(new Float64Array(16),this.pixelMatrix),!_)throw new Error("failed to invert matrix");this.pixelMatrixInverse=_,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.pointGeometry(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.pointGeometry(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let p=h.x,_=h.y,v=h.x,w=h.y;for(const A of s)p=Math.min(p,A.x),_=Math.min(_,A.y),v=Math.max(v,A.x),w=Math.max(w,A.y);return[new l.pointGeometry(p,_),new l.pointGeometry(v,_),new l.pointGeometry(v,w),new l.pointGeometry(p,w),new l.pointGeometry(p,_)]}}}class Nd{constructor(s){this._hashName=s&&encodeURIComponent(s),l.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,p){let _=!1,v=null;const w=()=>{v=null,_&&(h(),v=setTimeout(w,300),_=!1)};return()=>(_=!0,v||w(),v)}(this._updateHashUnthrottled.bind(this))}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),w=Math.round(h.lng*v)/v,A=Math.round(h.lat*v)/v,I=this._map.getBearing(),M=this._map.getPitch();let z="";if(z+=s?`/${w}/${A}/${p}`:`${p}/${A}/${w}`,(I||M)&&(z+="/"+Math.round(10*I)/10),M&&(z+=`/${Math.round(M)}`),this._hashName){const B=this._hashName;let V=!1;const ne=window.location.hash.slice(1).split("&").map(K=>{const ee=K.split("=")[0];return ee===B?(V=!0,`${ee}=${z}`):K}).filter(K=>K);return V||ne.push(`${B}=${z}`),`#${ne.join("&")}`}return`#${z}`}_getCurrentHash(){const s=window.location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(h=p)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}}}const el={linearity:.3,easing:l.bezier(0,0,.3,1)},Ud=l.extend({deceleration:2500,maxSpeed:1400},el),Vd=l.extend({deceleration:20,maxSpeed:1400},el),jd=l.extend({deceleration:1e3,maxSpeed:360},el),ra=l.extend({deceleration:1e3,maxSpeed:90},el);class Gd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=l.exported.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new l.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(h.pan.mag()){const v=nl(h.pan.mag(),p,l.extend({},Ud,s||{}));_.offset=h.pan.mult(v.amount/h.pan.mag()),_.center=this._map.transform.center,tl(_,v)}if(h.zoom){const v=nl(h.zoom,p,Vd);_.zoom=this._map.transform.zoom+v.amount,tl(_,v)}if(h.bearing){const v=nl(h.bearing,p,jd);_.bearing=this._map.transform.bearing+l.clamp(v.amount,-179,179),tl(_,v)}if(h.pitch){const v=nl(h.pitch,p,ra);_.pitch=this._map.transform.pitch+v.amount,tl(_,v)}if(_.zoom||_.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),l.extend(_,{noMoveStart:!0})}}function tl(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function nl(m,s,h){const{maxSpeed:p,linearity:_,deceleration:v}=h,w=l.clamp(m*_/(s/1e3),-p,p),A=Math.abs(w)/(v*_);return{easing:h.easing,duration:1e3*A,amount:w*(A/2)}}class or extends l.Event{constructor(s,h,p,_={}){const v=k.mousePos(h.getCanvasContainer(),p),w=h.unproject(v);super(s,l.extend({point:v,lngLat:w,originalEvent:p},_)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class il extends l.Event{constructor(s,h,p){const _=s==="touchend"?p.changedTouches:p.touches,v=k.touchPos(h.getCanvasContainer(),_),w=v.map(I=>h.unproject(I)),A=v.reduce((I,M,z,B)=>I.add(M.div(B.length)),new l.pointGeometry(0,0));super(s,{points:v,point:A,lngLats:w,lngLat:h.unproject(A),originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ar extends l.Event{constructor(s,h,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Xm{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new ar(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new or(s.type,this._map,s))}mouseup(s){this._map.fire(new or(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new or(s.type,this._map,s))}dblclick(s){return this._firePreventable(new or(s.type,this._map,s))}mouseover(s){this._map.fire(new or(s.type,this._map,s))}mouseout(s){this._map.fire(new or(s.type,this._map,s))}touchstart(s){return this._firePreventable(new il(s.type,this._map,s))}touchmove(s){this._map.fire(new il(s.type,this._map,s))}touchend(s){this._map.fire(new il(s.type,this._map,s))}touchcancel(s){this._map.fire(new il(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qs{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new or(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new or("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new or(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hd{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(k.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=k.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const v=Math.min(_.x,p.x),w=Math.max(_.x,p.x),A=Math.min(_.y,p.y),I=Math.max(_.y,p.y);k.setTransform(this._box,`translate(${v}px,${A}px)`),this._box.style.width=w-v+"px",this._box.style.height=I-A+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const p=this._startPos,_=h;if(this.reset(),k.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new l.Event(s,{originalEvent:h}))}}function Ss(m,s){if(m.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${s.length}`);const h={};for(let p=0;p<m.length;p++)h[m[p].identifier]=s[p];return h}class rl{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const v=new l.pointGeometry(0,0);for(const w of _)v._add(w);return v.div(_.length)}(h),this.touches=Ss(p,h)))}touchmove(s,h,p){if(this.aborted||!this.centroid)return;const _=Ss(p,h);for(const v in this.touches){const w=this.touches[v],A=_[v];(!A||A.dist(w)>30)&&(this.aborted=!0)}}touchend(s,h,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Cu{constructor(s){this.singleTap=new rl(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,p){this.singleTap.touchstart(s,h,p)}touchmove(s,h,p){this.singleTap.touchmove(s,h,p)}touchend(s,h,p){const _=this.singleTap.touchend(s,h,p);if(_){const v=s.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(v&&w||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Zm{constructor(){this._zoomIn=new Cu({numTouches:1,numTaps:2}),this._zoomOut=new Cu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,p){this._zoomIn.touchstart(s,h,p),this._zoomOut.touchstart(s,h,p)}touchmove(s,h,p){this._zoomIn.touchmove(s,h,p),this._zoomOut.touchmove(s,h,p)}touchend(s,h,p){const _=this._zoomIn.touchend(s,h,p),v=this._zoomOut.touchend(s,h,p);return _?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ym={0:1,2:2};class ec{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const p=k.mouseButton(s);this._correctButton(s,p)&&(this._lastPoint=h,this._eventButton=p)}mousemoveWindow(s,h){const p=this._lastPoint;if(p){if(s.preventDefault(),function(_,v){const w=Ym[v];return _.buttons===void 0||(_.buttons&w)!==w}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(p,h)}}mouseupWindow(s){this._lastPoint&&k.mouseButton(s)===this._eventButton&&(this._moved&&k.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl extends ec{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class As extends ec{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=.8*(h.x-s.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(s){s.preventDefault()}}class rt extends ec{_correctButton(s,h){return h===0&&s.ctrlKey||h===2}_move(s,h){const p=-.5*(h.y-s.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(s){s.preventDefault()}}class $d{constructor(s,h){this._minTouches=s.cooperativeGestures?2:1,this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(s,h,p){return this._calculateTransform(s,h,p)}touchmove(s,h,p){if(this._map._cooperativeGestures&&(this._minTouches===2&&p.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(s,!1,p.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(p.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,h,p)}touchend(s,h,p){this._calculateTransform(s,h,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,p){p.length>0&&(this._active=!0);const _=Ss(p,h),v=new l.pointGeometry(0,0),w=new l.pointGeometry(0,0);let A=0;for(const M in _){const z=_[M],B=this._touches[M];B&&(v._add(z),w._add(z.sub(B)),A++,_[M]=z)}if(this._touches=_,A<this._minTouches||!w.mag())return;const I=w.div(A);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(A),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(s){}_move(s,h,p){return{}}touchstart(s,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,p){if(!this._firstTwoTouches)return;s.preventDefault();const[_,v]=this._firstTwoTouches,w=Xs(p,h,_),A=Xs(p,h,v);if(!w||!A)return;const I=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],I,s)}touchend(s,h,p){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,w=Xs(p,h,_),A=Xs(p,h,v);w&&A||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xs(m,s,h){for(let p=0;p<m.length;p++)if(m[p].identifier===h)return s[p]}function Mu(m,s){return Math.log(m/s)/Math.LN2}class Ye extends vo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Mu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Mu(this._distance,p),pinchAround:h}}}function tc(m,s){return 180*m.angleWith(s)/Math.PI}class Km extends vo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const p=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:tc(this._vector,p),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,p=tc(s,this._startVector);return Math.abs(p)<h}}function ku(m){return Math.abs(m.y)>Math.abs(m.x)}class Lu extends vo{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,p){super.touchstart(s,h,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,ku(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,p){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const _=s[0].sub(this._lastPoints[0]),v=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(_,v,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,p){if(this._valid!==void 0)return this._valid;const _=s.mag()>=2,v=h.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=s.y>0==h.y>0;return ku(s)&&ku(h)&&w}}const Wd={panStep:100,bearingStep:15,pitchStep:10};class qd{constructor(){const s=Wd;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,p=0,_=0,v=0,w=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?_=1:(s.preventDefault(),w=-1);break;case 40:s.shiftKey?_=-1:(s.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:A=>{const I=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:Jm,zoom:h?Math.round(I)+h*(s.shiftKey?2:1):I,bearing:A.getBearing()+p*this._bearingStep,pitch:A.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-w*this._panStep],center:A.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jm(m){return m*(2-m)}const Xd=4.000244140625;class Ru{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,l.bindAll(["_onTimeout"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;s.preventDefault()}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=l.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Xd==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(_*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=k.mousePos(this._el,s);this._around=l.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>Xd?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&I!==0&&(I=1/I);const M=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(M*I))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,_=this._easing;let v,w=!1;if(this._type==="wheel"&&p&&_){const A=Math.min((l.exported.now()-this._lastWheelEventTime)/200,1),I=_(A);v=l.number(p,h,I),A<1?this._frameId||(this._frameId=!0):w=!0}else v=h,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:v-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=l.ease;if(this._prevEase){const p=this._prevEase,_=(l.exported.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),w=.27/Math.sqrt(v*v+1e-4)*.01,A=Math.sqrt(.0729-w*w);h=l.bezier(w,A,.25,1)}return this._prevEase={start:l.exported.now(),duration:s,easing:h},h}reset(){this._active=!1}}class Du{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zu{constructor(){this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(s.shiftKey?-1:1),around:p.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ou{constructor(){this._tap=new Cu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(s,h,p){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=h[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(s,h,p))}touchmove(s,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=h[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,h,p)}touchend(s,h,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(s,h,p)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $i{constructor(s,h,p){this._el=s,this._mousePan=h,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zs{constructor(s,h,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zd{constructor(s,h,p,_){this._el=s,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sa=m=>m.zoom||m.drag||m.pitch||m.rotate;class Fu extends l.Event{}function ol(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Yd{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Gd(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),l.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,w]of this._listeners)k.addEventListener(_,v,_===document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[s,h,p]of this._listeners)k.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new Xm(h,s));const _=h.boxZoom=new Hd(h,s);this._add("boxZoom",_);const v=new Zm,w=new zu;h.doubleClickZoom=new Du(w,v),this._add("tapZoom",v),this._add("clickZoom",w);const A=new Ou;this._add("tapDragZoom",A);const I=h.touchPitch=new Lu(h);this._add("touchPitch",I);const M=new As(s),z=new rt(s);h.dragRotate=new Zs(s,M,z),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new sl(s),V=new $d(s,h);h.dragPan=new $i(p,B,V),this._add("mousePan",B),this._add("touchPan",V,["touchZoom","touchRotate"]);const ne=new Km,K=new Ye;h.touchZoomRotate=new Zd(p,K,ne,A),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]);const ee=h.scrollZoom=new Ru(h,this);this._add("scrollZoom",ee,["mousePan"]);const he=h.keyboard=new qd;this._add("keyboard",he),this._add("blockableMapEvent",new qs(h));for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[pe]&&h[pe].enable(s[pe])}_add(s,h,p){this._handlers.push({handlerName:s,handler:h,allowed:p}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(sa(this._eventsInProgress))||this.isZooming()}_blockedByActive(s,h,p){for(const _ in s)if(_!==p&&(!h||h.indexOf(_)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const p of s)this._el.contains(p.target)&&h.push(p);return h}handleEvent(s,h){if(s.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const p=s.type==="renderFrame"?void 0:s,_={needsRenderFrame:!1},v={},w={},A=s.touches,I=A?this._getMapTouches(A):void 0,M=I?k.touchPos(this._el,I):k.mousePos(this._el,s);for(const{handlerName:V,handler:ne,allowed:K}of this._handlers){if(!ne.isEnabled())continue;let ee;this._blockedByActive(w,K,V)?ne.reset():ne[h||s.type]&&(ee=ne[h||s.type](s,M,I),this.mergeHandlerResult(_,v,ee,V,p),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||ne.isActive())&&(w[V]=ne)}const z={};for(const V in this._previousActiveHandlers)w[V]||(z[V]=p);this._previousActiveHandlers=w,(Object.keys(z).length||ol(_))&&(this._changes.push([_,v,z]),this._triggerRenderFrame()),(Object.keys(w).length||ol(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=_;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,h,p,_,v){if(!p)return;l.extend(s,p);const w={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=w),p.panDelta!==void 0&&(h.drag=w),p.pitchDelta!==void 0&&(h.pitch=w),p.bearingDelta!==void 0&&(h.rotate=w)}_applyChanges(){const s={},h={},p={};for(const[_,v,w]of this._changes)_.panDelta&&(s.panDelta=(s.panDelta||new l.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(s.around=_.around),_.pinchAround!==void 0&&(s.pinchAround=_.pinchAround),_.noInertia&&(s.noInertia=_.noInertia),l.extend(h,v),l.extend(p,w);this._updateMapTransform(s,h,p),this._changes=[]}_updateMapTransform(s,h,p){const _=this._map,v=_.transform,w=_.style&&_.style.terrain;if(!(ol(s)||w&&this._drag))return this._fireEvents(h,p,!0);let{panDelta:A,zoomDelta:I,bearingDelta:M,pitchDelta:z,around:B,pinchAround:V}=s;V!==void 0&&(B=V),_._stop(!0),B=B||_.transform.centerPoint;const ne=v.pointLocation(A?B.sub(A):B);M&&(v.bearing+=M),z&&(v.pitch+=z),I&&(v.zoom+=I),w?h.drag&&!this._drag?(this._drag={center:v.centerPoint,lngLat:v.pointLocation(B),point:B,handlerName:h.drag.handlerName},_.fire(new l.Event("freezeElevation",{freeze:!0}))):this._drag&&p[this._drag.handlerName]?(_.fire(new l.Event("freezeElevation",{freeze:!1})),this._drag=null):h.drag&&this._drag&&(v.center=v.pointLocation(v.centerPoint.sub(A))):v.setLocationAtPoint(ne,B),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,p,!0)}_fireEvents(s,h,p){const _=sa(this._eventsInProgress),v=sa(s),w={};for(const z in s){const{originalEvent:B}=s[z];this._eventsInProgress[z]||(w[`${z}start`]=B),this._eventsInProgress[z]=s[z]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const z in w)this._fireEvent(z,w[z]);v&&this._fireEvent("move",v.originalEvent);for(const z in s){const{originalEvent:B}=s[z];this._fireEvent(z,B)}const A={};let I;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:V}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],I=h[B]||V,A[`${z}end`]=I)}for(const z in A)this._fireEvent(z,A[z]);const M=sa(this._eventsInProgress);if(p&&(_||v)&&!M){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:I})):(this._map.fire(new l.Event("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new l.Event(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Fu("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Er={extend:(m,...s)=>l.extend(m,...s),run(m){m()},logToElement(m,s=!1,h="log"){const p=window.document.getElementById(h);p&&(s&&(p.innerHTML=""),p.innerHTML+=`<br>${m}`)}};class vn extends l.Evented{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,l.bindAll(["_renderFrameCallback"],this)}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,p){return s=l.pointGeometry.convert(s).mult(-1),this.panTo(this.transform.center,l.extend({offset:s},h),p)}panTo(s,h,p){return this.easeTo(l.extend({center:s},h),p)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,p){return this.easeTo(l.extend({zoom:s},h),p)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,p){return this.easeTo(l.extend({bearing:s},h),p)}resetNorth(s,h){return this.rotateTo(0,l.extend({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=l.LngLatBounds.convert(s);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,h)}_cameraForBoxAndBearing(s,h,p,_){const v={top:0,bottom:0,right:0,left:0};if(typeof(_=l.extend({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const xe=_.padding;_.padding={top:xe,bottom:xe,right:xe,left:xe}}_.padding=l.extend(v,_.padding);const w=this.transform,A=w.padding,I=w.project(l.LngLat.convert(s)),M=w.project(l.LngLat.convert(h)),z=I.rotate(-p*Math.PI/180),B=M.rotate(-p*Math.PI/180),V=new l.pointGeometry(Math.max(z.x,B.x),Math.max(z.y,B.y)),ne=new l.pointGeometry(Math.min(z.x,B.x),Math.min(z.y,B.y)),K=V.sub(ne),ee=(w.width-(A.left+A.right+_.padding.left+_.padding.right))/K.x,he=(w.height-(A.top+A.bottom+_.padding.top+_.padding.bottom))/K.y;if(he<0||ee<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const pe=Math.min(w.scaleZoom(w.scale*Math.min(ee,he)),_.maxZoom),ve=l.pointGeometry.convert(_.offset),re=new l.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),Ee=ve.add(re).mult(w.scale/w.zoomScale(pe));return{center:w.unproject(I.add(M).div(2).sub(Ee)),zoom:pe,bearing:p}}fitBounds(s,h,p){return this._fitInternal(this.cameraForBounds(s,h),h,p)}fitScreenCoordinates(s,h,p,_,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.pointGeometry.convert(s)),this.transform.pointLocation(l.pointGeometry.convert(h)),p,_),_,v)}_fitInternal(s,h,p){return s?(delete(h=l.extend(s,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(s,h){this.stop();const p=this.transform;let _=!1,v=!1,w=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(_=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=l.LngLat.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(v=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(w=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this.fire(new l.Event("movestart",h)).fire(new l.Event("move",h)),_&&this.fire(new l.Event("zoomstart",h)).fire(new l.Event("zoom",h)).fire(new l.Event("zoomend",h)),v&&this.fire(new l.Event("rotatestart",h)).fire(new l.Event("rotate",h)).fire(new l.Event("rotateend",h)),w&&this.fire(new l.Event("pitchstart",h)).fire(new l.Event("pitch",h)).fire(new l.Event("pitchend",h)),this.fire(new l.Event("moveend",h))}calculateCameraOptionsFromTo(s,h,p,_=0){const v=l.MercatorCoordinate.fromLngLat(s,h),w=l.MercatorCoordinate.fromLngLat(p,_),A=w.x-v.x,I=w.y-v.y,M=w.z-v.z,z=Math.hypot(A,I,M);if(z===0)throw new Error("Can't calculate camera options with same From and To");const B=Math.hypot(A,I),V=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),ne=180*Math.atan2(A,-I)/Math.PI;let K=180*Math.acos(B/z)/Math.PI;return K=M<0?90-K:90+K,{center:w.toLngLat(),zoom:V,pitch:K,bearing:ne}}easeTo(s,h){this._stop(!1,s.easeId),((s=l.extend({offset:[0,0],duration:500,easing:l.ease},s)).animate===!1||!s.essential&&l.exported.prefersReducedMotion)&&(s.duration=0);const p=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),A=this.getPadding(),I="zoom"in s?+s.zoom:_,M="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:w,B="padding"in s?s.padding:p.padding,V=l.pointGeometry.convert(s.offset);let ne=p.centerPoint.add(V);const K=p.pointLocation(ne),ee=l.LngLat.convert(s.center||K);this._normalizeCenter(ee);const he=p.project(K),pe=p.project(ee).sub(he),ve=p.zoomScale(I-_);let re,Ee;s.around&&(re=l.LngLat.convert(s.around),Ee=p.locationPoint(re));const xe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||I!==_,this._rotating=this._rotating||v!==M,this._pitching=this._pitching||z!==w,this._padding=!p.isPaddingEqual(B),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,xe),this._ease(ke=>{if(this._zooming&&(p.zoom=l.number(_,I,ke)),this._rotating&&(p.bearing=l.number(v,M,ke)),this._pitching&&(p.pitch=l.number(w,z,ke)),this._padding&&(p.interpolatePadding(A,B,ke),ne=p.centerPoint.add(V)),re)p.setLocationAtPoint(re,Ee);else{const Le=p.zoomScale(p.zoom-_),Fe=I>_?Math.min(2,ve):Math.max(.5,ve),Pe=Math.pow(Fe,1-ke),Qe=p.unproject(he.add(pe.mult(ke*Pe)).mult(Le));p.setLocationAtPoint(p.renderWorldCopies?Qe.wrap():Qe,ne)}this._fireMoveEvents(h)},ke=>{this._afterEase(h,ke)},s),this}_prepareEase(s,h,p={}){this._moving=!0,this.fire(new l.Event("freezeElevation",{freeze:!0})),h||p.moving||this.fire(new l.Event("movestart",s)),this._zooming&&!p.zooming&&this.fire(new l.Event("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new l.Event("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new l.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new l.Event("move",s)),this._zooming&&this.fire(new l.Event("zoom",s)),this._rotating&&this.fire(new l.Event("rotate",s)),this._pitching&&this.fire(new l.Event("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId,this.fire(new l.Event("freezeElevation",{freeze:!1}));const p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.Event("zoomend",s)),_&&this.fire(new l.Event("rotateend",s)),v&&this.fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}flyTo(s,h){if(!s.essential&&l.exported.prefersReducedMotion){const gt=l.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(gt,h)}this.stop(),s=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.ease},s);const p=this.transform,_=this.getZoom(),v=this.getBearing(),w=this.getPitch(),A=this.getPadding(),I="zoom"in s?l.clamp(+s.zoom,p.minZoom,p.maxZoom):_,M="bearing"in s?this._normalizeBearing(s.bearing,v):v,z="pitch"in s?+s.pitch:w,B="padding"in s?s.padding:p.padding,V=p.zoomScale(I-_),ne=l.pointGeometry.convert(s.offset);let K=p.centerPoint.add(ne);const ee=p.pointLocation(K),he=l.LngLat.convert(s.center||ee);this._normalizeCenter(he);const pe=p.project(ee),ve=p.project(he).sub(pe);let re=s.curve;const Ee=Math.max(p.width,p.height),xe=Ee/V,ke=ve.mag();if("minZoom"in s){const gt=l.clamp(Math.min(s.minZoom,_,I),p.minZoom,p.maxZoom),rn=Ee/p.zoomScale(gt-_);re=Math.sqrt(rn/ke*2)}const Le=re*re;function Fe(gt){const rn=(xe*xe-Ee*Ee+(gt?-1:1)*Le*Le*ke*ke)/(2*(gt?xe:Ee)*Le*ke);return Math.log(Math.sqrt(rn*rn+1)-rn)}function Pe(gt){return(Math.exp(gt)-Math.exp(-gt))/2}function Qe(gt){return(Math.exp(gt)+Math.exp(-gt))/2}const $e=Fe(0);let tt=function(gt){return Qe($e)/Qe($e+re*gt)},Ct=function(gt){return Ee*((Qe($e)*(Pe(rn=$e+re*gt)/Qe(rn))-Pe($e))/Le)/ke;var rn},Lt=(Fe(1)-$e)/re;if(Math.abs(ke)<1e-6||!isFinite(Lt)){if(Math.abs(Ee-xe)<1e-6)return this.easeTo(s,h);const gt=xe<Ee?-1:1;Lt=Math.abs(Math.log(xe/Ee))/re,Ct=function(){return 0},tt=function(rn){return Math.exp(gt*re*rn)}}return s.duration="duration"in s?+s.duration:1e3*Lt/("screenSpeed"in s?+s.screenSpeed/re:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=v!==M,this._pitching=z!==w,this._padding=!p.isPaddingEqual(B),this._prepareEase(h,!1),this._ease(gt=>{const rn=gt*Lt,sn=1/tt(rn);p.zoom=gt===1?I:_+p.scaleZoom(sn),this._rotating&&(p.bearing=l.number(v,M,gt)),this._pitching&&(p.pitch=l.number(w,z,gt)),this._padding&&(p.interpolatePadding(A,B,gt),K=p.centerPoint.add(ne));const Gt=gt===1?he:p.unproject(pe.add(ve.mult(Ct(rn))).mult(sn));p.setLocationAtPoint(p.renderWorldCopies?Gt.wrap():Gt,K),this._fireMoveEvents(h)},()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,h,p){p.animate===!1||p.duration===0?(s(1),h()):(this._easeStart=l.exported.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((l.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=l.wrap(s,-180,180);const p=Math.abs(s-h);return Math.abs(s-360-h)<p&&(s-=360),Math.abs(s+360-h)<p&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=s.lng-h.center.lng;s.lng+=p>180?-360:p<-180?360:0}}class al{constructor(s={}){this.options=s,l.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options&&this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const p=this._map._getUIString(`AttributionControl.${h}`);s.title=p,s.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const h=this._map.style.sourceCaches;for(const _ in h){const v=h[_];if(v.used||v.usedForTerrain){const w=v.getSource();w.attribution&&s.indexOf(w.attribution)<0&&s.push(w.attribution)}}s=s.filter(_=>String(_).trim()),s.sort((_,v)=>_.length-v.length),s=s.filter((_,v)=>{for(let w=v+1;w<s.length;w++)if(s[w].indexOf(_)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class nc{constructor(s={}){this.options=s,l.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=k.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Kd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const _ of p)if(_.id===s)return void(_.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Jd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},Qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Qm={showCompass:!0,showZoom:!0,visualizePitch:!1};class ls{constructor(s,h,p=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new As({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,p&&(this.mousePitch=new rt({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),l.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),k.addEventListener(h,"mousedown",this.mousedown),k.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(h,"touchmove",this.touchmove),k.addEventListener(h,"touchend",this.touchend),k.addEventListener(h,"touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),k.disableDrag()}move(s,h){const p=this.map,_=this.mouseRotate.mousemoveWindow(s,h);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(s,h);v&&v.pitchDelta&&p.setPitch(p.getPitch()+v.pitchDelta)}}off(){const s=this.element;k.removeEventListener(s,"mousedown",this.mousedown),k.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(s,"touchmove",this.touchmove),k.removeEventListener(s,"touchend",this.touchend),k.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup)}mousedown(s){this.down(l.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),k.mousePos(this.element,s)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)}mousemove(s){this.move(s,k.mousePos(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ll(m,s,h){if(m=new l.LngLat(m.lng,m.lat),s){const p=new l.LngLat(m.lng-360,m.lat),_=new l.LngLat(m.lng+360,m.lat),v=h.locationPoint(m).distSqr(s);h.locationPoint(p).distSqr(s)<v?m=p:h.locationPoint(_).distSqr(s)<v&&(m=_)}for(;Math.abs(m.lng-h.center.lng)>180;){const p=h.locationPoint(m);if(p.x>=0&&p.y>=0&&p.x<=h.width&&p.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const ut={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bt(m,s,h){const p=m.classList;for(const _ in ut)p.remove(`maplibregl-${h}-anchor-${_}`,`mapboxgl-${h}-anchor-${_}`);p.add(`maplibregl-${h}-anchor-${s}`,`mapboxgl-${h}-anchor-${s}`)}class oa extends l.Evented{constructor(s,h){if(super(),(s instanceof HTMLElement||h)&&(s=l.extend({element:s},h)),l.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,s&&s.element)this._element=s.element,this._offset=l.pointGeometry.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const p=k.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${_}px`),p.setAttributeNS(null,"width",`${v}px`),p.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const w=k.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const A=k.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const I=k.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ve of M){const re=k.createNS("http://www.w3.org/2000/svg","ellipse");re.setAttributeNS(null,"opacity","0.04"),re.setAttributeNS(null,"cx","10.5"),re.setAttributeNS(null,"cy","5.80029008"),re.setAttributeNS(null,"rx",ve.rx),re.setAttributeNS(null,"ry",ve.ry),I.appendChild(re)}const z=k.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const B=k.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(B);const V=k.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"opacity","0.25"),V.setAttributeNS(null,"fill","#000000");const ne=k.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),V.appendChild(ne);const K=k.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(6.0, 7.0)"),K.setAttributeNS(null,"fill","#FFFFFF");const ee=k.createNS("http://www.w3.org/2000/svg","g");ee.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=k.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const pe=k.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#FFFFFF"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962"),ee.appendChild(he),ee.appendChild(pe),A.appendChild(I),A.appendChild(z),A.appendChild(V),A.appendChild(K),A.appendChild(ee),p.appendChild(A),p.setAttributeNS(null,"height",_*this._scale+"px"),p.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(p),this._offset=l.pointGeometry.convert(s&&s.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),bt(this._element,this._anchor,"marker"),this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(s){const h=s.code,p=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?s.remove():s.addTo(this._map),this):this}_update(s){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${ut[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${h}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const _=this._map.unproject(this._pos),v=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=_.distanceTo(this._lngLat)>20*v?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(s){return this._offset=l.pointGeometry.convert(s),this._update(),this}_onMove(s){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"}_addDragHandler(s){this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Bu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ys,pi=0,Ks=!1;const cs={maxWidth:100,unit:"metric"};function ef(m,s,h){const p=h&&h.maxWidth||100,_=m._container.clientHeight/2,v=m.unproject([0,_]),w=m.unproject([p,_]),A=v.distanceTo(w);if(h&&h.unit==="imperial"){const I=3.2808*A;I>5280?Js(s,p,I/5280,m._getUIString("ScaleControl.Miles")):Js(s,p,I,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Js(s,p,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Js(s,p,A/1e3,m._getUIString("ScaleControl.Kilometers")):Js(s,p,A,m._getUIString("ScaleControl.Meters"))}function Js(m,s,h,p){const _=function(v){const w=Math.pow(10,`${Math.floor(v)}`.length-1);let A=v/w;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(I){const M=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*M)/M}(A),w*A}(h);m.style.width=s*(_/h)+"px",m.innerHTML=`${_}&nbsp;${p}`}const kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nu(m){if(m){if(typeof m=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new l.pointGeometry(0,0),top:new l.pointGeometry(0,m),"top-left":new l.pointGeometry(s,s),"top-right":new l.pointGeometry(-s,s),bottom:new l.pointGeometry(0,-m),"bottom-left":new l.pointGeometry(s,-s),"bottom-right":new l.pointGeometry(-s,-s),left:new l.pointGeometry(m,0),right:new l.pointGeometry(-m,0)}}if(m instanceof l.pointGeometry||Array.isArray(m)){const s=l.pointGeometry.convert(m);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.pointGeometry.convert(m.center||[0,0]),top:l.pointGeometry.convert(m.top||[0,0]),"top-left":l.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":l.pointGeometry.convert(m["top-right"]||[0,0]),bottom:l.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":l.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":l.pointGeometry.convert(m["bottom-right"]||[0,0]),left:l.pointGeometry.convert(m.left||[0,0]),right:l.pointGeometry.convert(m.right||[0,0])}}return Nu(new l.pointGeometry(0,0))}const xo={supported:b,setRTLTextPlugin:l.setRTLTextPlugin,getRTLTextPluginStatus:l.getRTLTextPluginStatus,Map:class extends vn{constructor(m){var s;if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(m=l.extend({},Qd,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Qa(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._cooperativeGestures=m.cooperativeGestures,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new Kd,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},Jd,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(s=m.pixelRatio)!==null&&s!==void 0?s:devicePixelRatio,this._requestManager=new X(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),l.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Yd(this,m),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=m.hash&&new Nd(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,l.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new al({customAttribution:m.customAttribution})),m.maplibreLogo&&this.addControl(new nc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new l.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new l.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new l.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,s,h,p){return p==null&&this.style.terrain&&(p=this.transform.getElevation(h,this.style.terrain)),super.calculateCameraOptionsFromTo(m,s,h,p)}resize(m){const s=this._containerDimensions(),h=s[0],p=s[1];this._resizeCanvas(h,p,this.getPixelRatio()),this.transform.resize(h,p),this.painter.resize(h,p,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new l.Event("movestart",m)).fire(new l.Event("move",m))),this.fire(new l.Event("resize",m)),_&&this.fire(new l.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[s,h]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(s,h,m),this.painter.resize(s,h,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(l.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m==null?60:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(l.LngLat.convert(m),this.style&&this.style.terrain)}unproject(m){return this.transform.pointLocation(l.pointGeometry.convert(m),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,s,h){if(m==="mouseenter"||m==="mouseover"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:v=>{const w=this.getLayer(s)?this.queryRenderedFeatures(v.point,{layers:[s]}):[];w.length?p||(p=!0,h.call(this,new or(m,this,v.originalEvent,{features:w}))):p=!1},mouseout:()=>{p=!1}}}}if(m==="mouseleave"||m==="mouseout"){let p=!1;return{layer:s,listener:h,delegates:{mousemove:w=>{(this.getLayer(s)?this.queryRenderedFeatures(w.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,h.call(this,new or(m,this,w.originalEvent)))},mouseout:w=>{p&&(p=!1,h.call(this,new or(m,this,w.originalEvent)))}}}}{const p=_=>{const v=this.getLayer(s)?this.queryRenderedFeatures(_.point,{layers:[s]}):[];v.length&&(_.features=v,h.call(this,_),delete _.features)};return{layer:s,listener:h,delegates:{[m]:p}}}}on(m,s,h){if(h===void 0)return super.on(m,s);const p=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(m,s,h){if(h===void 0)return super.once(m,s);const p=this._createDelegatedListener(m,s,h);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(m,s,h){return h===void 0?super.off(m,s):(this._delegatedListeners&&this._delegatedListeners[m]&&(p=>{const _=this._delegatedListeners[m];for(let v=0;v<_.length;v++){const w=_[v];if(w.layer===s&&w.listener===h){for(const A in w.delegates)this.off(A,w.delegates[A]);return _.splice(v,1),this}}})(),this)}queryRenderedFeatures(m,s){if(!this.style)return[];let h;if(s!==void 0||m===void 0||m instanceof l.pointGeometry||Array.isArray(m)||(s=m,m=void 0),s=s||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof l.pointGeometry||typeof m[0]=="number")h=[l.pointGeometry.convert(m)];else{const p=l.pointGeometry.convert(m[0]),_=l.pointGeometry.convert(m[1]);h=[p,new l.pointGeometry(_.x,p.y),_,new l.pointGeometry(p.x,_.y),p]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(m,s){return this.style.querySourceFeatures(m,s)}setStyle(m,s){return(s=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(m,s))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Yn(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Yn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,s){if(typeof m=="string"){const h=this._requestManager.transformRequest(m,l.ResourceType.Style);l.getJSON(h,(p,_)=>{p?this.fire(new l.ErrorEvent(p)):_&&this._updateDiff(_,s)})}else typeof m=="object"&&this._updateDiff(m,s)}_updateDiff(m,s){try{this.style.setState(m)&&this._update(!0)}catch(h){l.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(m,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(m,s){return this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)}isSourceLoaded(m){const s=this.style&&this.style.sourceCaches[m];if(s!==void 0)return s.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){return this.style.setTerrain(m),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const s in m){const h=m[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,s,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,s,{pixelRatio:h=1,sdf:p=!1,stretchX:_,stretchY:v,content:w}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||l.isImageBitmap(s)){const{width:A,height:I,data:M}=l.exported.getImageData(s);this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},M),pixelRatio:h,stretchX:_,stretchY:v,content:w,sdf:p,version:0})}else{if(s.width===void 0||s.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:I,data:M}=s,z=s;this.style.addImage(m,{data:new l.RGBAImage({width:A,height:I},new Uint8Array(M)),pixelRatio:h,stretchX:_,stretchY:v,content:w,sdf:p,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m)}}}updateImage(m,s){const h=this.style.getImage(m);if(!h)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||l.isImageBitmap(s)?l.exported.getImageData(s):s,{width:_,height:v,data:w}=p;if(_===void 0||v===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==h.data.width||v!==h.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(s instanceof HTMLImageElement||l.isImageBitmap(s));h.data.replace(w,A),this.style.updateImage(m,h)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,s){l.getImage(this._requestManager.transformRequest(m,l.ResourceType.Image),s)}listImages(){return this.style.listImages()}addLayer(m,s){return this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)}moveLayer(m,s){return this.style.moveLayer(m,s),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,s,h){return this.style.setLayerZoomRange(m,s,h),this._update(!0)}setFilter(m,s,h={}){return this.style.setFilter(m,s,h),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,s,h,p={}){return this.style.setPaintProperty(m,s,h,p),this._update(!0)}getPaintProperty(m,s){return this.style.getPaintProperty(m,s)}setLayoutProperty(m,s,h,p={}){return this.style.setLayoutProperty(m,s,h,p),this._update(!0)}getLayoutProperty(m,s){return this.style.getLayoutProperty(m,s)}setLight(m,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,s){return this.style.setFeatureState(m,s),this._update()}removeFeatureState(m,s){return this.style.removeFeatureState(m,s),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,s=0;return this._container&&(m=this._container.clientWidth||400,s=this._container.clientHeight||300),[m,s]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const s=this._canvasContainer=k.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&s.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const p=this._controlContainer=k.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{_[v]=k.create("div",`maplibregl-ctrl-${v} mapboxgl-ctrl-${v}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const m=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=k.create("div","maplibregl-cooperative-gesture-screen",m);let s="Control",h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(h=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use \u2318 + scroll to zoom the map",s="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${h}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",p=>{p.key===s&&(this._metaPress=!0)}),document.addEventListener("keyup",p=>{p.key===s&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",p=>{this._onCooperativeGesture(p,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(m,s,h){this._canvas.width=h*m,this._canvas.height=h*s,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const m=l.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);s?(this.painter=new Pu(s,this.transform),l.exported$1.testSupport(s)):this.fire(new l.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(m,s,h){return!s&&h<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let s,h=0;const p=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(s=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,s),h=l.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const w=this.transform.zoom,A=l.exported.now();this.style.zoomHistory.update(w,A);const I=new l.EvaluationParameters(w,{now:A,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=I.crossFadingFactor();M===1&&M===this._crossFadingFactor||(_=!0,this._crossFadingFactor=M),this.style.update(I)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const w=l.exported.now()-h;p.endQueryEXT(p.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=p.getQueryObjectEXT(s,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(s),this.fire(new l.Event("gpu-timing-frame",{cpuTime:w,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){const w=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(w);this.fire(new l.Event("gpu-timing-layer",{layerTimes:A}))},50)}const v=this._sourcesDirty||this._styleDirty||this._placementDirty;return v||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||v||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._cooperativeGestures&&k.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.exported.frame(m=>{l.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,s){l.setCacheLimits(m,s)}get version(){return"2.4.0"}},NavigationControl:class{constructor(m){this.options=l.extend({},Qm,m),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(l.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(l.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),s=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ls(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,s){const h=k.create("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){const h=this._map._getUIString(`NavigationControl.${s}`);m.title=h,m.setAttribute("aria-label",h)}},GeolocateControl:class extends l.Evented{constructor(m){super(),this.options=l.extend({},Bu,m),l.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var s;return this._map=m,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),s=this._setupUI,Ys!==void 0?s(Ys):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Ys=h.state!=="denied",s(Ys)}):(Ys=!!window.navigator.geolocation,s(Ys)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,pi=0,Ks=!1}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("geolocate",m)),this._finish()}}_updateCamera(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,p=this._map.getBearing(),_=l.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),_,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new l.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,s=this._map.unproject([0,m]),h=this._map.unproject([1,m]),p=s.distanceTo(h),_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Ks)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new l.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new oa(this._dotElement),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new oa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":pi--,Ks=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),pi++,pi>1?(m={maximumAge:6e5,timeout:0},Ks=!0):(m=this.options.positionOptions,Ks=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:al,LogoControl:nc,ScaleControl:class{constructor(m){this.options=l.extend({},cs,m),l.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ef(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,ef(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),l.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",l.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(m){this.options=m,l.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(m){return this._map=m,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends l.Evented{constructor(m){super(),this.options=l.extend(Object.create(kn),m),l.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=l.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=m;p=h.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=k.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(v=>this._container.classList.add(v)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const s=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let h=this.options.anchor;const p=Nu(this.options.offset);if(!h){const v=this._container.offsetWidth,w=this._container.offsetHeight;let A;A=s.y+p.bottom.y<w?["top"]:s.y>this._map.transform.height-w?["bottom"]:[],s.x<v/2?A.push("left"):s.x>this._map.transform.width-v/2&&A.push("right"),h=A.length===0?"bottom":A.join("-")}const _=s.add(p[h]).round();k.setTransform(this._container,`${ut[h]} translate(${_.x}px,${_.y}px)`),bt(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Gn);m&&m.focus()}_onClose(){this.remove()}},Marker:oa,Style:Yn,LngLat:l.LngLat,LngLatBounds:l.LngLatBounds,Point:l.pointGeometry,MercatorCoordinate:l.MercatorCoordinate,Evented:l.Evented,AJAXError:l.AJAXError,config:l.config,CanvasSource:tn,GeoJSONSource:vi,ImageSource:wt,RasterDEMTileSource:vt,RasterTileSource:Dt,VectorTileSource:en,VideoSource:St,prewarm:function(){di().acquire(Ci)},clearPrewarmedResources:function(){const m=ji;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ci),ji=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Xn.workerCount},set workerCount(m){Xn.workerCount=m},get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){l.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){l.clearTileCache(m)},workerUrl:"",addProtocol(m,s){l.config.REGISTERED_PROTOCOLS[m]=s},removeProtocol(m){delete l.config.REGISTERED_PROTOCOLS[m]}};return Er.extend(xo,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),xo});var f=o;return f})})(tA);const J5=tA.exports,Q5="modulepreload",eN=function(t,e){return new URL(t,e).href},Xw={},tN=function(e,n,i){if(!n||n.length===0)return e();const o=document.getElementsByTagName("link");return Promise.all(n.map(u=>{if(u=eN(u,i),u in Xw)return;Xw[u]=!0;const f=u.endsWith(".css"),l=f?'[rel="stylesheet"]':"";if(!!i)for(let C=o.length-1;C>=0;C--){const L=o[C];if(L.href===u&&(!f||L.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${l}`))return;const T=document.createElement("link");if(T.rel=f?"stylesheet":Q5,f||(T.as="script",T.crossOrigin=""),T.href=u,document.head.appendChild(T),f)return new Promise((C,L)=>{T.addEventListener("load",C),T.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${u}`)))})})).then(()=>e())};var iA={exports:{}},Rm={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nN=ft.exports,iN=Symbol.for("react.element"),rN=Symbol.for("react.fragment"),sN=Object.prototype.hasOwnProperty,oN=nN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aN={key:!0,ref:!0,__self:!0,__source:!0};function rA(t,e,n){var i,o={},u=null,f=null;n!==void 0&&(u=""+n),e.key!==void 0&&(u=""+e.key),e.ref!==void 0&&(f=e.ref);for(i in e)sN.call(e,i)&&!aN.hasOwnProperty(i)&&(o[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:iN,type:t,key:u,ref:f,props:o,_owner:oN.current}}Rm.Fragment=rN;Rm.jsx=rA;Rm.jsxs=rA;(function(t){t.exports=Rm})(iA);const ru=iA.exports.jsx,lN=ft.exports.createContext(null);function cN(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function Zw(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Yw(t,e){const n=e.viewState||e;let i=!1;if("longitude"in n&&"latitude"in n){const o=t.center;t.center=new o.constructor(n.longitude,n.latitude),i=i||o!==t.center}if("zoom"in n){const o=t.zoom;t.zoom=n.zoom,i=i||o!==t.zoom}if("bearing"in n){const o=t.bearing;t.bearing=n.bearing,i=i||o!==t.bearing}if("pitch"in n){const o=t.pitch;t.pitch=n.pitch,i=i||o!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(i=!0,t.padding=n.padding),i}const uN=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Kw(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const i of t.layers)e[i.id]=i;const n=t.layers.map(i=>{const o=e[i.ref];let u=null;if("interactive"in i&&(u={...i},delete u.interactive),o){u=u||{...i},delete u.ref;for(const f of uN)f in o&&(u[f]=o[f])}return u||i});return{...t,layers:n}}function hN(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,i=Array.isArray(t)?t[1]:t?t.y:0,o=Array.isArray(e)?e[0]:e?e.x:0,u=Array.isArray(e)?e[1]:e?e.y:0;return n===o&&i===u}function Ea(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Ea(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(const o of n)if(!e.hasOwnProperty(o)||!Ea(t[o],e[o]))return!1;return!0}return!1}const Jw={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},B_={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Qw={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},dN=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],fN=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class su{constructor(e,n,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=o=>{const u=this.props[Qw[o.type]];u&&u(o)},this._onPointerEvent=o=>{(o.type==="mousemove"||o.type==="mouseout")&&this._updateHover(o);const u=this.props[Jw[o.type]];if(u){if(this.props.interactiveLayerIds&&o.type!=="mouseover"&&o.type!=="mouseout"){const f=this._hoveredFeatures||this._map.queryRenderedFeatures(o.point,{layers:this.props.interactiveLayerIds});o.features=f}u(o),delete o.features}},this._onCameraEvent=o=>{if(!this._internalUpdate){const u=this.props[B_[o.type]];u&&u(o)}o.type in this._deferredEvents&&(this._deferredEvents[o.type]=!1)},this._MapClass=e,this.props=n,this._initialize(i)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const i=this._updateSettings(e,n);i&&this._createShadowTransform(this._map);const o=this._updateSize(e),u=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(i||o||u&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const i=su.savedMaps.pop();if(!i)return null;const o=i.map,u=o.getContainer();for(n.className=u.className;u.childNodes.length>0;)n.appendChild(u.childNodes[0]);o._container=n,i.setProps({...e,styleDiffing:!1}),o.resize();const{initialViewState:f}=e;return f&&(f.bounds?o.fitBounds(f.bounds,{...f.fitBoundsOptions,duration:0}):i._updateViewState(f,!1)),o.isStyleLoaded()?o.fire("load"):o.once("styledata",()=>o.fire("load")),i}_initialize(e){const{props:n}=this,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||pN()||null,container:e,style:Kw(n.mapStyle)},o=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),n.gl){const T=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=T,n.gl)}const u=new this._MapClass(i);o.padding&&u.setPadding(o.padding),n.cursor&&(u.getCanvas().style.cursor=n.cursor),this._createShadowTransform(u);const f=u._render;u._render=T=>{this._inRender=!0,f.call(u,T),this._inRender=!1};const l=u._renderTaskQueue.run;u._renderTaskQueue.run=T=>{l.call(u._renderTaskQueue,T),this._onBeforeRepaint()},u.on("render",()=>this._onAfterRepaint());const b=u.fire;u.fire=this._fireEvent.bind(this,b),u.on("resize",()=>{this._renderTransform.resize(u.transform.width,u.transform.height)}),u.on("styledata",()=>this._updateStyleComponents(this.props,{})),u.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const T in Jw)u.on(T,this._onPointerEvent);for(const T in B_)u.on(T,this._onCameraEvent);for(const T in Qw)u.on(T,this._onEvent);this._map=u}recycle(){su.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=cN(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const i=this._map;if(n.width!==i.transform.width||n.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const i=this._map,o=this._renderTransform,{zoom:u,pitch:f,bearing:l}=o,b=i.isMoving();b&&(o.cameraElevationReference="sea");const T=Yw(o,{...Zw(i.transform),...e});if(b&&(o.cameraElevationReference="ground"),T&&n){const C=this._deferredEvents;C.move=!0,C.zoom||(C.zoom=u!==o.zoom),C.rotate||(C.rotate=l!==o.bearing),C.pitch||(C.pitch=f!==o.pitch)}return b||Yw(i.transform,e),T}_updateSettings(e,n){const i=this._map;let o=!1;for(const u of dN)u in e&&!Ea(e[u],n[u])&&(o=!0,i[`set${u[0].toUpperCase()}${u.slice(1)}`](e[u]));return o}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor),e.mapStyle!==n.mapStyle){const i={diff:e.styleDiffing};return"localIdeographFontFamily"in e&&(i.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Kw(e.mapStyle),i),!0}return!1}_updateStyleComponents(e,n){const i=this._map;let o=!1;return i.style.loaded()&&("light"in e&&!Ea(e.light,n.light)&&(o=!0,i.setLight(e.light)),"fog"in e&&!Ea(e.fog,n.fog)&&(o=!0,i.setFog(e.fog)),"terrain"in e&&!Ea(e.terrain,n.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(o=!0,i.setTerrain(e.terrain))),o}_updateHandlers(e,n){const i=this._map;let o=!1;for(const u of fN){const f=e[u];Ea(f,n[u])||(o=!0,f?i[u].enable(f):i[u].disable())}return o}_updateHover(e){var n;const{props:i}=this;if(i.interactiveLayerIds&&(i.onMouseMove||i.onMouseEnter||i.onMouseLeave)){const u=e.type,f=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0;let l;if(u==="mousemove")try{l=this._map.queryRenderedFeatures(e.point,{layers:i.interactiveLayerIds})}catch{l=[]}else l=[];const b=l.length>0;!b&&f&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,b&&!f&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=u}else this._hoveredFeatures=null}_fireEvent(e,n,i){const o=this._map,u=o.transform,f=typeof n=="string"?n:n.type;return f==="move"&&this._updateViewState(this.props,!1),f in B_&&(typeof n=="object"&&(n.viewState=Zw(u)),this._map.isMoving())?(o.transform=this._renderTransform,e.call(o,n,i),o.transform=u,o):(e.call(o,n,i),o)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const i in this._deferredEvents)this._deferredEvents[i]&&e.fire(i);this._internalUpdate=!1;const n=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=n}}}su.savedMaps=[];function pN(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||process.env.MapboxAccessToken}catch{}try{t=t||process.env.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const mN=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function gN(t,e){if(!t)return null;const n=t.map,i={getMap:()=>n,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:o=>t.transform.locationPoint(e.LngLat.convert(o)),unproject:o=>t.transform.pointLocation(e.Point.convert(o)),queryTerrainElevation:(o,u)=>{const f=n.transform;n.transform=t.transform;const l=n.queryTerrainElevation(o,u);return n.transform=f,l}};for(const o of _N(n))!(o in i)&&!mN.includes(o)&&(i[o]=n[o].bind(n));return i}function _N(t){const e=new Set;let n=t;for(;n;){for(const i of Object.getOwnPropertyNames(n))i[0]!=="_"&&typeof t[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);n=Object.getPrototypeOf(n)}return Array.from(e)}const yN=typeof document<"u"?ft.exports.useLayoutEffect:ft.exports.useEffect,vN=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function xN(t,e){for(const n of vN)n in e&&(t[n]=e[n]);e.RTLTextPlugin&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(e.RTLTextPlugin,n=>{n&&console.error(n)},!1)}const Dm=ft.exports.createContext(null),bN={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:t=>console.error(t.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Sv=ft.exports.forwardRef((t,e)=>{const n=ft.exports.useContext(lN),[i,o]=ft.exports.useState(null),u=ft.exports.useRef(),{current:f}=ft.exports.useRef({mapLib:null,map:null});ft.exports.useEffect(()=>{const b=t.mapLib;let T=!0,C;return Promise.resolve(b||tN(()=>import("./mapbox-gl.b8248eab.js").then(L=>L.m),[],import.meta.url)).then(L=>{if(!!T){if(L.Map||(L=L.default),!L||!L.Map)throw new Error("Invalid mapLib");if(L.supported(t))xN(L,t),t.reuseMaps&&(C=su.reuse(t,u.current)),C||(C=new su(L.Map,t,u.current)),f.map=gN(C,L),f.mapLib=L,o(C),n==null||n.onMapMount(f.map,t.id);else throw new Error("Map is not supported by this browser")}}).catch(L=>{t.onError({type:"error",target:null,originalEvent:null,error:L})}),()=>{T=!1,C&&(n==null||n.onMapUnmount(t.id),t.reuseMaps?C.recycle():C.destroy())}},[]),yN(()=>{i&&i.setProps(t)}),ft.exports.useImperativeHandle(e,()=>f.map,[i]);const l=ft.exports.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]);return ru("div",{id:t.id,ref:u,style:l,children:i&&ru(Dm.Provider,{value:f,children:t.children})})});Sv.displayName="Map";Sv.defaultProps=bN;const wN=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ul(t,e){if(!t||!e)return;const n=t.style;for(const i in e){const o=e[i];Number.isFinite(o)&&!wN.test(i)?n[i]=`${o}px`:n[i]=o}}const EN={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function sA(t){const{map:e,mapLib:n}=ft.exports.useContext(Dm),i=ft.exports.useRef({props:t});i.current.props=t;const o=ft.exports.useMemo(()=>{let u=!1;ft.exports.Children.forEach(t.children,b=>{b&&(u=!0)});const f={...t,element:u?document.createElement("div"):null},l=new n.Marker(f).setLngLat([t.longitude,t.latitude]);return l.getElement().addEventListener("click",b=>{var T,C;(C=(T=i.current.props).onClick)===null||C===void 0||C.call(T,{type:"click",target:l,originalEvent:b})}),l.on("dragstart",b=>{var T,C;const L=b;L.lngLat=o.getLngLat(),(C=(T=i.current.props).onDragStart)===null||C===void 0||C.call(T,L)}),l.on("drag",b=>{var T,C;const L=b;L.lngLat=o.getLngLat(),(C=(T=i.current.props).onDrag)===null||C===void 0||C.call(T,L)}),l.on("dragend",b=>{var T,C;const L=b;L.lngLat=o.getLngLat(),(C=(T=i.current.props).onDragEnd)===null||C===void 0||C.call(T,L)}),l},[]);return ft.exports.useEffect(()=>(o.addTo(e.getMap()),()=>{o.remove()}),[]),ft.exports.useEffect(()=>{Ul(o.getElement(),t.style)},[t.style]),(o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!hN(o.getOffset(),t.offset)&&o.setOffset(t.offset),o.isDraggable()!==t.draggable&&o.setDraggable(t.draggable),o.getRotation()!==t.rotation&&o.setRotation(t.rotation),o.getRotationAlignment()!==t.rotationAlignment&&o.setRotationAlignment(t.rotationAlignment),o.getPitchAlignment()!==t.pitchAlignment&&o.setPitchAlignment(t.pitchAlignment),o.getPopup()!==t.popup&&o.setPopup(t.popup),om.exports.createPortal(t.children,o.getElement())}sA.defaultProps=EN;ft.exports.memo(sA);function e2(t){return new Set(t?t.trim().split(/\s+/):[])}function TN(t){const{map:e,mapLib:n}=ft.exports.useContext(Dm),i=ft.exports.useMemo(()=>document.createElement("div"),[]),o=ft.exports.useRef({props:t});o.current.props=t;const u=ft.exports.useMemo(()=>{const f={...t},l=new n.Popup(f).setLngLat([t.longitude,t.latitude]);return l.once("open",b=>{var T,C;(C=(T=o.current.props).onOpen)===null||C===void 0||C.call(T,b)}),l},[]);if(ft.exports.useEffect(()=>{const f=l=>{var b,T;(T=(b=o.current.props).onClose)===null||T===void 0||T.call(b,l)};return u.on("close",f),u.setDOMContent(i).addTo(e.getMap()),()=>{u.off("close",f),u.isOpen()&&u.remove()}},[]),ft.exports.useEffect(()=>{Ul(u.getElement(),t.style)},[t.style]),u.isOpen()&&((u.getLngLat().lng!==t.longitude||u.getLngLat().lat!==t.latitude)&&u.setLngLat([t.longitude,t.latitude]),t.offset&&!Ea(u.options.offset,t.offset)&&u.setOffset(t.offset),(u.options.anchor!==t.anchor||u.options.maxWidth!==t.maxWidth)&&(u.options.anchor=t.anchor,u.setMaxWidth(t.maxWidth)),u.options.className!==t.className)){const f=e2(u.options.className),l=e2(t.className);for(const b of f)l.has(b)||u.removeClassName(b);for(const b of l)f.has(b)||u.addClassName(b);u.options.className=t.className}return om.exports.createPortal(t.children,i)}ft.exports.memo(TN);function wd(t,e,n,i){const o=ft.exports.useContext(Dm),u=ft.exports.useMemo(()=>t(o),[]);return ft.exports.useEffect(()=>{const f=i||n||e,l=typeof e=="function"&&typeof n=="function"?e:null,b=typeof n=="function"?n:typeof e=="function"?e:null,{map:T}=o;return T.hasControl(u)||(T.addControl(u,f==null?void 0:f.position),l&&l(o)),()=>{b&&b(o),T.hasControl(u)&&T.removeControl(u)}},[]),u}function SN(t){const e=wd(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return ft.exports.useEffect(()=>{Ul(e._container,t.style)},[t.style]),null}ft.exports.memo(SN);function AN(t){const e=wd(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return ft.exports.useEffect(()=>{Ul(e._controlContainer,t.style)},[t.style]),null}ft.exports.memo(AN);const oA=ft.exports.forwardRef((t,e)=>{const n=ft.exports.useRef({props:t}),i=wd(({mapLib:o})=>{const u=new o.GeolocateControl(t),f=u._setupUI;return u._setupUI=l=>{u._container.hasChildNodes()||f(l)},u.on("geolocate",l=>{var b,T;(T=(b=n.current.props).onGeolocate)===null||T===void 0||T.call(b,l)}),u.on("error",l=>{var b,T;(T=(b=n.current.props).onError)===null||T===void 0||T.call(b,l)}),u.on("outofmaxbounds",l=>{var b,T;(T=(b=n.current.props).onOutOfMaxBounds)===null||T===void 0||T.call(b,l)}),u.on("trackuserlocationstart",l=>{var b,T;(T=(b=n.current.props).onTrackUserLocationStart)===null||T===void 0||T.call(b,l)}),u.on("trackuserlocationend",l=>{var b,T;(T=(b=n.current.props).onTrackUserLocationEnd)===null||T===void 0||T.call(b,l)}),u},{position:t.position});return n.current.props=t,ft.exports.useImperativeHandle(e,()=>({trigger:()=>i.trigger()}),[]),ft.exports.useEffect(()=>{Ul(i._container,t.style)},[t.style]),null});oA.displayName="GeolocateControl";ft.exports.memo(oA);function IN(t){const e=wd(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return ft.exports.useEffect(()=>{Ul(e._container,t.style)},[t.style]),null}ft.exports.memo(IN);const PN={unit:"metric",maxWidth:100};function aA(t){const e=wd(({mapLib:n})=>new n.ScaleControl(t),{position:t.position});return(e.options.unit!==t.unit||e.options.maxWidth!==t.maxWidth)&&(e.options.maxWidth=t.maxWidth,e.setUnit(t.unit)),ft.exports.useEffect(()=>{Ul(e._container,t.style)},[t.style]),null}aA.defaultProps=PN;ft.exports.memo(aA);const CN=[{id:1,name:"Nueva casita",description:"DESC #1",fileName:"IMG_20220105_213935.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.322484,-3.025605",date:"Wednesday, 5 January 2022, 21:39"},{id:2,name:"Old casita",description:"DESC #2",fileName:"IMG_20220122_004852.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.322473,-3.025589",date:"Saturday, 22 January 2022, 00:48"},{id:3,name:"Cambre",description:"DESC #3",fileName:"IMG_20220128_230726.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.326605,-3.02437",date:"Friday, 28 January 2022, 23:07"},{id:4,name:"Esencia",description:"DESC #4",fileName:"IMG_20220212_221813.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.249106,-2.919873",date:"Saturday, 12 February 2022, 22:18"},{id:5,name:"Puente colgante",description:"DESC #5",fileName:"IMG_20220213_165804.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.31441,-3.006411",date:"Sunday, 13 February 2022, 16:58"},{id:6,name:"Cenita chula",description:"DESC #6",fileName:"IMG_20220225_203103.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"43.31781,-3.023135",date:"Friday, 25 February 2022, 20:31"},{id:7,name:"Primer chiringuito",description:"DESC #7",fileName:"IMG-20220502-WA0040.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"TODO: CHIRINGUITO ",date:"Monday, 2 May 2022, 21:49"},{id:8,name:"Vivir Fuengirola",description:"DESC #8",fileName:"IMG_0315.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.6986,-4.4498",date:"Saturday, 14 May 2022, 20:14"},{id:9,name:"Estreno casa fuengirola",description:"DESC #9",fileName:"IMG_0329.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.543,-4.6214",date:"Sunday, 15 May 2022, 14:24"},{id:10,name:"Primer garito fuengirola",description:"DESC #10",fileName:"IMG_0338.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5428083,-4.6216944",date:"Sunday, 15 May 2022, 15:10"},{id:11,name:"Primer d\xEDa Myramar",description:"DESC #11",fileName:"IMG_0580.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5284,-4.6314",date:"Wednesday, 18 May 2022, 20:50"},{id:12,name:"Los cari\xF1os de Urkote",description:"DESC #12",fileName:"IMG_0637.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.554,-4.622",date:"Friday, 20 May 2022, 17:13"},{id:13,name:"\xA1Anda! \xA1Que hay un toro!",description:"DESC #13",fileName:"IMG_0695.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5607,-4.6098",date:"Friday, 20 May 2022, 17:13"},{id:14,name:"Paseo por la playa",description:"DESC #14",fileName:"IMG_0755.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5269,-4.626",date:"Sunday, 22 May 2022, 20:51"},{id:15,name:"Vaya elementos",description:"DESC #15",fileName:"IMG_0823.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.564,-4.6011",date:"Tuesday, 24 May 2022, 20:06"},{id:16,name:"Ben\xE1mdadena de la mano",description:"DESC #16",fileName:"IMG_1167.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5879,-4.5802",date:"Saturday, 28 May 2022, 18:24"},{id:17,name:"Bonitos paseos",description:"DESC #17",fileName:"IMG_1412.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5429,-4.6215",date:"Saturday, 4 June 2022, 21:58"},{id:18,name:"El Gecko",description:"DESC #18",fileName:"IMG_1494.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5744,-4.5842",date:"Sunday, 5 June 2022, 18:19"},{id:19,name:"Piscina post-operaci\xF3n",description:"DESC #19",fileName:"81C57173-CF3C-4BAF-85A3-EEEDE7917AC6.JPG",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5537396,-4.6219774",date:"Saturday, 18 June 2022, 19:09"},{id:20,name:"Besitos en la nueva casita, un rato sin collar\xEDn",description:"DESC #20",fileName:"IMG_3867.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5557,-4.6152",date:"Wednesday, 27 July 2022, 18:42"},{id:21,name:"Bye bye collar\xEDn",description:"DESC #21",fileName:"81e9de42-26ef-47ae-867f-a0f3aaa40f43.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5557,-4.6152",date:"Wednesday, 3 August 2022, 19:09"},{id:22,name:"Ba\xF1adores y piscinita",description:"DESC #22",fileName:"e5f3c6c2-3645-491c-9174-ba67b6abafd9.jpg",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"TODO: PLAYA",date:"Friday, 5 August 2022, 14:08"},{id:23,name:"Makati - primera cenita",description:"DESC #23",fileName:"IMG_4225.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5476583,-4.6165528",date:"Saturday, 6 August 2022, 22:36"},{id:24,name:"Primer d\xEDa en M\xE1laga capital",description:"DESC #24",fileName:"IMG_4352.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.7214,-4.4171",date:"Thursday, 11 August 2022, 20:01"},{id:25,name:"Pre-viaje a Granada",description:"DESC #25",fileName:"IMG_5035.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.7128,-4.4327",date:"Monday, 5 September 2022, 09:39"},{id:26,name:"Granada juntos",description:"DESC #26",fileName:"IMG_5120.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"37.1774,-3.5893",date:"Monday, 5 September 2022, 17:57"},{id:27,name:"Noches bonitas de la mano",description:"DESC #27",fileName:"IMG_6569.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5807306,-4.5573361",date:"Friday, 21 October 2022, 21:26"},{id:28,name:"Halloween",description:"DESC #28",fileName:"IMG_6864.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5557,-4.6151",date:"Monday, 31 October 2022, 21:20"},{id:29,name:"Noches de juegos y mimos",description:"DESC #29",fileName:"IMG_7245.HEIC",driveId:"1IUfo4XDSIuHZhVaXgyK1khvD5x2GqauI",location:"36.5555611,-4.6151833",date:"Sunday, 13 November 2022, 00:32"}],MN="https://drive.google.com/thumbnail?id=",kN={latitude:40.132527,longitude:-4.114423,zoom:5.5,pitch:0,bearing:0,dragRotate:!1};function LN(){const t=[new Tv({id:"images-layer",data:CN.map(({location:e,...n})=>({...n,coordinates:e.split(",").map(Number)})),getIcon:e=>({url:MN+e.driveId,width:128,height:128,anchorY:128,mask:!0})})];return ru(K5,{initialViewState:kN,controller:!0,layers:t,children:ru(Sv,{reuseMaps:!0,mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",mapLib:J5})})}N_.createRoot(document.getElementById("root")).render(ru(pP.StrictMode,{children:ru(LN,{})}));export{KI as c};
